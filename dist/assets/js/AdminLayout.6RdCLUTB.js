import{R as e,j as a,r as s,u as r,g as t,O as n}from"./react-vendor.BQ9wcLSU.js";import{u as l}from"./useAuth.BFXRZAYD.js";import{u as i}from"./useTheme.CGN4hm2q.js";import{u as o,a as d}from"./useTasks.CxrSvweo.js";import{LayoutDashboard as c,LucideUsers as m,ListTodo as g,CheckCircle as x,LucideMegaphone as u,FileText as h,LucideSettings as b,ChevronLeft as p,LucidePlus as f,LucideUser as y,LucideUserCog as v,LucideSun as j,LucideMoon as k,HelpCircle as w,LogOut as N,LucideMenu as C,Calendar as L,AlertTriangle as T}from"./icons.B5_ZQj31.js";import{L as S}from"./LoadingScreen.DY9CiPqQ.js";import"./charts.DuHk9BWv.js";import"./vendor.Vy3uO1vB.js";import"./index.u2ZZMBhh.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.ClmuHuJk.js";import"./supabase-vendor.nnmAzafq.js";import"./dataCache.DP4PyhNH.js";import"./authErrors.BDay5vyW.js";import"./telegram.service.CKSqE0Xu.js";import"./dateUtils.8XYiGfWV.js";const M=e.memo((function({icon:e,label:s,isActive:r,onClick:t,badge:n,isCollapsed:l=!1}){return l?a.jsxs("button",{onClick:t,className:`\n          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform\n          ${r?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n          focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n        `,title:s,"aria-label":s,children:[a.jsx(e,{className:"w-5 h-5 "+(r?"text-blue-600 dark:text-blue-400":"")}),void 0!==n&&a.jsx("span",{className:`\n            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full\n            ${r?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}\n            transform -translate-y-1 translate-x-1\n          `,children:n>99?"99+":n})]}):a.jsxs("button",{onClick:t,className:`\n        w-full flex items-center justify-between rounded-lg py-2.5 px-3 transition-all duration-200 will-change-transform\n        ${r?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n        focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n      `,"aria-label":s,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(e,{className:"w-5 h-5 "+(r?"text-blue-600 dark:text-blue-400":"")}),a.jsx("span",{className:"text-sm font-medium",children:s})]}),void 0!==n&&a.jsx("span",{className:`\n          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full\n          ${r?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}\n        `,children:n>99?"99+":n})]})})),U=e.memo((function({activeTab:e,onTabChange:r,onLogout:t,onCollapse:n,isSectionAdmin:o=!1,onCreateTask:d,isOpen:C,onClose:L}){const[T,S]=s.useState(!1),{isDark:U,toggle:E}=i(),{user:A}=l(),[z,D]=s.useState(""),[O,$]=s.useState(!1);s.useEffect((()=>{const e=()=>{window.innerWidth>=1024&&C&&L()};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[C,L]),s.useEffect((()=>{const e=()=>{D((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};e();const a=setInterval(e,6e4);return()=>clearInterval(a)}),[]),s.useEffect((()=>{const e=e=>{const a=e.target;O&&!a.closest(".profile-menu-container")&&$(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[O]);const I=s.useMemo((()=>[{id:"dashboard",label:"Dashboard",icon:c},{id:"users",label:"Users",icon:m,badge:147},{id:"tasks",label:"Tasks (Legacy)",icon:g,badge:56},{id:"task-management-v2",label:"Task Management",icon:x,badge:null}]),[]),_=s.useMemo((()=>[{id:"announcements",label:"Announcements",icon:u},{id:"lecture-slides",label:"Lecture Slides",icon:h}]),[]),P=s.useMemo((()=>o?_.filter((e=>["announcements","lecture-slides"].includes(e.id))):_),[_,o]);s.useCallback((()=>{setIsMobileMenuOpen((e=>!e)),$(!1)}),[]),s.useCallback((()=>{setIsMobileMenuOpen(!1)}),[]);const F=s.useCallback((e=>{r(e),L(),$(!1)}),[r,L]),R=s.useCallback((()=>{S((e=>{const a=!e;return n&&n(a),a})),$(!1)}),[n]),V=s.useCallback((()=>{E()}),[E]),q=s.useCallback((()=>{$((e=>!e))}),[]),H=s.useCallback((()=>{$(!1),t()}),[t]);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-gray-900/50 z-[25] lg:hidden backdrop-blur-sm transition-opacity duration-300 ease-in-out "+(C?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),onClick:L,"aria-hidden":"true"}),a.jsx("aside",{className:`\n        fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800\n        transform transition-all duration-300 ease-in-out z-40 shadow-2xl lg:shadow-none will-change-transform\n        ${C?"translate-x-0":"-translate-x-full"}\n        ${T?"w-20":"w-64"}\n        lg:relative lg:translate-x-0\n      `,children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:`h-[72px] px-4 pl-5 border-b border-gray-200 dark:border-gray-800 flex ${T?"justify-center":"justify-between"} items-center shrink-0`,children:[!T&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:a.jsx(b,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white leading-none tracking-tight",children:"NestTask"}),a.jsx("span",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 mt-0.5",children:o?"Section Panel":"Admin Panel"})]})]}),T&&a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:a.jsx(b,{className:"w-5 h-5 text-white"})}),a.jsx("button",{onClick:R,className:"hidden lg:flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":T?"Expand sidebar":"Collapse sidebar",children:a.jsx(p,{className:"w-4 h-4 text-gray-600 dark:text-gray-400 transition-transform "+(T?"rotate-180":"")})})]}),a.jsxs("div",{className:"flex-1 py-4 px-3 overflow-y-auto",children:[!T&&a.jsx("div",{className:"mb-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Main"})}),a.jsx("nav",{className:"space-y-1",children:I.map((s=>a.jsx(M,{icon:s.icon,label:s.label,isActive:e===s.id,onClick:()=>F(s.id),badge:s.badge,isCollapsed:T},s.id)))}),!T&&a.jsx("div",{className:"my-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Management"})}),T&&a.jsx("div",{className:"my-3 border-t border-gray-200 dark:border-gray-800 mx-2"}),a.jsx("nav",{className:"space-y-1",children:P.map((s=>a.jsx(M,{icon:s.icon,label:s.label,isActive:e===s.id,onClick:()=>F(s.id),isCollapsed:T},s.id)))}),!T&&a.jsx("div",{className:"mt-6 mx-2",children:a.jsxs("button",{className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors shadow-sm",onClick:()=>{d&&d(),F("task-management-v2")},children:[a.jsx(f,{className:"w-4 h-4"}),a.jsx("span",{children:"Create Task"})]})}),T&&a.jsx("div",{className:"mt-6 flex justify-center",children:a.jsx("button",{className:"w-10 h-10 flex items-center justify-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg transition-colors shadow-sm",onClick:()=>{d&&d(),F("task-management-v2")},"aria-label":"Create Task",children:a.jsx(f,{className:"w-5 h-5"})})})]}),a.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-800 relative profile-menu-container",children:[T?a.jsx("button",{onClick:q,className:"w-full flex justify-center group",children:a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-200 dark:group-hover:ring-blue-900 transition-all",children:(null==A?void 0:A.avatar)?a.jsx("img",{src:A.avatar,alt:A.name,className:"w-full h-full object-cover"}):a.jsx(y,{className:"w-5 h-5 text-white"})})}):a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("button",{onClick:q,className:"flex items-center gap-2.5 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors w-full group",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==A?void 0:A.avatar)?a.jsx("img",{src:A.avatar,alt:A.name,className:"w-full h-full object-cover"}):a.jsx(y,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate w-full group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(null==A?void 0:A.name)||"User"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-full",children:(null==A?void 0:A.email)||"Loading..."})]}),a.jsx(p,{className:`w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform rotate-90 ${O?"rotate-[270deg]":""} group-hover:text-blue-600 dark:group-hover:text-blue-400`})]})}),O&&a.jsxs("div",{className:`\n                absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50\n                ${T?"left-full ml-2 bottom-auto top-0":""}\n              `,children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==A?void 0:A.avatar)?a.jsx("img",{src:A.avatar,alt:A.name,className:"w-full h-full object-cover"}):a.jsx(y,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:(null==A?void 0:A.name)||"User"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(null==A?void 0:A.email)||"Loading..."})]})]})}),a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>F("profile"),children:[a.jsx(v,{className:"w-4 h-4"}),a.jsx("span",{children:"Profile Settings"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:V,children:[U?a.jsx(j,{className:"w-4 h-4"}):a.jsx(k,{className:"w-4 h-4"}),a.jsx("span",{children:U?"Light Mode":"Dark Mode"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>window.open("/help","_blank"),children:[a.jsx(w,{className:"w-4 h-4"}),a.jsx("span",{children:"Help Center"})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:H,children:[a.jsx(N,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})]})]})]})})]})}));function E(){var e,c;const m=r(),g=t(),{user:x,logout:u,loading:h}=l(),[b]=s.useState(null),[p,w]=s.useState(!1),[M,E]=s.useState(!1),{users:A,deleteUser:z,refreshUsers:D,loading:O}=o(),{tasks:$,createTask:I,updateTask:_,deleteTask:P,refreshTasks:F,loading:R}=d(null==x?void 0:x.id),V="section_admin"===(null==x?void 0:x.role),q=null==x?void 0:x.sectionId,H=null==x?void 0:x.sectionName,{isDark:W,toggle:B}=i(),[G,J]=s.useState(!1),K=s.useRef(null);s.useEffect((()=>{const e=e=>{K.current&&!K.current.contains(e.target)&&J(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),s.useEffect((()=>{h||(x?"admin"===x.role||"super-admin"===x.role||"section_admin"===x.role?"super-admin"!==x.role||"/admin"!==g.pathname&&"/admin/"!==g.pathname?"admin"!==x.role&&"section_admin"!==x.role||"/admin"!==g.pathname&&"/admin/"!==g.pathname||m("/admin/dashboard",{replace:!0}):m("/superadmin/dashboard",{replace:!0}):m("/",{replace:!0}):m("/auth",{replace:!0}))}),[x,m,g.pathname,h]);const Q=(()=>{const e=g.pathname;return e.includes("/admin/users")?"users":e.includes("/admin/tasks")?"tasks":e.includes("/admin/task-management")?"task-management-v2":e.includes("/admin/announcements")?"announcements":e.includes("/admin/lecture-slides")?"lecture-slides":e.includes("/admin/super-admin")?"super-admin":"dashboard"})(),X=s.useCallback((e=>{m({dashboard:"/admin/dashboard",users:"/admin/users",tasks:"/admin/tasks","task-management-v2":"/admin/task-management",announcements:"/admin/announcements","lecture-slides":"/admin/lecture-slides","super-admin":"/admin/super-admin"}[e])}),[m]),Y=s.useCallback((()=>{m("/admin/task-management"),setTimeout((()=>{w(!0)}),150)}),[m]);return!x||"admin"!==x.role&&"super-admin"!==x.role&&"section_admin"!==x.role?a.jsx(S,{minimumLoadTime:300}):a.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[a.jsx(U,{activeTab:Q,onTabChange:X,onLogout:u,isSectionAdmin:V,onCreateTask:Y,isOpen:M,onClose:()=>E(!1)}),a.jsx("main",{className:"flex-1 flex flex-col overflow-hidden w-full min-w-0 bg-gray-50 dark:bg-gray-900",children:a.jsxs("div",{className:"h-full overflow-y-auto",children:[a.jsxs("header",{className:"h-[72px] bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-8 sticky top-0 z-20 flex items-center justify-between gap-4 transition-all duration-200 ease-in-out",children:[a.jsxs("div",{className:"flex items-center gap-3 md:gap-4 min-w-0 overflow-hidden",children:[a.jsx("button",{onClick:()=>E(!0),className:"lg:hidden -ml-2 p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Open sidebar",children:a.jsx(C,{className:"w-6 h-6"})}),a.jsxs("h1",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white leading-none tracking-tight truncate",children:["dashboard"===Q&&"Overview","users"===Q&&"User Management","tasks"===Q&&"Legacy Tasks","task-management-v2"===Q&&"Task Management","announcements"===Q&&"Announcements","lecture-slides"===Q&&"Lecture Slides","super-admin"===Q&&"Super Admin"]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"hidden lg:block h-8 w-px bg-gray-200 dark:bg-gray-800 mx-2"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"hidden lg:flex flex-col items-end mr-1",children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:[a.jsx(L,{className:"w-3 h-3"}),a.jsx("span",{children:"Today"})]}),a.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200",children:(new Date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),a.jsxs("div",{className:"relative",ref:K,children:[a.jsxs("button",{onClick:()=>J(!G),className:"flex items-center gap-3 pl-3 pr-1 py-1 rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border border-transparent hover:border-gray-200 dark:hover:border-gray-700 group",children:[a.jsxs("div",{className:"flex flex-col items-end hidden md:flex",children:[a.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(null==(e=null==x?void 0:x.name)?void 0:e.split(" ")[0])||"User"}),a.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 capitalize",children:(null==(c=null==x?void 0:x.role)?void 0:c.replace("_"," "))||"Admin"})]}),a.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-100 dark:group-hover:ring-blue-900 transition-all",children:(null==x?void 0:x.avatar)?a.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover"}):a.jsx(y,{className:"w-4 h-4 text-white"})})]}),G&&a.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50 transform origin-top-right transition-all",children:[a.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:null==x?void 0:x.name}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:null==x?void 0:x.email})]}),a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:()=>{X("users"),J(!1)},children:[a.jsx(v,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{children:"Profile Settings"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:B,children:[W?a.jsx(j,{className:"w-4 h-4 text-gray-400"}):a.jsx(k,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{children:W?"Light Mode":"Dark Mode"})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{J(!1),u()},children:[a.jsx(N,{className:"w-4 h-4"}),a.jsx("span",{children:"Sign Out"})]})]})]})]})]})]})]}),a.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-full overflow-x-hidden",children:[b&&a.jsxs("div",{className:"mb-4 p-3 flex items-center gap-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm",children:[a.jsx(T,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{children:b})]}),a.jsx("div",{className:"space-y-4 sm:space-y-6",children:a.jsx(n,{context:{users:A,tasks:$,isSectionAdmin:V,sectionId:q,sectionName:H,deleteUser:z,refreshUsers:D,refreshTasks:F,onCreateTask:I,onDeleteTask:P,onUpdateTask:_,openTaskFormV2:p,setOpenTaskFormV2:w,usersLoading:O,tasksLoading:R}})})]})]})}),a.jsx("button",{onClick:Y,className:"lg:hidden fixed bottom-20 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-40 active:scale-95","aria-label":"Create Task",children:a.jsx(f,{className:"w-6 h-6"})})]})}export{E as AdminLayout};
