import{R as z,j as e,r as s,u as Y,a as Z,O as ee}from"./index.DH8OjaYb.js";import{u as V}from"./useAuth.BZmpKqmI.js";import{u as W,S as F,a as q,M as G,L as J}from"./sun.D0rUoR21.js";import{u as ae,a as te}from"./useTasks.CIPKgF8B.js";import{L as re,M as se}from"./menu.CoCNzTcZ.js";import{U as ne}from"./users.BroXXEug.js";import{L as le}from"./list-todo.BhngatHR.js";import{C as ie}from"./check-circle.Bl3rG41L.js";import{M as oe}from"./megaphone.D6f-7XIn.js";import{F as de}from"./file-text.DUgHKSpl.js";import{B as ce}from"./bell.B2sKJ7UF.js";import{C as H}from"./chevron-left.M3GNcqXe.js";import{P}from"./plus.DpdvfjPj.js";import{U}from"./user.BgVdbwT_.js";import{U as K,H as me}from"./user-cog.Di6CXWR8.js";import{L as ge}from"./LoadingScreen.DdeK7KNC.js";import{A as ue}from"./alert-triangle.BvynwjKk.js";import"./dataCache.CcjqYMC_.js";import"./authErrors.D8KAnYp0.js";import"./createLucideIcon.D43xn0Oz.js";import"./telegram.service.B5vX6-Oo.js";import"./dateUtils.CaLFIf6y.js";const B=z.memo(function({icon:l,label:i,isActive:a,onClick:m,badge:o,isCollapsed:g=!1}){return g?e.jsxs("button",{onClick:m,className:`
          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform
          ${a?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}
          focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50
        `,title:i,"aria-label":i,children:[e.jsx(l,{className:`w-5 h-5 ${a?"text-blue-600 dark:text-blue-400":""}`}),o!==void 0&&e.jsx("span",{className:`
            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full
            ${a?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}
            transform -translate-y-1 translate-x-1
          `,children:o>99?"99+":o})]}):e.jsxs("button",{onClick:m,className:`
        w-full flex items-center justify-between rounded-lg py-2.5 px-3 transition-all duration-200 will-change-transform
        ${a?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}
        focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50
      `,"aria-label":i,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:`w-5 h-5 ${a?"text-blue-600 dark:text-blue-400":""}`}),e.jsx("span",{className:"text-sm font-medium",children:i})]}),o!==void 0&&e.jsx("span",{className:`
          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full
          ${a?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}
        `,children:o>99?"99+":o})]})}),xe=z.memo(function({activeTab:l,onTabChange:i,onLogout:a,onCollapse:m,isSectionAdmin:o=!1,onCreateTask:g,isOpen:b,onClose:u}){const[n,N]=s.useState(!1),{isDark:k,toggle:j}=W(),{user:r}=V(),[E,C]=s.useState(""),[p,x]=s.useState(!1);s.useEffect(()=>{const t=()=>{window.innerWidth>=1024&&b&&u()};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[b,u]),s.useEffect(()=>{const t=()=>{C(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};t();const c=setInterval(t,6e4);return()=>clearInterval(c)},[]),s.useEffect(()=>{const t=c=>{const w=c.target;p&&!w.closest(".profile-menu-container")&&x(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[p]);const L=s.useMemo(()=>[{id:"dashboard",label:"Dashboard",icon:re},{id:"users",label:"Users",icon:ne,badge:147},{id:"tasks",label:"Tasks (Legacy)",icon:le,badge:56},{id:"task-management-v2",label:"Task Management",icon:ie,badge:null}],[]),y=s.useMemo(()=>[{id:"announcements",label:"Announcements",icon:oe},{id:"lecture-slides",label:"Lecture Slides",icon:de},{id:"fcm-management",label:"Push Notifications",icon:ce}],[]),M=s.useMemo(()=>o?y.filter(t=>["announcements","lecture-slides","fcm-management"].includes(t.id)):y,[y,o]);s.useCallback(()=>{setIsMobileMenuOpen(t=>!t),x(!1)},[]),s.useCallback(()=>{setIsMobileMenuOpen(!1)},[]);const h=s.useCallback(t=>{i(t),u(),x(!1)},[i,u]),T=s.useCallback(()=>{N(t=>{const c=!t;return m&&m(c),c}),x(!1)},[m]),S=s.useCallback(()=>{j()},[j]),v=s.useCallback(()=>{x(t=>!t)},[]),$=s.useCallback(()=>{x(!1),a()},[a]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 bg-gray-900/50 z-[25] lg:hidden backdrop-blur-sm transition-opacity duration-300 ease-in-out ${b?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:u,"aria-hidden":"true"}),e.jsxs("aside",{className:`
        fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800
        transform transition-all duration-300 ease-in-out z-40 shadow-2xl lg:shadow-none will-change-transform
        ${b?"translate-x-0":"-translate-x-full"}
        ${n?"w-20":"w-64"}
        lg:relative lg:translate-x-0
      `,children:[e.jsx("button",{onClick:T,className:"hidden lg:flex items-center justify-center w-7 h-7 rounded-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-blue-500 dark:hover:border-blue-500 transition-all shadow-md absolute top-[32px] -right-3.5 z-50","aria-label":n?"Expand sidebar":"Collapse sidebar",children:e.jsx(H,{className:`w-4 h-4 text-gray-600 dark:text-gray-400 transition-transform ${n?"rotate-180":""}`})}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`h-[72px] px-4 pl-5 border-b border-gray-200 dark:border-gray-800 flex ${n?"justify-center":"justify-start"} items-center shrink-0`,children:[!n&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:e.jsx(F,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white leading-none tracking-tight",children:"NestTask"}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 mt-0.5",children:o?"Section Panel":"Admin Panel"})]})]}),n&&e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:e.jsx(F,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 py-4 px-3 overflow-y-auto",children:[!n&&e.jsx("div",{className:"mb-3 px-2",children:e.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Main"})}),e.jsx("nav",{className:"space-y-1",children:L.map(t=>e.jsx(B,{icon:t.icon,label:t.label,isActive:l===t.id,onClick:()=>h(t.id),badge:t.badge,isCollapsed:n},t.id))}),!n&&e.jsx("div",{className:"my-3 px-2",children:e.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Management"})}),n&&e.jsx("div",{className:"my-3 border-t border-gray-200 dark:border-gray-800 mx-2"}),e.jsx("nav",{className:"space-y-1",children:M.map(t=>e.jsx(B,{icon:t.icon,label:t.label,isActive:l===t.id,onClick:()=>h(t.id),isCollapsed:n},t.id))}),!n&&e.jsx("div",{className:"mt-6 mx-2",children:e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors shadow-sm",onClick:()=>{g&&g(),h("task-management-v2")},children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Task"})]})}),n&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{className:"w-10 h-10 flex items-center justify-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg transition-colors shadow-sm",onClick:()=>{g&&g(),h("task-management-v2")},"aria-label":"Create Task",children:e.jsx(P,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-800 relative profile-menu-container",children:[n?e.jsx("button",{onClick:v,className:"w-full flex justify-center group",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-200 dark:group-hover:ring-blue-900 transition-all",children:r!=null&&r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-5 h-5 text-white"})})}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:v,className:"flex items-center gap-2.5 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors w-full group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:r!=null&&r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate w-full group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(r==null?void 0:r.name)||"User"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-full",children:(r==null?void 0:r.email)||"Loading..."})]}),e.jsx(H,{className:`w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform rotate-90 ${p?"rotate-[270deg]":""} group-hover:text-blue-600 dark:group-hover:text-blue-400`})]})}),p&&e.jsxs("div",{className:`
                absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50
                ${n?"left-full ml-2 bottom-auto top-0":""}
              `,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:r!=null&&r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:(r==null?void 0:r.name)||"User"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(r==null?void 0:r.email)||"Loading..."})]})]})}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("profile"),children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Profile Settings"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:S,children:[k?e.jsx(q,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:k?"Light Mode":"Dark Mode"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>window.open("/help","_blank"),children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Help Center"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:$,children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]})]})]})]})]})]})]})}),Ie=z.memo(function(){var A,R;const l=Y(),i=Z(),{user:a,logout:m,loading:o}=V(),[g]=s.useState(null),[b,u]=s.useState(!1),[n,N]=s.useState(!1),{users:k,deleteUser:j,refreshUsers:r,loading:E}=ae(),{tasks:C,createTask:p,updateTask:x,deleteTask:L,refreshTasks:y,loading:M}=te(a==null?void 0:a.id),h=(a==null?void 0:a.role)==="section_admin",T=a==null?void 0:a.sectionId,S=a==null?void 0:a.sectionName,{isDark:v,toggle:$}=W(),[t,c]=s.useState(!1),w=s.useRef(null);s.useEffect(()=>{const d=_=>{w.current&&!w.current.contains(_.target)&&c(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]),s.useEffect(()=>{if(o)return;if(!a){l("/auth",{replace:!0});return}if(!(a.role==="admin"||a.role==="super-admin"||a.role==="section_admin")){l("/",{replace:!0});return}if(a.role==="super-admin"&&(i.pathname==="/admin"||i.pathname==="/admin/")){l("/superadmin/dashboard",{replace:!0});return}(a.role==="admin"||a.role==="section_admin")&&(i.pathname==="/admin"||i.pathname==="/admin/")&&l("/admin/dashboard",{replace:!0})},[a,l,i.pathname,o]);const Q=()=>{const d=i.pathname;return d.includes("/admin/users")?"users":d.includes("/admin/tasks")?"tasks":d.includes("/admin/task-management")?"task-management-v2":d.includes("/admin/announcements")?"announcements":d.includes("/admin/lecture-slides")?"lecture-slides":d.includes("/admin/fcm-management")?"fcm-management":d.includes("/admin/super-admin")?"super-admin":"dashboard"},f=s.useMemo(()=>Q(),[i.pathname]);s.useMemo(()=>new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),[]);const X=s.useMemo(()=>({users:k,tasks:C,isSectionAdmin:h,sectionId:T,sectionName:S,deleteUser:j,refreshUsers:r,refreshTasks:y,onCreateTask:p,onDeleteTask:L,onUpdateTask:x,openTaskFormV2:b,setOpenTaskFormV2:u,usersLoading:E,tasksLoading:M}),[k,C,h,T,S,j,r,y,p,L,x,b,u,E,M]),D=s.useCallback(d=>{l({dashboard:"/admin/dashboard",users:"/admin/users",tasks:"/admin/tasks","task-management-v2":"/admin/task-management",announcements:"/admin/announcements","lecture-slides":"/admin/lecture-slides","fcm-management":"/admin/fcm-management","super-admin":"/admin/super-admin"}[d])},[l]),I=s.useCallback(()=>{l("/admin/task-management"),setTimeout(()=>{u(!0)},150)},[l]);return!a||a.role!=="admin"&&a.role!=="super-admin"&&a.role!=="section_admin"?e.jsx(ge,{minimumLoadTime:300}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsx(xe,{activeTab:f,onTabChange:D,onLogout:m,isSectionAdmin:h,onCreateTask:I,isOpen:n,onClose:()=>N(!1)}),e.jsx("main",{className:"flex-1 flex flex-col overflow-hidden w-full min-w-0 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"h-full overflow-y-auto",children:[e.jsxs("header",{className:"h-[72px] bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-8 sticky top-0 z-20 flex items-center justify-between gap-4 transition-all duration-200 ease-in-out",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 min-w-0 overflow-hidden",children:[e.jsx("button",{onClick:()=>N(!0),className:"lg:hidden -ml-2 p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Open sidebar",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsxs("h1",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white leading-none tracking-tight truncate",children:[f==="dashboard"&&"Overview",f==="users"&&"User Management",f==="tasks"&&"Legacy Tasks",f==="task-management-v2"&&"Task Management",f==="announcements"&&"Announcements",f==="lecture-slides"&&"Lecture Slides",f==="super-admin"&&"Super Admin"]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative",ref:w,children:[e.jsxs("button",{onClick:()=>c(!t),className:"flex items-center gap-3 pl-3 pr-1 py-1 rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border border-transparent hover:border-gray-200 dark:hover:border-gray-700 group",children:[e.jsxs("div",{className:"flex flex-col items-end hidden md:flex",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:((A=a==null?void 0:a.name)==null?void 0:A.split(" ")[0])||"User"}),e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 capitalize",children:((R=a==null?void 0:a.role)==null?void 0:R.replace("_"," "))||"Admin"})]}),e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-100 dark:group-hover:ring-blue-900 transition-all",children:a!=null&&a.avatar?e.jsx("img",{src:a.avatar,alt:a.name,className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-4 h-4 text-white"})})]}),t&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50 transform origin-top-right transition-all",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a==null?void 0:a.email})]}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:()=>{D("users"),c(!1)},children:[e.jsx(K,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:"Profile Settings"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:$,children:[v?e.jsx(q,{className:"w-4 h-4 text-gray-400"}):e.jsx(G,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:v?"Light Mode":"Dark Mode"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{c(!1),m()},children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Sign Out"})]})]})]})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-full overflow-x-hidden",children:[g&&e.jsxs("div",{className:"mb-4 p-3 flex items-center gap-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm",children:[e.jsx(ue,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:g})]}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:e.jsx(ee,{context:X})})]})]})}),e.jsx("button",{onClick:I,className:"lg:hidden fixed bottom-20 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-40 active:scale-95","aria-label":"Create Task",children:e.jsx(P,{className:"w-6 h-6"})})]})});export{Ie as AdminLayout};
