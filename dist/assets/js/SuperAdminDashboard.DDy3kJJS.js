import{r as e,j as a}from"./react-vendor.CJcloKvn.js";import{LucideX as t,LucideSave as r,EyeOff as s,Eye as d,Key as i,LucideUserPlus as n,CheckCircle as l,Filter as o,LucideSearch as c,LucidePlus as m,LucideRefreshCw as x,Info as g,ArrowUpNarrowWide as u,ArrowDownWideNarrow as h,ArrowUpDown as b,AlertTriangle as p,Check as y,LucideShield as f,Edit as w,LucideTrash2 as j,HelpCircle as k,ArrowUpRight as v,ArrowDownRight as N,Activity as S,LucideUserCheck as C,ChevronDown as A,ChevronUp as _,LucideUsers as M,LucideUserX as D,LucidePieChart as P,Building as F,BarChart as U,Download as E,Clock as T,CalendarClock as L,ArrowDownAZ as I,ArrowUpAZ as $,LucideUser as R,Copy as z,BookOpen as q,Layers as O,LucidePlusCircle as B,Loader as G,LucideXCircle as W,ChevronLeft as V,ChevronRight as H,BarChart2 as Y,FileText as J,LogOut as X,LucideSun as K,LucideMoon as Q}from"./icons.C9QY32ra.js";import{s as Z,a as ee}from"./notifications.BFXTDsYM.js";import{s as ae}from"./index.DDLbf5SO.js";import{u as te,a as re}from"./App.Cn0msJTB.js";import{c as se,d as de,e as ie}from"./AuthPage.CMR-Xtuo.js";import"./charts.Gb_JFp2r.js";import"./supabase.Dq8fQFgD.js";import"./AuthSubmitButton.BE_jUWqm.js";import"./ui-components.DYa2t8c-.js";import"./date-utils.CKfbr2bM.js";import"./ResetPasswordPage.BWrS7ko9.js";function ne({admin:s,onClose:d,onUpdate:i}){const[n,l]=e.useState({username:s.username,email:s.email,role:s.role,department:s.department||"",permissions:s.permissions||[]}),[o,c]=e.useState(!1),[m,x]=e.useState({}),[g,u]=e.useState(["user_manage","user_view","task_manage","task_view","course_manage","course_view","announcement_manage","announcement_view","teacher_manage","teacher_view","routine_manage","routine_view","study_material_manage","study_material_view"]),h=e=>{const{name:a,value:t}=e.target;l((e=>({...e,[a]:t}))),m[a]&&x((e=>({...e,[a]:""})))};return e.useEffect((()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),[]),a.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 flex items-center justify-center",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-xl w-full p-6 shadow-xl border border-gray-200 dark:border-gray-700 max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Edit Admin User"}),a.jsx("button",{onClick:d,className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close",children:a.jsx(t,{className:"h-6 w-6 text-gray-500 dark:text-gray-400"})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{var e,a;const t={};return(null==(e=n.username)?void 0:e.trim())||(t.username="Username is required"),(null==(a=n.email)?void 0:a.trim())?/\S+@\S+\.\S+/.test(n.email)||(t.email="Email is invalid"):t.email="Email is required",x(t),0===Object.keys(t).length})())try{c(!0),await i(s.id,n)}catch(a){}finally{c(!1)}},className:"space-y-5",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Username"}),a.jsx("input",{type:"text",id:"username",name:"username",value:n.username||"",onChange:h,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(m.username?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter username"}),m.username&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.username})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),a.jsx("input",{type:"email",id:"email",name:"email",value:n.email||"",onChange:h,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(m.email?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter email address"}),m.email&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.email})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),a.jsxs("select",{id:"role",name:"role",value:n.role||"admin",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[a.jsx("option",{value:"admin",children:"Admin"}),a.jsx("option",{value:"super-admin",children:"Super Admin"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Department (Optional)"}),a.jsx("input",{type:"text",id:"department",name:"department",value:n.department||"",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter department"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Permissions"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:g.map((e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:`permission-${e}`,checked:(n.permissions||[]).includes(e),onChange:()=>(e=>{l((a=>{const t=a.permissions||[];return{...a,permissions:t.includes(e)?t.filter((a=>a!==e)):[...t,e]}}))})(e),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600"}),a.jsx("label",{htmlFor:`permission-${e}`,className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")})]},e)))})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-3",children:[a.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:o,children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center transition-colors "+(o?"opacity-70 cursor-not-allowed":""),disabled:o,children:o?"Saving...":a.jsxs(a.Fragment,{children:[a.jsx(r,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]})})}function le({admin:r,onClose:n,onResetPassword:l}){const[o,c]=e.useState(""),[m,x]=e.useState(""),[g,u]=e.useState(!1),[h,b]=e.useState({}),[p,y]=e.useState(!1),[f,w]=e.useState(!1),[j,k]=e.useState("");return e.useEffect((()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),[]),a.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 flex items-center justify-center",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-xl border border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Reset Password"}),a.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close",children:a.jsx(t,{className:"h-6 w-6 text-gray-500 dark:text-gray-400"})})]}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-5",children:["You are resetting the password for ",a.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.username})," (",r.email,")."]}),j&&a.jsxs("div",{className:"mb-5 p-3 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300 mb-1",children:"Generated Password"}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("code",{className:"text-indigo-700 dark:text-indigo-300 bg-indigo-100 dark:bg-indigo-800/30 px-2 py-1 rounded font-mono",children:j}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(j)},className:"text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-800/30 text-indigo-700 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-800/50 transition-colors",children:"Copy"})]})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return o?o.length<8&&(e.newPassword="Password must be at least 8 characters"):e.newPassword="New password is required",o!==m&&(e.confirmPassword="Passwords do not match"),b(e),0===Object.keys(e).length})())try{u(!0),await l(r.id,o)}catch(a){}finally{u(!1)}},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:p?"text":"password",id:"newPassword",name:"newPassword",value:o,onChange:e=>{c(e.target.value),h.newPassword&&b({...h,newPassword:""})},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(h.newPassword?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter new password"}),a.jsx("button",{type:"button",onClick:()=>y(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:p?a.jsx(s,{size:18}):a.jsx(d,{size:18})})]}),h.newPassword&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.newPassword})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:f?"text":"password",id:"confirmPassword",name:"confirmPassword",value:m,onChange:e=>{x(e.target.value),h.confirmPassword&&b({...h,confirmPassword:""})},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(h.confirmPassword?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Confirm new password"}),a.jsx("button",{type:"button",onClick:()=>w(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:f?a.jsx(s,{size:18}):a.jsx(d,{size:18})})]}),h.confirmPassword&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.confirmPassword})]}),a.jsx("div",{children:a.jsxs("button",{type:"button",onClick:()=>{const e=(()=>{let e="";for(let a=0;a<12;a++)e+="ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%^&*()-_=+".charAt(Math.floor(68*Math.random()));return e})();c(e),x(e),k(e)},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"Generate Strong Password"]})}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:g,children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors "+(g?"opacity-70 cursor-not-allowed":""),disabled:g,children:g?"Resetting...":"Reset Password"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 pt-2",children:"Note: The admin will need to use this new password for their next login. Consider notifying them securely about the password change."})]})]})})}function oe({permissions:t,loading:r,onCreate:o}){const[c,m]=e.useState({username:"",email:"",role:"admin",status:"active",permissions:[]}),[x,g]=e.useState(""),[u,h]=e.useState(""),[b,p]=e.useState(!1),[y,f]=e.useState({}),[w,j]=e.useState(!1),[k,v]=e.useState(!1),[N,S]=e.useState(!1),C=e=>{const{name:a,value:t}=e.target;m((e=>({...e,[a]:t}))),y[a]&&f((e=>({...e,[a]:""})))};return a.jsxs("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 p-5 shadow-sm",children:[a.jsxs("div",{className:"mb-5 border-b border-gray-200 dark:border-gray-700 pb-4",children:[a.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx(n,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400"}),"Create New Admin User"]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Create a new admin account with specific permissions and access levels."})]}),N&&a.jsxs("div",{className:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-start gap-3",children:[a.jsx(l,{className:"h-5 w-5 text-green-600 dark:text-green-400 shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-green-800 dark:text-green-300",children:"Admin User Created Successfully"}),a.jsx("p",{className:"text-sm text-green-700 dark:text-green-400 mt-1",children:"The admin user has been created and can now log in using the provided credentials."}),a.jsx("button",{onClick:()=>{m({username:"",email:"",role:"admin",status:"active",permissions:[]}),g(""),h(""),f({}),S(!1)},className:"mt-2 text-sm font-medium text-green-700 dark:text-green-300 hover:text-green-800 dark:hover:text-green-200",children:"Create Another Admin"})]})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{var e,a;const t={};return(null==(e=c.username)?void 0:e.trim())||(t.username="Username is required"),(null==(a=c.email)?void 0:a.trim())?/\S+@\S+\.\S+/.test(c.email)||(t.email="Email is invalid"):t.email="Email is required",x?x.length<8&&(t.password="Password must be at least 8 characters"):t.password="Password is required",x!==u&&(t.confirmPassword="Passwords do not match"),f(t),0===Object.keys(t).length})())try{p(!0),await o(c,x)&&(S(!0),m({username:"",email:"",role:"admin",status:"active",permissions:[]}),g(""),h(""),Z("Admin user created successfully"))}catch(a){ee(a.message||"Failed to create admin user")}finally{p(!1)}},className:"space-y-5",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Username ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",id:"username",name:"username",value:c.username,onChange:C,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(y.username?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter admin username",disabled:b}),y.username&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.username})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Email ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"email",id:"email",name:"email",value:c.email,onChange:C,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(y.email?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter admin email",disabled:b}),y.email&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Role ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{id:"role",name:"role",value:c.role,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",disabled:b,children:[a.jsx("option",{value:"admin",children:"Admin"}),a.jsx("option",{value:"super-admin",children:"Super Admin"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Department (Optional)"}),a.jsx("input",{type:"text",id:"department",name:"department",value:c.department||"",onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter department",disabled:b})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Password ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:w?"text":"password",id:"password",name:"password",value:x,onChange:e=>{g(e.target.value),y.password&&f((e=>({...e,password:""}))),y.confirmPassword&&e.target.value===u&&f((e=>({...e,confirmPassword:""})))},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(y.password?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter password",disabled:b}),a.jsx("button",{type:"button",onClick:()=>j(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:w?a.jsx(s,{size:18}):a.jsx(d,{size:18})})]}),y.password&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.password})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Confirm Password ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:k?"text":"password",id:"confirmPassword",name:"confirmPassword",value:u,onChange:e=>{h(e.target.value),y.confirmPassword&&e.target.value===x&&f((e=>({...e,confirmPassword:""})))},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(y.confirmPassword?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Confirm password",disabled:b}),a.jsx("button",{type:"button",onClick:()=>v(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k?a.jsx(s,{size:18}):a.jsx(d,{size:18})})]}),y.confirmPassword&&a.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.confirmPassword})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs("button",{type:"button",onClick:()=>{let e="";for(let a=0;a<12;a++)e+="ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%^&*()-_=+".charAt(Math.floor(68*Math.random()));g(e),h(e),j(!0),(y.password||y.confirmPassword)&&f((e=>({...e,password:"",confirmPassword:""})))},disabled:b,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"Generate Strong Password"]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Permissions"}),a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:["user_manage","user_view","task_manage","task_view","course_manage","course_view","announcement_manage","announcement_view","teacher_manage","teacher_view","routine_manage","routine_view","study_material_manage","study_material_view"].map((e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:`permission-${e}`,checked:(c.permissions||[]).includes(e),onChange:()=>(e=>{m((a=>{const t=a.permissions||[];return{...a,permissions:t.includes(e)?t.filter((a=>a!==e)):[...t,e]}}))})(e),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600",disabled:b}),a.jsx("label",{htmlFor:`permission-${e}`,className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")})]},e)))})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"inline-flex items-center",children:[a.jsx("input",{type:"radio",name:"status",value:"active",checked:"active"===c.status,onChange:C,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",disabled:b}),a.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Active"})]}),a.jsxs("label",{className:"inline-flex items-center",children:[a.jsx("input",{type:"radio",name:"status",value:"disabled",checked:"disabled"===c.status,onChange:C,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",disabled:b}),a.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Disabled"})]})]})]}),a.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end",children:a.jsx("button",{type:"submit",disabled:b,className:"px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow flex items-center "+(b?"opacity-70 cursor-not-allowed":""),children:b?a.jsx(a.Fragment,{children:a.jsx("span",{className:"mr-2",children:"Creating..."})}):a.jsxs(a.Fragment,{children:[a.jsx(n,{className:"h-5 w-5 mr-2"}),"Create Admin User"]})})})]})]})}function ce({content:t}){const[r,s]=e.useState(!1);return a.jsxs("div",{className:"relative inline-block",children:[a.jsx("button",{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:()=>s(!r),className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 focus:outline-none",children:a.jsx(k,{className:"h-4 w-4"})}),r&&a.jsxs("div",{className:"absolute z-50 w-64 p-3 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-300 transform -translate-x-1/2 left-1/2 mt-2",children:[t,a.jsx("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 w-4 h-4 rotate-45 bg-white dark:bg-gray-800 border-t border-l border-gray-200 dark:border-gray-700"})]})]})}function me({admins:r,loading:s,error:d,onCreateAdmin:n,onUpdateAdmin:l,onDeleteAdmin:k,onResetPassword:v,onPromoteToAdmin:N,onRefresh:S}){const[C,A]=e.useState(""),[_,M]=e.useState("username"),[D,P]=e.useState("asc"),[F,U]=e.useState([]),[E,T]=e.useState(null),[L,I]=e.useState(!1),[$,R]=e.useState(!1),[z,q]=e.useState(!1),[O,B]=e.useState(null),[G,W]=e.useState("all"),[V,H]=e.useState("all"),[Y,J]=e.useState(!1),[X,K]=e.useState(!1),[Q,ae]=e.useState({});e.useEffect((()=>{}),[r,s,d]);const te=e.useMemo((()=>[{id:"1",username:"Test User",email:"test@example.com",role:"user",department:"Test Department",permissions:[],status:"active",isActive:!0,createdAt:(new Date).toISOString(),phone:"123-456-7890",studentId:"TEST001"},{id:"2",username:"Test Admin",email:"admin@example.com",role:"admin",department:"Admin Department",permissions:[],status:"active",isActive:!0,createdAt:(new Date).toISOString(),phone:"123-456-7891",studentId:"ADMIN001"},{id:"3",username:"Test Super Admin",email:"superadmin@example.com",role:"super-admin",department:"Super Admin Department",permissions:[],status:"active",isActive:!0,createdAt:(new Date).toISOString(),phone:"123-456-7892",studentId:"SADMIN001"}]),[]);e.useEffect((()=>{if(!r||0===r.length)return void U(te);let e=[...r];if("all"!==G&&(e=e.filter((e=>e.status===G))),"all"!==V&&(e=e.filter((e=>e.role===V))),C){const a=C.toLowerCase();e=e.filter((e=>(e.username||"").toLowerCase().includes(a)||(e.email||"").toLowerCase().includes(a)||(e.department||"").toLowerCase().includes(a)||(e.studentId||"").toLowerCase().includes(a)||(e.phone||"").toLowerCase().includes(a)))}e.sort(((e,a)=>{const t=e[_]||"",r=a[_]||"";return"string"==typeof t&&"string"==typeof r?"asc"===D?t.localeCompare(r):r.localeCompare(t):0})),U(e)}),[r,C,_,D,G,V,te]),e.useEffect((()=>{s||(r&&0!==r.length?U(r||[]):U(te))}),[r,s,te]);const re=e=>{_===e?P("asc"===D?"desc":"asc"):(M(e),P("asc"))};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row gap-3 justify-between items-start md:items-center bg-white dark:bg-gray-750 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("div",{className:"relative inline-block",children:[a.jsxs("select",{value:G,onChange:e=>W(e.target.value),className:"bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 pl-3 pr-10 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"disabled",children:"Disabled"})]}),a.jsx(o,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 pointer-events-none"})]}),a.jsxs("div",{className:"relative inline-block",children:[a.jsxs("select",{value:V,onChange:e=>H(e.target.value),className:"bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 pl-3 pr-10 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[a.jsx("option",{value:"all",children:"All Roles"}),a.jsx("option",{value:"admin",children:"Admin"}),a.jsx("option",{value:"super-admin",children:"Super Admin"}),a.jsx("option",{value:"user",children:"Regular User"})]}),a.jsx(o,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 pointer-events-none"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[a.jsxs("div",{className:"relative flex-1 md:min-w-[250px]",children:[a.jsx("input",{type:"text",placeholder:"Search users...",value:C,onChange:e=>A(e.target.value),className:"w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),C&&a.jsx("button",{onClick:()=>A(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 hover:text-gray-700",children:a.jsx(t,{className:"h-4 w-4"})})]}),a.jsxs("button",{onClick:()=>K(!0),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-1 shrink-0",children:[a.jsx(m,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden md:inline",children:"Create User"})]}),a.jsx("div",{className:"p-2 rounded-lg text-gray-600 dark:text-gray-300 transition-colors",children:a.jsx(ce,{content:"To promote a user to admin, click the shield icon in their actions. The user will need to log out and log back in for the changes to take effect. Only super-admins can promote users."})}),a.jsx("button",{onClick:async()=>{try{J(!0),S&&await S(),A(""),W("all"),H("all")}catch(e){}finally{J(!1)}},disabled:s||Y,className:"p-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-gray-600 dark:text-gray-300 transition-colors",title:"Refresh user list",children:a.jsx(x,{className:"h-4 w-4 "+(Y?"animate-spin":"")})})]})]}),a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/30 rounded-lg p-3 mt-4 flex items-start gap-3",children:[a.jsx(g,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"About Role Management"}),a.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-400 mt-1",children:["When you promote a user to admin, the change is made to their database record. They will need to ",a.jsx("strong",{children:"log out and log back in"}),' for the changes to take effect. Users with the "Relogin Required" tag have been promoted but haven\'t logged in again yet.']})]})]}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden mt-4",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-750",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer",onClick:()=>re("username"),children:a.jsxs("div",{className:"flex items-center gap-1",children:["Name","username"===_&&("asc"===D?a.jsx(u,{className:"h-3 w-3"}):a.jsx(h,{className:"h-3 w-3"})),"username"!==_&&a.jsx(b,{className:"h-3 w-3 text-gray-400"})]})}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer",onClick:()=>re("email"),children:a.jsxs("div",{className:"flex items-center gap-1",children:["Email","email"===_&&("asc"===D?a.jsx(u,{className:"h-3 w-3"}):a.jsx(h,{className:"h-3 w-3"})),"email"!==_&&a.jsx(b,{className:"h-3 w-3 text-gray-400"})]})}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer",onClick:()=>re("role"),children:a.jsxs("div",{className:"flex items-center gap-1",children:["Role","role"===_&&("asc"===D?a.jsx(u,{className:"h-3 w-3"}):a.jsx(h,{className:"h-3 w-3"})),"role"!==_&&a.jsx(b,{className:"h-3 w-3 text-gray-400"})]})}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer",onClick:()=>re("department"),children:a.jsxs("div",{className:"flex items-center gap-1",children:["Department","department"===_&&("asc"===D?a.jsx(u,{className:"h-3 w-3"}):a.jsx(h,{className:"h-3 w-3"})),"department"!==_&&a.jsx(b,{className:"h-3 w-3 text-gray-400"})]})}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer",onClick:()=>re("status"),children:a.jsxs("div",{className:"flex items-center gap-1",children:["Status","status"===_&&("asc"===D?a.jsx(u,{className:"h-3 w-3"}):a.jsx(h,{className:"h-3 w-3"})),"status"!==_&&a.jsx(b,{className:"h-3 w-3 text-gray-400"})]})}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Login"}),a.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:s?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-4 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(x,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Loading users..."})]})})}):d?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-4 py-4 text-center text-sm text-red-500",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(p,{className:"h-4 w-4"}),a.jsx("span",{children:d})]})})}):0===F.length?a.jsx("tr",{children:a.jsxs("td",{colSpan:7,className:"px-4 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:["No users found. ",C&&a.jsx("span",{children:"Try a different search term."})]})}):F.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[a.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.username||"Unnamed",Q[e.id]&&a.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full",children:"Relogin Required"})]})}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.email})}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a.jsx("div",{className:`\n                        px-2 py-1 inline-flex text-xs leading-5 font-medium rounded-full\n                        ${"super-admin"===e.role?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300":"admin"===e.role?"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}\n                      `,children:e.role||"User"})}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.department||"Unassigned"})}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a.jsx("span",{className:`\n                        px-2 py-1 inline-flex text-xs leading-5 font-medium rounded-full\n                        ${"active"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"}\n                      `,children:"active"===e.status?"Active":"Disabled"})}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.lastLogin?new Date(e.lastLogin).toLocaleDateString():"Never"}),a.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{onClick:()=>(async e=>{try{const a="active"===e.status?"disabled":"active";await l(e.id,{status:a}),Z(`Admin ${"active"===a?"activated":"disabled"} successfully`)}catch(a){ee(a.message||"Failed to update admin status")}})(e),disabled:"super-admin"===e.role,className:`\n                            p-1.5 rounded-lg transition-colors\n                            ${"active"===e.status?"bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/10 dark:text-red-400 dark:hover:bg-red-900/20":"bg-green-50 text-green-600 hover:bg-green-100 dark:bg-green-900/10 dark:text-green-400 dark:hover:bg-green-900/20"}\n                            ${"super-admin"===e.role?"opacity-50 cursor-not-allowed":""}\n                          `,title:"active"===e.status?"Disable account":"Activate account",children:"active"===e.status?a.jsx(t,{className:"h-4 w-4"}):a.jsx(y,{className:"h-4 w-4"})}),"user"===e.role&&N&&a.jsx("button",{onClick:()=>(async e=>{if(N)try{await N(e.id),ae((a=>({...a,[e.id]:!0}))),Z(`${e.username} has been promoted to admin. They will need to log out and log back in for the changes to take effect.`)}catch(a){ee(a.message||"Failed to promote user to admin")}})(e),className:"p-1.5 bg-purple-50 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors dark:bg-purple-900/10 dark:text-purple-400 dark:hover:bg-purple-900/20",title:"Promote to Admin",children:a.jsx(f,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>(e=>{T(e),I(!0)})(e),className:"p-1.5 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors dark:bg-blue-900/10 dark:text-blue-400 dark:hover:bg-blue-900/20",title:"Edit user",children:a.jsx(w,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>(e=>{T(e),R(!0)})(e),className:"p-1.5 bg-yellow-50 text-yellow-600 hover:bg-yellow-100 rounded-lg transition-colors dark:bg-yellow-900/10 dark:text-yellow-400 dark:hover:bg-yellow-900/20",title:"Reset password",children:a.jsx(i,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>(e=>{T(e),q(!0)})(e),disabled:"super-admin"===e.role,className:`\n                            p-1.5 bg-red-50 text-red-600 hover:bg-red-100 rounded-lg transition-colors dark:bg-red-900/10 dark:text-red-400 dark:hover:bg-red-900/20\n                            ${"super-admin"===e.role?"opacity-50 cursor-not-allowed":""}\n                          `,title:"Delete user",children:a.jsx(j,{className:"h-4 w-4"})})]})})]},e.id)))})]})})}),L&&E&&a.jsx(ne,{admin:E,onClose:()=>I(!1),onUpdate:async(e,a)=>{try{await l(e,a),I(!1),Z("Admin user updated successfully")}catch(t){ee(t.message||"Failed to update admin user")}}}),$&&E&&a.jsx(le,{admin:E,onClose:()=>R(!1),onResetPassword:async(e,a)=>{try{await v(e,a),R(!1),Z("Password reset successfully")}catch(t){ee(t.message||"Failed to reset password")}}}),z&&E&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-red-600 dark:text-red-400 mb-4",children:[a.jsx(p,{className:"h-6 w-6"}),a.jsx("h3",{className:"text-lg font-semibold",children:"Confirm Deletion"})]}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:["Are you sure you want to delete the user ",a.jsx("span",{className:"font-semibold",children:E.username||E.email}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:()=>q(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(E)try{B(E.id),await k(E.id),q(!1),T(null),Z("Admin user deleted successfully")}catch(e){ee(e.message||"Failed to delete admin user")}finally{B(null)}},disabled:!!O,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center space-x-2 transition-colors disabled:opacity-70",children:O===E.id?a.jsxs(a.Fragment,{children:[a.jsx(x,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Deleting..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(j,{className:"h-4 w-4"}),a.jsx("span",{children:"Delete"})]})})]})]})}),X&&a.jsx(oe,{permissions:[],loading:!1,onCreate:async e=>{try{await n(e),K(!1),Z("Admin user created successfully")}catch(a){ee(a.message||"Failed to create admin user")}},onCancel:()=>K(!1)})]})}function xe({stats:t,loading:r}){const[s,d]=e.useState("30d"),[i,n]=e.useState("all"),[l,c]=e.useState(!1),[m,g]=e.useState(!1),[u,h]=e.useState({admins:0,active:0,disabled:0,permissions:0}),b=(null==t?void 0:t.departmentDistribution)?["all",...t.departmentDistribution.map((e=>e.department))]:["all"];e.useEffect((()=>{t&&h({admins:Math.floor(20*Math.random())-10,active:Math.floor(15*Math.random()),disabled:Math.floor(10*Math.random())-7,permissions:Math.floor(30*Math.random())-10})}),[t]);const p=e.useCallback((()=>{g(!0),setTimeout((()=>{g(!1)}),1500)}),[]),y=e.useCallback((()=>{const e=(null==t?void 0:t.departmentDistribution)||[],r=Math.max(...e.map((e=>e.count)),1);return a.jsx("div",{className:"space-y-3",children:e.map((e=>a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[70%]",children:e.department}),a.jsxs("div",{className:"flex items-center text-sm",children:[a.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:e.count}),a.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 ml-1",children:"admins"})]})]}),a.jsx("div",{className:"overflow-hidden h-2.5 text-xs flex rounded-full bg-gray-200 dark:bg-gray-700",children:a.jsx("div",{style:{width:e.count/r*100+"%"},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 dark:bg-blue-600 rounded-full transition-all duration-500"})})]},e.department)))})}),[null==t?void 0:t.departmentDistribution]),w=e.useCallback((()=>{const e=(null==t?void 0:t.totalAdmins)||0,r=(null==t?void 0:t.activeAdmins)||0,s=(null==t?void 0:t.disabledAdmins)||0,d=e>0?Math.round(r/e*100):0,i=2*Math.PI*16,n=d/100*i;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"relative h-32 w-32",children:a.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 36 36",children:[a.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"#E5E7EB",strokeWidth:"3.6",className:"dark:stroke-gray-700"}),a.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"#3B82F6",strokeWidth:"3.6",strokeDasharray:`${n} ${i}`,strokeDashoffset:"0",strokeLinecap:"round",className:"dark:stroke-blue-500 transition-all duration-1000 ease-in-out",transform:"rotate(-90 18 18)"}),a.jsxs("text",{x:"18",y:"18",dy:".35em",dominantBaseline:"middle",textAnchor:"middle",fill:"#4B5563",className:"dark:fill-white text-3xl font-bold",children:[d,"%"]})]})}),a.jsx("div",{className:"flex-1 pl-5",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-3 w-3 rounded-full bg-blue-500 dark:bg-blue-500 mr-2"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Active"})]}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("p",{className:"text-xl font-bold text-gray-800 dark:text-white",children:r}),u.active>0&&a.jsxs("div",{className:"flex items-center ml-2 text-xs text-green-500",children:[a.jsx(v,{className:"h-3 w-3"}),a.jsxs("span",{children:[u.active,"%"]})]})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-300 dark:bg-gray-600 mr-2"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Disabled"})]}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("p",{className:"text-xl font-bold text-gray-800 dark:text-white",children:s}),u.disabled<0&&a.jsxs("div",{className:"flex items-center ml-2 text-xs text-red-500",children:[a.jsx(N,{className:"h-3 w-3"}),a.jsxs("span",{children:[Math.abs(u.disabled),"%"]})]})]})]})]})})]})}),[null==t?void 0:t.totalAdmins,null==t?void 0:t.activeAdmins,null==t?void 0:t.disabledAdmins,u]),j=e.useCallback((()=>{const e=(null==t?void 0:t.permissionUsage)||[];return a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map((e=>{const r=Math.min(100,Math.round(e.count/((null==t?void 0:t.totalAdmins)||1)*100));return a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"flex justify-between mb-1.5",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[80%]",children:e.permission}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsxs("span",{className:"text-xs font-semibold text-gray-900 dark:text-white",children:[r,"%"]}),a.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e.count,")"]})]})]}),a.jsx("div",{className:"overflow-hidden h-2 text-xs flex rounded-full bg-gray-200 dark:bg-gray-700",children:a.jsx("div",{style:{width:`${r}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center rounded-full transition-all duration-500 "+(r>75?"bg-green-500 dark:bg-green-600":r>50?"bg-blue-500 dark:bg-blue-600":r>25?"bg-amber-500 dark:bg-amber-600":"bg-red-500 dark:bg-red-600")})})]},e.permission)}))})}),[null==t?void 0:t.permissionUsage,null==t?void 0:t.totalAdmins]),k=e.useCallback((()=>{if(!(null==t?void 0:t.monthlyActivity)||0===t.monthlyActivity.length)return a.jsx("div",{className:"flex items-center justify-center h-40 text-gray-500 dark:text-gray-400",children:"No activity data available"});const e=t.monthlyActivity,r=Math.max(...e.map((e=>e.logins))),s=Math.max(...e.map((e=>e.actions)));return a.jsxs("div",{className:"pt-5",children:[a.jsx("div",{className:"flex items-end justify-between space-x-1 h-[180px]",children:e.map((e=>a.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[a.jsxs("div",{className:"relative w-full flex justify-center",children:[a.jsxs("div",{className:"absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-900 text-white text-xs rounded py-1 px-2 pointer-events-none z-10 whitespace-nowrap",children:[a.jsx("div",{className:"font-medium",children:e.month}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"Logins:"}),a.jsx("span",{children:e.logins})]}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"Actions:"}),a.jsx("span",{children:e.actions})]})]}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-3 bg-blue-500 dark:bg-blue-600 rounded-t hover:bg-blue-600 dark:hover:bg-blue-700 transition-all cursor-pointer group-hover:opacity-90",style:{height:e.logins/r*100+"%"}}),a.jsx("div",{className:"w-3 bg-purple-500 dark:bg-purple-600 rounded-t hover:bg-purple-600 dark:hover:bg-purple-700 transition-all cursor-pointer group-hover:opacity-90",style:{height:e.actions/s*100+"%"}})]})]}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:e.month.substring(0,3)})]},e.month)))}),a.jsxs("div",{className:"flex justify-center mt-4 space-x-8",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-3 w-3 rounded bg-blue-500 dark:bg-blue-600 mr-2"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Logins"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-3 w-3 rounded bg-purple-500 dark:bg-purple-600 mr-2"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Actions"})]})]})]})}),[null==t?void 0:t.monthlyActivity]),L=e.useCallback((()=>(null==t?void 0:t.mostActiveAdmins)&&0!==t.mostActiveAdmins.length?a.jsx("div",{className:"space-y-3",children:t.mostActiveAdmins.map(((e,t)=>a.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-750 rounded-lg transition-colors",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 mr-3 font-semibold",children:t+1}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:e.adminName}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.adminId.substring(0,8)})]})]}),a.jsxs("div",{className:"flex items-center bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded-full",children:[a.jsx(S,{className:"h-3.5 w-3.5 text-blue-600 dark:text-blue-400 mr-1.5"}),a.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:e.actionsCount})]})]},e.adminId)))}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No activity data available"})),[null==t?void 0:t.mostActiveAdmins]),I=e.useCallback((()=>(null==t?void 0:t.recentLogins)&&0!==t.recentLogins.length?a.jsx("div",{className:"space-y-3",children:t.recentLogins.map((e=>{const t=new Date(e.timestamp),r=(new Date).getTime()-t.getTime(),s=Math.floor(r/864e5),d=Math.floor(r/36e5),i=Math.floor(r/6e4);let n;return n=s>0?`${s}d ago`:d>0?`${d}h ago`:`${i}m ago`,a.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-750 rounded-lg transition-colors",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400 mr-3",children:a.jsx(C,{className:"h-4 w-4"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:e.adminName}),a.jsxs("div",{className:"flex items-center text-xs",children:[a.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:e.ipAddress}),a.jsx("span",{className:"mx-1.5 h-1 w-1 rounded-full bg-gray-300 dark:bg-gray-700"}),a.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:n})]})]})]}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},e.adminId)}))}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No recent login data available"})),[null==t?void 0:t.recentLogins]);return a.jsxs("div",{children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 mb-6 shadow-sm",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[a.jsx(S,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2"}),"Admin Analytics Dashboard"]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Comprehensive analytics for monitoring admin activity and usage patterns."})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsxs("select",{value:s,onChange:e=>d(e.target.value),className:"appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 pr-8 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"7d",children:"Last 7 days"}),a.jsx("option",{value:"30d",children:"Last 30 days"}),a.jsx("option",{value:"90d",children:"Last 90 days"}),a.jsx("option",{value:"1y",children:"Last year"})]}),a.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300",children:a.jsx(A,{className:"h-4 w-4"})})]}),a.jsxs("button",{onClick:()=>c(!l),className:"flex items-center justify-center gap-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-650 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm font-medium transition-colors",children:[a.jsx(o,{className:"h-4 w-4"}),a.jsx("span",{children:"Filters"}),l?a.jsx(_,{className:"h-4 w-4"}):a.jsx(A,{className:"h-4 w-4"})]}),a.jsxs("button",{onClick:p,disabled:m,className:"flex items-center justify-center gap-1.5 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 border border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-400 py-2 px-3 rounded-lg text-sm font-medium transition-colors "+(m?"opacity-70 cursor-not-allowed":""),children:[a.jsx(x,{className:"h-4 w-4 "+(m?"animate-spin":"")}),a.jsx("span",{children:m?"Refreshing...":"Refresh Data"})]})]})]}),l&&a.jsx("div",{className:"bg-gray-50 dark:bg-gray-750 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Department"}),a.jsx("select",{value:i,onChange:e=>n(e.target.value),className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:b.map((e=>a.jsx("option",{value:e,children:"all"===e?"All Departments":e},e)))})]})})}),r?a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map(((e,t)=>a.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"},t)))}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[...Array(4)].map(((e,t)=>a.jsx("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded-lg"},t)))})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Admins"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==t?void 0:t.totalAdmins)||0}),a.jsxs("div",{className:"flex items-center ml-2 text-xs "+(u.admins>0?"text-green-500":u.admins<0?"text-red-500":"text-gray-500"),children:[u.admins>0?a.jsx(v,{className:"h-3 w-3 mr-0.5"}):u.admins<0?a.jsx(N,{className:"h-3 w-3 mr-0.5"}):null,a.jsxs("span",{children:[Math.abs(u.admins),"%"]})]})]})]}),a.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:a.jsx(M,{className:"h-6 w-6"})})]})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Active Admins"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==t?void 0:t.activeAdmins)||0}),a.jsxs("div",{className:"flex items-center ml-2 text-xs text-green-500",children:[a.jsx(v,{className:"h-3 w-3 mr-0.5"}),a.jsxs("span",{children:[u.active,"%"]})]})]})]}),a.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400",children:a.jsx(C,{className:"h-6 w-6"})})]})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Disabled Admins"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==t?void 0:t.disabledAdmins)||0}),0!==u.disabled&&a.jsxs("div",{className:"flex items-center ml-2 text-xs "+(u.disabled<0?"text-green-500":"text-red-500"),children:[u.disabled<0?a.jsx(N,{className:"h-3 w-3 mr-0.5"}):a.jsx(v,{className:"h-3 w-3 mr-0.5"}),a.jsxs("span",{children:[Math.abs(u.disabled),"%"]})]})]})]}),a.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400",children:a.jsx(D,{className:"h-6 w-6"})})]})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Permission Changes"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==t?void 0:t.permissionChanges)||0}),a.jsx("div",{className:"flex items-center ml-2 text-xs "+(u.permissions>0?"text-amber-500":u.permissions<0?"text-blue-500":"text-gray-500"),children:0!==u.permissions&&a.jsxs(a.Fragment,{children:[u.permissions>0?a.jsx(v,{className:"h-3 w-3 mr-0.5"}):a.jsx(N,{className:"h-3 w-3 mr-0.5"}),a.jsxs("span",{children:[Math.abs(u.permissions),"%"]})]})})]})]}),a.jsx("div",{className:"h-12 w-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-600 dark:text-amber-400",children:a.jsx(f,{className:"h-6 w-6"})})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Active vs Disabled Admins"}),a.jsx(P,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),w()]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Admin Distribution by Department"}),a.jsx(F,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),y()]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Monthly Admin Activity"}),a.jsx(U,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),k()]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Permission Usage Patterns"}),a.jsx(f,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),j()]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Most Active Admins"}),a.jsx(S,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),L(),(null==t?void 0:t.mostActiveAdmins)&&t.mostActiveAdmins.length>0&&a.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:a.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-500 font-medium flex items-center justify-center w-full",children:[a.jsx(E,{className:"h-4 w-4 mr-1.5"}),"Export Activity Report"]})})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Recent Admin Logins"}),a.jsx(T,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),I(),(null==t?void 0:t.recentLogins)&&t.recentLogins.length>0&&a.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:a.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-500 font-medium flex items-center justify-center w-full",children:[a.jsx(E,{className:"h-4 w-4 mr-1.5"}),"Export Login Report"]})})]})]})]})]}),a.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2 mb-6",children:[a.jsx(x,{className:"h-3.5 w-3.5 "+(m?"animate-spin text-blue-500":"")}),a.jsx("span",{className:"flex items-center",children:m?"Refreshing data...":`Last updated: ${(new Date).toLocaleString()}`})]})]})}function ge({logs:r,loading:s}){const[d,i]=e.useState(""),[n,l]=e.useState([]),[m,x]=e.useState("all"),[g,u]=e.useState({from:"",to:""}),[h,b]=e.useState("desc");e.useEffect((()=>{let e=[...r];if(d){const a=d.toLowerCase();e=e.filter((e=>e.adminName.toLowerCase().includes(a)||e.action.toLowerCase().includes(a)||e.details.toLowerCase().includes(a)))}if("all"!==m&&(e=e.filter((e=>e.action===m))),g.from){const a=new Date(g.from);e=e.filter((e=>new Date(e.timestamp)>=a))}if(g.to){const a=new Date(g.to);a.setHours(23,59,59,999),e=e.filter((e=>new Date(e.timestamp)<=a))}e.sort(((e,a)=>{const t=new Date(e.timestamp),r=new Date(a.timestamp);return"desc"===h?+r-+t:+t-+r})),l(e)}),[r,d,m,g,h]);const p=e=>{const{name:a,value:t}=e.target;u((e=>({...e,[a]:t})))},y=e=>{switch(e){case"create_admin":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300";case"update_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300";case"delete_admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300";case"reset_password":return"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-300";case"login":return"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},f=e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");return a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-4",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[a.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center",children:[a.jsx(L,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),"Admin Activity Logs"]}),a.jsxs("button",{onClick:()=>{if(0===n.length)return;const e=[["Admin","Action","Details","Timestamp","IP Address"].join(","),...n.map((e=>[`"${e.adminName}"`,`"${e.action}"`,`"${e.details.replace(/"/g,'""')}"`,`"${new Date(e.timestamp).toLocaleString()}"`,`"${e.ipAddress||""}"`].join(",")))].join("\n"),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download",`admin-logs-${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},disabled:0===n.length,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(E,{className:"h-4 w-4 mr-1.5"}),"Export CSV"]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"Search logs...",value:d,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"}),a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("select",{value:m,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white appearance-none",children:["all","create_admin","update_admin","delete_admin","reset_password","login","logout"].map((e=>a.jsx("option",{value:e,children:"all"===e?"All Actions":f(e)},e)))}),a.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"date",name:"from",value:g.from,onChange:p,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"From date"}),a.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"date",name:"to",value:g.to,onChange:p,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"To date"}),a.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-2",children:[a.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(d||"all"!==m||g.from||g.to)&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active filters:"}),d&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Search: ",d,a.jsx(t,{size:14,className:"ml-1 cursor-pointer",onClick:()=>i("")})]}),"all"!==m&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Action: ",f(m),a.jsx(t,{size:14,className:"ml-1 cursor-pointer",onClick:()=>x("all")})]}),g.from&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["From: ",g.from,a.jsx(t,{size:14,className:"ml-1 cursor-pointer",onClick:()=>u((e=>({...e,from:""})))})]}),g.to&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["To: ",g.to,a.jsx(t,{size:14,className:"ml-1 cursor-pointer",onClick:()=>u((e=>({...e,to:""})))})]}),a.jsx("button",{onClick:()=>{i(""),x("all"),u({from:"",to:""})},className:"text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"Clear all"})]})}),a.jsxs("button",{onClick:()=>b((e=>"desc"===e?"asc":"desc")),className:"inline-flex items-center px-2 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[a.jsx(T,{className:"h-4 w-4 mr-1"}),"desc"===h?a.jsxs(a.Fragment,{children:["Newest first ",a.jsx(I,{className:"h-3 w-3 ml-1"})]}):a.jsxs(a.Fragment,{children:["Oldest first ",a.jsx($,{className:"h-3 w-3 ml-1"})]})]})]})]}),a.jsx("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:s?a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"}),[...Array(5)].map(((e,t)=>a.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},t)))]})}):0===n.length?a.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:0===r.length?"No activity logs found in the system.":"No logs match your current filters."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Admin"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Details"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP Address"})]})}),a.jsx("tbody",{className:"bg-white dark:bg-gray-750 divide-y divide-gray-200 dark:divide-gray-700",children:n.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:a.jsx(R,{className:"h-4 w-4"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.adminName}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.adminId.substring(0,8)})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${y(e.action)}`,children:f(e.action)})}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:e.details}),e.resource&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Resource: ",e.resource," ",e.resourceId&&`#${e.resourceId.substring(0,8)}`]})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(e.timestamp).toLocaleString()}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.ipAddress||"-"})]},e.id)))})]})})}),!s&&r.length>0&&a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:["Showing ",n.length," of ",r.length," logs"]})]})}function ue({admins:t,onResetPassword:r}){const[n,l]=e.useState(""),[o,c]=e.useState(""),[m,g]=e.useState(!1),[u,h]=e.useState(!1),[b,w]=e.useState(!1);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:"Security Settings"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage security settings and reset passwords"})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Password Reset"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"admin-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select User"}),a.jsxs("select",{id:"admin-select",value:n,onChange:e=>l(e.target.value),className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select a user"}),t.filter((e=>"super-admin"!==e.role)).map((e=>a.jsxs("option",{value:e.id,children:[e.username," (",e.email,") - ",e.role]},e.id)))]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"flex",children:[a.jsx("input",{id:"password",type:m?"text":"password",value:o,onChange:e=>c(e.target.value),className:"flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Generate a secure password",readOnly:!0}),a.jsx("button",{type:"button",onClick:()=>g(!m),className:"bg-gray-100 dark:bg-gray-600 border-y border-r border-gray-300 dark:border-gray-600 rounded-r-lg px-3",children:m?a.jsx(s,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}):a.jsx(d,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>{let e="";e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],e+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],e+="0123456789"[Math.floor(10*Math.random())],e+="!@#$%^&*()_+"[Math.floor(12*Math.random())];for(let a=4;a<12;a++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+"[Math.floor(74*Math.random())];e=e.split("").sort((()=>Math.random()-.5)).join(""),c(e)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[a.jsx(i,{className:"h-4 w-4"}),a.jsx("span",{children:"Generate Password"})]}),o&&a.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(o).then((()=>{w(!0),setTimeout((()=>w(!1)),2e3)})).catch((e=>{ee("Failed to copy password to clipboard")}))},className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors",children:b?a.jsxs(a.Fragment,{children:[a.jsx(y,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{children:"Copied!"})]}):a.jsxs(a.Fragment,{children:[a.jsx(z,{className:"h-4 w-4"}),a.jsx("span",{children:"Copy"})]})})]}),a.jsx("div",{className:"mt-6",children:a.jsxs("button",{type:"button",onClick:async()=>{if(n)if(!o||o.length<8)ee("Please generate a secure password");else{h(!0);try{await r(n,o)?(Z("Password reset successfully"),l(""),c("")):ee("Failed to reset password")}catch(e){ee(e.message||"Failed to reset password")}finally{h(!1)}}else ee("Please select an admin")},disabled:!n||!o||u,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors disabled:bg-red-300 dark:disabled:bg-red-800/50 disabled:cursor-not-allowed",children:[u?a.jsx(x,{className:"h-4 w-4 animate-spin"}):a.jsx(f,{className:"h-4 w-4"}),a.jsx("span",{children:"Reset Password"})]})}),n&&o&&a.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg flex items-start gap-2 text-sm",children:[a.jsx(p,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Important:"}),a.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"You are about to reset the password for this user. Make sure to share the new password with them securely. They should change their password after logging in."})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Security Policies"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Two-factor Authentication"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Require 2FA for all admin accounts"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),a.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Password Expiry"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Force password change every 90 days"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),a.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Session Timeout"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Auto logout after 30 minutes of inactivity"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Failed Login Lockout"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lock account after 5 failed login attempts"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})]}),a.jsx("div",{className:"mt-6",children:a.jsxs("button",{type:"button",className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[a.jsx(f,{className:"h-4 w-4"}),a.jsx("span",{children:"Save Security Settings"})]})})]})]})}async function he(e,a,t,r,s){try{const{data:d,error:i}=await ae.from("users").select("name").eq("id",e).single();if(i)return;const{error:n}=await ae.from("admin_logs").insert([{admin_id:e,admin_name:(null==d?void 0:d.name)||"Unknown",action:a,details:t,timestamp:(new Date).toISOString(),resource:r,resource_id:s}])}catch(d){}}function be({admins:t,loading:r,error:s,onPromoteToSectionAdmin:d,onDemoteUser:i,onDeleteUser:n,onGetSectionUsers:l,onGetSections:o,onRefresh:m,departments:u,batches:h,sections:b}){var y,w;const[k,v]=e.useState(""),[N,S]=e.useState(null),[C,D]=e.useState(null),[P,F]=e.useState(null),[U,E]=e.useState([]),[T,L]=e.useState([]),[I,$]=e.useState([]);e.useState({});const[z,Y]=e.useState(!1),[J,X]=e.useState(null),[K,Q]=e.useState(!1),[te,re]=e.useState(null),[se,de]=e.useState(!1),[ie,ne]=e.useState(1),[le,oe]=e.useState(10),[ce,me]=e.useState(0),[xe,ge]=e.useState("name"),[ue,he]=e.useState("asc"),[be,pe]=e.useState(!1),[ye,fe]=e.useState(5),[we,je]=e.useState(!1);e.useEffect((()=>{if(N){const e=h.filter((e=>e.departmentId===N));L(e),D(null),F(null)}else L([]),D(null),F(null)}),[N,h]),e.useEffect((()=>{if(C){const e=b.filter((e=>e.batchId===C));E(e),F(null)}else E([]),F(null)}),[C,b]),e.useEffect((()=>{P?(_e(P),ne(1)):$([])}),[P]);const ke=e=>{xe===e?he((e=>"asc"===e?"desc":"asc")):(ge(e),he("asc"))},ve=ie*le,Ne=ve-le,Se=e.useMemo((()=>I.length?[...I.filter((e=>{if(!k)return!0;const a=k.toLowerCase();return(e.username||"").toLowerCase().includes(a)||(e.email||"").toLowerCase().includes(a)||(e.role||"").toLowerCase().includes(a)}))].sort(((e,a)=>{let t,r;switch(xe){case"name":default:t=e.username||"",r=a.username||"";break;case"email":t=e.email||"",r=a.email||"";break;case"role":t=e.role||"",r=a.role||"";break;case"studentId":t=e.studentId||"",r=a.studentId||""}return"asc"===ue?t.localeCompare(r):r.localeCompare(t)})):[]),[I,k,xe,ue]),Ce=e.useMemo((()=>(me(Se.length),Se.slice(Ne,ve))),[Se,Ne,ve]),Ae=Math.ceil(ce/le),_e=async e=>{var a;de(!0);try{await new Promise((e=>setTimeout(e,500)));const t=await l(e);$(t);const r=null==(a=b.find((a=>a.id===e)))?void 0:a.name,s=t.length,d=t.filter((e=>"section_admin"===e.role)).length;Z(`Loaded ${s} users (${d} section admins) from ${r||"selected section"}`),t.length}catch(t){ee(t.message||"Failed to load section users"),$([])}finally{de(!1)}},Me=async()=>{Y(!0);try{await m(),P&&await _e(P),Z("User data refreshed successfully")}catch(e){ee(e.message||"Failed to refresh data")}finally{Y(!1)}},De=e=>xe!==e?null:"asc"===ue?a.jsx(_,{className:"h-4 w-4 inline-block ml-1"}):a.jsx(A,{className:"h-4 w-4 inline-block ml-1"});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx(M,{className:"h-6 w-6 text-blue-500"}),"Section Admin Management"]}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage section administrators and users by department, batch, and section"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:Me,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm disabled:opacity-50",title:"Refresh data",children:[a.jsx(x,{className:"h-4 w-4 "+(z?"animate-spin":"")}),a.jsx("span",{children:"Refresh"})]}),a.jsxs("a",{href:"#help-section",className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm",children:[a.jsx(g,{className:"h-4 w-4"}),a.jsx("span",{children:"Help"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Department"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(q,{className:"h-5 w-5 text-gray-400"})}),a.jsxs("select",{value:N||"",onChange:e=>S(e.target.value||null),className:"block w-full pl-10 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500 shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[a.jsx("option",{value:"",children:"Select Department"}),u.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Batch"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(O,{className:"h-5 w-5 text-gray-400"})}),a.jsxs("select",{value:C||"",onChange:e=>D(e.target.value||null),disabled:!N||0===T.length,className:"block w-full pl-10 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500 shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:text-gray-500 dark:disabled:text-gray-500",children:[a.jsx("option",{value:"",children:N?0===T.length?"No batches in this department":"Select Batch":"Select department first"}),T.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Section"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(M,{className:"h-5 w-5 text-gray-400"})}),a.jsxs("select",{value:P||"",onChange:e=>F(e.target.value||null),disabled:!C||0===U.length,className:"block w-full pl-10 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500 shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:text-gray-500 dark:disabled:text-gray-500",children:[a.jsx("option",{value:"",children:C?0===U.length?"No sections in this batch":"Select Section":"Select batch first"}),U.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]})]})]})]}),P&&a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[a.jsxs("div",{className:"flex items-center bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm w-full md:w-auto",children:[a.jsx("div",{className:"flex items-center justify-center px-3 py-2",children:a.jsx(c,{className:"h-5 w-5 text-gray-400"})}),a.jsx("input",{type:"text",placeholder:"Search users by name or email",value:k,onChange:e=>v(e.target.value),className:"flex-1 px-3 py-2 bg-transparent border-0 outline-none text-gray-900 dark:text-white placeholder-gray-400 min-w-[200px] md:min-w-[300px]"})]}),a.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[a.jsxs("button",{onClick:()=>je(!we),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm disabled:opacity-50 w-full md:w-auto",children:[a.jsx(B,{className:"h-4 w-4"}),a.jsx("span",{children:"Create Test Users"})]}),a.jsxs("button",{onClick:Me,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm disabled:opacity-50",title:"Refresh users",children:[a.jsx(x,{className:"h-4 w-4 "+(z?"animate-spin":"")}),a.jsx("span",{className:"sr-only md:not-sr-only",children:"Refresh"})]})]})]}),P&&we&&a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/50 rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-300 mb-3 flex items-center gap-2",children:[a.jsx(R,{className:"h-5 w-5"}),"Create Test Users"]}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-end",children:[a.jsxs("div",{className:"space-y-2 flex-grow",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number of Test Users"}),a.jsx("input",{type:"number",min:"1",max:"20",value:ye,onChange:e=>fe(Math.min(20,Math.max(1,parseInt(e.target.value)||1))),className:"block w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500 shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Creates test users with random data. The last user will be a section admin."})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:async()=>{if(P&&C&&N){pe(!0);try{const e=await async function(e,a,t,r=2){try{if(!e||!a||!t)throw new Error("Department ID, Batch ID, and Section ID are required");const{data:s,error:i}=await ae.from("departments").select("name").eq("id",e).single();if(i)throw new Error("Department not found");const{data:n,error:l}=await ae.from("batches").select("name").eq("id",a).single();if(l)throw new Error("Batch not found");const{data:o,error:c}=await ae.from("sections").select("name").eq("id",t).single();if(c)throw new Error("Section not found");const m=Date.now(),x=[];for(let g=0;g<r;g++){const i=g===r-1,l=i?"section_admin":"user",c=`test${g+1}_${m}@example.com`,u=`Test ${i?"Admin":"Student"} ${g+1}`,h=`ST-${m}-${g+1}`,{data:b,error:p}=await ae.auth.admin.createUser({email:c,password:"Password123!",email_confirm:!0,user_metadata:{name:u,role:l,department_id:e,batch_id:a,section_id:t}});if(p)throw new Error(`Failed to create auth user: ${p.message}`);const{data:y,error:f}=await ae.from("users").insert([{id:b.user.id,email:c,name:u,role:l,department_id:e,batch_id:a,section_id:t,phone:`123456789${g}`,student_id:h}]).select().single();if(f){try{await ae.auth.admin.deleteUser(b.user.id)}catch(d){}throw new Error(`Failed to create user in database: ${f.message}`)}x.push({id:b.user.id,email:c,username:u,role:l,department:s.name,departmentId:e,batch:n.name,batchId:a,section:o.name,sectionId:t,phone:`123456789${g}`,studentId:h,isActive:!0,status:"active",permissions:[],createdAt:(new Date).toISOString()})}return x}catch(s){throw new Error(`Failed to create test users: ${s.message}`)}}(N,C,P,ye);if(e&&"success"in e&&e.success&&e.data)Z(`Created ${e.data.length} test users for this section`);else{const a=e&&"error"in e?e.error:"Unknown error";ee(`Failed to create test users: ${a}`)}await _e(P),je(!1)}catch(e){ee(e.message||"Failed to create test users")}finally{pe(!1)}}else ee("Please select a department, batch, and section first")},disabled:be,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm disabled:opacity-50 flex items-center gap-2",children:[be?a.jsx(G,{className:"h-4 w-4 animate-spin"}):a.jsx(B,{className:"h-4 w-4"}),a.jsx("span",{children:"Create Users"})]}),a.jsx("button",{onClick:()=>je(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]}),P?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-750",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>ke("name"),children:a.jsxs("div",{className:"flex items-center",children:["Name ",De("name")]})}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>ke("email"),children:a.jsxs("div",{className:"flex items-center",children:["Email ",De("email")]})}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>ke("role"),children:a.jsxs("div",{className:"flex items-center",children:["Role ",De("role")]})}),a.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r||se?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-4 py-8 text-center",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(x,{className:"h-6 w-6 text-blue-500 animate-spin mr-2"}),a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading users..."})]})})}):0===Ce.length?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-4 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:k?"No users match your search":"No users found in this section"})}):Ce.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750",children:[a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.username||"Unnamed User"}),a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.jsx("div",{children:e.email})}),a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("section_admin"===e.role?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500":"admin"===e.role?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-500":"super-admin"===e.role?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-500":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:"section_admin"===e.role?"Section Admin":"super-admin"===e.role?"Super Admin":"admin"===e.role?"Admin":"User"})}),a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:["section_admin"!==e.role&&"super-admin"!==e.role&&a.jsx("button",{onClick:()=>(async e=>{const a=I.find((a=>a.id===e));a&&((e,a)=>{re({type:"promote",userId:e,userName:a}),Q(!0)})(e,a.username||a.email)})(e.id),disabled:J===e.id,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 disabled:opacity-50 p-1 rounded-full hover:bg-blue-50 dark:hover:bg-blue-900/20",title:"Promote to Section Admin",children:a.jsx(f,{className:"h-5 w-5"})}),"section_admin"===e.role&&a.jsx("button",{onClick:()=>(async e=>{const a=I.find((a=>a.id===e));a&&((e,a)=>{re({type:"demote",userId:e,userName:a}),Q(!0)})(e,a.username||a.email)})(e.id),disabled:J===e.id,className:"text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300 disabled:opacity-50 p-1 rounded-full hover:bg-yellow-50 dark:hover:bg-yellow-900/20",title:"Demote to User",children:a.jsx(W,{className:"h-5 w-5"})}),"super-admin"!==e.role&&a.jsx("button",{onClick:()=>(async e=>{const a=I.find((a=>a.id===e));a&&((e,a)=>{re({type:"delete",userId:e,userName:a}),Q(!0)})(e,a.username||a.email)})(e.id),disabled:J===e.id,className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 disabled:opacity-50 p-1 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20",title:"Delete User",children:a.jsx(j,{className:"h-5 w-5"})})]})})]},e.id)))})]})}),ce<=le?null:a.jsxs("div",{className:"flex items-center justify-between mt-4 text-sm",children:[a.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:["Showing ",Ne+1,"-",Math.min(ve,ce)," of ",ce," users"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{ie>1&&ne(ie-1)},disabled:1===ie,className:"p-2 rounded-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 disabled:opacity-50","aria-label":"Previous page",children:a.jsx(V,{className:"h-4 w-4"})}),(()=>{const e=[];let t=Math.max(1,ie-Math.floor(2.5)),r=Math.min(Ae,t+5-1);r-t+1<5&&(t=Math.max(1,r-5+1));for(let s=t;s<=r;s++)e.push(a.jsx("button",{onClick:()=>{var e;(e=s)>=1&&e<=Ae&&ne(e)},className:"w-8 h-8 flex items-center justify-center rounded-md "+(s===ie?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"),children:s},s));return a.jsx("div",{className:"flex items-center gap-1",children:e})})(),a.jsx("button",{onClick:()=>{ie<Ae&&ne(ie+1)},disabled:ie===Ae,className:"p-2 rounded-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 disabled:opacity-50","aria-label":"Next page",children:a.jsx(H,{className:"h-4 w-4"})})]})]})]}),!r&&!se&&Se.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm text-sm text-gray-500 dark:text-gray-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(R,{className:"h-4 w-4"}),a.jsxs("span",{children:["Total: ",Se.length," users"]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(f,{className:"h-4 w-4 text-blue-500"}),a.jsxs("span",{children:["Section Admins: ",Se.filter((e=>"section_admin"===e.role)).length]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(q,{className:"h-4 w-4 text-purple-500"}),a.jsxs("span",{children:["Department: ",(null==(y=u.find((e=>e.id===N)))?void 0:y.name)||"Unknown"]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(O,{className:"h-4 w-4 text-green-500"}),a.jsxs("span",{children:["Batch: ",(null==(w=h.find((e=>e.id===C)))?void 0:w.name)||"Unknown"]})]})]})]}):a.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm text-center",children:[a.jsx(M,{className:"h-24 w-24 text-blue-500 mb-4"}),a.jsx("h3",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:"Select a Section to Manage Users"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-md mb-6",children:"Choose a department, batch, and section from the filters above to view and manage users and section administrators."}),a.jsxs("div",{className:"w-full max-w-md border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-6",children:[a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 px-4 py-2 text-blue-800 dark:text-blue-300 font-medium",children:"Quick Selection Guide"}),a.jsx("div",{className:"p-4 text-sm text-left",children:a.jsxs("ol",{className:"list-decimal list-inside space-y-2",children:[a.jsxs("li",{className:"text-gray-700 dark:text-gray-300",children:["Select a ",a.jsx("span",{className:"font-medium",children:"Department"})," from the dropdown"]}),a.jsxs("li",{className:"text-gray-700 dark:text-gray-300",children:["Choose a ",a.jsx("span",{className:"font-medium",children:"Batch"})," for the selected department"]}),a.jsxs("li",{className:"text-gray-700 dark:text-gray-300",children:["Select a ",a.jsx("span",{className:"font-medium",children:"Section"})," to view and manage its users"]})]})})]}),a.jsxs("div",{id:"help-section",className:"w-full max-w-md p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg text-sm text-yellow-800 dark:text-yellow-300",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx(p,{className:"h-5 w-5 mr-2 flex-shrink-0"}),a.jsx("h4",{className:"font-medium",children:"Troubleshooting"})]}),a.jsx("p",{className:"mb-2",children:"If you don't see users after selecting a section, you may need to:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 pl-1",children:[a.jsx("li",{children:"Check that users are assigned to this section in the database"}),a.jsx("li",{children:'Use the "Create Test Users" button after selecting a section'}),a.jsx("li",{children:"Verify that department_id, batch_id, and section_id fields are not null in the users table"}),a.jsx("li",{children:"Ensure the section_id values in users table match the section IDs exactly"}),a.jsx("li",{children:"Refresh the page if data was recently changed"})]}),a.jsxs("div",{className:"mt-4 pt-3 border-t border-yellow-200 dark:border-yellow-800/50",children:[a.jsx("h5",{className:"font-medium mb-1",children:"Database Check:"}),a.jsx("p",{className:"mb-2",children:"If users still don't appear, check your database and ensure:"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 pl-1",children:[a.jsx("li",{children:"The users table has records with the correct section_id"}),a.jsx("li",{children:"User records have valid values for department_id and batch_id"}),a.jsx("li",{children:"There are no permission issues preventing data access"})]})]})]})]}),K&&te&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 shadow-xl animate-fade-in",children:[a.jsxs("div",{className:"mb-4",children:["promote"===te.type&&a.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mx-auto mb-4",children:a.jsx(f,{className:"h-6 w-6 text-blue-500"})}),"demote"===te.type&&a.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center mx-auto mb-4",children:a.jsx(W,{className:"h-6 w-6 text-yellow-500"})}),"delete"===te.type&&a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-4",children:a.jsx(j,{className:"h-6 w-6 text-red-500"})}),a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white text-center",children:["promote"===te.type&&"Promote to Section Admin","demote"===te.type&&"Demote User","delete"===te.type&&"Delete User"]})]}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:["promote"===te.type&&a.jsxs(a.Fragment,{children:["Are you sure you want to promote ",a.jsx("span",{className:"font-semibold",children:te.userName})," to section admin? They will have administrative privileges over this section."]}),"demote"===te.type&&a.jsxs(a.Fragment,{children:["Are you sure you want to demote ",a.jsx("span",{className:"font-semibold",children:te.userName}),"? They will lose their section admin privileges."]}),"delete"===te.type&&a.jsxs(a.Fragment,{children:["Are you sure you want to delete ",a.jsx("span",{className:"font-semibold",children:te.userName}),"? This action cannot be undone."]})]}),a.jsxs("div",{className:"flex justify-center space-x-3",children:[a.jsx("button",{onClick:()=>{Q(!1),re(null)},className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors font-medium",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{if(te){Q(!1),X(te.userId);try{switch(te.type){case"promote":await d(te.userId),Z(`${te.userName} promoted to section admin successfully`);break;case"demote":await i(te.userId),Z(`${te.userName} demoted successfully`);break;case"delete":await n(te.userId),Z(`${te.userName} deleted successfully`)}P&&await _e(P)}catch(e){ee(e.message||`Failed to ${te.type} user`)}finally{X(null),re(null)}}},className:"px-4 py-2 text-white rounded-lg transition-colors font-medium "+("promote"===te.type?"bg-blue-600 hover:bg-blue-700":"demote"===te.type?"bg-yellow-600 hover:bg-yellow-700":"bg-red-600 hover:bg-red-700"),children:["promote"===te.type&&"Promote","demote"===te.type&&"Demote","delete"===te.type&&"Delete"]})]})]})})]})}const pe=document.createElement("style");pe.innerHTML="\n  @keyframes fadeIn {\n    from { opacity: 0; transform: translateY(-10px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n  .animate-fade-in {\n    animation: fadeIn 0.2s ease-out;\n  }\n",document.head.appendChild(pe);const ye=({icon:e,label:t,isActive:r,onClick:s,badge:d,isCollapsed:i=!1})=>i?a.jsxs("button",{onClick:s,className:`\n          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform\n          ${r?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n        `,title:t,children:[a.jsx(e,{className:"w-5 h-5 "+(r?"text-blue-600 dark:text-blue-400":"")}),void 0!==d&&a.jsx("span",{className:`\n            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full\n            ${r?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}\n          `,children:d>99?"99+":d})]}):a.jsxs("button",{onClick:s,className:`\n        w-full flex items-center justify-between rounded-lg py-2 px-3 transition-all duration-200 will-change-transform\n        ${r?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n      `,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(e,{className:"w-5 h-5 "+(r?"text-blue-600 dark:text-blue-400":"")}),a.jsx("span",{className:"text-sm font-medium",children:t})]}),void 0!==d&&a.jsx("span",{className:`\n          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full\n          ${r?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}\n        `,children:d>99?"99+":d})]});function fe(){const[t,r]=e.useState("admins"),[s,d]=e.useState(null),[l,o]=e.useState([]),[c,m]=e.useState(!1),[x,g]=e.useState(!1),[u,h]=e.useState(!1),[b,p]=e.useState(""),[y,f]=e.useState(""),[w,j]=e.useState({admins:!0,stats:!0,logs:!0,departments:!0});e.useState(!1),e.useState(null);const[k,v]=e.useState([]),[N,S]=e.useState([]),[C,A]=e.useState([]),{isDark:_,toggle:D}=te(),{logout:P}=re(),{admins:F,loading:U,error:E,createAdmin:T,updateAdmin:L,deleteAdmin:I,resetPassword:$,promoteToAdmin:R,promoteToSectionAdmin:z,demoteUser:q,getSectionUsers:O,getSections:B,refreshAdmins:G}=function(){const[a,t]=e.useState([]),[r,s]=e.useState(!0),[d,i]=e.useState(null),n=e.useCallback((async()=>{s(!0),i(null);try{const e=await async function(){try{const{data:{user:e}}=await ae.auth.getUser(),{data:a,error:t}=await ae.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").order("created_at",{ascending:!1});if(t)throw new Error(t.message||"Failed to fetch admin users");const{data:r}=await ae.from("departments").select("id, name"),{data:s}=await ae.from("batches").select("id, name"),{data:d}=await ae.from("sections").select("id, name"),i=new Map((null==r?void 0:r.map((e=>[e.id,e.name])))||[]),n=new Map((null==s?void 0:s.map((e=>[e.id,e.name])))||[]),l=new Map((null==d?void 0:d.map((e=>[e.id,e.name])))||[]);return(null==a?void 0:a.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:i.get(e.department_id)||"",departmentId:e.department_id,batch:n.get(e.batch_id)||"",batchId:e.batch_id,section:l.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[]}catch(d){throw new Error(d.message||"Failed to fetch admin users")}}();t(e)}catch(e){i(e.message||"Failed to fetch admin users")}finally{s(!1)}}),[]);return e.useEffect((()=>{n()}),[n]),{admins:a,loading:r,error:d,createAdmin:async e=>{s(!0),i(null);try{const a=Math.random().toString(36).slice(-8)+Math.random().toString(36).slice(-8).toUpperCase()+"!1",t=await async function(e,a){try{const{data:{user:t}}=await ae.auth.getUser(),{data:r,error:s}=await ae.auth.admin.createUser({email:e.email,password:a,email_confirm:!0,user_metadata:{name:e.username,role:e.role,department:e.department||null}});if(s||!r.user)throw new Error((null==s?void 0:s.message)||"Failed to create admin user");const{data:d,error:i}=await ae.from("users").update({permissions:e.permissions,status:e.status,department:e.department}).eq("id",r.user.id).select();if(i)throw new Error(i.message||"Failed to create admin user");return t&&await he(t.id,"create_admin",`Created admin user: ${e.email}`),{id:r.user.id,username:e.username,email:e.email,role:e.role,department:e.department,permissions:e.permissions,status:e.status,isActive:"active"===e.status,createdAt:(new Date).toISOString(),phone:e.phone,studentId:e.studentId}}catch(d){throw new Error(d.message||"Failed to create admin user")}}(e,a);return await n(),t}catch(a){throw i(a.message||"Failed to create admin user"),a}finally{s(!1)}},updateAdmin:async(e,a)=>{s(!0),i(null);try{await async function(e,a){try{const{data:{user:t}}=await ae.auth.getUser();if(a.email||a.role||a.username){const{error:t}=await ae.auth.admin.updateUserById(e,{email:a.email,user_metadata:{name:a.username,role:a.role,department:a.department}});if(t)throw new Error(t.message||"Failed to update admin user")}const r={};a.permissions&&(r.permissions=a.permissions),a.status&&(r.status=a.status),a.department&&(r.department=a.department);const{data:s,error:d}=await ae.from("users").update(r).eq("id",e).select();if(d)throw new Error(d.message||"Failed to update admin user");t&&await he(t.id,"update_admin",`Updated admin user: ${e}`);const i=null==s?void 0:s[0];return{id:i.id,username:i.name||"",email:i.email||"",role:i.role||"admin",department:i.department,permissions:i.permissions||[],status:i.status||"active",isActive:"active"===i.status,lastLogin:i.last_active,createdAt:i.created_at,updatedAt:i.updated_at,phone:i.phone||"",studentId:i.student_id||""}}catch(d){throw new Error(d.message||"Failed to update admin user")}}(e,a),await n()}catch(t){throw i(t.message||"Failed to update admin user"),t}finally{s(!1)}},deleteAdmin:async e=>{s(!0),i(null);try{await async function(e){try{const{data:{user:t}}=await ae.auth.getUser(),{data:r,error:s}=await ae.from("users").select("*").eq("id",e).single();if(s)throw new Error(s.message||"Failed to delete admin user");try{const{error:a}=await ae.from("admin_archives").insert([{admin_id:e,admin_data:r,archived_by:(null==t?void 0:t.id)||"system",archived_at:(new Date).toISOString()}])}catch(a){}const{error:d}=await ae.auth.admin.deleteUser(e);if(d)throw new Error(d.message||"Failed to delete admin user");t&&await he(t.id,"delete_admin",`Deleted admin user: ${e}`)}catch(d){throw new Error(d.message||"Failed to delete admin user")}}(e),await n()}catch(a){throw i(a.message||"Failed to delete admin user"),a}finally{s(!1)}},resetPassword:async(e,a)=>{s(!0),i(null);try{const t=await async function(e,a){try{const{data:{user:r}}=await ae.auth.getUser(),{error:s}=await ae.auth.admin.updateUserById(e,{password:a});if(s)throw new Error(s.message||"Failed to reset admin password");try{r&&await he(r.id,"reset_password",`Reset password for admin: ${e}`)}catch(t){}return!0}catch(d){throw new Error(d.message||"Failed to reset admin password")}}(e,a);return await n(),t}catch(t){return i(t.message||"Failed to reset admin password"),!1}finally{s(!1)}},promoteToAdmin:async e=>{s(!0),i(null);try{await async function(e){var a;try{const{data:{user:t}}=await ae.auth.getUser();let r="super-admin"===(null==(a=null==t?void 0:t.user_metadata)?void 0:a.role);if(!r){const{data:e,error:a}=await ae.from("users").select("role").eq("id",null==t?void 0:t.id).single();!a&&e&&(r="super-admin"===e.role)}if(!r)throw new Error("Unauthorized: Only super admins can promote users to admin");const{error:s}=await ae.from("users").update({role:"admin"}).eq("id",e);if(s)throw new Error(s.message||"Failed to promote user to admin");t&&await he(t.id,"promote_to_admin",`Promoted user ${e} to admin role`)}catch(d){throw new Error(d.message||"Failed to promote user to admin")}}(e),await n()}catch(a){throw i(a.message||"Failed to promote user to admin"),a}finally{s(!1)}},promoteToSectionAdmin:async e=>{s(!0),i(null);try{const t=a.find((a=>a.id===e));if(!t)throw new Error("User not found");if(!t.sectionId)throw new Error("User does not have a section assigned. Please assign a section first.");await async function(e){try{const{data:a,error:t}=await ae.rpc("promote_user_to_section_admin",{input_user_id:e});if(t)throw new Error(t.message||"Failed to promote user to section admin")}catch(d){throw new Error(d.message||"Failed to promote user to section admin")}}(e),await n()}catch(t){throw i(t.message||"Failed to promote user to section admin"),t}finally{s(!1)}},demoteUser:async e=>{s(!0),i(null);try{const t=a.find((a=>a.id===e));if(!t)throw new Error("User not found");if("super-admin"===t.role)throw new Error("Super admins cannot be demoted through this interface");await async function(e){try{const{data:a,error:t}=await ae.rpc("demote_user_to_regular",{user_id:e});if(t)throw new Error(t.message||"Failed to demote user")}catch(d){throw new Error(d.message||"Failed to demote user")}}(e),await n()}catch(t){throw i(t.message||"Failed to demote user"),t}finally{s(!1)}},getSectionUsers:async e=>{s(!0),i(null);try{const a=await async function(e){try{const{data:{user:a}}=await ae.auth.getUser();if(!e)throw new Error("No section ID provided");const{data:t,error:r}=await ae.from("sections").select("id, name, batch_id").eq("id",e).single(),{data:s,error:d}=await ae.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").eq("section_id",e).order("created_at",{ascending:!1});if(d)throw new Error(d.message||"Failed to fetch section users");const{data:i}=await ae.from("departments").select("id, name"),{data:n}=await ae.from("batches").select("id, name"),{data:l}=await ae.from("sections").select("id, name"),o=new Map((null==i?void 0:i.map((e=>[e.id,e.name])))||[]),c=new Map((null==n?void 0:n.map((e=>[e.id,e.name])))||[]),m=new Map((null==l?void 0:l.map((e=>[e.id,e.name])))||[]),x=(null==s?void 0:s.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:o.get(e.department_id)||"",departmentId:e.department_id,batch:c.get(e.batch_id)||"",batchId:e.batch_id,section:m.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[];if(0===x.length){const{data:e,error:a}=await ae.from("users").select("id, email, section_id").not("section_id","is",null).limit(5);a||e.length}return x}catch(d){throw new Error(d.message||"Failed to fetch section users")}}(e);return a}catch(a){throw i(a.message||"Failed to fetch section users"),a}finally{s(!1)}},getSections:async(e,a)=>{s(!0),i(null);try{const t=await async function(e,a){try{let t=ae.from("sections").select("id, name, batch_id");e&&(t=t.eq("batch_id",e));const{data:r,error:s}=await t.order("name");if(s)throw new Error(s.message||"Failed to fetch sections");if(a&&!e){const{data:e,error:t}=await ae.from("batches").select("id").eq("department_id",a);if(t)throw new Error(t.message||"Failed to fetch batches");const s=e.map((e=>e.id));return r.filter((e=>s.includes(e.batch_id)))}return r||[]}catch(d){throw new Error(d.message||"Failed to fetch sections")}}(e,a);return t}catch(t){throw i(t.message||"Failed to fetch sections"),t}finally{s(!1)}},refreshAdmins:n}}();function W(e){const a=e.reduce(((e,a)=>{const t=a.department||"Unassigned";return e[t]=(e[t]||0)+1,e}),{});return Object.entries(a).map((([e,a])=>({department:e,count:a})))}function H(e){const a=e.reduce(((e,a)=>{const t=a.role||"Standard";return e[t]=(e[t]||0)+1,e}),{});return Object.entries(a).map((([e,a])=>({role:e,count:a})))}function Z(){const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=(new Date).getMonth();return e.map(((t,r)=>{const s=10+Math.floor(3.5*r),d=40+Math.floor(7*r),i=.8+.4*Math.random(),n=.8+.4*Math.random(),l=e.indexOf(t),o=l===a,c=l<a;let m=Math.floor(s*i),x=Math.floor(d*n);return o&&(m=Math.floor(.7*m),x=Math.floor(.7*x)),c||o||(m=0,x=0),{month:t,logins:m,actions:x}}))}function ee(e){const a={"User Management":["viewUsers","createUsers","editUsers","deleteUsers"],"Course Management":["viewCourses","createCourses","editCourses","deleteCourses"],"Announcement Management":["viewAnnouncements","createAnnouncements","editAnnouncements"],"Teacher Management":["viewTeachers","assignTeachers","editTeachers"],"Routine Management":["viewRoutine","createRoutine","editRoutine"],"Task Management":["viewTasks","createTasks","editTasks","deleteTasks","assignTasks"],"Report Viewing":["viewReports","exportData","analyzeData"],"Settings Management":["viewSettings","editSettings","manageSecuritySettings"]};return["User Management","Course Management","Announcement Management","Teacher Management","Routine Management","Task Management","Report Viewing","Settings Management"].map((t=>{const r=a[t]||[];let s=0;return s=r.length>0?e.filter((e=>!!e.permissions&&r.some((a=>{var t;return null==(t=e.permissions)?void 0:t.includes(a)})))).length:Math.floor((.7*Math.random()+.3)*e.length),{permission:t,count:s}}))}function ne(e){const a=e.filter((e=>e.isActive));if(0===a.length)return[];const t=[],r=new Date;for(let s=0;s<Math.min(10,2*a.length);s++){const e=a[Math.floor(Math.random()*a.length)],d=Math.floor(48*Math.random()*60),i=new Date(r.getTime()-60*d*1e3),n=`${Math.floor(255*Math.random())}.${Math.floor(255*Math.random())}.${Math.floor(255*Math.random())}.${Math.floor(255*Math.random())}`;t.push({id:`login_${s}_${e.id.substring(0,5)}`,adminId:e.id,adminName:e.username,timestamp:i.toISOString(),ipAddress:n})}return t.sort(((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime())).slice(0,5)}function le(e){return e.reduce(((e,a)=>{const t=a.department||"Unassigned";return e[t]=(e[t]||0)+1,e}),{})}e.useEffect((()=>{localStorage.setItem("is_super_admin","true"),sessionStorage.setItem("is_super_admin","true"),G(),sessionStorage.removeItem("super_admin_reloading"),sessionStorage.removeItem("super_admin_reload_count"),sessionStorage.removeItem("recovering_super_admin"),window.location.pathname.includes("/section-admins")?r("section-admins"):window.location.pathname.includes("/analytics")?r("analytics"):window.location.pathname.includes("/logs")?r("logs"):window.location.pathname.includes("/security")&&r("security")}),[G,r]),e.useEffect((()=>{const e=()=>{const e=window.innerWidth<1024;g(e),!e&&u&&h(!1)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[u]),e.useEffect((()=>{const e=()=>{const e=new Date;p(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));const a=e.getHours();f(a<12?"Good Morning":a<18?"Good Afternoon":"Good Evening")};e();const a=setInterval(e,6e4);return()=>clearInterval(a)}),[]),e.useEffect((()=>{(async()=>{j((e=>({...e,departments:!0})));try{const e=await se();v(e);const a=e.map((e=>de(e.id))),t=(await Promise.all(a)).flat();S(t);const r=t.map((e=>ie(e.id))),s=(await Promise.all(r)).flat();A(s)}catch(e){}finally{j((e=>({...e,departments:!1})))}})()}),[]),e.useEffect((()=>{!U&&F.length>0&&(async()=>{j((e=>({...e,stats:!0})));try{const a={totalAdmins:F.length,activeAdmins:F.filter((e=>e.isActive)).length,disabledAdmins:F.filter((e=>!e.isActive)).length,permissionChanges:Math.floor(15*Math.random())+5,departmentDistribution:W(F),roleDistribution:H(F),monthlyActivity:Z(),permissionUsage:ee(F),recentLogins:ne(F),mostActiveAdmins:(e=F,e.map((e=>{let a=Math.floor(40*Math.random())+10;if(e.isActive&&(a*=1.5),e.lastLogin){const t=new Date(e.lastLogin),r=new Date,s=Math.floor((r.getTime()-t.getTime())/864e5);s<7?a*=1.3:s>30&&(a*=.7)}return{adminId:e.id,adminName:e.username,actionsCount:Math.floor(a)}})).sort(((e,a)=>a.actionsCount-e.actionsCount)).slice(0,5)),adminsByDepartment:le(F)};await new Promise((e=>setTimeout(e,800))),d(a)}catch(a){}finally{j((e=>({...e,stats:!1})))}var e})()}),[F,U]),e.useEffect((()=>{!U&&F.length>0&&(async()=>{j((e=>({...e,logs:!0})));try{const e=function(e){const a=["logged_in","logged_out","created_user","updated_user","deleted_user","reset_password","changed_settings","exported_data","viewed_report"],t=[];for(let r=0;r<50;r++){const s=e[Math.floor(Math.random()*e.length)],d=a[Math.floor(Math.random()*a.length)],i=Math.floor(30*Math.random()),n=new Date;n.setDate(n.getDate()-i);let l={};"created_user"===d||"updated_user"===d||"deleted_user"===d?l={userId:`user_${Math.floor(1e3*Math.random())}`,username:`user${Math.floor(1e3*Math.random())}`}:"changed_settings"===d&&(l={setting:"security_policy",oldValue:"moderate",newValue:"strict"}),t.push({id:`log_${r}`,adminId:s.id,adminName:s.username,action:d,timestamp:n.toISOString(),ipAddress:`192.168.1.${Math.floor(255*Math.random())}`,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",details:l})}return t.sort(((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime()))}(F);await new Promise((e=>setTimeout(e,1e3))),o(e)}catch(e){}finally{j((e=>({...e,logs:!1})))}})()}),[F,U]),e.useEffect((()=>{j((e=>({...e,admins:U})))}),[U]);const oe=()=>{h(!u)};e.useEffect((()=>{}),[F,U,E]);const ce=[{id:"admins",label:"Admins",icon:n,badge:F.length},{id:"section-admins",label:"Section Admins",icon:M},{id:"analytics",label:"Analytics",icon:Y},{id:"logs",label:"Logs",icon:J,badge:l.length},{id:"security",label:"Security",icon:i}];return a.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[a.jsxs("aside",{className:`fixed inset-y-0 left-0 z-10 flex flex-col bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 ${x?u?"translate-x-0":"-translate-x-full":c?"w-16":"w-64"} ${x?"shadow-xl":""}`,children:[a.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-gray-200 dark:border-gray-700",children:[!c&&a.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Super Admin"}),a.jsx("button",{onClick:x?oe:()=>{m(!c)},className:"p-1.5 rounded-lg bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors "+(c?"mx-auto":""),children:a.jsx(V,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 transition-transform "+(c?"rotate-180":"")})})]}),a.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto scrollbar-thin",children:ce.map((e=>a.jsx(ye,{icon:e.icon,label:e.label,isActive:t===e.id,onClick:()=>r(e.id),badge:e.badge,isCollapsed:c},e.id)))}),a.jsx("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700",children:a.jsxs("button",{onClick:async()=>{try{await P(),setTimeout((()=>{window.location.pathname.includes("super-admin")&&(window.location.href="/")}),1e3)}catch(e){alert("Logout failed. Please try again.")}},className:`\n              flex items-center w-full gap-3 px-3 py-2 text-sm text-red-600 dark:text-red-400 rounded-lg\n              hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\n              ${c?"justify-center":""}\n            `,title:"Logout",children:[a.jsx(X,{className:"w-5 h-5"}),!c&&a.jsx("span",{children:"Logout"})]})})]}),x&&u&&a.jsx("div",{className:"fixed inset-0 bg-gray-900/50 z-[5]",onClick:oe}),a.jsxs("main",{className:"flex-1 overflow-y-auto transition-all duration-300 "+(x?"pl-0":c?"pl-16":"pl-64"),children:[a.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10 shadow-sm",children:a.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[x&&a.jsx("button",{onClick:oe,className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:a.jsx(V,{className:"h-5 w-5 "+(u?"":"rotate-180")})}),a.jsxs("div",{className:"flex items-center "+(x?"mx-auto":""),children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:b}),a.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600 mx-2"}),a.jsxs("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[y,", Admin"]})]}),a.jsx("div",{className:"flex items-center space-x-3",children:a.jsx("button",{onClick:D,className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":"Toggle theme",children:_?a.jsx(K,{className:"h-5 w-5"}):a.jsx(Q,{className:"h-5 w-5"})})})]})}),a.jsxs("div",{className:"p-6 dashboard-content",children:["admins"===t&&a.jsx(me,{admins:F,loading:U,error:E,onCreateAdmin:T,onUpdateAdmin:L,onDeleteAdmin:I,onResetPassword:$,onPromoteToAdmin:R,onRefresh:G}),"section-admins"===t&&a.jsx(be,{admins:F,loading:U||w.departments,error:E,onPromoteToSectionAdmin:z,onDemoteUser:q,onDeleteUser:I,onGetSectionUsers:O,onGetSections:B,onRefresh:G,departments:k,batches:N,sections:C}),"analytics"===t&&a.jsx(xe,{stats:s,loading:w.stats}),"logs"===t&&a.jsx(ge,{logs:l,loading:w.logs}),"security"===t&&a.jsx(ue,{admins:F,onResetPassword:$})]})]})]})}export{fe as SuperAdminDashboard};
