const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnnouncementManager.DtGWQWKG.js","assets/js/index.D5HgYyae.js","assets/css/index.CYisyyCB.css","assets/js/megaphone.Bys2W7Q7.js","assets/js/createLucideIcon.CgqYSU6F.js","assets/js/send.Db-Xwmwb.js","assets/js/linkParser.CRNpH1Sh.js","assets/js/calendar.DuEmmdvM.js","assets/js/trash-2.BqyRYTpe.js"])))=>i.map(i=>d[i]);
import{s as e,r as n,_ as t,b as a,j as r}from"./index.D5HgYyae.js";import{a as o}from"./telegram.service.BTr96-Tu.js";import"./dateUtils.8XYiGfWV.js";const c=n.lazy((()=>t((()=>import("./AnnouncementManager.DtGWQWKG.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then((e=>({default:e.AnnouncementManager})))));function s(){const{isSectionAdmin:t,sectionId:s}=a(),{announcements:i,createAnnouncement:u,deleteAnnouncement:l}=function(){const[t,a]=n.useState([]),[r,c]=n.useState(!0),[s,i]=n.useState(null),u=n.useCallback((async(n=!1)=>{try{c(!0);const n=await async function(){try{const{data:n,error:t}=await e.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;return n}catch(s){return console.error("Error fetching announcements:",s),[]}}();a(n)}catch(t){i(t.message)}finally{c(!1)}}),[]);return n.useEffect((()=>{u()}),[u]),{announcements:t,loading:r,error:s,createAnnouncement:async n=>{try{i(null),await async function(n){const{data:{user:t}}=await e.auth.getUser();if(!t)throw new Error("Not authenticated");try{const a=(new Date).toISOString(),{data:r,error:c}=await e.from("announcements").insert({title:n.title,content:n.content,created_by:t.id,created_at:a}).select().single();if(c)throw c;const s={...r,createdAt:a};return await o(s),s}catch(s){throw console.error("Error creating announcement:",s),s}}(n),await u()}catch(t){throw i(t.message),t}},deleteAnnouncement:async n=>{try{i(null),await async function(n){const{data:{user:t}}=await e.auth.getUser();if(!t)throw new Error("Not authenticated");try{const{error:t}=await e.from("announcements").delete().eq("id",n);if(t)throw t}catch(s){throw console.error("Error deleting announcement:",s),s}}(n),await u()}catch(t){throw i(t.message),t}},refreshAnnouncements:n.useCallback((async()=>{try{return await u(!0)}catch(e){throw console.error("Failed to refresh announcements:",e),i(e.message),e}}),[u])}}(),m=n.useMemo((()=>t&&s?i.filter((e=>!e.sectionId||e.sectionId===s)):i),[i,t,s]);return r.jsx(n.Suspense,{fallback:r.jsxs("div",{className:"space-y-4 animate-pulse",children:[r.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"}),[1,2,3].map((e=>r.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-xl"},e)))]}),children:r.jsx(c,{announcements:m,onCreateAnnouncement:u,onDeleteAnnouncement:l})})}export{s as AnnouncementsPage};
