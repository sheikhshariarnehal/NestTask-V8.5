import{j as e,r as a,u as s,g as t}from"./react-vendor.BQ9wcLSU.js";import{ao as r,h as i,ap as d,aq as l,ar as n,as as o,at as c,au as m}from"./vendor.Vy3uO1vB.js";import{LucideX as x,ChevronRight as g,ChevronLeft as h,LayoutDashboard as u,LucideShield as p,LucideUsers as b,Activity as y,FileText as f,LucideSettings as j,CheckCircle as v,Database as w,Layers as N,LucideTrendingUp as k,LucideRefreshCw as _,LucidePlus as C,LucideSearch as A,Download as S,Edit as U,Key as E,LucideMoreVertical as L,ArrowUpRight as D,ArrowDownRight as F,LucideUserCheck as M,ChevronDown as R,Filter as T,ChevronUp as I,LucideUserX as $,LucidePieChart as q,Building as P,BarChart as z,Clock as O,CalendarClock as B,ArrowDownAZ as V,ArrowUpAZ as H,LucideUser as Y,EyeOff as W,Eye as J,Check as G,Copy as X,AlertTriangle as K,LucideUserPlus as Q,Crown as Z,LucideShieldCheck as ee,Calendar as ae,AlertCircle as se,LucideMail as te,LucidePhone as re,Edit2 as ie,LucideTrash2 as de,LucideMenu as le,Bell as ne,LucideSun as oe,LucideMoon as ce,LogOut as me}from"./icons.B5_ZQj31.js";import{s as xe}from"./index.DHgWRtD1.js";import{s as ge,a as he}from"./notifications.BFXTDsYM.js";import{u as ue}from"./useTheme.CGN4hm2q.js";import{u as pe}from"./useAuth.BFcx65Ch.js";import"./charts.DuHk9BWv.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.ClmuHuJk.js";import"./supabase-vendor.nnmAzafq.js";import"./dataCache.DP4PyhNH.js";import"./authErrors.BDay5vyW.js";function be(...e){return r(i(e))}const ye=[{id:"overview",label:"Overview",icon:u},{id:"admins",label:"Admin Management",icon:p},{id:"section-admins",label:"Section Admins",icon:b},{id:"analytics",label:"Analytics",icon:y},{id:"logs",label:"System Logs",icon:f},{id:"security",label:"Security Settings",icon:j}];function fe({activeTab:a,onTabChange:s,isCollapsed:t,onToggleCollapse:r,isMobile:i=!1,isOpen:d=!1,onClose:l}){return i?e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:l}),e.jsxs("div",{className:be("fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 lg:hidden",d?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(x,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"p-4 space-y-2",children:ye.map((t=>{const r=t.icon,i=a===t.id;return e.jsxs("button",{onClick:()=>{s(t.id),null==l||l()},className:be("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",i?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(r,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t.label})]},t.id)}))})]})]}):e.jsxs("div",{className:be("hidden lg:flex flex-col bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transition-all duration-300",t?"w-20":"w-64"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800",children:[!t&&e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg ml-auto",children:t?e.jsx(g,{className:"w-5 h-5"}):e.jsx(h,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:ye.map((r=>{const i=r.icon,d=a===r.id;return e.jsxs("button",{onClick:()=>s(r.id),className:be("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",d?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",t&&"justify-center"),title:t?r.label:void 0,children:[e.jsx(i,{className:"w-5 h-5 flex-shrink-0"}),!t&&e.jsx("span",{className:"font-medium",children:r.label})]},r.id)}))})]})}const je=a.forwardRef((({className:a,...s},t)=>e.jsx("div",{ref:t,className:be("rounded-xl border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-900 dark:text-gray-50",a),...s})));je.displayName="Card";const ve=a.forwardRef((({className:a,...s},t)=>e.jsx("div",{ref:t,className:be("flex flex-col space-y-1.5 p-6",a),...s})));ve.displayName="CardHeader";const we=a.forwardRef((({className:a,...s},t)=>e.jsx("h3",{ref:t,className:be("font-semibold leading-none tracking-tight",a),...s})));we.displayName="CardTitle";const Ne=a.forwardRef((({className:a,...s},t)=>e.jsx("p",{ref:t,className:be("text-sm text-gray-500 dark:text-gray-400",a),...s})));Ne.displayName="CardDescription";const ke=a.forwardRef((({className:a,...s},t)=>e.jsx("div",{ref:t,className:be("p-6 pt-0",a),...s})));ke.displayName="CardContent",a.forwardRef((({className:a,...s},t)=>e.jsx("div",{ref:t,className:be("flex items-center p-6 pt-0",a),...s}))).displayName="CardFooter";const _e=d("inline-flex items-center rounded-md border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",{variants:{variant:{default:"border-transparent bg-gray-900 text-gray-50 shadow hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",secondary:"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",destructive:"border-transparent bg-red-500 text-gray-50 shadow hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",outline:"text-gray-950 dark:text-gray-50",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"}},defaultVariants:{variant:"default"}});function Ce({className:a,variant:s,...t}){return e.jsx("div",{className:be(_e({variant:s}),a),...t})}function Ae(){const[s,t]=a.useState(null),[r,i]=a.useState([]),[d,l]=a.useState(!0);a.useEffect((()=>{n()}),[]);const n=async()=>{try{l(!0);const{data:e,error:a}=await xe.rpc("get_dashboard_stats",{});if(a){const[e,a,s,r,i,d,l,n]=await Promise.all([xe.from("users").select("*",{count:"exact",head:!0}),xe.from("users").select("*",{count:"exact",head:!0}).eq("role","admin"),xe.from("users").select("*",{count:"exact",head:!0}).eq("role","section_admin"),xe.from("tasks").select("*",{count:"exact",head:!0}),xe.from("tasks").select("*",{count:"exact",head:!0}).eq("status","completed"),xe.from("departments").select("*",{count:"exact",head:!0}),xe.from("batches").select("*",{count:"exact",head:!0}),xe.from("sections").select("*",{count:"exact",head:!0})]);t({total_users:e.count||0,total_admins:a.count||0,total_section_admins:s.count||0,total_tasks:r.count||0,completed_tasks:i.count||0,total_departments:d.count||0,total_batches:l.count||0,total_sections:n.count||0})}else t(e);const{data:s}=await xe.from("activities").select("\n          id,\n          type,\n          title,\n          metadata,\n          created_at,\n          user:users(name, email)\n        ").order("created_at",{ascending:!1}).limit(10);s&&i(s.map((e=>({...e,user:Array.isArray(e.user)?e.user[0]:e.user}))))}catch(e){}finally{l(!1)}},o=s?[{title:"Total Users",value:s.total_users,change:"+12%",icon:b,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{title:"Admins",value:s.total_admins,change:"+3%",icon:p,color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{title:"Section Admins",value:s.total_section_admins,change:"+8%",icon:b,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20"},{title:"Total Tasks",value:s.total_tasks,change:"+24%",icon:v,color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{title:"Completed Tasks",value:s.completed_tasks,change:`${s.total_tasks>0?Math.round(s.completed_tasks/s.total_tasks*100):0}%`,icon:v,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20"},{title:"Departments",value:s.total_departments,change:"",icon:w,color:"text-indigo-600",bgColor:"bg-indigo-50 dark:bg-indigo-900/20"},{title:"Batches",value:s.total_batches,change:"",icon:N,color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/20"},{title:"Sections",value:s.total_sections,change:"",icon:N,color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/20"}]:[];return d?e.jsx("div",{className:"space-y-6 animate-pulse",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map((a=>e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"},a)))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.map(((a,s)=>{var t;const r=a.icon;return e.jsxs(je,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(ve,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(we,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:a.title}),e.jsx("div",{className:`p-2 rounded-lg ${a.bgColor}`,children:e.jsx(r,{className:`w-5 h-5 ${a.color}`})})]}),e.jsxs(ke,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Number(null!=(t=a.value)?t:0).toLocaleString()}),a.change&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1 mt-1",children:[e.jsx(k,{className:"w-3 h-3"}),a.change," from last month"]})]})]},s)}))}),e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Recent Activity"]}),e.jsx(Ne,{children:"Latest system activities and updates"})]}),e.jsx(ke,{children:0===r.length?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:"No recent activities to display"}):e.jsx("div",{className:"space-y-4",children:r.map((a=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-50 dark:bg-blue-900/20",children:e.jsx(y,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.user&&"object"==typeof a.user&&!Array.isArray(a.user)?a.user.name||a.user.email:"System"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(Ce,{variant:"secondary",className:"text-xs",children:a.type}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(a.created_at).toLocaleDateString()})]})]},a.id)))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Organization Structure"]}),e.jsx(Ne,{children:"Hierarchical breakdown"})]}),e.jsx(ke,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Departments"}),e.jsx(Ce,{variant:"info",children:(null==s?void 0:s.total_departments)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Batches"}),e.jsx(Ce,{variant:"info",children:(null==s?void 0:s.total_batches)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sections"}),e.jsx(Ce,{variant:"info",children:(null==s?void 0:s.total_sections)||0})]})]})})]}),e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Task Overview"]}),e.jsx(Ne,{children:"Current task statistics"})]}),e.jsx(ke,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Tasks"}),e.jsx(Ce,{variant:"info",children:(null==s?void 0:s.total_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completed"}),e.jsx(Ce,{variant:"success",children:(null==s?void 0:s.completed_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pending"}),e.jsx(Ce,{variant:"warning",children:((null==s?void 0:s.total_tasks)||0)-((null==s?void 0:s.completed_tasks)||0)})]})]})})]})]})]})}const Se=d("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50 dark:focus-visible:ring-gray-300",{variants:{variant:{default:"bg-gray-900 text-gray-50 shadow hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",destructive:"bg-red-500 text-gray-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",outline:"border border-gray-200 bg-white shadow-sm hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",secondary:"bg-gray-100 text-gray-900 shadow-sm hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",link:"text-gray-900 underline-offset-4 hover:underline dark:text-gray-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ue=a.forwardRef((({className:a,variant:s,size:t,asChild:r=!1,...i},d)=>{const n=r?l:"button";return e.jsx(n,{className:be(Se({variant:s,size:t,className:a})),ref:d,...i})}));Ue.displayName="Button";const Ee=a.forwardRef((({className:a,type:s,...t},r)=>e.jsx("input",{type:s,className:be("flex h-9 w-full rounded-md border border-gray-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",a),ref:r,...t})));Ee.displayName="Input";const Le=a.forwardRef((({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:be("w-full caption-bottom text-sm",a),...s})})));Le.displayName="Table";const De=a.forwardRef((({className:a,...s},t)=>e.jsx("thead",{ref:t,className:be("[&_tr]:border-b",a),...s})));De.displayName="TableHeader";const Fe=a.forwardRef((({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:be("[&_tr:last-child]:border-0",a),...s})));Fe.displayName="TableBody",a.forwardRef((({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:be("border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",a),...s}))).displayName="TableFooter";const Me=a.forwardRef((({className:a,...s},t)=>e.jsx("tr",{ref:t,className:be("border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",a),...s})));Me.displayName="TableRow";const Re=a.forwardRef((({className:a,...s},t)=>e.jsx("th",{ref:t,className:be("h-10 px-2 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-gray-400",a),...s})));Re.displayName="TableHead";const Te=a.forwardRef((({className:a,...s},t)=>e.jsx("td",{ref:t,className:be("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s})));Te.displayName="TableCell",a.forwardRef((({className:a,...s},t)=>e.jsx("caption",{ref:t,className:be("mt-4 text-sm text-gray-500 dark:text-gray-400",a),...s}))).displayName="TableCaption";const Ie=a.forwardRef((({className:a,...s},t)=>e.jsx(n,{ref:t,className:be("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s})));Ie.displayName=n.displayName,a.forwardRef((({className:a,...s},t)=>e.jsx(o,{ref:t,className:be("aspect-square h-full w-full",a),...s}))).displayName=o.displayName;const $e=a.forwardRef((({className:a,...s},t)=>e.jsx(c,{ref:t,className:be("flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",a),...s})));async function qe(e,a,s,t,r){try{const{data:i,error:d}=await xe.from("users").select("name").eq("id",e).single();if(d)return;const{error:l}=await xe.from("admin_logs").insert([{admin_id:e,admin_name:(null==i?void 0:i.name)||"Unknown",action:a,details:s,timestamp:(new Date).toISOString(),resource:t,resource_id:r}])}catch(i){}}function Pe(){const[e,s]=a.useState([]),[t,r]=a.useState(!0),[i,d]=a.useState(null),l=a.useCallback((async()=>{r(!0),d(null);try{const e=await async function(){try{const{data:{user:e}}=await xe.auth.getUser(),{data:a,error:s}=await xe.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").order("created_at",{ascending:!1});if(s)throw new Error(s.message||"Failed to fetch admin users");const{data:t}=await xe.from("departments").select("id, name"),{data:r}=await xe.from("batches").select("id, name"),{data:i}=await xe.from("sections").select("id, name"),d=new Map((null==t?void 0:t.map((e=>[e.id,e.name])))||[]),l=new Map((null==r?void 0:r.map((e=>[e.id,e.name])))||[]),n=new Map((null==i?void 0:i.map((e=>[e.id,e.name])))||[]);return(null==a?void 0:a.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:d.get(e.department_id)||"",departmentId:e.department_id,batch:l.get(e.batch_id)||"",batchId:e.batch_id,section:n.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[]}catch(i){throw new Error(i.message||"Failed to fetch admin users")}}();s(e)}catch(e){d(e.message||"Failed to fetch admin users")}finally{r(!1)}}),[]);return a.useEffect((()=>{l()}),[l]),{admins:e,loading:t,error:i,createAdmin:async e=>{r(!0),d(null);try{const a=Math.random().toString(36).slice(-8)+Math.random().toString(36).slice(-8).toUpperCase()+"!1",s=await async function(e,a){try{const{data:{user:s}}=await xe.auth.getUser(),{data:t,error:r}=await xe.auth.admin.createUser({email:e.email,password:a,email_confirm:!0,user_metadata:{name:e.username,role:e.role,department:e.department||null}});if(r||!t.user)throw new Error((null==r?void 0:r.message)||"Failed to create admin user");const{data:i,error:d}=await xe.from("users").update({permissions:e.permissions,status:e.status,department:e.department}).eq("id",t.user.id).select();if(d)throw new Error(d.message||"Failed to create admin user");return s&&await qe(s.id,"create_admin",`Created admin user: ${e.email}`),{id:t.user.id,username:e.username,email:e.email,role:e.role,department:e.department,permissions:e.permissions,status:e.status,isActive:"active"===e.status,createdAt:(new Date).toISOString(),phone:e.phone,studentId:e.studentId}}catch(i){throw new Error(i.message||"Failed to create admin user")}}(e,a);return await l(),s}catch(a){throw d(a.message||"Failed to create admin user"),a}finally{r(!1)}},updateAdmin:async(e,a)=>{r(!0),d(null);try{await async function(e,a){try{const{data:{user:s}}=await xe.auth.getUser();if(a.email||a.role||a.username){const{error:s}=await xe.auth.admin.updateUserById(e,{email:a.email,user_metadata:{name:a.username,role:a.role,department:a.department}});if(s)throw new Error(s.message||"Failed to update admin user")}const t={};a.permissions&&(t.permissions=a.permissions),a.status&&(t.status=a.status),a.department&&(t.department=a.department);const{data:r,error:i}=await xe.from("users").update(t).eq("id",e).select();if(i)throw new Error(i.message||"Failed to update admin user");s&&await qe(s.id,"update_admin",`Updated admin user: ${e}`);const d=null==r?void 0:r[0];return{id:d.id,username:d.name||"",email:d.email||"",role:d.role||"admin",department:d.department,permissions:d.permissions||[],status:d.status||"active",isActive:"active"===d.status,lastLogin:d.last_active,createdAt:d.created_at,updatedAt:d.updated_at,phone:d.phone||"",studentId:d.student_id||""}}catch(i){throw new Error(i.message||"Failed to update admin user")}}(e,a),await l()}catch(s){throw d(s.message||"Failed to update admin user"),s}finally{r(!1)}},deleteAdmin:async e=>{r(!0),d(null);try{await async function(e){try{const{data:{user:s}}=await xe.auth.getUser(),{data:t,error:r}=await xe.from("users").select("*").eq("id",e).single();if(r)throw new Error(r.message||"Failed to delete admin user");try{const{error:a}=await xe.from("admin_archives").insert([{admin_id:e,admin_data:t,archived_by:(null==s?void 0:s.id)||"system",archived_at:(new Date).toISOString()}])}catch(a){}const{error:i}=await xe.auth.admin.deleteUser(e);if(i)throw new Error(i.message||"Failed to delete admin user");s&&await qe(s.id,"delete_admin",`Deleted admin user: ${e}`)}catch(i){throw new Error(i.message||"Failed to delete admin user")}}(e),await l()}catch(a){throw d(a.message||"Failed to delete admin user"),a}finally{r(!1)}},resetPassword:async(e,a)=>{r(!0),d(null);try{const s=await async function(e,a){try{const{data:{user:t}}=await xe.auth.getUser(),{error:r}=await xe.auth.admin.updateUserById(e,{password:a});if(r)throw new Error(r.message||"Failed to reset admin password");try{t&&await qe(t.id,"reset_password",`Reset password for admin: ${e}`)}catch(s){}return!0}catch(i){throw new Error(i.message||"Failed to reset admin password")}}(e,a);return await l(),s}catch(s){return d(s.message||"Failed to reset admin password"),!1}finally{r(!1)}},promoteToAdmin:async e=>{r(!0),d(null);try{await async function(e){var a;try{const{data:{user:s}}=await xe.auth.getUser();let t="super-admin"===(null==(a=null==s?void 0:s.user_metadata)?void 0:a.role);if(!t){const{data:e,error:a}=await xe.from("users").select("role").eq("id",null==s?void 0:s.id).single();!a&&e&&(t="super-admin"===e.role)}if(!t)throw new Error("Unauthorized: Only super admins can promote users to admin");const{error:r}=await xe.from("users").update({role:"admin"}).eq("id",e);if(r)throw new Error(r.message||"Failed to promote user to admin");s&&await qe(s.id,"promote_to_admin",`Promoted user ${e} to admin role`)}catch(i){throw new Error(i.message||"Failed to promote user to admin")}}(e),await l()}catch(a){throw d(a.message||"Failed to promote user to admin"),a}finally{r(!1)}},promoteToSectionAdmin:async a=>{r(!0),d(null);try{const s=e.find((e=>e.id===a));if(!s)throw new Error("User not found");if(!s.sectionId)throw new Error("User does not have a section assigned. Please assign a section first.");await async function(e){try{const{data:a,error:s}=await xe.rpc("promote_user_to_section_admin",{input_user_id:e});if(s)throw new Error(s.message||"Failed to promote user to section admin")}catch(i){throw new Error(i.message||"Failed to promote user to section admin")}}(a),await l()}catch(s){throw d(s.message||"Failed to promote user to section admin"),s}finally{r(!1)}},demoteUser:async a=>{r(!0),d(null);try{const s=e.find((e=>e.id===a));if(!s)throw new Error("User not found");if("super-admin"===s.role)throw new Error("Super admins cannot be demoted through this interface");await async function(e){try{const{data:a,error:s}=await xe.rpc("demote_user_to_regular",{user_id:e});if(s)throw new Error(s.message||"Failed to demote user")}catch(i){throw new Error(i.message||"Failed to demote user")}}(a),await l()}catch(s){throw d(s.message||"Failed to demote user"),s}finally{r(!1)}},getSectionUsers:async e=>{r(!0),d(null);try{const a=await async function(e){try{const{data:{user:a}}=await xe.auth.getUser();if(!e)throw new Error("No section ID provided");const{data:s,error:t}=await xe.from("sections").select("id, name, batch_id").eq("id",e).single(),{data:r,error:i}=await xe.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").eq("section_id",e).order("created_at",{ascending:!1});if(i)throw new Error(i.message||"Failed to fetch section users");const{data:d}=await xe.from("departments").select("id, name"),{data:l}=await xe.from("batches").select("id, name"),{data:n}=await xe.from("sections").select("id, name"),o=new Map((null==d?void 0:d.map((e=>[e.id,e.name])))||[]),c=new Map((null==l?void 0:l.map((e=>[e.id,e.name])))||[]),m=new Map((null==n?void 0:n.map((e=>[e.id,e.name])))||[]),x=(null==r?void 0:r.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:o.get(e.department_id)||"",departmentId:e.department_id,batch:c.get(e.batch_id)||"",batchId:e.batch_id,section:m.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[];if(0===x.length){const{data:e,error:a}=await xe.from("users").select("id, email, section_id").not("section_id","is",null).limit(5);a||e.length}return x}catch(i){throw new Error(i.message||"Failed to fetch section users")}}(e);return a}catch(a){throw d(a.message||"Failed to fetch section users"),a}finally{r(!1)}},getSections:async(e,a)=>{r(!0),d(null);try{const s=await async function(e,a){try{let s=xe.from("sections").select("id, name, batch_id");e&&(s=s.eq("batch_id",e));const{data:t,error:r}=await s.order("name");if(r)throw new Error(r.message||"Failed to fetch sections");if(a&&!e){const{data:e,error:s}=await xe.from("batches").select("id").eq("department_id",a);if(s)throw new Error(s.message||"Failed to fetch batches");const r=e.map((e=>e.id));return t.filter((e=>r.includes(e.batch_id)))}return t||[]}catch(i){throw new Error(i.message||"Failed to fetch sections")}}(e,a);return s}catch(s){throw d(s.message||"Failed to fetch sections"),s}finally{r(!1)}},refreshAdmins:l}}function ze(){const[s,t]=a.useState(""),[r,i]=a.useState("all"),[d,l]=a.useState("all"),{admins:n,loading:o,error:c,refreshAdmins:m}=Pe(),x=n.filter((e=>{var a,t,i;const l=(null==(a=e.username)?void 0:a.toLowerCase().includes(s.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(s.toLowerCase()))||(null==(i=e.department)?void 0:i.toLowerCase().includes(s.toLowerCase())),n="all"===r||e.role===r,o="all"===d||("active"===d?e.isActive:!e.isActive);return l&&n&&o})),g=a=>{switch(a){case"super-admin":return e.jsx(Ce,{variant:"destructive",children:"Super Admin"});case"admin":return e.jsx(Ce,{variant:"info",children:"Admin"});case"section_admin":return e.jsx(Ce,{variant:"warning",children:"Section Admin"});default:return e.jsx(Ce,{variant:"secondary",children:"User"})}};return o&&0===n.length?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-800 rounded-xl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(je,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(we,{className:"text-2xl",children:"Admin Management"}),e.jsx(Ne,{children:"Manage system administrators and their permissions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ue,{variant:"outline",size:"sm",onClick:async()=>{try{await m(),ge("Admins refreshed successfully")}catch(e){he("Failed to refresh admins")}},disabled:o,children:[e.jsx(_,{className:"w-4 h-4 mr-2 "+(o?"animate-spin":"")}),"Refresh"]}),e.jsxs(Ue,{size:"sm",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Admin"]})]})]})}),e.jsx(ke,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ee,{placeholder:"Search by name, email, or department...",value:s,onChange:e=>t(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"user",children:"User"})]}),e.jsxs("select",{value:d,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs(Ue,{variant:"outline",size:"sm",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(je,{children:e.jsxs(ve,{className:"pb-2",children:[e.jsx(Ne,{children:"Total Admins"}),e.jsx(we,{className:"text-3xl",children:n.length})]})}),e.jsx(je,{children:e.jsxs(ve,{className:"pb-2",children:[e.jsx(Ne,{children:"Active"}),e.jsx(we,{className:"text-3xl text-green-600",children:n.filter((e=>e.isActive)).length})]})}),e.jsx(je,{children:e.jsxs(ve,{className:"pb-2",children:[e.jsx(Ne,{children:"Super Admins"}),e.jsx(we,{className:"text-3xl text-purple-600",children:n.filter((e=>"super-admin"===e.role)).length})]})}),e.jsx(je,{children:e.jsxs(ve,{className:"pb-2",children:[e.jsx(Ne,{children:"Section Admins"}),e.jsx(we,{className:"text-3xl text-blue-600",children:n.filter((e=>"section_admin"===e.role)).length})]})})]}),e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsxs(we,{children:["Administrators (",x.length,")"]}),e.jsx(Ne,{children:s||"all"!==r||"all"!==d?`Showing ${x.length} of ${n.length} admins`:"All system administrators"})]}),e.jsxs(ke,{children:[c&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:c}),0===x.length?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No admins found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Le,{children:[e.jsx(De,{children:e.jsxs(Me,{children:[e.jsx(Re,{children:"Admin"}),e.jsx(Re,{children:"Role"}),e.jsx(Re,{children:"Department"}),e.jsx(Re,{children:"Status"}),e.jsx(Re,{children:"Joined"}),e.jsx(Re,{className:"text-right",children:"Actions"})]})}),e.jsx(Fe,{children:x.map((a=>{var s,t,r;return e.jsxs(Me,{children:[e.jsx(Te,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"h-10 w-10",children:e.jsx($e,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:(null==(s=a.username)?void 0:s.charAt(0).toUpperCase())||(null==(t=a.email)?void 0:t.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.username||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.email})]})]})}),e.jsx(Te,{children:g(a.role||"user")}),e.jsx(Te,{className:"text-gray-600 dark:text-gray-400",children:a.department||"N/A"}),e.jsx(Te,{children:(r=a.isActive,r?e.jsx(Ce,{variant:"success",children:"Active"}):e.jsx(Ce,{variant:"secondary",children:"Inactive"}))}),e.jsx(Te,{className:"text-gray-600 dark:text-gray-400",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"N/A"}),e.jsx(Te,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(Ue,{variant:"ghost",size:"sm",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx(Ue,{variant:"ghost",size:"sm",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx(Ue,{variant:"ghost",size:"sm",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},a.id)}))})]})})]})]})]})}function Oe({stats:s,loading:t}){const[r,i]=a.useState("30d"),[d,l]=a.useState("all"),[n,o]=a.useState(!1),[c,m]=a.useState(!1),[x,g]=a.useState({admins:0,active:0,disabled:0,permissions:0}),h=(null==s?void 0:s.departmentDistribution)?["all",...s.departmentDistribution.map((e=>e.department))]:["all"];a.useEffect((()=>{s&&g({admins:Math.floor(20*Math.random())-10,active:Math.floor(15*Math.random()),disabled:Math.floor(10*Math.random())-7,permissions:Math.floor(30*Math.random())-10})}),[s]);const u=a.useCallback((()=>{m(!0),setTimeout((()=>{m(!1)}),1500)}),[]),f=a.useCallback((()=>{const a=(null==s?void 0:s.departmentDistribution)||[],t=Math.max(...a.map((e=>e.count)),1);return e.jsx("div",{className:"space-y-3",children:a.map((a=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[70%]",children:a.department}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:a.count}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 ml-1",children:"admins"})]})]}),e.jsx("div",{className:"overflow-hidden h-2.5 text-xs flex rounded-full bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{style:{width:a.count/t*100+"%"},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 dark:bg-blue-600 rounded-full transition-all duration-500"})})]},a.department)))})}),[null==s?void 0:s.departmentDistribution]),j=a.useCallback((()=>{const a=(null==s?void 0:s.totalAdmins)||0,t=(null==s?void 0:s.activeAdmins)||0,r=(null==s?void 0:s.disabledAdmins)||0,i=a>0?Math.round(t/a*100):0,d=2*Math.PI*16,l=i/100*d;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"relative h-32 w-32",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 36 36",children:[e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"#E5E7EB",strokeWidth:"3.6",className:"dark:stroke-gray-700"}),e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"#3B82F6",strokeWidth:"3.6",strokeDasharray:`${l} ${d}`,strokeDashoffset:"0",strokeLinecap:"round",className:"dark:stroke-blue-500 transition-all duration-1000 ease-in-out",transform:"rotate(-90 18 18)"}),e.jsxs("text",{x:"18",y:"18",dy:".35em",dominantBaseline:"middle",textAnchor:"middle",fill:"#4B5563",className:"dark:fill-white text-3xl font-bold",children:[i,"%"]})]})}),e.jsx("div",{className:"flex-1 pl-5",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-blue-500 dark:bg-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Active"})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xl font-bold text-gray-800 dark:text-white",children:t}),x.active>0&&e.jsxs("div",{className:"flex items-center ml-2 text-xs text-green-500",children:[e.jsx(D,{className:"h-3 w-3"}),e.jsxs("span",{children:[x.active,"%"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-300 dark:bg-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Disabled"})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xl font-bold text-gray-800 dark:text-white",children:r}),x.disabled<0&&e.jsxs("div",{className:"flex items-center ml-2 text-xs text-red-500",children:[e.jsx(F,{className:"h-3 w-3"}),e.jsxs("span",{children:[Math.abs(x.disabled),"%"]})]})]})]})]})})]})}),[null==s?void 0:s.totalAdmins,null==s?void 0:s.activeAdmins,null==s?void 0:s.disabledAdmins,x]),v=a.useCallback((()=>{const a=(null==s?void 0:s.permissionUsage)||[];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map((a=>{const t=Math.min(100,Math.round(a.count/((null==s?void 0:s.totalAdmins)||1)*100));return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[80%]",children:a.permission}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-900 dark:text-white",children:[t,"%"]}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",a.count,")"]})]})]}),e.jsx("div",{className:"overflow-hidden h-2 text-xs flex rounded-full bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{style:{width:`${t}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center rounded-full transition-all duration-500 "+(t>75?"bg-green-500 dark:bg-green-600":t>50?"bg-blue-500 dark:bg-blue-600":t>25?"bg-amber-500 dark:bg-amber-600":"bg-red-500 dark:bg-red-600")})})]},a.permission)}))})}),[null==s?void 0:s.permissionUsage,null==s?void 0:s.totalAdmins]),w=a.useCallback((()=>{if(!(null==s?void 0:s.monthlyActivity)||0===s.monthlyActivity.length)return e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-500 dark:text-gray-400",children:"No activity data available"});const a=s.monthlyActivity,t=Math.max(...a.map((e=>e.logins))),r=Math.max(...a.map((e=>e.actions)));return e.jsxs("div",{className:"pt-5",children:[e.jsx("div",{className:"flex items-end justify-between space-x-1 h-[180px]",children:a.map((a=>e.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[e.jsxs("div",{className:"relative w-full flex justify-center",children:[e.jsxs("div",{className:"absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-900 text-white text-xs rounded py-1 px-2 pointer-events-none z-10 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:a.month}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"Logins:"}),e.jsx("span",{children:a.logins})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"Actions:"}),e.jsx("span",{children:a.actions})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-3 bg-blue-500 dark:bg-blue-600 rounded-t hover:bg-blue-600 dark:hover:bg-blue-700 transition-all cursor-pointer group-hover:opacity-90",style:{height:a.logins/t*100+"%"}}),e.jsx("div",{className:"w-3 bg-purple-500 dark:bg-purple-600 rounded-t hover:bg-purple-600 dark:hover:bg-purple-700 transition-all cursor-pointer group-hover:opacity-90",style:{height:a.actions/r*100+"%"}})]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:a.month.substring(0,3)})]},a.month)))}),e.jsxs("div",{className:"flex justify-center mt-4 space-x-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-3 w-3 rounded bg-blue-500 dark:bg-blue-600 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Logins"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-3 w-3 rounded bg-purple-500 dark:bg-purple-600 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Actions"})]})]})]})}),[null==s?void 0:s.monthlyActivity]),N=a.useCallback((()=>(null==s?void 0:s.mostActiveAdmins)&&0!==s.mostActiveAdmins.length?e.jsx("div",{className:"space-y-3",children:s.mostActiveAdmins.map(((a,s)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-750 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 mr-3 font-semibold",children:s+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:a.adminName}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.adminId.substring(0,8)})]})]}),e.jsxs("div",{className:"flex items-center bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded-full",children:[e.jsx(y,{className:"h-3.5 w-3.5 text-blue-600 dark:text-blue-400 mr-1.5"}),e.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:a.actionsCount})]})]},a.adminId)))}):e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No activity data available"})),[null==s?void 0:s.mostActiveAdmins]),k=a.useCallback((()=>(null==s?void 0:s.recentLogins)&&0!==s.recentLogins.length?e.jsx("div",{className:"space-y-3",children:s.recentLogins.map((a=>{const s=new Date(a.timestamp),t=(new Date).getTime()-s.getTime(),r=Math.floor(t/864e5),i=Math.floor(t/36e5),d=Math.floor(t/6e4);let l;return l=r>0?`${r}d ago`:i>0?`${i}h ago`:`${d}m ago`,e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-750 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400 mr-3",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:a.adminName}),e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a.ipAddress}),e.jsx("span",{className:"mx-1.5 h-1 w-1 rounded-full bg-gray-300 dark:bg-gray-700"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:l})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},a.adminId)}))}):e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No recent login data available"})),[null==s?void 0:s.recentLogins]);return e.jsxs("div",{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2"}),"Admin Analytics Dashboard"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Comprehensive analytics for monitoring admin activity and usage patterns."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:r,onChange:e=>i(e.target.value),className:"appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 pr-8 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"}),e.jsx("option",{value:"90d",children:"Last 90 days"}),e.jsx("option",{value:"1y",children:"Last year"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300",children:e.jsx(R,{className:"h-4 w-4"})})]}),e.jsxs("button",{onClick:()=>o(!n),className:"flex items-center justify-center gap-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-650 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Filters"}),n?e.jsx(I,{className:"h-4 w-4"}):e.jsx(R,{className:"h-4 w-4"})]}),e.jsxs("button",{onClick:u,disabled:c,className:"flex items-center justify-center gap-1.5 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 border border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-400 py-2 px-3 rounded-lg text-sm font-medium transition-colors "+(c?"opacity-70 cursor-not-allowed":""),children:[e.jsx(_,{className:"h-4 w-4 "+(c?"animate-spin":"")}),e.jsx("span",{children:c?"Refreshing...":"Refresh Data"})]})]})]}),n&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-750 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Department"}),e.jsx("select",{value:d,onChange:e=>l(e.target.value),className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:h.map((a=>e.jsx("option",{value:a,children:"all"===a?"All Departments":a},a)))})]})})}),t?e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map(((a,s)=>e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"},s)))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[...Array(4)].map(((a,s)=>e.jsx("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded-lg"},s)))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Admins"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==s?void 0:s.totalAdmins)||0}),e.jsxs("div",{className:"flex items-center ml-2 text-xs "+(x.admins>0?"text-green-500":x.admins<0?"text-red-500":"text-gray-500"),children:[x.admins>0?e.jsx(D,{className:"h-3 w-3 mr-0.5"}):x.admins<0?e.jsx(F,{className:"h-3 w-3 mr-0.5"}):null,e.jsxs("span",{children:[Math.abs(x.admins),"%"]})]})]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:e.jsx(b,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Active Admins"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==s?void 0:s.activeAdmins)||0}),e.jsxs("div",{className:"flex items-center ml-2 text-xs text-green-500",children:[e.jsx(D,{className:"h-3 w-3 mr-0.5"}),e.jsxs("span",{children:[x.active,"%"]})]})]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400",children:e.jsx(M,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Disabled Admins"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==s?void 0:s.disabledAdmins)||0}),0!==x.disabled&&e.jsxs("div",{className:"flex items-center ml-2 text-xs "+(x.disabled<0?"text-green-500":"text-red-500"),children:[x.disabled<0?e.jsx(F,{className:"h-3 w-3 mr-0.5"}):e.jsx(D,{className:"h-3 w-3 mr-0.5"}),e.jsxs("span",{children:[Math.abs(x.disabled),"%"]})]})]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400",children:e.jsx($,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Permission Changes"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==s?void 0:s.permissionChanges)||0}),e.jsx("div",{className:"flex items-center ml-2 text-xs "+(x.permissions>0?"text-amber-500":x.permissions<0?"text-blue-500":"text-gray-500"),children:0!==x.permissions&&e.jsxs(e.Fragment,{children:[x.permissions>0?e.jsx(D,{className:"h-3 w-3 mr-0.5"}):e.jsx(F,{className:"h-3 w-3 mr-0.5"}),e.jsxs("span",{children:[Math.abs(x.permissions),"%"]})]})})]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-amber-600 dark:text-amber-400",children:e.jsx(p,{className:"h-6 w-6"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Active vs Disabled Admins"}),e.jsx(q,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),j()]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Admin Distribution by Department"}),e.jsx(P,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),f()]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Monthly Admin Activity"}),e.jsx(z,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),w()]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Permission Usage Patterns"}),e.jsx(p,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),v()]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Most Active Admins"}),e.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),N(),(null==s?void 0:s.mostActiveAdmins)&&s.mostActiveAdmins.length>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-500 font-medium flex items-center justify-center w-full",children:[e.jsx(S,{className:"h-4 w-4 mr-1.5"}),"Export Activity Report"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-5 rounded-lg shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Recent Admin Logins"}),e.jsx(O,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})]}),k(),(null==s?void 0:s.recentLogins)&&s.recentLogins.length>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-500 font-medium flex items-center justify-center w-full",children:[e.jsx(S,{className:"h-4 w-4 mr-1.5"}),"Export Login Report"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2 mb-6",children:[e.jsx(_,{className:"h-3.5 w-3.5 "+(c?"animate-spin text-blue-500":"")}),e.jsx("span",{className:"flex items-center",children:c?"Refreshing data...":`Last updated: ${(new Date).toLocaleString()}`})]})]})}function Be({logs:s,loading:t}){const[r,i]=a.useState(""),[d,l]=a.useState([]),[n,o]=a.useState("all"),[c,m]=a.useState({from:"",to:""}),[g,h]=a.useState("desc");a.useEffect((()=>{let e=[...s];if(r){const a=r.toLowerCase();e=e.filter((e=>e.adminName.toLowerCase().includes(a)||e.action.toLowerCase().includes(a)||e.details.toLowerCase().includes(a)))}if("all"!==n&&(e=e.filter((e=>e.action===n))),c.from){const a=new Date(c.from);e=e.filter((e=>new Date(e.timestamp)>=a))}if(c.to){const a=new Date(c.to);a.setHours(23,59,59,999),e=e.filter((e=>new Date(e.timestamp)<=a))}e.sort(((e,a)=>{const s=new Date(e.timestamp),t=new Date(a.timestamp);return"desc"===g?+t-+s:+s-+t})),l(e)}),[s,r,n,c,g]);const u=e=>{const{name:a,value:s}=e.target;m((e=>({...e,[a]:s})))},p=e=>{switch(e){case"create_admin":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300";case"update_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300";case"delete_admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300";case"reset_password":return"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-300";case"login":return"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},b=e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),"Admin Activity Logs"]}),e.jsxs("button",{onClick:()=>{if(0===d.length)return;const e=[["Admin","Action","Details","Timestamp","IP Address"].join(","),...d.map((e=>[`"${e.adminName}"`,`"${e.action}"`,`"${e.details.replace(/"/g,'""')}"`,`"${new Date(e.timestamp).toLocaleString()}"`,`"${e.ipAddress||""}"`].join(",")))].join("\n"),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),t=document.createElement("a");t.setAttribute("href",s),t.setAttribute("download",`admin-logs-${(new Date).toISOString().split("T")[0]}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},disabled:0===d.length,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(S,{className:"h-4 w-4 mr-1.5"}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search logs...",value:r,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"}),e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white appearance-none",children:["all","create_admin","update_admin","delete_admin","reset_password","login","logout"].map((a=>e.jsx("option",{value:a,children:"all"===a?"All Actions":b(a)},a)))}),e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"from",value:c.from,onChange:u,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"From date"}),e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"to",value:c.to,onChange:u,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"To date"}),e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-2",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(r||"all"!==n||c.from||c.to)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active filters:"}),r&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Search: ",r,e.jsx(x,{size:14,className:"ml-1 cursor-pointer",onClick:()=>i("")})]}),"all"!==n&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Action: ",b(n),e.jsx(x,{size:14,className:"ml-1 cursor-pointer",onClick:()=>o("all")})]}),c.from&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["From: ",c.from,e.jsx(x,{size:14,className:"ml-1 cursor-pointer",onClick:()=>m((e=>({...e,from:""})))})]}),c.to&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["To: ",c.to,e.jsx(x,{size:14,className:"ml-1 cursor-pointer",onClick:()=>m((e=>({...e,to:""})))})]}),e.jsx("button",{onClick:()=>{i(""),o("all"),m({from:"",to:""})},className:"text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"Clear all"})]})}),e.jsxs("button",{onClick:()=>h((e=>"desc"===e?"asc":"desc")),className:"inline-flex items-center px-2 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"desc"===g?e.jsxs(e.Fragment,{children:["Newest first ",e.jsx(V,{className:"h-3 w-3 ml-1"})]}):e.jsxs(e.Fragment,{children:["Oldest first ",e.jsx(H,{className:"h-3 w-3 ml-1"})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:t?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"}),[...Array(5)].map(((a,s)=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},s)))]})}):0===d.length?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:0===s.length?"No activity logs found in the system.":"No logs match your current filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Admin"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Details"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP Address"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-750 divide-y divide-gray-200 dark:divide-gray-700",children:d.map((a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.adminName}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.adminId.substring(0,8)})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${p(a.action)}`,children:b(a.action)})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:a.details}),a.resource&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Resource: ",a.resource," ",a.resourceId&&`#${a.resourceId.substring(0,8)}`]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(a.timestamp).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.ipAddress||"-"})]},a.id)))})]})})}),!t&&s.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:["Showing ",d.length," of ",s.length," logs"]})]})}function Ve({admins:s,onResetPassword:t}){const[r,i]=a.useState(""),[d,l]=a.useState(""),[n,o]=a.useState(!1),[c,m]=a.useState(!1),[x,g]=a.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:"Security Settings"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage security settings and reset passwords"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Password Reset"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"admin-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select User"}),e.jsxs("select",{id:"admin-select",value:r,onChange:e=>i(e.target.value),className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a user"}),s.filter((e=>"super-admin"!==e.role)).map((a=>e.jsxs("option",{value:a.id,children:[a.username," (",a.email,") - ",a.role]},a.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{id:"password",type:n?"text":"password",value:d,onChange:e=>l(e.target.value),className:"flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Generate a secure password",readOnly:!0}),e.jsx("button",{type:"button",onClick:()=>o(!n),className:"bg-gray-100 dark:bg-gray-600 border-y border-r border-gray-300 dark:border-gray-600 rounded-r-lg px-3",children:n?e.jsx(W,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}):e.jsx(J,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{let e="";e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],e+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],e+="0123456789"[Math.floor(10*Math.random())],e+="!@#$%^&*()_+"[Math.floor(12*Math.random())];for(let a=4;a<12;a++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+"[Math.floor(74*Math.random())];e=e.split("").sort((()=>Math.random()-.5)).join(""),l(e)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate Password"})]}),d&&e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(d).then((()=>{g(!0),setTimeout((()=>g(!1)),2e3)})).catch((e=>{he("Failed to copy password to clipboard")}))},className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors",children:x?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Copy"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",onClick:async()=>{if(r)if(!d||d.length<8)he("Please generate a secure password");else{m(!0);try{await t(r,d)?(ge("Password reset successfully"),i(""),l("")):he("Failed to reset password")}catch(e){he(e.message||"Failed to reset password")}finally{m(!1)}}else he("Please select an admin")},disabled:!r||!d||c,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors disabled:bg-red-300 dark:disabled:bg-red-800/50 disabled:cursor-not-allowed",children:[c?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{children:"Reset Password"})]})}),r&&d&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg flex items-start gap-2 text-sm",children:[e.jsx(K,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Important:"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"You are about to reset the password for this user. Make sure to share the new password with them securely. They should change their password after logging in."})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Security Policies"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Two-factor Authentication"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Require 2FA for all admin accounts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Password Expiry"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Force password change every 90 days"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Session Timeout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Auto logout after 30 minutes of inactivity"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Failed Login Lockout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lock account after 5 failed login attempts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Security Settings"})]})})]})]})}$e.displayName=c.displayName;const He=d("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ye=a.forwardRef((({className:a,...s},t)=>e.jsx(m,{ref:t,className:be(He(),a),...s})));Ye.displayName=m.displayName;const We=({open:a,onOpenChange:s,children:t})=>a?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>s(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:t})]}):null,Je=a.forwardRef((({className:a,children:s,onClose:t,...r},i)=>e.jsxs("div",{ref:i,className:be("relative bg-white dark:bg-gray-950 rounded-lg shadow-xl border border-gray-200 dark:border-gray-800 w-full max-w-lg max-h-[90vh] overflow-y-auto",a),onClick:e=>e.stopPropagation(),...r,children:[t&&e.jsxs("button",{onClick:t,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none dark:ring-offset-gray-950 dark:focus:ring-gray-300",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),s]})));Je.displayName="DialogContent";const Ge=({className:a,...s})=>e.jsx("div",{className:be("flex flex-col space-y-1.5 p-6 pb-4",a),...s});Ge.displayName="DialogHeader";const Xe=({className:a,...s})=>e.jsx("div",{className:be("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-4",a),...s});Xe.displayName="DialogFooter";const Ke=a.forwardRef((({className:a,...s},t)=>e.jsx("h2",{ref:t,className:be("text-lg font-semibold leading-none tracking-tight text-gray-900 dark:text-white",a),...s})));Ke.displayName="DialogTitle";const Qe=a.forwardRef((({className:a,...s},t)=>e.jsx("p",{ref:t,className:be("text-sm text-gray-500 dark:text-gray-400",a),...s})));Qe.displayName="DialogDescription";const Ze=({className:a,...s})=>e.jsx("div",{className:be("px-6 py-2",a),...s});async function ea(){try{const{data:e,error:a}=await xe.from("users").select("*").order("created_at",{ascending:!1});if(a)throw new Error(a.message);return e||[]}catch(e){throw e}}async function aa(){try{const{data:e,error:a}=await xe.from("departments").select("*").order("name");if(a)throw new Error(a.message);return e||[]}catch(e){throw e}}async function sa(e){try{let e=xe.from("batches").select("*").order("name");const{data:a,error:s}=await e;if(s)throw new Error(s.message);return a||[]}catch(a){throw a}}async function ta(e){try{let e=xe.from("sections").select("*").order("name");const{data:a,error:s}=await e;if(s)throw new Error(s.message);return a||[]}catch(a){throw a}}Ze.displayName="DialogBody";const ra={"super-admin":{label:"Super Admin",color:"text-red-600 dark:text-red-400",icon:Z,badgeVariant:"destructive"},admin:{label:"Admin",color:"text-blue-600 dark:text-blue-400",icon:ee,badgeVariant:"info"},section_admin:{label:"Section Admin",color:"text-orange-600 dark:text-orange-400",icon:p,badgeVariant:"warning"},user:{label:"User",color:"text-gray-600 dark:text-gray-400",icon:Y,badgeVariant:"secondary"}};function ia({open:s,onClose:t,user:r,departments:i,batches:d,sections:l,onSubmit:n,mode:o}){const[c,m]=a.useState({email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""}),[x,g]=a.useState(!1),[h,u]=a.useState([]),[p,b]=a.useState([]);return a.useEffect((()=>{m("edit"===o&&r?{email:r.email||"",password:"",name:r.name||"",role:r.role,phone:r.phone||"",student_id:r.student_id||"",department_id:r.department_id||"",batch_id:r.batch_id||"",section_id:r.section_id||""}:{email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""})}),[r,o,s]),a.useEffect((()=>{c.department_id?u(d.filter((e=>e.department_id===c.department_id))):u(d)}),[c.department_id,d]),a.useEffect((()=>{c.batch_id?b(l.filter((e=>e.batch_id===c.batch_id))):b(l)}),[c.batch_id,l]),e.jsx(We,{open:s,onOpenChange:t,children:e.jsxs(Je,{onClose:t,className:"max-w-2xl",children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:"create"===o?"Create New User":"Edit User"}),e.jsx(Qe,{children:"create"===o?"Add a new user to the system with specified role and details.":`Update user information for ${(null==r?void 0:r.name)||(null==r?void 0:r.email)}`})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),"create"!==o||c.email&&c.password)if(c.name){g(!0);try{const e="create"===o?c:{name:c.name,role:c.role,phone:c.phone||void 0,student_id:c.student_id||void 0,department_id:c.department_id||void 0,batch_id:c.batch_id||void 0,section_id:c.section_id||void 0};await n(e),t()}catch(a){he(a.message||"Failed to save user")}finally{g(!1)}}else he("Name is required");else he("Email and password are required")},children:[e.jsxs(Ze,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["create"===o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"email",children:"Email *"}),e.jsx(Ee,{id:"email",type:"email",placeholder:"user@example.com",value:c.email,onChange:e=>m((a=>({...a,email:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"password",children:"Password *"}),e.jsx(Ee,{id:"password",type:"password",placeholder:"",value:c.password,onChange:e=>m((a=>({...a,password:e.target.value}))),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"name",children:"Full Name *"}),e.jsx(Ee,{id:"name",placeholder:"John Doe",value:c.name,onChange:e=>m((a=>({...a,name:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"role",children:"Role *"}),e.jsxs("select",{id:"role",value:c.role,onChange:e=>m((a=>({...a,role:e.target.value}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super-admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"phone",children:"Phone"}),e.jsx(Ee,{id:"phone",placeholder:"+1234567890",value:c.phone,onChange:e=>m((a=>({...a,phone:e.target.value})))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"student_id",children:"Student ID"}),e.jsx(Ee,{id:"student_id",placeholder:"STU-123456",value:c.student_id,onChange:e=>m((a=>({...a,student_id:e.target.value})))})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-4",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"department",children:"Department"}),e.jsxs("select",{id:"department",value:c.department_id,onChange:e=>m((a=>({...a,department_id:e.target.value,batch_id:"",section_id:""}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Department"}),i.map((a=>e.jsx("option",{value:a.id,children:a.name},a.id)))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"batch",children:"Batch"}),e.jsxs("select",{id:"batch",value:c.batch_id,onChange:e=>m((a=>({...a,batch_id:e.target.value,section_id:""}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!c.department_id,children:[e.jsx("option",{value:"",children:"Select Batch"}),h.map((a=>e.jsx("option",{value:a.id,children:a.name},a.id)))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"section",children:"Section"}),e.jsxs("select",{id:"section",value:c.section_id,onChange:e=>m((a=>({...a,section_id:e.target.value}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!c.batch_id,children:[e.jsx("option",{value:"",children:"Select Section"}),p.map((a=>e.jsx("option",{value:a.id,children:a.name},a.id)))]})]})]})]})]}),e.jsxs(Xe,{children:[e.jsx(Ue,{type:"button",variant:"outline",onClick:t,disabled:x,children:"Cancel"}),e.jsx(Ue,{type:"submit",disabled:x,children:x?"Saving...":"create"===o?"Create User":"Update User"})]})]})]})})}function da({open:s,onClose:t,user:r,sections:i,onRoleChange:d}){var l,n;const[o,c]=a.useState("user"),[m,x]=a.useState(""),[g,h]=a.useState(!1);return a.useEffect((()=>{r&&(c(r.role),x(r.section_id||""))}),[r,s]),r?e.jsx(We,{open:s,onOpenChange:t,children:e.jsxs(Je,{onClose:t,children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:"Change User Role"}),e.jsxs(Qe,{children:["Change the role for ",r.name||r.email]})]}),e.jsxs(Ze,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx(Ie,{className:"h-12 w-12",children:e.jsx($e,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 text-lg",children:(null==(l=r.name)?void 0:l.charAt(0).toUpperCase())||(null==(n=r.email)?void 0:n.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email}),e.jsxs(Ce,{variant:ra[r.role].badgeVariant,className:"mt-1",children:["Current: ",ra[r.role].label]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{children:"New Role"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(ra).map((([a,s])=>{const t=s.icon;return e.jsxs("button",{type:"button",onClick:()=>c(a),className:"flex items-center gap-2 p-3 border rounded-lg transition-all "+(o===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-800 hover:border-gray-300"),children:[e.jsx(t,{className:`w-4 h-4 ${s.color}`}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},a)}))})]}),"section_admin"===o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{children:"Assign to Section *"}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Section"}),i.map((a=>e.jsx("option",{value:a.id,children:a.name},a.id)))]})]})]}),e.jsxs(Xe,{children:[e.jsx(Ue,{variant:"outline",onClick:t,disabled:g,children:"Cancel"}),e.jsx(Ue,{onClick:async()=>{if(r)if("section_admin"!==o||m){h(!0);try{await d(r.id,o,m||void 0),ge(`Role changed to ${ra[o].label}`),t()}catch(e){he(e.message||"Failed to change role")}finally{h(!1)}}else he("Please select a section for section admin")},disabled:g||o===r.role,children:g?"Updating...":"Change Role"})]})]})}):null}function la({open:s,onClose:t,user:r,onDelete:i}){var d,l;const[n,o]=a.useState(!1),[c,m]=a.useState("");if(a.useEffect((()=>{s||m("")}),[s]),!r)return null;const x="delete"===c.toLowerCase();return e.jsx(We,{open:s,onOpenChange:t,children:e.jsxs(Je,{onClose:t,children:[e.jsxs(Ge,{children:[e.jsx(Ke,{className:"text-red-600",children:"Delete User"}),e.jsx(Qe,{children:"This action cannot be undone. This will permanently delete the user account."})]}),e.jsxs(Ze,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx(Ie,{className:"h-12 w-12",children:e.jsx($e,{className:"bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 text-lg",children:(null==(d=r.name)?void 0:d.charAt(0).toUpperCase())||(null==(l=r.email)?void 0:l.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email}),e.jsx(Ce,{variant:ra[r.role].badgeVariant,className:"mt-1",children:ra[r.role].label})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{children:'Type "delete" to confirm'}),e.jsx(Ee,{value:c,onChange:e=>m(e.target.value),placeholder:"delete",className:"border-red-200 dark:border-red-800 focus:border-red-500"})]})]}),e.jsxs(Xe,{children:[e.jsx(Ue,{variant:"outline",onClick:t,disabled:n,children:"Cancel"}),e.jsx(Ue,{variant:"destructive",onClick:async()=>{if(r){o(!0);try{await i(r.id),ge("User deleted successfully"),t()}catch(e){he(e.message||"Failed to delete user")}finally{o(!1)}}},disabled:n||!x,children:n?"Deleting...":"Delete User"})]})]})})}function na({onEdit:s,onChangeRole:t,onDelete:r}){const[i,d]=a.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{variant:"ghost",size:"icon",onClick:()=>d(!i),children:e.jsx(L,{className:"w-4 h-4"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-48 py-1 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg shadow-lg z-50",children:[e.jsxs("button",{onClick:()=>{s(),d(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Edit User"]}),e.jsxs("button",{onClick:()=>{t(),d(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Change Role"]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-800 my-1"}),e.jsxs("button",{onClick:()=>{r(),d(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Delete User"]})]})]})]})}function oa({title:a,value:s,icon:t,color:r,bgColor:i}){return e.jsx(je,{children:e.jsx(ke,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a}),e.jsx("p",{className:`text-2xl font-bold ${r}`,children:s})]}),e.jsx("div",{className:`p-3 rounded-full ${i}`,children:e.jsx(t,{className:`w-5 h-5 ${r}`})})]})})})}function ca(){const[s,t]=a.useState([]),[r,i]=a.useState([]),[d,l]=a.useState([]),[n,o]=a.useState([]),[c,m]=a.useState(!0),[x,g]=a.useState(""),[h,u]=a.useState("all"),[y,f]=a.useState(!1),[j,v]=a.useState(!1),[w,N]=a.useState(!1),[k,C]=a.useState(null),[S,U]=a.useState("create"),E=a.useCallback((async()=>{try{m(!0);const[e,a,s,r]=await Promise.all([ea(),aa(),sa(),ta()]);t(e),i(a),l(s),o(r)}catch(e){he(e.message||"Failed to load data")}finally{m(!1)}}),[]);a.useEffect((()=>{E()}),[E]);const L=a.useMemo((()=>function(e){const a=e.length,s=e.filter((e=>"super-admin"===e.role)).length,t=e.filter((e=>"admin"===e.role)).length,r=e.filter((e=>"section_admin"===e.role)).length,i=e.filter((e=>"user"===e.role)).length,d=new Date;return d.setDate(d.getDate()-7),{totalUsers:a,superAdmins:s,admins:t,sectionAdmins:r,regularUsers:i,activeUsers:e.filter((e=>e.last_active&&new Date(e.last_active)>d)).length,newUsersThisWeek:e.filter((e=>e.created_at&&new Date(e.created_at)>d)).length}}(s)),[s]),D=a.useMemo((()=>{let e=function(e,a){if(!a)return e;const s=a.toLowerCase();return e.filter((e=>{var a,t,r,i;return(null==(a=e.name)?void 0:a.toLowerCase().includes(s))||(null==(t=e.email)?void 0:t.toLowerCase().includes(s))||(null==(r=e.student_id)?void 0:r.toLowerCase().includes(s))||(null==(i=e.phone)?void 0:i.toLowerCase().includes(s))}))}(s,x);return e=function(e,a){return"all"===a?e:e.filter((e=>e.role===a))}(e,h),e}),[s,x,h]),F=e=>{C(e),U("edit"),f(!0)},M=e=>{C(e),v(!0)},R=e=>{C(e),N(!0)},T=e=>{var a;return e&&(null==(a=r.find((a=>a.id===e)))?void 0:a.name)||""},I=e=>{var a;return e&&(null==(a=n.find((a=>a.id===e)))?void 0:a.name)||""};return c?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading users..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Manage all users, roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ue,{variant:"outline",onClick:E,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(Ue,{onClick:()=>{C(null),U("create"),f(!0)},children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(oa,{title:"Total Users",value:L.totalUsers,icon:b,color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-100 dark:bg-gray-800"}),e.jsx(oa,{title:"Super Admins",value:L.superAdmins,icon:Z,color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30"}),e.jsx(oa,{title:"Admins",value:L.admins,icon:ee,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30"}),e.jsx(oa,{title:"Section Admins",value:L.sectionAdmins,icon:p,color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900/30"}),e.jsx(oa,{title:"Regular Users",value:L.regularUsers,icon:Y,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30"}),e.jsx(oa,{title:"Active (7d)",value:L.activeUsers,icon:ae,color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-100 dark:bg-purple-900/30"})]}),e.jsx(je,{children:e.jsx(ke,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ee,{placeholder:"Search by name, email, student ID or phone...",value:x,onChange:e=>g(e.target.value),className:"pl-10"})]}),e.jsxs("select",{value:h,onChange:e=>u(e.target.value),className:"h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm min-w-[150px]",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admins"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"section_admin",children:"Section Admins"}),e.jsx("option",{value:"user",children:"Users"})]})]})})}),e.jsxs(je,{children:[e.jsx(ve,{children:e.jsx(we,{className:"flex items-center justify-between",children:e.jsxs("span",{children:["Users (",D.length,")"]})})}),e.jsx(ke,{children:0===D.length?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Le,{children:[e.jsx(De,{children:e.jsxs(Me,{children:[e.jsx(Re,{children:"User"}),e.jsx(Re,{children:"Role"}),e.jsx(Re,{className:"hidden lg:table-cell",children:"Department"}),e.jsx(Re,{className:"hidden md:table-cell",children:"Section"}),e.jsx(Re,{className:"hidden lg:table-cell",children:"Joined"}),e.jsx(Re,{className:"text-right",children:"Actions"})]})}),e.jsx(Fe,{children:D.map((a=>{var s,t,r,i,d,l;const n=(null==(s=ra[a.role])?void 0:s.icon)||Y;return e.jsxs(Me,{children:[e.jsx(Te,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"h-10 w-10",children:e.jsx($e,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:(null==(t=a.name)?void 0:t.charAt(0).toUpperCase())||(null==(r=a.email)?void 0:r.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name||""}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),a.email]}),a.phone&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),a.phone]})]})]})}),e.jsx(Te,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:`w-4 h-4 ${(null==(i=ra[a.role])?void 0:i.color)||""}`}),e.jsx(Ce,{variant:(null==(d=ra[a.role])?void 0:d.badgeVariant)||"secondary",children:(null==(l=ra[a.role])?void 0:l.label)||a.role})]})}),e.jsx(Te,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:T(a.department_id)}),e.jsx(Te,{className:"hidden md:table-cell text-gray-600 dark:text-gray-400",children:I(a.section_id)}),e.jsx(Te,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:a.created_at?new Date(a.created_at).toLocaleDateString():""}),e.jsx(Te,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(Ue,{variant:"ghost",size:"sm",onClick:()=>M(a),className:"hidden sm:inline-flex",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"Role"]}),e.jsx(Ue,{variant:"ghost",size:"sm",onClick:()=>F(a),className:"hidden sm:inline-flex",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx(Ue,{variant:"ghost",size:"sm",onClick:()=>R(a),className:"hidden sm:inline-flex text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(na,{user:a,onEdit:()=>F(a),onChangeRole:()=>M(a),onDelete:()=>R(a)})})]})})]},a.id)}))})]})})})]}),e.jsx(ia,{open:y,onClose:()=>f(!1),user:k,departments:r,batches:d,sections:n,onSubmit:"create"===S?async e=>{await async function(e){try{const{data:a}=await xe.auth.getUser();if(!a.user)throw new Error("You must be logged in to create users");const{data:s,error:t}=await xe.auth.signUp({email:e.email,password:e.password,options:{data:{name:e.name,role:e.role}}});if(t)throw new Error(t.message);if(!s.user)throw new Error("Failed to create user account");const{data:r,error:i}=await xe.from("users").upsert({id:s.user.id,email:e.email,name:e.name,role:e.role,phone:e.phone||null,student_id:e.student_id||null,department_id:e.department_id||null,batch_id:e.batch_id||null,section_id:e.section_id||null}).select().single();if(i)throw new Error(i.message);return await xe.from("activities").insert({type:"user_created",title:`New user created: ${e.name}`,user_id:a.user.id,metadata:{target_user_id:s.user.id,email:e.email,role:e.role}}),r}catch(a){throw a}}(e),ge("User created successfully"),await E()}:async e=>{k&&(await async function(e,a){try{const{data:s}=await xe.auth.getUser();if(!s.user)throw new Error("You must be logged in to update users");const{data:t}=await xe.from("users").select("*").eq("id",e).single(),{data:r,error:i}=await xe.from("users").update({name:a.name,role:a.role,phone:a.phone,student_id:a.student_id,department_id:a.department_id,batch_id:a.batch_id,section_id:a.section_id}).eq("id",e).select().single();if(i)throw new Error(i.message);return"section_admin"===a.role&&a.section_id&&"section_admin"!==(null==t?void 0:t.role)&&await xe.from("section_admins").upsert({user_id:e,section_id:a.section_id,assigned_by:s.user.id}),"section_admin"===(null==t?void 0:t.role)&&"section_admin"!==a.role&&await xe.from("section_admins").delete().eq("user_id",e),await xe.from("activities").insert({type:"user_updated",title:`User updated: ${r.name}`,user_id:s.user.id,metadata:{target_user_id:e,changes:a,previous:t}}),r}catch(s){throw s}}(k.id,e),ge("User updated successfully"),await E())},mode:S}),e.jsx(da,{open:j,onClose:()=>v(!1),user:k,sections:n,onRoleChange:async(e,a,s)=>{await async function(e,a,s){try{const{data:t}=await xe.auth.getUser();if(!t.user)throw new Error("You must be logged in to change user roles");const{data:r}=await xe.from("users").select("*").eq("id",e).single(),i={role:a};s&&(i.section_id=s);const{data:d,error:l}=await xe.from("users").update(i).eq("id",e).select().single();if(l)throw new Error(l.message);return"section_admin"===a&&s?(await xe.from("section_admins").delete().eq("user_id",e),await xe.from("section_admins").insert({user_id:e,section_id:s,assigned_by:t.user.id})):"section_admin"===(null==r?void 0:r.role)&&"section_admin"!==a&&await xe.from("section_admins").delete().eq("user_id",e),await xe.from("activities").insert({type:"role_change",title:`User role changed: ${null==r?void 0:r.role}  ${a}`,user_id:t.user.id,metadata:{target_user_id:e,previous_role:null==r?void 0:r.role,new_role:a,section_id:s}}),d}catch(t){throw t}}(e,a,s),await E()}}),e.jsx(la,{open:w,onClose:()=>N(!1),user:k,onDelete:async e=>{await async function(e){try{const{data:a}=await xe.auth.getUser();if(!a.user)throw new Error("You must be logged in to delete users");const{data:s}=await xe.from("users").select("*").eq("id",e).single();await xe.from("section_admins").delete().eq("user_id",e);const{error:t}=await xe.from("users").delete().eq("id",e);if(t)throw new Error(t.message);await xe.from("activities").insert({type:"user_deleted",title:`User deleted: ${(null==s?void 0:s.name)||(null==s?void 0:s.email)}`,user_id:a.user.id,metadata:{deleted_user:s}})}catch(a){throw a}}(e),await E()}})]})}function ma(){return e.jsx(ca,{})}function xa(){const{admins:s,loading:t}=Pe(),[r,i]=a.useState(null),[d,l]=a.useState(!0);return a.useEffect((()=>{!t&&s.length>0&&(async()=>{try{l(!0);const e={totalAdmins:s.length,activeAdmins:s.filter((e=>e.isActive)).length,disabledAdmins:s.filter((e=>!e.isActive)).length,permissionChanges:Math.floor(15*Math.random())+5,departmentDistribution:[],roleDistribution:[],monthlyActivity:[],permissionUsage:[],recentLogins:[],mostActiveAdmins:[],adminsByDepartment:{}};i(e)}catch(e){}finally{l(!1)}})()}),[s,t]),e.jsx(Oe,{stats:r,loading:d})}function ga(){const[s,t]=a.useState([]),[r,i]=a.useState(!0);return a.useEffect((()=>{(async()=>{try{i(!0);const{data:e}=await xe.from("activities").select("*").order("created_at",{ascending:!1}).limit(100);if(e){const a=e.map((e=>({id:e.id,timestamp:e.created_at,adminId:e.user_id||"",adminName:"Admin",action:e.type,target:e.title,details:{description:e.title,metadata:e.metadata},ipAddress:"0.0.0.0",userAgent:"N/A",status:"success"})));t(a)}}catch(e){}finally{i(!1)}})()}),[]),e.jsx(Be,{logs:s,loading:r})}function ha(){const{admins:a,resetPassword:s}=Pe();return e.jsx(Ve,{admins:a,onResetPassword:s})}function ua(){var r;const i=s(),d=t(),[l,n]=a.useState("overview"),[o,c]=a.useState(!1),[m,x]=a.useState(!1),[g,h]=a.useState(!1),[u,p]=a.useState(!1),{isDark:b,toggle:y}=ue(),{logout:f,user:j}=pe(),{refreshAdmins:v}=Pe();return a.useEffect((()=>{const e=d.pathname;n({"/superadmin/dashboard":"overview","/superadmin/overview":"overview","/superadmin/admins":"admins","/superadmin/sectionadmins":"section-admins","/superadmin/analytics":"analytics","/superadmin/logs":"logs","/superadmin/security":"security"}[e]||"overview")}),[d.pathname]),a.useEffect((()=>{const e=()=>{const e=window.innerWidth<1024;h(e),!e&&m&&x(!1)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[m]),a.useEffect((()=>{localStorage.setItem("is_super_admin","true"),sessionStorage.setItem("is_super_admin","true"),v()}),[v]),e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-950",children:[e.jsx(fe,{activeTab:l,onTabChange:e=>{n(e),i({overview:"/superadmin/dashboard",admins:"/superadmin/admins","section-admins":"/superadmin/sectionadmins",analytics:"/superadmin/analytics",logs:"/superadmin/logs",security:"/superadmin/security"}[e]||"/superadmin/dashboard",{replace:!0})},isCollapsed:o,onToggleCollapse:()=>c(!o),isMobile:g,isOpen:m,onClose:()=>x(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>x(!0),className:"lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white",children:{overview:"Dashboard Overview",admins:"Admin Management","section-admins":"Section Admin Management",analytics:"Analytics & Reports",logs:"System Logs",security:"Security Settings"}[l]||"Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 hidden sm:block",children:{overview:"Monitor your system at a glance",admins:"Manage system administrators and their permissions","section-admins":"Manage section-level administrators",analytics:"View detailed analytics and performance metrics",logs:"Monitor system activities and audit logs",security:"Configure security settings and permissions"}[l]||""})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg relative",children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx(Ce,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:"3"})]}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:b?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 pl-2 border-l border-gray-200 dark:border-gray-800",children:[e.jsx(Ie,{className:"h-8 w-8",children:e.jsx($e,{className:"bg-blue-600 text-white text-sm",children:(null==(r=null==j?void 0:j.name)?void 0:r.charAt(0).toUpperCase())||"SA"})}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(null==j?void 0:j.name)||"Super Admin"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:null==j?void 0:j.email})]})]}),e.jsxs(Ue,{variant:"ghost",size:"sm",onClick:async()=>{if(!u)try{p(!0),await f(),i("/auth",{replace:!0})}catch(e){p(!1)}},disabled:u,className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:u?"Logging out...":"Logout"})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-[1600px] mx-auto",children:(()=>{switch(l){case"overview":default:return e.jsx(Ae,{});case"admins":return e.jsx(ze,{});case"section-admins":return e.jsx(ma,{});case"analytics":return e.jsx(xa,{});case"logs":return e.jsx(ga,{});case"security":return e.jsx(ha,{})}})()})})]})]})}export{ua as SuperAdminDashboard};
