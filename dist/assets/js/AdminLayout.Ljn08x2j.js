import{R as $,j as e,r,u as _,a as R,O as H}from"./index.DAKxqFgX.js";import{u as P}from"./useAuth.CmPWb_Mc.js";import{u as B,a as V}from"./useTasks.Dh9G9tna.js";import{X as W}from"./x.CbJLoV8p.js";import{M as X,L as q}from"./menu.BSfgrZ9b.js";import{u as G,S as I,a as J,M as K,L as Q}from"./useTheme.DmK9bFC9.js";import{U as Y}from"./users.dFvV4QGB.js";import{L as Z}from"./list-todo.BiJ3Dg7I.js";import{C as ee}from"./check-circle.EjuVaWD2.js";import{M as ae}from"./megaphone.DbcpsMcv.js";import{F as te}from"./file-text.Dl2kjLdj.js";import{C as A}from"./chevron-left.B2bfqgi7.js";import{P as U}from"./plus.Ci5-r8Cn.js";import{U as S}from"./user.DQ0jvDOM.js";import{U as se,H as re}from"./user-cog.Cz3ENnXq.js";import{L as ne}from"./LoadingScreen.ng5xLHta.js";import{A as le}from"./alert-triangle.DaPUKSsZ.js";import"./dataCache.z_cl_fNt.js";import"./authErrors.D8KAnYp0.js";import"./telegram.service.B5vX6-Oo.js";import"./dateUtils.CaLFIf6y.js";import"./createLucideIcon.D9NnmSLx.js";const O=$.memo(function({icon:l,label:a,isActive:d,onClick:m,badge:i,isCollapsed:u=!1}){return u?e.jsxs("button",{onClick:m,className:`
          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform
          ${d?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}
          focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50
        `,title:a,"aria-label":a,children:[e.jsx(l,{className:`w-5 h-5 ${d?"text-blue-600 dark:text-blue-400":""}`}),i!==void 0&&e.jsx("span",{className:`
            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full
            ${d?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}
            transform -translate-y-1 translate-x-1
          `,children:i>99?"99+":i})]}):e.jsxs("button",{onClick:m,className:`
        w-full flex items-center justify-between rounded-lg py-2.5 px-3 transition-all duration-200 will-change-transform
        ${d?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}
        focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50
      `,"aria-label":a,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:`w-5 h-5 ${d?"text-blue-600 dark:text-blue-400":""}`}),e.jsx("span",{className:"text-sm font-medium",children:a})]}),i!==void 0&&e.jsx("span",{className:`
          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full
          ${d?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}
        `,children:i>99?"99+":i})]})}),ie=$.memo(function({isOpen:l,onClick:a}){return e.jsx("button",{onClick:a,className:`
        lg:hidden fixed top-4 left-4 z-50 p-2.5 rounded-xl shadow-md 
        transition-all duration-300 transform will-change-transform
        ${l?"bg-white dark:bg-gray-800 rotate-0":"bg-gradient-to-r from-blue-600 to-indigo-600"}
        focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50
      `,"aria-label":l?"Close menu":"Open menu",children:l?e.jsx(W,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}):e.jsx(X,{className:"w-5 h-5 text-white"})})}),oe=$.memo(function({activeTab:l,onTabChange:a,onLogout:d,onCollapse:m,isSectionAdmin:i=!1,onCreateTask:u}){const[g,f]=r.useState(!1),[n,C]=r.useState(!1),{isDark:j,toggle:w}=G(),{user:s}=P(),[E,M]=r.useState(""),[b,x]=r.useState(!1);r.useEffect(()=>{const t=()=>{window.innerWidth>=1024&&g&&f(!1)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[g]),r.useEffect(()=>{const t=()=>{M(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};t();const p=setInterval(t,6e4);return()=>clearInterval(p)},[]),r.useEffect(()=>{const t=p=>{const z=p.target;b&&!z.closest(".profile-menu-container")&&x(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[b]);const y=r.useMemo(()=>[{id:"dashboard",label:"Dashboard",icon:q},{id:"users",label:"Users",icon:Y,badge:147},{id:"tasks",label:"Tasks (Legacy)",icon:Z,badge:56},{id:"task-management-v2",label:"Task Management",icon:ee,badge:null}],[]),k=r.useMemo(()=>[{id:"announcements",label:"Announcements",icon:ae},{id:"lecture-slides",label:"Lecture Slides",icon:te}],[]),v=r.useMemo(()=>i?k.filter(t=>["announcements","lecture-slides"].includes(t.id)):k,[k,i]),D=r.useCallback(()=>{f(t=>!t),x(!1)},[]),L=r.useCallback(()=>{f(!1)},[]),h=r.useCallback(t=>{a(t),f(!1),x(!1)},[a]),N=r.useCallback(()=>{C(t=>{const p=!t;return m&&m(p),p}),x(!1)},[m]),c=r.useCallback(()=>{w()},[w]),T=r.useCallback(()=>{x(t=>!t)},[]),F=r.useCallback(()=>{x(!1),d()},[d]);return e.jsxs(e.Fragment,{children:[e.jsx(ie,{isOpen:g,onClick:D}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 lg:hidden dark:bg-opacity-70 backdrop-blur-sm will-change-transform",onClick:L}),e.jsx("aside",{className:`
        fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-100 dark:border-gray-800
        transform transition-all duration-300 ease-in-out z-40 shadow-md will-change-transform
        ${g?"translate-x-0":"-translate-x-full"}
        ${n?"w-20":"w-64"}
        lg:relative lg:translate-x-0 lg:shadow-none
      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`p-4 border-b border-gray-100 dark:border-gray-800 flex ${n?"justify-center":"justify-between"} items-center`,children:[!n&&e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center shadow-sm",children:e.jsx(I,{className:"w-4.5 h-4.5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold text-gray-900 dark:text-white",children:"NestTask"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i?"Section Admin":"Admin Panel"})]})]}),n&&e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center shadow-sm",children:e.jsx(I,{className:"w-5 h-5 text-white"})}),e.jsx("button",{onClick:N,className:"hidden lg:flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":n?"Expand sidebar":"Collapse sidebar",children:e.jsx(A,{className:`w-4 h-4 text-gray-600 dark:text-gray-400 transition-transform ${n?"rotate-180":""}`})})]}),e.jsxs("div",{className:"flex-1 py-4 px-3 overflow-y-auto",children:[!n&&e.jsx("div",{className:"mb-3 px-2",children:e.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Main"})}),e.jsx("nav",{className:"space-y-1",children:y.map(t=>e.jsx(O,{icon:t.icon,label:t.label,isActive:l===t.id,onClick:()=>h(t.id),badge:t.badge,isCollapsed:n},t.id))}),!n&&e.jsx("div",{className:"my-3 px-2",children:e.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Management"})}),n&&e.jsx("div",{className:"my-3 border-t border-gray-100 dark:border-gray-800 mx-2"}),e.jsx("nav",{className:"space-y-1",children:v.map(t=>e.jsx(O,{icon:t.icon,label:t.label,isActive:l===t.id,onClick:()=>h(t.id),isCollapsed:n},t.id))}),!n&&e.jsx("div",{className:"mt-6 mx-2",children:e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors shadow-sm",onClick:()=>{u&&u(),h("task-management-v2")},children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Task"})]})}),n&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{className:"w-10 h-10 flex items-center justify-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg transition-colors shadow-sm",onClick:()=>{u&&u(),h("task-management-v2")},"aria-label":"Create Task",children:e.jsx(U,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 dark:border-gray-800 relative profile-menu-container",children:[n?e.jsx("button",{onClick:T,className:"w-full flex justify-center group",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-200 dark:group-hover:ring-blue-900 transition-all",children:s!=null&&s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-5 h-5 text-white"})})}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:T,className:"flex items-center gap-2.5 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors w-full group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:s!=null&&s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate w-full group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(s==null?void 0:s.name)||"User"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-full",children:(s==null?void 0:s.email)||"Loading..."})]}),e.jsx(A,{className:`w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform rotate-90 ${b?"rotate-[270deg]":""} group-hover:text-blue-600 dark:group-hover:text-blue-400`})]})}),b&&e.jsxs("div",{className:`
                absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-100 dark:border-gray-700 py-2 z-50
                ${n?"left-full ml-2 bottom-auto top-0":""}
              `,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:s!=null&&s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:(s==null?void 0:s.name)||"User"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(s==null?void 0:s.email)||"Loading..."})]})]})}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("profile"),children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Profile Settings"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:c,children:[j?e.jsx(J,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:j?"Light Mode":"Dark Mode"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>window.open("/help","_blank"),children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Help Center"})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 my-1"}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:F,children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]})]})]})]})]})})]})});function $e(){const o=_(),l=R(),{user:a,logout:d,loading:m}=P(),[i]=r.useState(null),[u,g]=r.useState(!1),{users:f,deleteUser:n,refreshUsers:C,loading:j}=B(),{tasks:w,createTask:s,updateTask:E,deleteTask:M,refreshTasks:b,loading:x}=V(a==null?void 0:a.id),y=(a==null?void 0:a.role)==="section_admin",k=a==null?void 0:a.sectionId,v=a==null?void 0:a.sectionName;r.useEffect(()=>{if(m)return;if(!a){o("/auth",{replace:!0});return}if(!(a.role==="admin"||a.role==="super-admin"||a.role==="section_admin")){o("/",{replace:!0});return}if(a.role==="super-admin"&&(l.pathname==="/admin"||l.pathname==="/admin/")){o("/superadmin/dashboard",{replace:!0});return}(a.role==="admin"||a.role==="section_admin")&&(l.pathname==="/admin"||l.pathname==="/admin/")&&o("/admin/dashboard",{replace:!0})},[a,o,l.pathname,m]);const L=(()=>{const c=l.pathname;return c.includes("/admin/users")?"users":c.includes("/admin/tasks")?"tasks":c.includes("/admin/task-management")?"task-management-v2":c.includes("/admin/announcements")?"announcements":c.includes("/admin/lecture-slides")?"lecture-slides":c.includes("/admin/super-admin")?"super-admin":"dashboard"})(),h=r.useCallback(c=>{o({dashboard:"/admin/dashboard",users:"/admin/users",tasks:"/admin/tasks","task-management-v2":"/admin/task-management",announcements:"/admin/announcements","lecture-slides":"/admin/lecture-slides","super-admin":"/admin/super-admin"}[c])},[o]),N=r.useCallback(()=>{o("/admin/task-management"),setTimeout(()=>{g(!0)},150)},[o]);return!a||a.role!=="admin"&&a.role!=="super-admin"&&a.role!=="section_admin"?e.jsx(ne,{minimumLoadTime:300}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsx(oe,{activeTab:L,onTabChange:h,onLogout:d,isSectionAdmin:y,onCreateTask:N}),e.jsx("main",{className:"flex-1 flex flex-col overflow-hidden w-full min-w-0",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"h-full p-4 sm:p-6 lg:p-8 max-w-full overflow-x-hidden",children:[e.jsx("header",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white truncate",children:y?`${v} Admin`:"Admin Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your application"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap",children:new Date().toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})})]})}),i&&e.jsxs("div",{className:"mb-4 p-3 flex items-center gap-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm",children:[e.jsx(le,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:i})]}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:e.jsx(H,{context:{users:f,tasks:w,isSectionAdmin:y,sectionId:k,sectionName:v,deleteUser:n,refreshUsers:C,refreshTasks:b,onCreateTask:s,onDeleteTask:M,onUpdateTask:E,openTaskFormV2:u,setOpenTaskFormV2:g,usersLoading:j,tasksLoading:x}})})]})})}),e.jsx("button",{onClick:N,className:"lg:hidden fixed bottom-20 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-40 active:scale-95","aria-label":"Create Task",children:e.jsx(U,{className:"w-6 h-6"})})]})}export{$e as AdminLayout};
