import{r as e,j as t,R as a}from"./react-vendor.BQ9wcLSU.js";import{s as r}from"./index.DHgWRtD1.js";import{LucideX as s,AlertCircle as l,LucideRefreshCw as d,LucideUpload as i,FileText as n,LucideTrash2 as o,Link as c,Calendar as g,Eye as x,Edit2 as u,ChevronUp as m,ChevronDown as h,LucideMessageSquare as b,LucideSend as p,History as y,CheckCircle2 as f,Clock as k,LucideUser as j,LucideUsers as v,LucideTag as w,Download as N,LucideSearch as C,Filter as D,CheckSquare as S,LucidePlus as T}from"./icons.B5_ZQj31.js";import"./charts.DuHk9BWv.js";import"./vendor.Vy3uO1vB.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.ClmuHuJk.js";import"./supabase-vendor.nnmAzafq.js";class _{static async execute(e,t="Operation",a){var r,s;let l=null;for(let i=0;i<=2;i++)try{if(null==a?void 0:a.aborted)throw new Error("Operation cancelled");const{data:r,error:s}=await e();if(s)throw new Error(s.message||`${t} failed`);if(null===r)throw new Error(`${t}: No data returned`);return r}catch(d){if(l=d,"Operation cancelled"===d.message||(null==a?void 0:a.aborted))throw new Error("Operation cancelled");if((null==(r=d.message)?void 0:r.includes("JWT"))||(null==(s=d.message)?void 0:s.includes("session")))throw new Error("Session expired. Please refresh the page.");if(i<2){await new Promise((e=>setTimeout(e,1e3)));continue}}throw l||new Error(`${t} failed`)}static async executeVoid(e,t="Operation"){var a,r;let s=null;for(let d=0;d<=2;d++)try{const{error:a}=await e();if(a)throw new Error(a.message||`${t} failed`);return}catch(l){if(s=l,(null==(a=l.message)?void 0:a.includes("JWT"))||(null==(r=l.message)?void 0:r.includes("session")))throw new Error("Session expired. Please refresh the page.");if(d<2){await new Promise((e=>setTimeout(e,1e3)));continue}}throw s||new Error(`${t} failed`)}}function E(e,t){if(!t)return e;const a=e;return"function"==typeof(null==a?void 0:a.abortSignal)?a.abortSignal(t):e}async function L(e,t,a){const s={};return void 0!==t.name&&(s.name=t.name),void 0!==t.description&&(s.description=t.description),void 0!==t.category&&(s.category=t.category),void 0!==t.dueDate&&(s.due_date=t.dueDate),void 0!==t.status&&(s.status=t.status,"completed"===t.status&&(s.completed_at=(new Date).toISOString())),void 0!==t.priority&&(s.priority=t.priority),void 0!==t.tags&&(s.tags=t.tags),void 0!==t.assignedTo&&(s.assigned_to=t.assignedTo),void 0!==t.attachments&&(s.attachments=t.attachments),void 0!==t.googleDriveLinks&&(s.google_drive_links=t.googleDriveLinks),$(await _.execute((()=>E(r.from("tasks").update(s).eq("id",e).select("*").single(),a)),"Update task"))}async function I(e){await _.executeVoid((()=>r.from("tasks").delete().eq("id",e)),"Delete task")}function $(e){return{id:e.id,name:e.name,category:e.category,dueDate:e.due_date,description:e.description,status:e.status,createdAt:e.created_at,updatedAt:e.updated_at,isAdminTask:e.is_admin_task||!1,sectionId:e.section_id,departmentId:e.department_id,batchId:e.batch_id,priority:e.priority||"medium",tags:e.tags||[],assignedTo:e.assigned_to,assignedBy:e.assigned_by,completedAt:e.completed_at,completedBy:e.completed_by,attachments:e.attachments||[],googleDriveLinks:e.google_drive_links||[],isTemplate:e.is_template||!1,templateName:e.template_name,userId:e.user_id,assignedToUser:e.assignedToUser,assignedByUser:e.assignedByUser,section:e.section,department:e.department,batch:e.batch}}function F(e){return{id:e.id,taskId:e.task_id,userId:e.user_id,comment:e.comment,createdAt:e.created_at,updatedAt:e.updated_at,isEdited:e.is_edited||!1,user:e.user}}function z(e){return{id:e.id,taskId:e.task_id,userId:e.user_id,action:e.action,fieldName:e.field_name,oldValue:e.old_value,newValue:e.new_value,metadata:e.metadata,createdAt:e.created_at,user:e.user}}const A=e.memo((({userId:a,sectionId:g,task:x,onClose:u,onTaskCreated:m,onTaskUpdated:h})=>{var b,p;const y=!!x,f=e.useRef(!0),k=e.useRef(),j=e.useRef(!1),[v,w]=e.useState({name:(null==x?void 0:x.name)||"",description:(null==x?void 0:x.description)||"",category:(null==x?void 0:x.category)||"assignment",dueDate:(null==x?void 0:x.dueDate)||"",priority:(null==x?void 0:x.priority)||"medium",googleDriveLinks:(null==(b=null==x?void 0:x.googleDriveLinks)?void 0:b.join("\n"))||""}),[N,C]=e.useState(!1),[D,S]=e.useState(!1),[T,I]=e.useState(null),[F,z]=e.useState({}),[A,U]=e.useState((null==(p=null==x?void 0:x.attachments)?void 0:p.map((e=>{var t;return{url:e,name:(null==(t=e.split("/").pop())?void 0:t.split("_").slice(0,-2).join("_"))||"file",size:0}})))||[]),O=e.useRef(null),P=e.useRef(null);e.useEffect((()=>(f.current=!0,S(!1),C(!1),()=>{f.current=!1,k.current&&k.current.abort()})),[]),e.useEffect((()=>{j.current=D}),[D]),e.useEffect((()=>{const e=()=>{"visible"===document.visibilityState&&D&&P.current&&Date.now()-P.current>2e4&&(S(!1),I("Operation may have timed out. Please try again."),k.current&&k.current.abort())};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[D]),e.useEffect((()=>{const e=()=>{var e;j.current&&P.current&&Date.now()-P.current>2e4&&(S(!1),I("Operation may have timed out. Please try again."),null==(e=k.current)||e.abort())};return window.addEventListener("app-resume",e),window.addEventListener("supabase-resume",e),window.addEventListener("supabase-session-refreshed",e),()=>{window.removeEventListener("app-resume",e),window.removeEventListener("supabase-resume",e),window.removeEventListener("supabase-session-refreshed",e)}}),[]),e.useEffect((()=>{P.current=D?Date.now():null}),[D]);const M=e.useCallback((e=>{U((t=>t.filter(((t,a)=>a!==e))))}),[]),R=e=>{if(0===e)return"Unknown size";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]},B=e.useCallback((async e=>{if(e.preventDefault(),D)return;S(!0),I(null),P.current=Date.now(),k.current=new AbortController;const t=3e4,s=setTimeout((()=>{var e;if(!f.current)return;if(!j.current)return;const a=P.current;(a?Date.now()-a:t)>=t&&(null==(e=k.current)||e.abort(),S(!1),I("Request timed out. Please try again."))}),t);try{const e=v.googleDriveLinks.split("\n").map((e=>e.trim())).filter(Boolean);if(y){const t={name:v.name,description:v.description,category:v.category,dueDate:v.dueDate,priority:v.priority,attachments:A.map((e=>e.url)),googleDriveLinks:e},a=await L(x.id,t,k.current.signal);clearTimeout(s),f.current&&(null==h||h(a),u())}else{const t={name:v.name,description:v.description,category:v.category,dueDate:v.dueDate,priority:v.priority,sectionId:g,attachments:A.map((e=>e.url)),googleDriveLinks:e},l=await async function(e,t,a,s){const l={name:t.name,description:t.description,category:t.category,due_date:t.dueDate,priority:t.priority||"medium",tags:t.tags||[],assigned_to:t.assignedTo||null,assigned_by:t.assignedTo?e:null,section_id:a||t.sectionId||null,attachments:t.attachments||[],google_drive_links:t.googleDriveLinks||[],status:t.status||"pending",user_id:e,is_admin_task:!!a,is_template:!1},d=$(await _.execute((()=>E(r.from("tasks").insert(l).select("*").single(),s)),"Create task",s));return d.isAdminTask&&async function(e){try{const t="https://nglfbbdoyyfslzyjarqs.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5nbGZiYmRveXlmc2x6eWphcnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1OTgyMTQsImV4cCI6MjA4MzE3NDIxNH0.3sXujO3rtin57rTcHpXHi6Zfi9XJCEX3-mmcnnB8cJE",r=new Date(e.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),s={presentation:"ðŸ“Š",assignment:"ðŸ“",quiz:"â“","lab-report":"ðŸ”¬","lab-final":"ðŸ§ª","lab-performance":"âš—ï¸",task:"âœ“",documents:"ðŸ“„",blc:"ðŸ“š",groups:"ðŸ‘¥",project:"ðŸš€",midterm:"ðŸ“–","final-exam":"ðŸŽ“",others:"ðŸ“Œ"},l=e.category.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),d=s[e.category]||"ðŸ“Œ",i={taskId:e.id,title:`${d} New ${l}`,body:`${e.name}\nðŸ“… Due: ${r}`,sectionId:e.sectionId||void 0,data:{taskId:e.id,category:e.category,categoryName:l,priority:e.priority||"medium",dueDate:e.dueDate,taskName:e.name}},n=await fetch(`${t}/functions/v1/send-fcm-push`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(i)});if(!n.ok){const e=await n.json().catch((()=>({})));throw new Error(`FCM push failed: ${JSON.stringify(e)}`)}await n.json()}catch(T){throw T}}(d).catch((()=>{})),d}(a,t,g,k.current.signal);clearTimeout(s),f.current&&(S(!1),null==m||m(l),u())}}catch(l){if(clearTimeout(s),"Operation cancelled"===(null==l?void 0:l.message))return;if(f.current){const e=(null==l?void 0:l.message)||"Failed to save task. Please try again.";I(e),S(!1)}}}),[D,v,y,x,A,a,g,m,h,u]);return t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-4 sm:py-5 border-b border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 shrink-0",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:y?"Edit Task":"Create New Task"}),t.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Fill in the details below to ",y?"update the":"create a new"," task."]})]}),t.jsx("button",{onClick:u,disabled:D,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200","aria-label":"Close form",children:t.jsx(s,{className:"w-5 h-5"})})]}),T&&t.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl flex items-start gap-3 shrink-0",children:[t.jsx(l,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:T}),t.jsxs("button",{type:"button",onClick:()=>I(null),className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:underline flex items-center gap-1 font-medium",children:[t.jsx(d,{className:"w-3 h-3"}),"Dismiss and try again"]})]})]}),t.jsx("div",{className:"overflow-y-auto flex-1 admin-scrollbar",children:t.jsxs("form",{onSubmit:B,className:"p-4 sm:p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:["Task Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",required:!0,value:v.name,onChange:e=>w({...v,name:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm placeholder:text-gray-400",placeholder:"Enter a clear and concise task name"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:["Category ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{required:!0,value:v.category,onChange:e=>w({...v,category:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm appearance-none",children:[t.jsx("option",{value:"assignment",children:"ðŸ“ Assignment"}),t.jsx("option",{value:"quiz",children:"â“ Quiz"}),t.jsx("option",{value:"presentation",children:"ðŸŽ¯ Presentation"}),t.jsx("option",{value:"project",children:"ðŸ› ï¸ Project"}),t.jsx("option",{value:"lab-report",children:"ðŸ”¬ Lab Report"}),t.jsx("option",{value:"lab-final",children:"ðŸ† Lab Final"}),t.jsx("option",{value:"lab-performance",children:"ðŸ“ˆ Lab Performance"}),t.jsx("option",{value:"task",children:"âœ”ï¸ Task"}),t.jsx("option",{value:"documents",children:"ðŸ“„ Documents"}),t.jsx("option",{value:"blc",children:"ðŸ“š BLC"}),t.jsx("option",{value:"groups",children:"ðŸ‘¥ Groups"}),t.jsx("option",{value:"midterm",children:"ðŸ“Š Midterm"}),t.jsx("option",{value:"final-exam",children:"ðŸŽ“ Final Exam"}),t.jsx("option",{value:"others",children:"ðŸ”¹ Others"})]}),t.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:["Priority ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{required:!0,value:v.priority,onChange:e=>w({...v,priority:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm appearance-none",children:[t.jsx("option",{value:"low",children:"ðŸŸ¢ Low Priority"}),t.jsx("option",{value:"medium",children:"ðŸ”µ Medium Priority"}),t.jsx("option",{value:"high",children:"ðŸŸ  High Priority"}),t.jsx("option",{value:"urgent",children:"ðŸ”´ Urgent Priority"})]}),t.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:["Due Date ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",required:!0,value:v.dueDate,onChange:e=>w({...v,dueDate:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:["Description ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{required:!0,value:v.description,onChange:e=>w({...v,description:e.target.value}),rows:4,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm resize-none placeholder:text-gray-400",placeholder:"Provide detailed information about the task..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-4 h-4"}),"Attachments"]}),t.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"Max 10 files, 50MB each"})]})}),t.jsxs("div",{className:"relative group",children:[t.jsx("input",{ref:O,type:"file",multiple:!0,onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=A.length+t.length;if(a>10)return void I(`Maximum 10 files allowed. You're trying to upload ${a} files.`);C(!0),I(null);const s={};try{const e=Array.from(t).map((async e=>{const t=`${e.name}-${Date.now()}`;s[t]=0,z({...s});try{const a=await async function(e,t,a){var s;const l=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","csv","jpg","jpeg","png","gif","svg","zip","rar","7z","mp4","mp3","wav"];if(e.size>52428800)throw new Error(`File size exceeds 50MB limit. Your file: ${(e.size/1024/1024).toFixed(2)}MB`);const d=null==(s=e.name.split(".").pop())?void 0:s.toLowerCase();if(!d||!l.includes(d))throw new Error(`File type .${d} is not allowed. Allowed types: ${l.join(", ")}`);const i=Date.now();var n;const o=`${(n=e.name).substring(0,n.lastIndexOf(".")).replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")||"file"}_${i}_${Math.random().toString(36).substring(2,8)}.${d}`,c=t?`tasks/${t}/${o}`:`temp/${o}`;try{const{data:t,error:s}=await r.storage.from("task-attachments").upload(c,e,{cacheControl:"3600",upsert:!1});if(s){if(s.message.includes("already exists"))throw new Error("A file with this name already exists. Please rename and try again.");throw new Error(`Upload failed: ${s.message}`)}const{data:l}=r.storage.from("task-attachments").getPublicUrl(t.path);return a&&a(100),{url:l.publicUrl,name:e.name,size:e.size}}catch(T){throw new Error(T.message||"Failed to upload file. Please try again.")}}(e,null==x?void 0:x.id,(e=>{f.current&&(s[t]=e,z({...s}))}));return a}catch(a){throw new Error(`${e.name}: ${a.message}`)}})),a=await Promise.all(e);f.current&&(U((e=>[...e,...a])),z({}),O.current&&(O.current.value=""))}catch(l){f.current&&(I((null==l?void 0:l.message)||"Failed to upload files. Please try again."),z({}))}finally{f.current&&C(!1)}},disabled:N||A.length>=10,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv,.jpg,.jpeg,.png,.gif,.svg,.zip,.rar,.7z,.mp4,.mp3,.wav",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10 disabled:cursor-not-allowed"}),t.jsx("div",{className:"w-full px-6 py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-800/50 text-center group-hover:border-blue-500 dark:group-hover:border-blue-400 group-hover:bg-blue-50/50 dark:group-hover:bg-blue-900/10 transition-all duration-200",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"p-3 bg-white dark:bg-gray-700 rounded-full shadow-sm group-hover:scale-110 transition-transform duration-200",children:t.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Click to upload or drag and drop"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Support for documents, images, and archives"})]})]})})]}),N&&Object.keys(F).length>0&&t.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(F).map((([e,a])=>t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate flex-1",children:e.split("-")[0]}),t.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-semibold ml-2",children:[a,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden",children:t.jsx("div",{className:"bg-blue-600 dark:bg-blue-500 h-full transition-all duration-300 ease-out",style:{width:`${a}%`}})})]},e)))}),A.length>0&&t.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:A.map(((e,a)=>t.jsxs("div",{className:"group flex items-center gap-3 bg-white dark:bg-gray-700/50 px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all duration-200",children:[t.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:t.jsx(n,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),e.size>0&&t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:R(e.size)})]}),t.jsx("button",{type:"button",onClick:()=>M(a),disabled:D,className:"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200 opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Remove file",children:t.jsx(o,{className:"w-4 h-4"})})]},a)))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4"}),"Google Drive Links"]})}),t.jsx("textarea",{value:v.googleDriveLinks,onChange:e=>w({...v,googleDriveLinks:e.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none shadow-sm resize-none placeholder:text-gray-400 font-mono text-sm",placeholder:"https://drive.google.com/file/d/..."}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1.5",children:"Enter one link per line. Supported: Drive files, folders, Docs, Sheets, Slides."})]})]})}),t.jsx("div",{className:"p-4 sm:p-6 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 shrink-0",children:t.jsxs("div",{className:"flex gap-3 justify-end",children:[t.jsx("button",{type:"button",onClick:()=>{S(!1),u()},className:"px-6 py-2.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-white dark:hover:bg-gray-700 font-medium transition-all duration-200 disabled:opacity-50 shadow-sm hover:shadow",disabled:D,children:"Cancel"}),t.jsx("button",{onClick:e=>B(e),className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 flex items-center gap-2",disabled:D||N,children:D?t.jsxs(t.Fragment,{children:[t.jsx(d,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):y?"Update Task":"Create Task"})]})})]})})})),U=a.memo((function({tasks:e,selectedTaskIds:a,onSelectTasks:r,onTaskClick:s,onTaskEdit:l,onTaskDelete:d,sort:i,onSortChange:c}){const b=(e,t)=>{r(t?[...a,e]:a.filter((t=>t!==e)))},p=e=>{i.field===e?c({field:e,direction:"asc"===i.direction?"desc":"asc"}):c({field:e,direction:"asc"})},y=async e=>{if(confirm("Delete this task?"))try{await I(e),d(e)}catch(t){alert("Failed to delete task")}},f={low:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",medium:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"},k={"my-tasks":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","in-progress":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",completed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"},j=({field:e})=>i.field!==e?null:"asc"===i.direction?t.jsx(m,{className:"w-4 h-4"}):t.jsx(h,{className:"w-4 h-4"});return 0===e.length?t.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[t.jsxs("div",{className:"relative mb-6",children:[t.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 flex items-center justify-center",children:t.jsx(n,{className:"w-12 h-12 text-blue-600 dark:text-blue-400"})}),t.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center shadow-lg",children:t.jsx("span",{className:"text-white text-lg",children:"âœ¨"})})]}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No Tasks Found"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center max-w-md",children:"Try adjusting your search or filters, or create your first task to get started"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"md:hidden space-y-4",children:e.map(((e,r)=>{const d=new Date(e.dueDate)<new Date&&"completed"!==e.status;return t.jsxs("div",{className:"group relative bg-white dark:bg-gray-800 rounded-xl border transition-all duration-200 shadow-md hover:shadow-lg "+(d?"border-red-200 dark:border-red-800 bg-red-50/40 dark:bg-red-900/15":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600"),children:[d&&t.jsx("div",{className:"absolute top-0 right-0 bg-gradient-to-l from-red-500 to-red-600 text-white px-3 py-1 rounded-bl-lg text-xs font-semibold",children:"Overdue"}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[t.jsx("input",{type:"checkbox",checked:a.includes(e.id),onChange:t=>b(e.id,t.target.checked),className:"mt-0.5 w-5 h-5 rounded border-2 border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0 transition-colors"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>s(e),className:"font-semibold text-sm text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 text-left mb-1.5 line-clamp-2 transition-colors",children:e.name}),e.description&&t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3 line-clamp-2",children:e.description}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[t.jsx("span",{className:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 capitalize",children:e.category.replace("-"," ")}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-1 text-xs font-semibold rounded-full capitalize ${k[e.status]||k["my-tasks"]}`,children:"my-tasks"===e.status?"To Do":"pending"===e.status?"Pending":e.status.replace("-"," ")}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-1 text-xs font-semibold rounded-full capitalize ${f[e.priority]}`,children:e.priority})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 dark:text-gray-400",children:[t.jsx(g,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:new Date(e.dueDate).toLocaleDateString()}),d&&t.jsxs("span",{className:"ml-1 inline-flex items-center gap-1 text-red-600 dark:text-red-400 font-medium",children:[t.jsx("span",{className:"w-1 h-1 bg-red-600 dark:bg-red-400 rounded-full animate-pulse"}),"Overdue"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>s(e),className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200 touch-manipulation active:scale-95",title:"View details",children:t.jsx(x,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>l(e),className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 dark:text-gray-400 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-lg transition-all duration-200 touch-manipulation active:scale-95",title:"Edit task",children:t.jsx(u,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>y(e.id),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200 touch-manipulation active:scale-95",title:"Delete",children:t.jsx(o,{className:"w-4 h-4"})})]})]})]})]})})]},e.id)}))}),t.jsx("div",{className:"hidden md:block",children:t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-lg shadow-gray-200/50 dark:shadow-gray-900/50 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full table-fixed",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/80 border-b-2 border-gray-200 dark:border-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"w-12 px-6 py-4 text-left",children:t.jsx("input",{type:"checkbox",checked:a.length===e.length,onChange:t=>{return a=t.target.checked,void r(a?e.map((e=>e.id)):[]);var a},className:"w-5 h-5 rounded border-2 border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-2 focus:ring-blue-500"})}),t.jsx("th",{onClick:()=>p("name"),className:"w-auto px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:t.jsxs("div",{className:"flex items-center gap-2",children:["Task Name",t.jsx(j,{field:"name"})]})}),t.jsx("th",{onClick:()=>p("category"),className:"w-40 px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:t.jsxs("div",{className:"flex items-center gap-2",children:["Category",t.jsx(j,{field:"category"})]})}),t.jsx("th",{onClick:()=>p("status"),className:"w-32 px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:t.jsxs("div",{className:"flex items-center gap-2",children:["Status",t.jsx(j,{field:"status"})]})}),t.jsx("th",{onClick:()=>p("priority"),className:"w-32 px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:t.jsxs("div",{className:"flex items-center gap-2",children:["Priority",t.jsx(j,{field:"priority"})]})}),t.jsx("th",{onClick:()=>p("dueDate"),className:"w-40 px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:t.jsxs("div",{className:"flex items-center gap-2",children:["Due Date",t.jsx(j,{field:"dueDate"})]})}),t.jsx("th",{className:"w-36 px-6 py-4 text-right text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:e.map((e=>{const r=new Date(e.dueDate)<new Date&&"completed"!==e.status;return t.jsxs("tr",{className:"group task-table-row transition-all duration-200 border-b border-gray-100 dark:border-gray-700/50 last:border-0 "+(r?"bg-red-50/40 dark:bg-red-900/10 hover:bg-red-50/60 dark:hover:bg-red-900/15":"hover:bg-blue-50/30 dark:hover:bg-gray-800/70"),children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("input",{type:"checkbox",checked:a.includes(e.id),onChange:t=>b(e.id,t.target.checked),className:"w-5 h-5 rounded border-2 border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-2 focus:ring-blue-500 transition-colors"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("button",{onClick:()=>s(e),className:"font-semibold text-sm text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 text-left transition-colors line-clamp-1",children:e.name}),e.description&&t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-1",children:e.description})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 capitalize",children:e.category.replace("-"," ")})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-full capitalize ${k[e.status]||k["my-tasks"]}`,children:"my-tasks"===e.status?"To Do":"pending"===e.status?"Pending":e.status.replace("-"," ")})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-full uppercase ${f[e.priority]}`,children:e.priority})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[t.jsx(g,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),t.jsx("span",{children:new Date(e.dueDate).toLocaleDateString()})]}),r&&t.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600 dark:text-red-400 font-medium",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-red-600 dark:bg-red-400 rounded-full animate-pulse"}),"Overdue"]})]})}),t.jsx("td",{className:"px-6 py-4 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-1 task-action-buttons",children:[t.jsx("button",{onClick:()=>s(e),className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-200",title:"View details","aria-label":"View task details",children:t.jsx(x,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>l(e),className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 dark:text-gray-400 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-lg transition-all duration-200",title:"Edit task","aria-label":"Edit task",children:t.jsx(u,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>y(e.id),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200",title:"Delete","aria-label":"Delete task",children:t.jsx(o,{className:"w-4 h-4"})})]})})]},e.id)}))})]})})})})]})}));function O(){return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-900",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-blue-600/20 dark:border-blue-400/20 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Loading..."})]})})}function P({taskId:a,userId:s,userName:l}){const[d,i]=e.useState([]),[n,o]=e.useState(!0),[c,g]=e.useState(""),[x,u]=e.useState(!1),[m,h]=e.useState(null),[y,f]=e.useState("");e.useEffect((()=>{k()}),[a]),e.useEffect((()=>()=>{u(!1)}),[]);const k=async()=>{try{o(!0);const e=await async function(e){const{data:t,error:a}=await r.from("task_comments").select("\n      *,\n      user:users(id, name, email)\n    ").eq("task_id",e).order("created_at",{ascending:!0});if(a)throw new Error(`Failed to fetch comments: ${a.message}`);return(t||[]).map(F)}(a);i(e)}catch(e){}finally{o(!1)}};return n?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx(O,{})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-gray-900 dark:text-white",children:[t.jsx(b,{className:"w-5 h-5"}),t.jsxs("h3",{className:"font-semibold",children:["Comments (",d.length,")"]})]}),t.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===d.length?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:"No comments yet. Be the first to comment!"}):d.map((e=>t.jsx(M,{comment:e,isOwner:e.userId===s,isEditing:m===e.id,editText:y,onEditTextChange:f,onStartEdit:()=>{h(e.id),f(e.comment)},onCancelEdit:()=>{h(null),f("")},onSaveEdit:()=>(async e=>{if(y.trim())try{const t=await async function(e,t){const{data:a,error:s}=await r.from("task_comments").update({comment:t,is_edited:!0}).eq("id",e).select("\n      *,\n      user:users(id, name, email)\n    ").single();if(s)throw new Error(`Failed to update comment: ${s.message}`);return F(a)}(e,y.trim());i(d.map((a=>a.id===e?t:a))),h(null),f("")}catch(t){alert("Failed to update comment")}})(e.id),onDelete:()=>(async e=>{if(confirm("Delete this comment?"))try{await async function(e){const{error:t}=await r.from("task_comments").delete().eq("id",e);if(t)throw new Error(`Failed to delete comment: ${t.message}`)}(e),i(d.filter((t=>t.id!==e)))}catch(t){alert("Failed to delete comment")}})(e.id)},e.id)))}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),c.trim()&&!x){u(!0);try{const e=await async function(e,t,a){const{data:s,error:l}=await r.from("task_comments").insert({task_id:e,user_id:t,comment:a}).select("\n      *,\n      user:users(id, name, email)\n    ").single();if(l)throw new Error(`Failed to add comment: ${l.message}`);return F(s)}(a,s,c.trim());i([...d,e]),g("")}catch(t){alert("Failed to add comment")}finally{u(!1)}}},className:"flex gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx("textarea",{value:c,onChange:e=>g(e.target.value),placeholder:"Write a comment...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:2,disabled:x})}),t.jsxs("button",{type:"submit",disabled:!c.trim()||x,className:"self-end px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[t.jsx(p,{className:"w-4 h-4"}),x?"Sending...":"Send"]})]})]})}function M({comment:e,isOwner:a,isEditing:r,editText:s,onEditTextChange:l,onStartEdit:d,onCancelEdit:i,onSaveEdit:n,onDelete:c}){var g,x,m;return t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium",children:(null==(x=null==(g=e.user)?void 0:g.name)?void 0:x.charAt(0).toUpperCase())||"?"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:(null==(m=e.user)?void 0:m.name)||"Unknown"}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),r=Math.floor(a/6e4),s=Math.floor(a/36e5),l=Math.floor(a/864e5);return r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:l<7?`${l}d ago`:t.toLocaleDateString()})(e.createdAt),e.isEdited&&" (edited)"]})]})]}),a&&!r&&t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:d,className:"p-1 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"Edit comment",children:t.jsx(u,{className:"w-4 h-4"})}),t.jsx("button",{onClick:c,className:"p-1 text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete comment",children:t.jsx(o,{className:"w-4 h-4"})})]})]}),r?t.jsxs("div",{className:"space-y-2",children:[t.jsx("textarea",{value:s,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none",rows:2}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:n,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Save"}),t.jsx("button",{onClick:i,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 text-sm rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"})]})]}):t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap",children:e.comment})]})}function R({task:a,userId:d,onClose:i,onTaskUpdated:n,onTaskDeleted:x}){const[m,h]=e.useState("details"),[p,C]=e.useState(!1),[D,S]=e.useState([]),[T,_]=e.useState(!1),[E,$]=e.useState(!1);e.useEffect((()=>{"history"===m&&F()}),[m]);const F=async()=>{try{_(!0);const e=await async function(e){const{data:t,error:a}=await r.from("task_history").select("\n      *,\n      user:users(id, name, email)\n    ").eq("task_id",e).order("created_at",{ascending:!1});if(a)throw new Error(`Failed to fetch history: ${a.message}`);return(t||[]).map(z)}(a.id);S(e)}catch(e){}finally{_(!1)}},U=async e=>{try{$(!0);const t=await L(a.id,{status:e});n(t)}catch(t){alert("Failed to update status")}finally{$(!1)}},O=new Date(a.dueDate)<new Date&&"completed"!==a.status;return p?t.jsx(A,{userId:d,task:a,onClose:()=>C(!1),onTaskUpdated:e=>{n(e),C(!1)}}):t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex-1 mr-4",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-2",children:a.name}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${{low:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",medium:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}[a.priority]}`,children:a.priority.toUpperCase()}),t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${{"my-tasks":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300","in-progress":"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",completed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"}[a.status]}`,children:"my-tasks"===a.status?"To Do":a.status.replace("-"," ")}),O&&t.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 rounded-full text-xs font-medium",children:[t.jsx(l,{className:"w-3 h-3"}),"Overdue"]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>C(!0),className:"p-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Edit task",children:t.jsx(u,{className:"w-5 h-5"})}),t.jsx("button",{onClick:async()=>{if(confirm("Delete this task? This action cannot be undone."))try{await I(a.id),x(a.id),i()}catch(e){alert("Failed to delete task")}},className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Delete task",children:t.jsx(o,{className:"w-5 h-5"})}),t.jsx("button",{onClick:i,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:t.jsx(s,{className:"w-6 h-6"})})]})]}),t.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 overflow-x-auto no-scrollbar",children:[t.jsx("button",{onClick:()=>h("details"),className:"px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap "+("details"===m?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:"Details"}),t.jsxs("button",{onClick:()=>h("comments"),className:"flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap "+("comments"===m?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[t.jsx(b,{className:"w-4 h-4"}),"Comments"]}),t.jsxs("button",{onClick:()=>h("history"),className:"flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap "+("history"===m?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[t.jsx(y,{className:"w-4 h-4"}),"History"]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:["details"===m&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),t.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:a.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quick Actions"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:["in-progress"!==a.status&&t.jsx("button",{onClick:()=>U("in-progress"),disabled:E,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50",children:"Start Working"}),"completed"!==a.status&&t.jsxs("button",{onClick:()=>U("completed"),disabled:E,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[t.jsx(f,{className:"w-4 h-4"}),"Mark Complete"]}),"completed"===a.status&&t.jsx("button",{onClick:()=>U("my-tasks"),disabled:E,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:"Reopen Task"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(B,{icon:t.jsx(g,{className:"w-5 h-5"}),label:"Due Date",value:new Date(a.dueDate).toLocaleDateString()}),t.jsx(B,{icon:t.jsx(k,{className:"w-5 h-5"}),label:"Category",value:a.category.replace("-"," ")}),a.assignedToUser&&t.jsx(B,{icon:t.jsx(j,{className:"w-5 h-5"}),label:"Assigned To",value:a.assignedToUser.name}),a.assignedByUser&&t.jsx(B,{icon:t.jsx(v,{className:"w-5 h-5"}),label:"Assigned By",value:a.assignedByUser.name}),t.jsx(B,{icon:t.jsx(k,{className:"w-5 h-5"}),label:"Created",value:new Date(a.createdAt).toLocaleString()}),a.completedAt&&t.jsx(B,{icon:t.jsx(f,{className:"w-5 h-5"}),label:"Completed",value:new Date(a.completedAt).toLocaleString()})]}),a.tags&&a.tags.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[t.jsx(w,{className:"w-4 h-4"}),"Tags"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(((e,a)=>t.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 rounded-full text-sm",children:e},a)))})]}),a.attachments&&a.attachments.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[t.jsx(N,{className:"w-4 h-4"}),"Attachments"]}),t.jsx("div",{className:"space-y-2",children:a.attachments.map(((e,a)=>t.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[t.jsx(N,{className:"w-4 h-4"}),e.split("/").pop()]},a)))})]}),a.googleDriveLinks&&a.googleDriveLinks.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4"}),"Google Drive Links"]}),t.jsx("div",{className:"space-y-2",children:a.googleDriveLinks.map(((e,a)=>t.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 break-all",children:[t.jsx(c,{className:"w-4 h-4 flex-shrink-0"}),e]},a)))})]})]}),"comments"===m&&t.jsx(P,{taskId:a.id,userId:d,userName:"Current User"}),"history"===m&&t.jsx("div",{className:"space-y-4",children:T?t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Loading history..."}):0===D.length?t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No history yet"}):D.map((e=>t.jsx(q,{entry:e},e.id)))})]})]})})}function B({icon:e,label:a,value:r}){return t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-750 rounded-lg",children:[t.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:e}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a}),t.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white capitalize",children:r})]})]})}function q({entry:e}){var a,r,s,l,d;return t.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-gray-750 rounded-lg",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium flex-shrink-0",children:(null==(r=null==(a=e.user)?void 0:a.name)?void 0:r.charAt(0).toUpperCase())||"?"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"flex items-start justify-between gap-2",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(null==(s=e.user)?void 0:s.name)||"Unknown User"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:(d=e.createdAt,new Date(d).toLocaleString())})]})}),t.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-2",children:[(l=e.action,{created:"Created task",status_changed:"Changed status",priority_changed:"Changed priority",assigned:"Assigned task",deleted:"Deleted task"}[l]||l),e.fieldName&&t.jsxs(t.Fragment,{children:[" ",t.jsx("span",{className:"font-medium",children:e.fieldName}),e.oldValue&&e.newValue&&t.jsxs(t.Fragment,{children:[" from ",t.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:e.oldValue})," to ",t.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:e.newValue})]})]})]})]})]})}const V=()=>t.jsxs("div",{className:"space-y-4 p-4",children:[t.jsx("div",{className:"md:hidden space-y-4",children:[1,2,3,4,5].map((e=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl border-2 border-gray-200 dark:border-gray-700 p-5 overflow-hidden relative",style:{animationDelay:.1*e+"s"},children:[t.jsx("div",{className:"absolute inset-0 shimmer"}),t.jsxs("div",{className:"flex items-start gap-3 relative",children:[t.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded mt-1"}),t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"}),t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"}),t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-16"})]}),t.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"})]})]})]})]})]},e)))}),t.jsx("div",{className:"hidden md:block",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl border-2 border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm relative",children:[t.jsx("div",{className:"absolute inset-0 shimmer z-10 pointer-events-none"}),t.jsxs("table",{className:"w-full relative z-0",children:[t.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-750 border-b-2 border-gray-200 dark:border-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4",children:t.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})}),t.jsx("th",{className:"px-6 py-4 text-left",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})}),t.jsx("th",{className:"px-6 py-4 text-left",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),t.jsx("th",{className:"px-6 py-4 text-left",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),t.jsx("th",{className:"px-6 py-4 text-left",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),t.jsx("th",{className:"px-6 py-4 text-left",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),t.jsx("th",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 ml-auto"})})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[1,2,3,4,5,6,7].map((e=>t.jsxs("tr",{style:{animationDelay:.05*e+"s"},children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-48"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-64"})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"})]})})]},e)))})]})]})})]}),J=e.memo((({userId:a,sectionId:s,isSectionAdmin:i=!1,isAdmin:n=!1,openCreateForm:c=!1,onCloseCreateForm:g})=>{const[x,u]=e.useState(!1),[m,h]=e.useState(c),[b,p]=e.useState(null),[y,f]=e.useState(null),[k,j]=e.useState(0);e.useEffect((()=>{c&&h(!0)}),[c]);const v=e.useCallback((()=>{h(!1),f(null),g&&g()}),[g]),[w,L]=e.useState([]),[I,F]=e.useState(!0),[z,O]=e.useState(null),[P]=e.useState(1),[M,B]=e.useState(0),q=e.useRef(null),J=e.useRef(null),X=e.useRef(!0),[H,W]=e.useState(""),[G,Z]=e.useState({search:"",category:"all",status:"all",priority:"all"}),[Q,Y]=e.useState({field:"createdAt",direction:"desc"}),[K,ee]=e.useState([]),[te,ae]=e.useState(!1),re=e.useCallback((async(e=!1)=>{q.current&&q.current.abort();const t=new AbortController;q.current=t;try{e||F(!0),O(null);const a=await async function(e,t={}){var a,s;const{page:l=1,pageSize:d=50,filters:i={},sort:n,sectionId:o,abortSignal:c}=t,g=(l-1)*d,x=g+d-1;let u=r.from("tasks").select("*",{count:"exact"});if(o&&(u=u.eq("section_id",o)),i.search&&(u=u.or(`name.ilike.%${i.search}%,description.ilike.%${i.search}%`)),i.category&&"all"!==i.category&&(u=u.eq("category",i.category)),i.status&&"all"!==i.status&&(u=u.eq("status",i.status)),i.priority&&"all"!==i.priority&&(u=u.eq("priority",i.priority)),i.assignedTo&&(u=u.eq("assigned_to",i.assignedTo)),i.tags&&i.tags.length>0&&(u=u.contains("tags",i.tags)),(null==(a=i.dateRange)?void 0:a.start)&&(u=u.gte("due_date",i.dateRange.start)),(null==(s=i.dateRange)?void 0:s.end)&&(u=u.lte("due_date",i.dateRange.end)),i.overdue){const e=(new Date).toISOString().split("T")[0];u=u.lt("due_date",e).neq("status","completed")}if(n){const e="dueDate"===n.field?"due_date":"createdAt"===n.field?"created_at":n.field;u=u.order(e,{ascending:"asc"===n.direction})}else u=u.order("created_at",{ascending:!1});u=u.range(g,x);const m=E(u,c),{data:h,error:b,count:p}=await m;if(b)throw new Error(`Failed to fetch tasks: ${b.message}`);return{tasks:(h||[]).map($),total:p||0,page:l,pageSize:d,hasMore:!!p&&p>x+1}}(0,{page:P,pageSize:50,filters:G,sort:Q,sectionId:s,abortSignal:t.signal});X.current&&!t.signal.aborted&&(L(a.tasks),B(a.total),O(null))}catch(a){if(X.current&&!t.signal.aborted&&"AbortError"!==(null==a?void 0:a.name)&&"Operation cancelled"!==(null==a?void 0:a.message)){const e=a.message||"Failed to load tasks";O(e)}}finally{X.current&&!t.signal.aborted&&F(!1),q.current===t&&(q.current=null)}}),[a,P,G,Q,s]);e.useEffect((()=>(J.current&&clearTimeout(J.current),J.current=setTimeout((()=>{Z((e=>({...e,search:H})))}),300),()=>{J.current&&clearTimeout(J.current)})),[H]),e.useEffect((()=>{re()}),[re]),e.useEffect((()=>(X.current=!0,()=>{X.current=!1,q.current&&(q.current.abort(),q.current=null),J.current&&(clearTimeout(J.current),J.current=null),h(!1)})),[]),e.useEffect((()=>{c&&(j((e=>e+1)),h(!0))}),[c]);const se=e.useCallback((e=>{h(!1),j((e=>e+1)),re(!0)}),[re]),le=e.useCallback((e=>{X.current&&(L((t=>t.map((t=>t.id===e.id?e:t)))),p((t=>(null==t?void 0:t.id)===e.id?e:t)))}),[]),de=e.useCallback((e=>{f(e)}),[]),ie=e.useCallback((e=>{X.current&&(L((t=>t.filter((t=>t.id!==e)))),B((e=>e-1)),ee((t=>t.filter((t=>t!==e)))),p((t=>(null==t?void 0:t.id)===e?null:t)))}),[]),ne=e.useCallback((async()=>{if(0!==K.length&&!te&&confirm(`Delete ${K.length} selected task${K.length>1?"s":""}?`)){ae(!0);try{await async function(e){await _.executeVoid((()=>r.from("tasks").delete().in("id",e)),"Bulk delete tasks")}(K),X.current&&(L((e=>e.filter((e=>!K.includes(e.id))))),B((e=>e-K.length)),ee([]),re(!0))}catch(e){X.current&&(O(e.message||"Failed to delete tasks"),re(!0))}finally{X.current&&ae(!1)}}}),[K,te,re]),oe=e.useCallback((async e=>{if(0!==K.length&&!te){ae(!0);try{await async function(e,t){const a={status:t};"completed"===t&&(a.completed_at=(new Date).toISOString()),await _.executeVoid((()=>r.from("tasks").update(a).in("id",e)),"Bulk update status")}(K,e),X.current&&(ee([]),await re(!0))}catch(t){X.current&&O(t.message||"Failed to update tasks")}finally{X.current&&ae(!1)}}}),[K,te,re]),ce=e.useCallback((()=>{const e=[["Name","Category","Status","Priority","Due Date","Created At"],...w.map((e=>[e.name,e.category,e.status,e.priority,e.dueDate,new Date(e.createdAt).toLocaleDateString()]))].map((e=>e.join(","))).join("\n"),t=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`tasks-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(a)}),[w]),ge=e.useCallback(((e,t)=>{Z((a=>({...a,[e]:t})))}),[]),xe=e.useCallback((e=>{Y(e)}),[]),ue=e.useMemo((()=>{let e=w;if(G.search){const t=G.search.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)))}return"all"!==G.category&&(e=e.filter((e=>e.category===G.category))),"all"!==G.status&&(e=e.filter((e=>e.status===G.status))),"all"!==G.priority&&(e=e.filter((e=>e.priority===G.priority))),e}),[w,G]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm",children:[t.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:t.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 flex-1 lg:max-w-3xl",children:[t.jsx("div",{className:"flex-1 sm:max-w-md",children:t.jsxs("div",{className:"relative group",children:[t.jsx(C,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-gray-400 group-focus-within:text-blue-600 transition-colors"}),t.jsx("input",{type:"text",placeholder:"Search tasks...",value:H,onChange:e=>W(e.target.value),className:"w-full pl-10 pr-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 dark:focus:border-blue-500 dark:focus:ring-blue-900/30 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all outline-none shadow-sm","aria-label":"Search tasks"})]})}),t.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 sm:pb-0 no-scrollbar sm:flex-wrap",children:[t.jsxs("button",{onClick:()=>u(!x),className:"flex items-center gap-2 px-4 py-2.5 border rounded-lg font-medium transition-all duration-200 whitespace-nowrap shadow-sm "+(x?"border-blue-600 bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-500 shadow-blue-100 dark:shadow-blue-900/20":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500"),"aria-label":x?"Hide filters":"Show filters","aria-expanded":x,children:[t.jsx(D,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Filters"})]}),K.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>oe("completed"),disabled:te,className:"flex items-center gap-2 px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed font-medium transition-colors duration-200 whitespace-nowrap shadow-sm","aria-label":`Mark ${K.length} selected task${K.length>1?"s":""} as completed`,children:[t.jsx(S,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:te?"Processing...":"Complete"})]}),t.jsxs("button",{onClick:ne,disabled:te,className:"flex items-center gap-2 px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed font-medium transition-colors duration-200 whitespace-nowrap shadow-sm","aria-label":`Delete ${K.length} selected task${K.length>1?"s":""}`,children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:te?"Deleting...":"Delete"})]})]}),t.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500 font-medium transition-all duration-200 whitespace-nowrap shadow-sm","aria-label":"Export tasks to CSV",children:[t.jsx(N,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Export"})]})]})]}),t.jsx("div",{className:"flex items-center justify-end sm:w-auto w-full",children:t.jsxs("button",{onClick:()=>{j((e=>e+1)),h(!0)},className:"w-full sm:w-auto flex items-center justify-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg font-semibold transition-all duration-200 whitespace-nowrap shadow-md hover:shadow-lg","aria-label":"Create new task",children:[t.jsx(T,{className:"w-5 h-5"}),t.jsx("span",{className:"text-sm",children:"Create Task"})]})})]})}),x&&t.jsx("div",{className:"mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),t.jsxs("select",{id:"category-filter",value:G.category,onChange:e=>ge("category",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none","aria-label":"Filter by category",children:[t.jsx("option",{value:"all",children:"All Categories"}),t.jsx("option",{value:"assignment",children:"Assignment"}),t.jsx("option",{value:"quiz",children:"Quiz"}),t.jsx("option",{value:"presentation",children:"Presentation"}),t.jsx("option",{value:"project",children:"Project"}),t.jsx("option",{value:"lab-report",children:"Lab Report"}),t.jsx("option",{value:"midterm",children:"Midterm"}),t.jsx("option",{value:"final-exam",children:"Final Exam"}),t.jsx("option",{value:"task",children:"Task"}),t.jsx("option",{value:"others",children:"Others"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),t.jsxs("select",{id:"status-filter",value:G.status,onChange:e=>ge("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none","aria-label":"Filter by status",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"my-tasks",children:"To Do"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"completed",children:"Completed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"priority-filter",className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),t.jsxs("select",{id:"priority-filter",value:G.priority,onChange:e=>ge("priority",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none","aria-label":"Filter by priority",children:[t.jsx("option",{value:"all",children:"All Priorities"}),t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:()=>{W(""),Z({search:"",category:"all",status:"all",priority:"all"})},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors duration-200","aria-label":"Reset all filters",children:"Reset Filters"})})]})})]}),z?t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4 p-8",children:[t.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-red-100 dark:bg-red-900/30",children:t.jsx(l,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Failed to Load Tasks"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-md",children:z})]}),t.jsxs("button",{onClick:()=>re(!1),disabled:I,className:"flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-medium transition-colors duration-200 disabled:cursor-not-allowed",children:[t.jsx(d,{className:"w-4 h-4 "+(I?"animate-spin":"")}),t.jsx("span",{children:"Retry"})]})]}):I?t.jsx(V,{}):t.jsx(U,{tasks:ue,selectedTaskIds:K,onSelectTasks:ee,onTaskClick:p,onTaskEdit:de,onTaskDelete:ie,sort:Q,onSortChange:xe}),m&&t.jsx(A,{userId:a,sectionId:s,onClose:v,onTaskCreated:se},k),y&&t.jsx(A,{userId:a,sectionId:s,task:y,onClose:v,onTaskUpdated:e=>{le(e),f(null)}}),b&&t.jsx(R,{task:b,userId:a,onClose:()=>p(null),onTaskUpdated:le,onTaskDeleted:ie})]})}));export{J as TaskManagerEnhanced};
