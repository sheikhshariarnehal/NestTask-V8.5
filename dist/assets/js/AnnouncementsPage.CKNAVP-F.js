const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnnouncementManager.DCNaJ2eY.js","assets/js/react-vendor.BQ9wcLSU.js","assets/js/charts.DuHk9BWv.js","assets/js/vendor.Vy3uO1vB.js","assets/js/icons.B5_ZQj31.js","assets/js/linkParser.CRNpH1Sh.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./capacitor-vendor.WkpnXCg6.js";import{r as t,h as n,j as a}from"./react-vendor.BQ9wcLSU.js";import{s as r}from"./index.DHgWRtD1.js";import{a as s}from"./telegram.service.CKSqE0Xu.js";import"./charts.DuHk9BWv.js";import"./vendor.Vy3uO1vB.js";import"./ionic-vendor.ClmuHuJk.js";import"./supabase-vendor.nnmAzafq.js";import"./dateUtils.8XYiGfWV.js";const o=t.lazy((()=>e((()=>import("./AnnouncementManager.DCNaJ2eY.js")),__vite__mapDeps([0,1,2,3,4,5])).then((e=>({default:e.AnnouncementManager})))));function c(){const{isSectionAdmin:e,sectionId:c}=n(),{announcements:i,createAnnouncement:u,deleteAnnouncement:m}=function(){const[e,n]=t.useState([]),[a,o]=t.useState(!0),[c,i]=t.useState(null),u=t.useCallback((async(e=!1)=>{try{o(!0);const e=await async function(){try{const{data:e,error:t}=await r.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}catch(c){return[]}}();n(e)}catch(t){i(t.message)}finally{o(!1)}}),[]);return t.useEffect((()=>{u()}),[u]),{announcements:e,loading:a,error:c,createAnnouncement:async e=>{try{i(null),await async function(e){const{data:{user:t}}=await r.auth.getUser();if(!t)throw new Error("Not authenticated");try{const n=(new Date).toISOString(),{data:a,error:o}=await r.from("announcements").insert({title:e.title,content:e.content,created_by:t.id,created_at:n}).select().single();if(o)throw o;const c={...a,createdAt:n};return await s(c),c}catch(c){throw c}}(e),await u()}catch(t){throw i(t.message),t}},deleteAnnouncement:async e=>{try{i(null),await async function(e){const{data:{user:t}}=await r.auth.getUser();if(!t)throw new Error("Not authenticated");try{const{error:t}=await r.from("announcements").delete().eq("id",e);if(t)throw t}catch(c){throw c}}(e),await u()}catch(t){throw i(t.message),t}},refreshAnnouncements:t.useCallback((async()=>{try{return await u(!0)}catch(e){throw i(e.message),e}}),[u])}}(),d=t.useMemo((()=>e&&c?i.filter((e=>!e.sectionId||e.sectionId===c)):i),[i,e,c]);return a.jsx(t.Suspense,{fallback:a.jsxs("div",{className:"space-y-4 animate-pulse",children:[a.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"}),[1,2,3].map((e=>a.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-xl"},e)))]}),children:a.jsx(o,{announcements:d,onCreateAnnouncement:u,onDeleteAnnouncement:m})})}export{c as AnnouncementsPage};
