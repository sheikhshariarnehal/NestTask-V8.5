const e=new class{constructor(){this.cache=new Map,this.defaultTTL=3e5}get(e,t){const s=this.cache.get(e);if(!s)return null;const a=null!=t?t:this.defaultTTL;return Date.now()-s.timestamp>a?(this.cache.delete(e),null):s.data}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}async getOrFetch(e,t,s){const a=this.get(e,s);if(null!==a)return a;const c=this.cache.get(e);if(null==c?void 0:c.promise)return c.promise;const n=t();this.cache.set(e,{data:null,timestamp:Date.now(),promise:n});try{const t=await n;return this.cache.set(e,{data:t,timestamp:Date.now()}),t}catch(i){throw this.cache.delete(e),i}}invalidate(e){this.cache.delete(e)}invalidatePattern(e){for(const t of this.cache.keys())e.test(t)&&this.cache.delete(t)}clear(){this.cache.clear()}clearAll(){console.log("[DataCache] Clearing all cache"),this.cache.clear(),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("cache-cleared"))}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}cleanup(){const e=Date.now();for(const[t,s]of this.cache.entries())e-s.timestamp>this.defaultTTL&&this.cache.delete(t)}};"undefined"!=typeof window&&(setInterval((()=>{e.cleanup()}),3e5),window.addEventListener("app-resume",(()=>{console.log("[DataCache] App resumed, clearing cache"),e.clearAll()})),window.addEventListener("supabase-session-refreshed",(()=>{console.log("[DataCache] Session refreshed, clearing cache"),e.clearAll()})));const t={user:e=>`user:${e}`,userWithFullInfo:e=>`user_full:${e}`,department:e=>`department:${e}`,departments:()=>"departments:all",batch:e=>`batch:${e}`,batches:e=>e?`batches:dept:${e}`:"batches:all",section:e=>`section:${e}`,sections:e=>e?`sections:batch:${e}`:"sections:all",tasks:e=>`tasks:${e}`,tasksEnhanced:(e,t)=>t?`tasks_enhanced:${e}:${t}`:`tasks_enhanced:${e}`,taskById:e=>`task:${e}`,announcements:()=>"announcements:all",sectionUsers:e=>`section_users:${e}`,userRole:e=>`user_role:${e}`};export{t as c,e as d};
