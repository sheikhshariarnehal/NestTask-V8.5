const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Dashboard.DaDnQCMu.js","assets/js/react-vendor.2V4evweb.js","assets/js/charts.ixvsjPR7.js","assets/js/vendor.BFZKXrfJ.js","assets/js/icons.DID50SbB.js","assets/js/index.lt7-dZRp.js","assets/js/capacitor-vendor.WkpnXCg6.js","assets/js/ionic-vendor.DB8jv2bB.js","assets/css/ionic-vendor.5aKpPXL6.css","assets/js/supabase-vendor.GZbxw4Q7.js","assets/css/index.U9a9p-Kp.css","assets/js/UserActiveGraph.D6lIwkzx.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./capacitor-vendor.WkpnXCg6.js";import{r as s,j as t,h as a}from"./react-vendor.2V4evweb.js";import{s as r}from"./index.lt7-dZRp.js";import{LucideX as l,AlertCircle as i,LucideTag as n,Calendar as d,Clock as c,LucideUserCheck as o,LucideUsers as x,ListTodo as m,Activity as h,ChevronUp as u,ChevronDown as g}from"./icons.DID50SbB.js";import"./charts.ixvsjPR7.js";import"./vendor.BFZKXrfJ.js";import"./ionic-vendor.DB8jv2bB.js";import"./supabase-vendor.GZbxw4Q7.js";function p({title:e,value:s,icon:a,color:r,onClick:l,loading:i=!1}){return t.jsx("button",{onClick:l,disabled:i,className:`\n        w-full bg-white rounded-2xl p-6 shadow-sm \n        transition-all duration-300 \n        ${l?"hover:shadow-lg hover:-translate-y-1 cursor-pointer":"cursor-default"}\n      `,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 mb-1",children:e}),i?t.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"}):t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s})]}),t.jsx("div",{className:`p-3 rounded-xl transition-colors ${(()=>{switch(r){case"blue":return"bg-blue-50 text-blue-600 hover:bg-blue-100";case"green":return"bg-green-50 text-green-600 hover:bg-green-100";case"purple":return"bg-purple-50 text-purple-600 hover:bg-purple-100";case"indigo":return"bg-indigo-50 text-indigo-600 hover:bg-indigo-100"}})()}`,children:t.jsx(a,{className:"w-6 h-6"})})]})})}function b({users:e=[],onClose:s}){return(null==e?void 0:e.length)?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),t.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(l,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:t.jsx("div",{className:"divide-y",children:e.map((e=>t.jsxs("div",{className:"py-4 first:pt-0 last:pb-0",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-medium",children:e.name.charAt(0).toUpperCase()}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),t.jsx("p",{className:"text-sm text-gray-500",children:e.email})]}),t.jsx("span",{className:"ml-auto px-2.5 py-0.5 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role})]}),t.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Joined ",new Date(e.createdAt).toLocaleDateString()]})]},e.id)))})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),t.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(l,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("div",{className:"p-6",children:t.jsx("p",{className:"text-gray-500 text-center",children:"No users found"})})]})]})}function j({tasks:e=[],onClose:s}){const a=[...e].sort(((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),r=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}};return(null==e?void 0:e.length)?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),t.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-4xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(i,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"All Tasks"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Total ",e.length," tasks in the system"]})]})]}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(l,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:t.jsx("div",{className:"grid gap-4",children:a.map((e=>t.jsx("div",{className:"bg-white border rounded-xl p-4 hover:shadow-md transition-shadow",children:t.jsx("div",{className:"flex items-start justify-between gap-4",children:t.jsxs("div",{className:"flex-grow",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${r(e.status)}`,children:"my-tasks"===e.status?"To Do":"in-progress"===e.status?"In Progress":"Completed"}),e.isAdminTask&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-800 rounded-full",children:"Admin Task"})]}),t.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(n,{className:"w-4 h-4"}),t.jsx("span",{children:e.category})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(d,{className:"w-4 h-4"}),t.jsxs("span",{children:["Due: ",new Date(e.dueDate).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(c,{className:"w-4 h-4"}),t.jsxs("span",{children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]})]})]})})},e.id)))})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),t.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Task Details"}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(l,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("div",{className:"p-6",children:t.jsx("p",{className:"text-gray-500 text-center",children:"No tasks found"})})]})]})}function f({users:e,type:s,onClose:a}){const r=e.filter((e=>{if(!e.lastActive&&!e.createdAt)return!1;const t=new Date;if("active"===s){const s=e.lastActive?new Date(e.lastActive):null;if(!s)return!1;const a=new Date(t);a.setHours(0,0,0,0);const r=new Date(t);return r.setHours(23,59,59,999),s>=a&&s<=r}{const s=new Date(t.getTime()-6048e5);return new Date(e.createdAt)>=s}}));return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm z-40",onClick:a}),t.jsxs("div",{className:"fixed inset-x-4 top-[5%] sm:top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl z-50 max-h-[90vh] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:"active"===s?t.jsx(o,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}):t.jsx(d,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"active"===s?"Active Users Today":"New Users This Week"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length," ",1===r.length?"user":"users"]})]})]}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close modal",children:t.jsx(l,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),t.jsx("div",{className:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:0===r.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center",children:"active"===s?t.jsx(o,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}):t.jsx(d,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),t.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:"No users found"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"active"===s?"No users have been active today":"No new users have joined this week"})]}):t.jsx("div",{className:"space-y-3",children:r.map((e=>t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-grow min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white font-medium flex-shrink-0",children:e.name.charAt(0).toUpperCase()}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:e.email})]})]}),t.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-3 ml-13 sm:ml-0",children:[t.jsx("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300"),children:e.role}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:new Date("active"===s&&e.lastActive||e.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},e.id)))})})]})]})}function v({users:e,tasks:a}){const{stats:l,loading:i}=function(){const[e,t]=s.useState({totalUsers:0,activeToday:0,newThisWeek:0}),[a,l]=s.useState(!0),[i,n]=s.useState(null);s.useEffect((()=>{d()}),[]);const d=async()=>{try{l(!0);const{data:e,error:s}=await r.rpc("get_user_stats");if(s)throw s;t({totalUsers:e.total_users,activeToday:e.active_today,newThisWeek:e.new_this_week})}catch(e){n(e.message)}finally{l(!1)}};return{stats:e,loading:a,error:i,refresh:d}}(),[n,d]=s.useState(!1),[h,u]=s.useState(!1),[g,v]=s.useState(null),w=(()=>{const s=new Date(new Date);return s.setHours(0,0,0,0),e.filter((e=>!!e.lastActive&&new Date(e.lastActive)>=s))})(),N=(()=>{const s=new Date((new Date).getTime()-6048e5);return e.filter((e=>new Date(e.createdAt)>=s))})(),y=[{title:"Total Users",value:e.length,icon:x,color:"blue",onClick:()=>d(!0)},{title:"Active Today",value:w.length,icon:o,color:"green",onClick:()=>v("active")},{title:"New This Week",value:N.length,icon:c,color:"purple",onClick:()=>v("new")},{title:"Total Tasks",value:a.length,icon:m,color:"indigo",onClick:()=>u(!0)}];return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:y.map((e=>t.jsx(p,{...e,loading:i},e.title)))}),n&&t.jsx(b,{users:e,onClose:()=>d(!1)}),h&&t.jsx(j,{tasks:a,onClose:()=>u(!1)}),g&&t.jsx(f,{users:"active"===g?w:N,type:g,onClose:()=>v(null)})]})}function w({users:e}){const[a,r]=s.useState([]),[l,i]=s.useState(!1),[n,d]=s.useState([]);s.useEffect((()=>{const s=[...e].sort(((e,s)=>{const t=e.lastActive?new Date(e.lastActive).getTime():new Date(e.createdAt).getTime();return(s.lastActive?new Date(s.lastActive).getTime():new Date(s.createdAt).getTime())-t}));d(s),r(l?s:s.slice(0,5))}),[e,l]);const c=e=>{const s=new Date(e),t=(new Date).getTime()-s.getTime(),a=Math.floor(t/6e4),r=Math.floor(a/60),l=Math.floor(r/24);return a<1?"Just now":a<60?`${a}m ago`:r<24?`${r}h ago`:1===l?"Yesterday":`${l}d ago`},o=()=>{i(!l)};return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-sm mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Activity"})]}),n.length>5&&t.jsx("button",{onClick:o,className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Show Less"}),t.jsx(u,{className:"w-4 h-4"})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Show All"}),t.jsx(g,{className:"w-4 h-4"})]})})]}),0===a.length?t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No recent activity"}):t.jsx("div",{className:"space-y-3 sm:space-y-4",children:a.map((e=>t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-4 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-medium text-sm sm:text-base",children:e.name.charAt(0).toUpperCase()}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:e.name}),t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300"),children:e.role})]}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]}),t.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 ml-11 sm:ml-0 mt-2 sm:mt-0",children:c(e.lastActive||e.createdAt)})]},e.id)))}),!l&&n.length>5&&t.jsxs("button",{onClick:o,className:"w-full mt-4 py-2 bg-gray-50 dark:bg-gray-700 rounded-lg text-sm text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors flex items-center justify-center gap-1",children:[t.jsxs("span",{children:["View All Activities (",n.length,")"]}),t.jsx(g,{className:"w-4 h-4"})]})]})}const N=s.lazy((()=>e((()=>import("./Dashboard.DaDnQCMu.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then((e=>({default:e.Dashboard}))))),y=s.lazy((()=>e((()=>import("./UserActiveGraph.D6lIwkzx.js")),__vite__mapDeps([11,1,2,3,4])).then((e=>({default:e.UserActiveGraph})))));function k(){const{users:e,tasks:r,isSectionAdmin:l,sectionId:i}=a(),n=s.useMemo((()=>l&&i?e.filter((e=>e.sectionId===i)):e),[e,l,i]),d=s.useMemo((()=>l&&i?r.filter((e=>e.sectionId===i)):r),[r,l,i]);return t.jsxs("div",{className:"space-y-6",children:[t.jsx(s.Suspense,{fallback:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-pulse",children:[t.jsx("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded-xl"}),t.jsx("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),children:t.jsx(N,{users:n,tasks:d})}),t.jsx(v,{users:n,tasks:d}),t.jsx(s.Suspense,{fallback:t.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl animate-pulse"}),children:t.jsx(y,{users:n})}),t.jsx(w,{users:n})]})}export{k as DashboardPage};
