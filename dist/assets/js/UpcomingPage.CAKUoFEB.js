const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/App.D8QDpBl6.js","assets/js/index.C_acLESD.js","assets/css/index.BC4iM_r6.css","assets/js/useAuth.CMlLUe7_.js","assets/js/dataCache.z_cl_fNt.js","assets/js/authErrors.D8KAnYp0.js","assets/js/useTasks.DUJhpa8S.js","assets/js/telegram.service.B5vX6-Oo.js","assets/js/dateUtils.CaLFIf6y.js","assets/js/AuthPage.M-krAP4a.js","assets/js/AuthSubmitButton.gfSMuI6O.js","assets/js/createLucideIcon.CKymOnwz.js","assets/js/alert-circle.DhOw_PQ_.js","assets/js/mail.DC2UCBYC.js","assets/js/eye-off.BYoefIRx.js","assets/js/eye.Bhgy5N19.js","assets/js/loader-2.BDaxWTWs.js","assets/js/user.D0EJMNgj.js","assets/js/book-open.UCLcrQYX.js","assets/js/users.Au5Rmc_G.js","assets/js/check-circle-2.T9Ad0aXx.js","assets/js/x.EQqBnDVm.js","assets/js/briefcase.CMCk0SE4.js","assets/js/shield.DJTHJk-L.js","assets/js/sun.C0BuOcI6.js","assets/js/chevron-right.CxCyoZnO.js","assets/js/calendar.BsI68CSu.js","assets/js/clock.7qrk36aN.js","assets/js/search.CPh8H5iB.js","assets/js/ResetPasswordPage.C3UE5wgT.js","assets/js/shield-check.BFo2NFw-.js","assets/js/linkParser.BKY3c5ee.js","assets/js/googleDriveUtils.DwiLj3PK.js","assets/js/file-text.DUSoxLOK.js","assets/js/link.CE-clJEQ.js","assets/js/tag.CtaS_PpL.js","assets/js/copy.BPpwAQe5.js","assets/js/download.5h7xx-gb.js","assets/js/list-todo.Cn4zm62d.js"])))=>i.map(i=>d[i]);
import{r as l,_ as ne,R as oe,j as e}from"./index.C_acLESD.js";import{a as ve}from"./useTasks.DUJhpa8S.js";import{u as Ne}from"./useAuth.CMlLUe7_.js";import{t as S,m as de,a as ie,c as je,s as ce,f as Z,F as De,G as Te}from"./App.D8QDpBl6.js";import{P as Se}from"./googleDriveUtils.DwiLj3PK.js";import{C as P}from"./calendar.BsI68CSu.js";import{a as U}from"./addDays.CVFu2y4L.js";import{C as Ce}from"./check-circle-2.T9Ad0aXx.js";import{A as $e}from"./alert-circle.DhOw_PQ_.js";import{C as Me}from"./clock.7qrk36aN.js";import{B as te}from"./book-open.UCLcrQYX.js";import{P as Ue,F as Ee}from"./pen-tool.BBlyI9Qe.js";import{F as re}from"./file-text.DUSoxLOK.js";import{A as Pe}from"./activity.BdFVh8VG.js";import{B as Re}from"./building.DxlbKc0Y.js";import{U as Ae}from"./users.Au5Rmc_G.js";import{T as Fe}from"./tag.CtaS_PpL.js";import"./telegram.service.B5vX6-Oo.js";import"./dateUtils.CaLFIf6y.js";import"./dataCache.z_cl_fNt.js";import"./authErrors.D8KAnYp0.js";import"./AuthPage.M-krAP4a.js";import"./AuthSubmitButton.gfSMuI6O.js";import"./createLucideIcon.CKymOnwz.js";import"./mail.DC2UCBYC.js";import"./eye-off.BYoefIRx.js";import"./eye.Bhgy5N19.js";import"./loader-2.BDaxWTWs.js";import"./user.D0EJMNgj.js";import"./x.EQqBnDVm.js";import"./briefcase.CMCk0SE4.js";import"./shield.DJTHJk-L.js";import"./sun.C0BuOcI6.js";import"./chevron-right.CxCyoZnO.js";import"./search.CPh8H5iB.js";import"./ResetPasswordPage.C3UE5wgT.js";import"./shield-check.BFo2NFw-.js";import"./linkParser.BKY3c5ee.js";import"./link.CE-clJEQ.js";import"./copy.BPpwAQe5.js";import"./download.5h7xx-gb.js";import"./list-todo.Cn4zm62d.js";function me(r,t){const s=S(r,t==null?void 0:t.in);return s.setHours(23,59,59,999),s}function ue(r,t){return+S(r)<+S(t)}function R(r,t){const s=()=>je(t==null?void 0:t.in,NaN),i=Ye(r);let m;if(i.date){const c=Oe(i.date,2);m=Be(c.restDateString,c.year)}if(!m||isNaN(+m))return s();const x=+m;let p=0,u;if(i.time&&(p=We(i.time),isNaN(p)))return s();if(i.timezone){if(u=Ze(i.timezone),isNaN(u))return s()}else{const c=new Date(x+p),f=S(0,t==null?void 0:t.in);return f.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),f.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),f}return S(x+p+u,t==null?void 0:t.in)}const E={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Le=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,_e=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ze=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ye(r){const t={},s=r.split(E.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],E.timeZoneDelimiter.test(t.date)&&(t.date=r.split(E.timeZoneDelimiter)[0],n=r.substr(t.date.length,r.length))),n){const i=E.timezone.exec(n);i?(t.time=n.replace(i[1],""),t.timezone=i[1]):t.time=n}return t}function Oe(r,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=r.match(s);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,m=n[2]?parseInt(n[2]):null;return{year:m===null?i:m*100,restDateString:r.slice((n[1]||n[2]).length)}}function Be(r,t){if(t===null)return new Date(NaN);const s=r.match(Le);if(!s)return new Date(NaN);const n=!!s[4],i=D(s[1]),m=D(s[2])-1,x=D(s[3]),p=D(s[4]),u=D(s[5])-1;if(n)return Ge(t,p,u)?qe(t,p,u):new Date(NaN);{const c=new Date(0);return!Ke(t,m,x)||!Ve(t,i)?new Date(NaN):(c.setUTCFullYear(t,m,Math.max(i,x)),c)}}function D(r){return r?parseInt(r):1}function We(r){const t=r.match(_e);if(!t)return NaN;const s=W(t[1]),n=W(t[2]),i=W(t[3]);return Je(s,n,i)?s*de+n*ie+i*1e3:NaN}function W(r){return r&&parseFloat(r.replace(",","."))||0}function Ze(r){if(r==="Z")return 0;const t=r.match(ze);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Xe(n,i)?s*(n*de+i*ie):NaN}function qe(r,t,s){const n=new Date(0);n.setUTCFullYear(r,0,4);const i=n.getUTCDay()||7,m=(t-1)*7+s+1-i;return n.setUTCDate(n.getUTCDate()+m),n}const He=[31,null,31,30,31,30,31,31,30,31,30,31];function ge(r){return r%400===0||r%4===0&&r%100!==0}function Ke(r,t,s){return t>=0&&t<=11&&s>=1&&s<=(He[t]||(ge(r)?29:28))}function Ve(r,t){return t>=1&&t<=(ge(r)?366:365)}function Ge(r,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function Je(r,t,s){return r===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&r>=0&&r<25}function Xe(r,t){return t>=0&&t<=59}const ae=3,Qe=2e3,N=new Map,T=(r,t)=>{const s=`${r.getTime()}_${t}`;if(!N.has(s)&&(N.set(s,Z(r,t)),N.size>100)){const n=N.keys().next().value;n&&N.delete(n)}return N.get(s)},Ie=l.lazy(()=>ne(()=>import("./App.D8QDpBl6.js").then(r=>r.N),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38])).then(r=>({default:r.TaskDetailsPopup}))),et=l.lazy(()=>ne(()=>import("./App.D8QDpBl6.js").then(r=>r.J),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38])).then(r=>({default:r.MonthlyCalendar}))),se=oe.memo(()=>e.jsx("div",{className:"px-3 xs:px-4 md:max-w-4xl lg:max-w-5xl md:mx-auto pb-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:Array.from({length:6}).map((r,t)=>e.jsxs("div",{className:"relative overflow-hidden bg-white dark:bg-gray-800/90 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700/50 border-l-[3px] border-l-blue-300 dark:border-l-blue-600",style:{animationDelay:`${t*100}ms`},children:[e.jsxs("div",{className:"p-4 h-full flex flex-col",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-1/3 animate-pulse"})}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-3.5 bg-gray-200 dark:bg-gray-700 rounded w-full animate-pulse",style:{animationDelay:"100ms"}})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3.5 h-3.5 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 animate-pulse",style:{animationDelay:"150ms"}})]}),e.jsx("div",{className:"h-5 bg-blue-100 dark:bg-blue-900/30 rounded-md px-2.5 py-0.5 w-24 animate-pulse",style:{animationDelay:"250ms"}})]})]}),e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/10 dark:via-gray-400/5 to-transparent"})]},t))})})),le=oe.memo(()=>e.jsxs("div",{className:"max-w-full md:max-w-5xl mx-auto px-2 md:px-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-28 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"})]}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"})]}),e.jsx("div",{className:"pb-4",children:e.jsx("div",{className:"grid grid-cols-7 gap-2 md:gap-3 px-2 md:px-4",children:Array.from({length:7}).map((r,t)=>e.jsxs("div",{className:`flex flex-col items-center justify-center h-16 sm:h-20 md:h-24 w-full p-2 md:p-3 rounded-lg animate-pulse ${t===3?"bg-blue-500/80":"bg-gray-200 dark:bg-gray-700"}`,style:{animationDelay:`${t*50}ms`},children:[e.jsx("div",{className:`w-6 h-2.5 rounded mb-1 ${t===3?"bg-blue-200":"bg-gray-300 dark:bg-gray-600"}`}),e.jsx("div",{className:`w-7 h-7 rounded ${t===3?"bg-blue-200":"bg-gray-300 dark:bg-gray-600"}`})]},t))})})]}));l.memo(({day:r,onClick:t})=>e.jsxs("button",{onClick:t,className:`
        relative group
        flex flex-col items-center justify-center
        w-full aspect-square
        p-1 sm:p-1.5 md:p-3 lg:p-4 rounded-lg sm:rounded-xl 
        border transition-all duration-200
        ${r.isSelected?"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 border-blue-400/50 shadow-md shadow-blue-500/20 dark:shadow-blue-600/20 scale-[1.02] -translate-y-0.5 md:scale-105":r.isToday?"bg-gradient-to-br from-blue-100 via-indigo-50 to-purple-50 border-blue-200/70 dark:from-blue-900/50 dark:via-indigo-900/40 dark:to-purple-900/50 dark:border-blue-700/50":"bg-white/90 dark:bg-gray-800/90 border-gray-200/50 dark:border-gray-700/50"}
        hover:shadow-md hover:-translate-y-0.5
        hover:border-blue-300/70 dark:hover:border-blue-600/70
        active:scale-95 touch-manipulation
        md:hover:shadow-lg md:hover:-translate-y-1
      `,children:[e.jsx("span",{className:`
        text-[10px] sm:text-xs md:text-sm font-semibold tracking-wide
        transition-colors duration-200
        ${r.isSelected?"text-blue-100":r.isToday?"text-blue-600/90 dark:text-blue-400":"text-gray-500 group-hover:text-blue-500 dark:text-gray-400 dark:group-hover:text-blue-400"}
        mb-0.5 sm:mb-1 md:mb-2
      `,children:r.weekDay}),e.jsx("span",{className:`
        text-base sm:text-lg md:text-3xl lg:text-4xl font-bold 
        transition-colors duration-200
        ${r.isSelected?"text-white":r.isToday?"text-blue-600/90 dark:text-blue-400":"text-gray-700 group-hover:text-blue-600 dark:text-gray-300 dark:group-hover:text-blue-400"}
      `,children:r.day}),r.isToday&&!r.isSelected&&e.jsx("div",{className:"absolute -bottom-0.5 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"w-1 h-1 sm:w-1.5 sm:h-1.5 md:w-2 md:h-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 dark:from-blue-400 dark:to-indigo-400 animate-pulse shadow-lg shadow-blue-500/50"})}),r.isSelected&&e.jsx("div",{className:"absolute inset-0 rounded-lg sm:rounded-xl ring-2 ring-blue-400/40 dark:ring-blue-500/40 animate-pulse"})]}));const tt=l.memo(({task:r,status:t,categoryInfo:s,hasAttachments:n,cleanTaskDescription:i,onClick:m,preventTaskSelection:x})=>{const p=R(r.dueDate),u=new Date,c=ue(me(p),ce(u)),f=()=>r.status==="completed"?"border-l-green-500/80":c?"border-l-red-500/80":{presentation:"border-l-purple-500/80",project:"border-l-blue-500/80",assignment:"border-l-indigo-500/80",quiz:"border-l-emerald-500/80","lab-report":"border-l-red-500/80","lab-final":"border-l-yellow-500/80","lab-perf":"border-l-amber-500/80",documents:"border-l-sky-500/80"}[r.category.toLowerCase()]||"border-l-gray-300 dark:border-l-gray-600";return e.jsx("div",{onClick:m,className:`
        group h-full bg-white dark:bg-gray-800/90 rounded-lg
        shadow-sm hover:shadow-md
        border border-gray-100 dark:border-gray-700/50
        relative overflow-hidden ${x?"":"cursor-pointer"}
        transition-all duration-200
        transform ${x?"":"hover:-translate-y-0.5"}
        flex flex-col
        border-l-[3px] ${f()}
        ${r.status==="completed"?"opacity-80":""}
      `,children:e.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[e.jsx("div",{className:"flex items-start mb-2 sm:mb-3",children:e.jsxs("div",{className:"flex items-start gap-2 min-w-0 flex-1",children:[e.jsx("h3",{className:`
              text-sm sm:text-base font-semibold leading-tight flex-1
              ${r.status==="completed"?"text-gray-500 dark:text-gray-400 line-through":c?"text-red-800 dark:text-red-300":"text-gray-800 dark:text-gray-100"}
            `,children:r.name}),n&&e.jsx("div",{className:"flex-shrink-0 p-0.5 mt-0.5",children:e.jsx(Se,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-gray-500 dark:text-gray-400"})})]})}),e.jsx("p",{className:`
          text-[11px] xs:text-xs sm:text-sm leading-relaxed line-clamp-2 xs:line-clamp-3 sm:line-clamp-2 mb-3 sm:mb-4 flex-grow
          ${r.status==="completed"?"text-gray-500 dark:text-gray-400":c?"text-gray-700 dark:text-gray-300":"text-gray-600 dark:text-gray-300"}
        `,children:i(r.description)}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx(P,{className:`
              w-3 h-3 sm:w-3.5 sm:h-3.5
              ${c&&!r.status?"text-red-500 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`}),e.jsxs("span",{className:`
              text-[10px] sm:text-xs font-medium
              ${c&&!r.status?"text-red-500 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:["Due: ",Z(p,"MMM d")]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[(r.status==="completed"||c)&&e.jsxs("span",{className:`
                inline-flex items-center gap-1
                px-1.5 sm:px-2 py-0.5
                text-[9px] sm:text-[10px] font-medium
                rounded-full
                ${r.status==="completed"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400"}
                ${c&&r.status!=="completed"?"animate-pulse":""}
              `,children:[t.icon,e.jsx("span",{children:t.label})]}),e.jsxs("span",{className:`
              inline-flex items-center gap-1 sm:gap-1.5
              px-2 sm:px-2.5 py-0.5
              text-[9px] sm:text-[10px] font-medium tracking-wide
              rounded-md border
              ${s.color.replace("bg-","bg-opacity-75 bg-").replace("text-","text-opacity-90 text-")}
              transition-all duration-200
              shadow-sm
              border-opacity-30
              ${s.color.includes("blue")?"border-blue-200 dark:border-blue-700":s.color.includes("purple")?"border-purple-200 dark:border-purple-700":s.color.includes("emerald")?"border-emerald-200 dark:border-emerald-700":s.color.includes("indigo")?"border-indigo-200 dark:border-indigo-700":s.color.includes("green")?"border-green-200 dark:border-green-700":s.color.includes("red")?"border-red-200 dark:border-red-700":s.color.includes("yellow")?"border-yellow-200 dark:border-yellow-700":s.color.includes("amber")?"border-amber-200 dark:border-amber-700":s.color.includes("sky")?"border-sky-200 dark:border-sky-700":"border-gray-200 dark:border-gray-700"}
              hover:shadow-md group-hover:shadow-md
            `,children:[e.jsx("div",{className:"flex-shrink-0",children:s.icon}),e.jsx("span",{className:"capitalize whitespace-nowrap",children:r.category.replace("-"," ")})]})]})]})]})})});function Ht({tasks:r,openTaskId:t,onOpenTaskIdConsumed:s}){const{user:n}=Ne(),{tasks:i,loading:m,error:x,updateTask:p,refreshTasks:u}=ve(r||n==null?void 0:n.id),[c,f]=l.useState([]),[g,y]=l.useState(new Date),[j,k]=l.useState(null),[A,q]=l.useState(!1),[H,C]=l.useState(null),[K,F]=l.useState(!1),[V,G]=l.useState(!1),[L,rt]=l.useState(!0),[at,xe]=l.useState(!0),[$,be]=l.useState(0),J=l.useRef(!0),X=l.useRef(Date.now()),_=l.useRef(),z=l.useRef();l.useEffect(()=>{f(r||i||[])},[r,i]),l.useEffect(()=>{if(console.log("[UpcomingPage] openTaskId changed:",t),!t)return;const a=r||i||[];if(console.log("[UpcomingPage] Searching for task:",t,"in",a.length,"tasks"),a.length===0&&m){console.log("[UpcomingPage] Tasks still loading, will retry when tasks are available...");return}const o=a.find(d=>d.id===t);if(o){if(console.log("[UpcomingPage] Found task, opening popup:",o.name),k(o),o.dueDate)try{const d=typeof o.dueDate=="string"?R(o.dueDate):new Date(o.dueDate);Number.isNaN(d.getTime())||y(d)}catch(d){}s==null||s()}else if(console.log("[UpcomingPage] Task not found:",t),!m){console.log("[UpcomingPage] Tasks loaded but task not found. Waiting 2s before giving up...");const d=setTimeout(()=>{console.log("[UpcomingPage] Giving up on finding task:",t),s==null||s()},2e3);return()=>clearTimeout(d)}},[t,r,i,m]),l.useEffect(()=>(m&&(z.current=setTimeout(()=>{m&&(console.warn("Loading state stuck for too long, forcing refresh"),u())},1e4)),()=>{z.current&&clearTimeout(z.current)}),[m,u]);const Q=l.useCallback(()=>{$<ae?(console.log(`Retrying task load attempt ${$+1} of ${ae}`),be(a=>a+1),_.current=setTimeout(()=>{u()},Qe*($+1))):(console.error("Max retry attempts reached"),C("Failed to load tasks after multiple attempts. Please try again later."))},[$,u]);l.useEffect(()=>()=>{_.current&&clearTimeout(_.current)},[]),l.useEffect(()=>{x&&(console.error("Task error occurred:",x),C(x),Q())},[x,Q]),l.useEffect(()=>{const a=()=>{const o=document.visibilityState==="visible";if(xe(o),o){const d=Date.now(),h=d-X.current;console.log("Page became visible after",h/1e3,"seconds"),h>3e4&&(console.log("Refreshing tasks due to long visibility change"),u()),X.current=d}};return document.addEventListener("visibilitychange",a),J.current&&(console.log("Initial render, ensuring tasks are loaded"),J.current=!1,!m&&(!i||i.length===0)&&(console.log("No tasks available on mount, triggering load"),u())),()=>{document.removeEventListener("visibilitychange",a)}},[u,m,i]),l.useCallback(()=>{console.log("Manual refresh triggered"),u()},[u]);const he=l.useCallback(a=>a?a.replace(/\*This task is assigned to section ID: [0-9a-f-]+\*/g,"").replace(/\[([^\]]+)\]\(attachment:[^)]+\)/g,"").replace(/\*\*Attachments:\*\*.*?\)/g,"").replace(/AS \*\*Attachments:\*\*.*?$/gm,"").replace(/Attachments:.*?$/gm,"").trim():"",[]),pe=l.useCallback(a=>[/\[([^\]]+)\]\(attachment:[^)]+\)/,/\*\*Attachments:\*\*/,/AS \*\*Attachments:\*\*/,/Attachments:/].some(d=>d.test(a)),[]),Y=l.useCallback(a=>T(a,"yyyy-MM-dd"),[]),M=l.useCallback((a,o)=>!a||!o?!1:a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()===o.getDate(),[]),fe=l.useMemo(()=>{const a=U(g,-3),o=new Date;return Array.from({length:7},(d,h)=>{const b=U(a,h);return{date:b,day:T(b,"dd"),weekDay:T(b,"EEE"),isSelected:M(b,g),isToday:M(b,o)}})},[g,M,T]),I=l.useMemo(()=>{if(!c||c.length===0)return new Map;const a=new Map;return c.forEach(o=>{if(o.dueDate)try{const d=R(o.dueDate),h=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;a.has(h)||a.set(h,[]),a.get(h).push(o)}catch(d){}}),a},[c]),ee=l.useMemo(()=>{const a=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`;return I.get(a)||[]},[I,g]),ye=l.useCallback(a=>{const o=R(a.dueDate),d=new Date,h=ue(me(o),ce(d));return a.status==="completed"?{label:"Completed",color:"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400 ring-green-500/20",icon:e.jsx(Ce,{className:"w-3.5 h-3.5"})}:h?{label:"Overdue",color:"bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 ring-red-500/20",icon:e.jsx($e,{className:"w-3.5 h-3.5"}),cardStyle:"border-l-[3px] border-l-red-500 bg-red-50/30 dark:bg-red-900/10"}:{label:"In Progress",color:"bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 ring-blue-500/20",icon:e.jsx(Me,{className:"w-3.5 h-3.5"})}},[]),O=l.useMemo(()=>({task:e.jsx(te,{className:"w-3 h-3 md:w-4 md:h-4"}),presentation:e.jsx(Ue,{className:"w-3 h-3 md:w-4 md:h-4"}),project:e.jsx(De,{className:"w-3 h-3 md:w-4 md:h-4"}),assignment:e.jsx(re,{className:"w-3 h-3 md:w-4 md:h-4"}),quiz:e.jsx(te,{className:"w-3 h-3 md:w-4 md:h-4"}),"lab-report":e.jsx(Ee,{className:"w-3 h-3 md:w-4 md:h-4"}),"lab-final":e.jsx(Te,{className:"w-3 h-3 md:w-4 md:h-4"}),"lab-performance":e.jsx(Pe,{className:"w-3 h-3 md:w-4 md:h-4"}),documents:e.jsx(re,{className:"w-3 h-3 md:w-4 md:h-4"}),blc:e.jsx(Re,{className:"w-3 h-3 md:w-4 md:h-4"}),groups:e.jsx(Ae,{className:"w-3 h-3 md:w-4 md:h-4"}),default:e.jsx(Fe,{className:"w-3 h-3 md:w-4 md:h-4"})}),[]),B=l.useMemo(()=>({task:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300",presentation:"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300",project:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-300",assignment:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300",quiz:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/20 dark:text-indigo-300","lab-report":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300","lab-final":"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-300","lab-performance":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-300",documents:"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-300",blc:"bg-amber-100 text-amber-700 dark:bg-amber-900/20 dark:text-amber-300",groups:"bg-sky-100 text-sky-700 dark:bg-sky-900/20 dark:text-sky-300",default:"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-300"}),[]),ke=l.useCallback(a=>{const o=a||"default";return{icon:O[o]||O.default,color:B[o]||B.default}},[O,B]),we=async(a,o)=>{try{q(!0),C(null);const d=c.find(b=>b.id===a);if(!d)throw new Error("Task not found in current list");const h=d.status;try{const b=await p(a,{status:o});f(w=>w.map(v=>v.id===a?b:v)),(j==null?void 0:j.id)===a&&k(b)}catch(b){throw f(w=>w.map(v=>v.id===a?{...v,status:h}:v)),b}}catch(d){C("Failed to update task status. Please try again."),console.error("Error updating task status:",d)}finally{q(!1)}};return l.useCallback(a=>{y(a),k(null)},[]),l.useEffect(()=>{const o=setTimeout(()=>{try{const d=new URLSearchParams(window.location.search),h=d.get("selectedDate"),b=Y(g);if(h!==b){d.set("selectedDate",b);const w=`${window.location.pathname}?${d.toString()}`;window.history.replaceState({path:w},"",w)}}catch(d){console.error("Error updating URL parameter:",d)}},300);return()=>clearTimeout(o)},[g,Y]),L&&m?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pt-4",children:[e.jsx(le,{}),e.jsx(se,{})]}):m&&!L?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pt-4",children:[e.jsx(le,{}),e.jsx(se,{})]}):!m&&(!c||c.length===0)?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pt-4",children:e.jsx("div",{className:"max-w-full md:max-w-5xl mx-auto px-2 md:px-6",children:e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200/80 dark:border-gray-700/80 mt-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsx("p",{className:"text-lg text-gray-900 dark:text-gray-100 font-medium",children:"No tasks available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Try refreshing the page or check back later"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(x||H)&&e.jsx("div",{className:"fixed top-4 right-4 z-50 bg-red-100 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg shadow-lg animate-fade-in",children:e.jsx("p",{className:"text-sm font-medium",children:x||H})}),(A||m&&!L)&&e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-xl animate-scale-in",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:A?"Updating task...":"Loading tasks..."})]})}),e.jsxs("div",{className:"max-w-full md:max-w-5xl mx-auto px-2 md:px-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>y(U(g,-7)),className:"p-2.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50/80 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/30 rounded-lg transition-colors duration-150 active:scale-95","aria-label":"Previous week",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsxs("button",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700 dark:text-gray-200 cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors px-4 py-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 active:scale-98",onClick:()=>F(!0),"aria-label":"Open calendar",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:T(g,"MMMM yyyy")})]}),e.jsx("button",{onClick:()=>y(U(g,7)),className:"p-2.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50/80 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/30 rounded-lg transition-colors duration-150 active:scale-95","aria-label":"Next week",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"pb-4",children:e.jsx("div",{className:"grid grid-cols-7 gap-2 md:gap-3 px-2 md:px-4",children:fe.map(a=>e.jsxs("button",{onClick:()=>y(a.date),className:`
                flex flex-col items-center justify-center
                h-16 sm:h-20 md:h-24 w-full
                p-2 md:p-3 rounded-lg
                border transition-all duration-200
                ${a.isSelected?"bg-blue-600 border-blue-500 shadow-lg shadow-blue-500/20 text-white scale-105":a.isToday?"bg-blue-50/50 border-blue-200/60 dark:bg-blue-900/20 dark:border-blue-700/50":"bg-white dark:bg-gray-800/50 border-gray-200 dark:border-gray-700/50"}
                hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-md
                active:scale-95
              `,children:[e.jsx("span",{className:`
                text-[10px] sm:text-xs font-semibold tracking-wider uppercase
                ${a.isSelected?"text-blue-100":a.isToday?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"}
              `,children:a.weekDay}),e.jsx("span",{className:`
                text-xl sm:text-2xl md:text-3xl font-bold mt-1
                ${a.isSelected?"text-white":a.isToday?"text-blue-600 dark:text-blue-400":"text-gray-800 dark:text-gray-200"}
              `,children:a.day})]},a.day+a.weekDay))})})]}),e.jsx("div",{className:"px-3 xs:px-4 md:max-w-4xl lg:max-w-5xl md:mx-auto pb-8",children:ee.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 xs:gap-3 md:gap-4",children:ee.map(a=>e.jsx(tt,{task:a,status:ye(a),categoryInfo:ke(a.category),hasAttachments:pe(a.description),cleanTaskDescription:he,onClick:()=>{V||k(a)},preventTaskSelection:V},a.id))}):e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200/80 dark:border-gray-700/80 mt-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("p",{className:"text-lg text-gray-900 dark:text-gray-100 font-medium",children:["No tasks for ",Z(g,"MMMM d")]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:M(g,new Date)?"You're all caught up for today!":"Nothing scheduled for this day"})]})}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"})}),children:j&&e.jsx(Ie,{task:j,onClose:()=>k(null),onStatusUpdate:we,isUpdating:A})}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"})}),children:K&&e.jsx(et,{isOpen:K,onClose:()=>F(!1),selectedDate:g,onSelectDate:a=>{k(null),G(!0),setTimeout(()=>{G(!1)},1e3),y(a),F(!1);try{const o=new URLSearchParams(window.location.search);o.set("selectedDate",Y(a));const d=`${window.location.pathname}?${o.toString()}`;window.history.pushState({path:d},"",d)}catch(o){console.error("Error setting date parameter:",o)}},tasks:c})})]})}export{Ht as UpcomingPage};
