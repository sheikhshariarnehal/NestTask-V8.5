import{R as e,j as a,r as s,u as t,g as r,O as n}from"./react-vendor.2V4evweb.js";import{u as l}from"./useAuth.Bb42EurS.js";import{u as i,a as o}from"./useUsers.CEWjooTn.js";import{LucideX as d,LucideMenu as c,LayoutDashboard as m,LucideUsers as u,ListTodo as g,CheckCircle as x,LucideMegaphone as h,FileText as b,LucideSettings as f,ChevronLeft as p,LucidePlus as j,LucideUser as k,LucideUserCog as y,LucideSun as v,LucideMoon as w,HelpCircle as N,LogOut as C,AlertTriangle as L}from"./icons.DID50SbB.js";import{u as T}from"./useTheme.C_vj2EEw.js";import{a as S,b as U,c as A}from"./ionic-vendor.DB8jv2bB.js";import{L as M}from"./LoadingScreen.sJMF5eww.js";import"./charts.ixvsjPR7.js";import"./vendor.BFZKXrfJ.js";import"./index.lt7-dZRp.js";import"./capacitor-vendor.WkpnXCg6.js";import"./supabase-vendor.GZbxw4Q7.js";import"./dataCache.DP4PyhNH.js";import"./authErrors.BDay5vyW.js";import"./telegram.service.CKSqE0Xu.js";import"./dateUtils.8XYiGfWV.js";const $=e.memo((function({icon:e,label:s,isActive:t,onClick:r,badge:n,isCollapsed:l=!1}){return l?a.jsxs("button",{onClick:r,className:`\n          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform\n          ${t?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n          focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n        `,title:s,"aria-label":s,children:[a.jsx(e,{className:"w-5 h-5 "+(t?"text-blue-600 dark:text-blue-400":"")}),void 0!==n&&a.jsx("span",{className:`\n            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full\n            ${t?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}\n            transform -translate-y-1 translate-x-1\n          `,children:n>99?"99+":n})]}):a.jsxs("button",{onClick:r,className:`\n        w-full flex items-center justify-between rounded-lg py-2.5 px-3 transition-all duration-200 will-change-transform\n        ${t?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n        focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n      `,"aria-label":s,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(e,{className:"w-5 h-5 "+(t?"text-blue-600 dark:text-blue-400":"")}),a.jsx("span",{className:"text-sm font-medium",children:s})]}),void 0!==n&&a.jsx("span",{className:`\n          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full\n          ${t?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}\n        `,children:n>99?"99+":n})]})})),D=e.memo((function({isOpen:e,onClick:s}){return a.jsx("button",{onClick:s,className:`\n        lg:hidden fixed top-4 left-4 z-50 p-2.5 rounded-xl shadow-md \n        transition-all duration-300 transform will-change-transform\n        ${e?"bg-white dark:bg-gray-800 rotate-0":"bg-gradient-to-r from-blue-600 to-indigo-600"}\n        focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n      `,"aria-label":e?"Close menu":"Open menu",children:e?a.jsx(d,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}):a.jsx(c,{className:"w-5 h-5 text-white"})})})),E=e.memo((function({activeTab:e,onTabChange:t,onLogout:r,onCollapse:n,isSectionAdmin:i=!1,onCreateTask:o}){const[d,c]=s.useState(!1),[L,S]=s.useState(!1),{isDark:U,toggle:A}=T(),{user:M}=l(),[E,z]=s.useState(""),[I,O]=s.useState(!1);s.useEffect((()=>{const e=()=>{z((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};e();const a=setInterval(e,6e4);return()=>clearInterval(a)}),[]),s.useEffect((()=>{const e=e=>{const a=e.target;I&&!a.closest(".profile-menu-container")&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[I]);const _=s.useMemo((()=>[{id:"dashboard",label:"Dashboard",icon:m},{id:"users",label:"Users",icon:u,badge:147},{id:"tasks",label:"Tasks (Legacy)",icon:g,badge:56},{id:"task-management-v2",label:"Task Management",icon:x,badge:null}]),[]),P=s.useMemo((()=>[{id:"announcements",label:"Announcements",icon:h},{id:"lecture-slides",label:"Lecture Slides",icon:b}]),[]),F=s.useMemo((()=>i?P.filter((e=>["announcements","lecture-slides"].includes(e.id))):P),[P,i]),R=s.useCallback((()=>{c((e=>!e)),O(!1)}),[]),V=s.useCallback((()=>{c(!1)}),[]),q=s.useCallback((e=>{t(e),c(!1),O(!1)}),[t]),H=s.useCallback((()=>{S((e=>{const a=!e;return n&&n(a),a})),O(!1)}),[n]),W=s.useCallback((()=>{A()}),[A]),X=s.useCallback((()=>{O((e=>!e))}),[]),Y=s.useCallback((()=>{O(!1),r()}),[r]);return a.jsxs(a.Fragment,{children:[a.jsx(D,{isOpen:d,onClick:R}),d&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 lg:hidden dark:bg-opacity-70 backdrop-blur-sm will-change-transform",onClick:V}),a.jsx("aside",{className:`\n        fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-100 dark:border-gray-800\n        transform transition-all duration-300 ease-in-out z-40 shadow-md will-change-transform\n        ${d?"translate-x-0":"-translate-x-full"}\n        ${L?"w-20":"w-64"}\n        lg:translate-x-0\n      `,children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:`p-4 border-b border-gray-100 dark:border-gray-800 flex ${L?"justify-center":"justify-between"} items-center`,children:[!L&&a.jsxs("div",{className:"flex items-center gap-2.5",children:[a.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center shadow-sm",children:a.jsx(f,{className:"w-4.5 h-4.5 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-base font-bold text-gray-900 dark:text-white",children:"NestTask"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i?"Section Admin":"Admin Panel"})]})]}),L&&a.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center shadow-sm",children:a.jsx(f,{className:"w-5 h-5 text-white"})}),a.jsx("button",{onClick:H,className:"hidden lg:flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":L?"Expand sidebar":"Collapse sidebar",children:a.jsx(p,{className:"w-4 h-4 text-gray-600 dark:text-gray-400 transition-transform "+(L?"rotate-180":"")})})]}),a.jsxs("div",{className:"flex-1 py-4 px-3 overflow-y-auto",children:[!L&&a.jsx("div",{className:"mb-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Main"})}),a.jsx("nav",{className:"space-y-1",children:_.map((s=>a.jsx($,{icon:s.icon,label:s.label,isActive:e===s.id,onClick:()=>q(s.id),badge:s.badge,isCollapsed:L},s.id)))}),!L&&a.jsx("div",{className:"my-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Management"})}),L&&a.jsx("div",{className:"my-3 border-t border-gray-100 dark:border-gray-800 mx-2"}),a.jsx("nav",{className:"space-y-1",children:F.map((s=>a.jsx($,{icon:s.icon,label:s.label,isActive:e===s.id,onClick:()=>q(s.id),isCollapsed:L},s.id)))}),!L&&a.jsx("div",{className:"mt-6 mx-2",children:a.jsxs("button",{className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors shadow-sm",onClick:()=>{o&&o(),q("task-management-v2")},children:[a.jsx(j,{className:"w-4 h-4"}),a.jsx("span",{children:"Create Task"})]})}),L&&a.jsx("div",{className:"mt-6 flex justify-center",children:a.jsx("button",{className:"w-10 h-10 flex items-center justify-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg transition-colors shadow-sm",onClick:()=>{o&&o(),q("task-management-v2")},"aria-label":"Create Task",children:a.jsx(j,{className:"w-5 h-5"})})})]}),a.jsxs("div",{className:"p-3 border-t border-gray-100 dark:border-gray-800 relative profile-menu-container",children:[L?a.jsx("button",{onClick:X,className:"w-full flex justify-center group",children:a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-200 dark:group-hover:ring-blue-900 transition-all",children:(null==M?void 0:M.avatar)?a.jsx("img",{src:M.avatar,alt:M.name,className:"w-full h-full object-cover"}):a.jsx(k,{className:"w-5 h-5 text-white"})})}):a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("button",{onClick:X,className:"flex items-center gap-2.5 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors w-full group",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==M?void 0:M.avatar)?a.jsx("img",{src:M.avatar,alt:M.name,className:"w-full h-full object-cover"}):a.jsx(k,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate w-full group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(null==M?void 0:M.name)||"User"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-full",children:(null==M?void 0:M.email)||"Loading..."})]}),a.jsx(p,{className:`w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform rotate-90 ${I?"rotate-[270deg]":""} group-hover:text-blue-600 dark:group-hover:text-blue-400`})]})}),I&&a.jsxs("div",{className:`\n                absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-100 dark:border-gray-700 py-2 z-50\n                ${L?"left-full ml-2 bottom-auto top-0":""}\n              `,children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==M?void 0:M.avatar)?a.jsx("img",{src:M.avatar,alt:M.name,className:"w-full h-full object-cover"}):a.jsx(k,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:(null==M?void 0:M.name)||"User"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(null==M?void 0:M.email)||"Loading..."})]})]})}),a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>q("profile"),children:[a.jsx(y,{className:"w-4 h-4"}),a.jsx("span",{children:"Profile Settings"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:W,children:[U?a.jsx(v,{className:"w-4 h-4"}):a.jsx(w,{className:"w-4 h-4"}),a.jsx("span",{children:U?"Light Mode":"Dark Mode"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>window.open("/help","_blank"),children:[a.jsx(N,{className:"w-4 h-4"}),a.jsx("span",{children:"Help Center"})]}),a.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 my-1"}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:Y,children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})]})]})]})})]})}));function z(){const e=t(),d=r(),{user:c,logout:m}=l(),[u]=s.useState(null),[g,x]=s.useState(!1),{users:h,deleteUser:b,refreshUsers:f,loading:p}=i(),{tasks:k,createTask:y,updateTask:v,deleteTask:w,refreshTasks:N,loading:C}=o(null==c?void 0:c.id),T="section_admin"===(null==c?void 0:c.role),$=null==c?void 0:c.sectionId,D=null==c?void 0:c.sectionName;s.useEffect((()=>{c?"admin"===c.role||"super-admin"===c.role||"section_admin"===c.role?"super-admin"!==c.role||"/admin"!==d.pathname&&"/admin/"!==d.pathname&&"/admin/dashboard"!==d.pathname&&!d.pathname.startsWith("/admin/")?"admin"!==c.role&&"section_admin"!==c.role||"/admin"!==d.pathname&&"/admin/"!==d.pathname||e("/admin/dashboard",{replace:!0}):e("/superadmin/dashboard",{replace:!0}):e("/",{replace:!0}):e("/auth",{replace:!0})}),[c,e,d.pathname]);const z=s.useCallback((async e=>{const a=Date.now();try{"vibrate"in navigator&&navigator.vibrate(10);const e=await N(!0);await f();const s=Date.now()-a;s<500&&await new Promise((e=>setTimeout(e,500-s))),e&&"vibrate"in navigator&&navigator.vibrate([5,50,5])}catch(s){"vibrate"in navigator&&navigator.vibrate(100)}finally{e.detail.complete()}}),[N,f]),I=(()=>{const e=d.pathname;return e.includes("/admin/users")?"users":e.includes("/admin/tasks")?"tasks":e.includes("/admin/task-management")?"task-management-v2":e.includes("/admin/announcements")?"announcements":e.includes("/admin/lecture-slides")?"lecture-slides":e.includes("/admin/super-admin")?"super-admin":"dashboard"})(),O=s.useCallback((a=>{e({dashboard:"/admin/dashboard",users:"/admin/users",tasks:"/admin/tasks","task-management-v2":"/admin/task-management",announcements:"/admin/announcements","lecture-slides":"/admin/lecture-slides","super-admin":"/admin/super-admin"}[a])}),[e]),_=s.useCallback((()=>{e("/admin/task-management"),setTimeout((()=>{x(!0)}),150)}),[e]);return!c||"admin"!==c.role&&"super-admin"!==c.role&&"section_admin"!==c.role?a.jsx(M,{minimumLoadTime:300}):a.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[a.jsx(E,{activeTab:I,onTabChange:O,onLogout:m,isSectionAdmin:T,onCreateTask:_}),a.jsx("main",{className:"flex-1 flex flex-col overflow-hidden",children:a.jsxs(S,{scrollY:!0,fullscreen:!0,className:"h-full",children:[a.jsx(U,{slot:"fixed",onIonRefresh:z,children:a.jsx(A,{})}),a.jsxs("div",{className:"h-full p-4 sm:p-6 lg:p-8",children:[a.jsx("header",{className:"mb-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:T?`${D} Admin`:"Admin Dashboard"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage your application"})]}),a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})})]})}),u&&a.jsxs("div",{className:"mb-4 p-3 flex items-center gap-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm",children:[a.jsx(L,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{children:u})]}),a.jsx("div",{className:"space-y-4 sm:space-y-6",children:a.jsx(n,{context:{users:h,tasks:k,isSectionAdmin:T,sectionId:$,sectionName:D,deleteUser:b,refreshUsers:f,refreshTasks:N,onCreateTask:y,onDeleteTask:w,onUpdateTask:v,openTaskFormV2:g,setOpenTaskFormV2:x,usersLoading:p,tasksLoading:C}})})]})]})}),a.jsx("button",{onClick:_,className:"lg:hidden fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-50 active:scale-95","aria-label":"Create Task",children:a.jsx(j,{className:"w-6 h-6"})})]})}export{z as AdminLayout};
