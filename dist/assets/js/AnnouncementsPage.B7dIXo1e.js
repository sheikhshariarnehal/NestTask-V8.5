const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnnouncementManager.DN3uiW0M.js","assets/js/index.BWQ-9TVi.js","assets/css/index.JTvkVYmA.css","assets/js/megaphone.BmF1nNLh.js","assets/js/createLucideIcon.CgkG35nA.js","assets/js/send.DfZCQsvr.js","assets/js/linkParser.BKY3c5ee.js","assets/js/calendar.CPh7x9wv.js","assets/js/trash-2.heIzzBDp.js"])))=>i.map(i=>d[i]);
import{s as m,r as s,_ as w,b as g,j as l}from"./index.BWQ-9TVi.js";import{a as A}from"./telegram.service.B5vX6-Oo.js";import"./dateUtils.CaLFIf6y.js";async function y(){try{const{data:n,error:t}=await m.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;return n}catch(n){return console.error("Error fetching announcements:",n),[]}}async function p(n){const{data:{user:t}}=await m.auth.getUser();if(!t)throw new Error("Not authenticated");try{const e=new Date().toISOString(),{data:u,error:i}=await m.from("announcements").insert({title:n.title,content:n.content,created_by:t.id,created_at:e}).select().single();if(i)throw i;const r={...u,createdAt:e};return await A(r),r}catch(e){throw console.error("Error creating announcement:",e),e}}async function x(n){const{data:{user:t}}=await m.auth.getUser();if(!t)throw new Error("Not authenticated");try{const{error:e}=await m.from("announcements").delete().eq("id",n);if(e)throw e}catch(e){throw console.error("Error deleting announcement:",e),e}}function E(){const[n,t]=s.useState([]),[e,u]=s.useState(!0),[i,r]=s.useState(null),a=s.useCallback(async(c=!1)=>{try{u(!0);const o=await y();t(o)}catch(o){r(o.message)}finally{u(!1)}},[]);s.useEffect(()=>{a()},[a]);const d=async c=>{try{r(null),await p(c),await a()}catch(o){throw r(o.message),o}},f=async c=>{try{r(null),await x(c),await a()}catch(o){throw r(o.message),o}},h=s.useCallback(async()=>{try{return await a(!0)}catch(c){throw console.error("Failed to refresh announcements:",c),r(c.message),c}},[a]);return{announcements:n,loading:e,error:i,createAnnouncement:d,deleteAnnouncement:f,refreshAnnouncements:h}}const _=s.lazy(()=>w(()=>import("./AnnouncementManager.DN3uiW0M.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>({default:n.AnnouncementManager})));function N(){const{isSectionAdmin:n,sectionId:t}=g(),{announcements:e,createAnnouncement:u,deleteAnnouncement:i}=E(),r=s.useMemo(()=>!n||!t?e:e.filter(a=>!a.sectionId||a.sectionId===t),[e,n,t]);return l.jsx(s.Suspense,{fallback:l.jsxs("div",{className:"space-y-4 animate-pulse",children:[l.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"}),[1,2,3].map(a=>l.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-xl"},a))]}),children:l.jsx(_,{announcements:r,onCreateAnnouncement:u,onDeleteAnnouncement:i})})}export{N as AnnouncementsPage};
