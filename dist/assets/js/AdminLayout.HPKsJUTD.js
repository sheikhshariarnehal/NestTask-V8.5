import{R as e,j as a,r,u as s,a as t,O as n}from"./index.ByUURyMP.js";import{u as l}from"./useAuth.DAYYE1Fp.js";import{u as i,S as o,a as d,M as c,L as m}from"./sun.dhT0FQco.js";import{u as g,a as u}from"./useTasks.CT-BJmXs.js";import{L as x,M as h}from"./menu.HqhhxqbO.js";import{U as b}from"./users.8b9AGNXK.js";import{L as f}from"./list-todo.md6ylFQz.js";import{C as p}from"./check-circle.DB7iireG.js";import{M as y}from"./megaphone.CLQrOp3t.js";import{F as j}from"./file-text.Co0KXXHu.js";import{B as k}from"./bell.Cp6G9hA6.js";import{C as v}from"./chevron-left.BcKAxoAz.js";import{P as w}from"./plus.oK6zdGg4.js";import{U as N}from"./user.ag73gZHG.js";import{U as C,H as L}from"./user-cog.gP6wCpBE.js";import{L as T}from"./LoadingScreen.A7QnjXuQ.js";import{A as M}from"./alert-triangle.B-t2kkBO.js";import"./dataCache.yGM8Zd45.js";import"./authErrors.BDay5vyW.js";import"./createLucideIcon.DqimOJnD.js";import"./telegram.service.BTr96-Tu.js";import"./dateUtils.8XYiGfWV.js";const S=e.memo((function({icon:e,label:r,isActive:s,onClick:t,badge:n,isCollapsed:l=!1}){return l?a.jsxs("button",{onClick:t,className:`\n          w-full flex items-center justify-center rounded-lg p-2.5 transition-all duration-200 relative will-change-transform\n          ${s?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n          focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n        `,title:r,"aria-label":r,children:[a.jsx(e,{className:"w-5 h-5 "+(s?"text-blue-600 dark:text-blue-400":"")}),void 0!==n&&a.jsx("span",{className:`\n            absolute top-0 right-0.5 px-1 py-0.5 min-w-[18px] h-4.5 flex items-center justify-center text-[10px] font-medium rounded-full\n            ${s?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}\n            transform -translate-y-1 translate-x-1\n          `,children:n>99?"99+":n})]}):a.jsxs("button",{onClick:t,className:`\n        w-full flex items-center justify-between rounded-lg py-2.5 px-3 transition-all duration-200 will-change-transform\n        ${s?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"}\n        focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-opacity-50\n      `,"aria-label":r,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(e,{className:"w-5 h-5 "+(s?"text-blue-600 dark:text-blue-400":"")}),a.jsx("span",{className:"text-sm font-medium",children:r})]}),void 0!==n&&a.jsx("span",{className:`\n          px-1.5 py-0.5 min-w-[20px] h-5 flex items-center justify-center text-xs font-medium rounded-full\n          ${s?"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}\n        `,children:n>99?"99+":n})]})})),U=e.memo((function({activeTab:e,onTabChange:s,onLogout:t,onCollapse:n,isSectionAdmin:g=!1,onCreateTask:u,isOpen:h,onClose:T}){const[M,U]=r.useState(!1),{isDark:A,toggle:E}=i(),{user:z}=l(),[D,O]=r.useState(""),[$,I]=r.useState(!1);r.useEffect((()=>{const e=()=>{window.innerWidth>=1024&&h&&T()};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[h,T]),r.useEffect((()=>{const e=()=>{O((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};e();const a=setInterval(e,6e4);return()=>clearInterval(a)}),[]),r.useEffect((()=>{const e=e=>{const a=e.target;$&&!a.closest(".profile-menu-container")&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[$]);const P=r.useMemo((()=>[{id:"dashboard",label:"Dashboard",icon:x},{id:"users",label:"Users",icon:b,badge:147},{id:"tasks",label:"Tasks (Legacy)",icon:f,badge:56},{id:"task-management-v2",label:"Task Management",icon:p,badge:null}]),[]),_=r.useMemo((()=>[{id:"announcements",label:"Announcements",icon:y},{id:"lecture-slides",label:"Lecture Slides",icon:j},{id:"fcm-management",label:"Push Notifications",icon:k}]),[]),F=r.useMemo((()=>g?_.filter((e=>["announcements","lecture-slides","fcm-management"].includes(e.id))):_),[_,g]);r.useCallback((()=>{setIsMobileMenuOpen((e=>!e)),I(!1)}),[]),r.useCallback((()=>{setIsMobileMenuOpen(!1)}),[]);const B=r.useCallback((e=>{s(e),T(),I(!1)}),[s,T]),H=r.useCallback((()=>{U((e=>{const a=!e;return n&&n(a),a})),I(!1)}),[n]),R=r.useCallback((()=>{E()}),[E]),V=r.useCallback((()=>{I((e=>!e))}),[]),q=r.useCallback((()=>{I(!1),t()}),[t]);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-gray-900/50 z-[25] lg:hidden backdrop-blur-sm transition-opacity duration-300 ease-in-out "+(h?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),onClick:T,"aria-hidden":"true"}),a.jsxs("aside",{className:`\n        fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800\n        transform transition-all duration-300 ease-in-out z-40 shadow-2xl lg:shadow-none will-change-transform\n        ${h?"translate-x-0":"-translate-x-full"}\n        ${M?"w-20":"w-64"}\n        lg:relative lg:translate-x-0\n      `,children:[a.jsx("button",{onClick:H,className:"hidden lg:flex items-center justify-center w-7 h-7 rounded-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-blue-500 dark:hover:border-blue-500 transition-all shadow-md absolute top-[32px] -right-3.5 z-50","aria-label":M?"Expand sidebar":"Collapse sidebar",children:a.jsx(v,{className:"w-4 h-4 text-gray-600 dark:text-gray-400 transition-transform "+(M?"rotate-180":"")})}),a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:`h-[72px] px-4 pl-5 border-b border-gray-200 dark:border-gray-800 flex ${M?"justify-center":"justify-start"} items-center shrink-0`,children:[!M&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:a.jsx(o,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white leading-none tracking-tight",children:"NestTask"}),a.jsx("span",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 mt-0.5",children:g?"Section Panel":"Admin Panel"})]})]}),M&&a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-sm",children:a.jsx(o,{className:"w-5 h-5 text-white"})})]}),a.jsxs("div",{className:"flex-1 py-4 px-3 overflow-y-auto",children:[!M&&a.jsx("div",{className:"mb-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Main"})}),a.jsx("nav",{className:"space-y-1",children:P.map((r=>a.jsx(S,{icon:r.icon,label:r.label,isActive:e===r.id,onClick:()=>B(r.id),badge:r.badge,isCollapsed:M},r.id)))}),!M&&a.jsx("div",{className:"my-3 px-2",children:a.jsx("h2",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Management"})}),M&&a.jsx("div",{className:"my-3 border-t border-gray-200 dark:border-gray-800 mx-2"}),a.jsx("nav",{className:"space-y-1",children:F.map((r=>a.jsx(S,{icon:r.icon,label:r.label,isActive:e===r.id,onClick:()=>B(r.id),isCollapsed:M},r.id)))}),!M&&a.jsx("div",{className:"mt-6 mx-2",children:a.jsxs("button",{className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors shadow-sm",onClick:()=>{u&&u(),B("task-management-v2")},children:[a.jsx(w,{className:"w-4 h-4"}),a.jsx("span",{children:"Create Task"})]})}),M&&a.jsx("div",{className:"mt-6 flex justify-center",children:a.jsx("button",{className:"w-10 h-10 flex items-center justify-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg transition-colors shadow-sm",onClick:()=>{u&&u(),B("task-management-v2")},"aria-label":"Create Task",children:a.jsx(w,{className:"w-5 h-5"})})})]}),a.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-800 relative profile-menu-container",children:[M?a.jsx("button",{onClick:V,className:"w-full flex justify-center group",children:a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-200 dark:group-hover:ring-blue-900 transition-all",children:(null==z?void 0:z.avatar)?a.jsx("img",{src:z.avatar,alt:z.name,className:"w-full h-full object-cover"}):a.jsx(N,{className:"w-5 h-5 text-white"})})}):a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("button",{onClick:V,className:"flex items-center gap-2.5 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors w-full group",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==z?void 0:z.avatar)?a.jsx("img",{src:z.avatar,alt:z.name,className:"w-full h-full object-cover"}):a.jsx(N,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate w-full group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(null==z?void 0:z.name)||"User"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-full",children:(null==z?void 0:z.email)||"Loading..."})]}),a.jsx(v,{className:`w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform rotate-90 ${$?"rotate-[270deg]":""} group-hover:text-blue-600 dark:group-hover:text-blue-400`})]})}),$&&a.jsxs("div",{className:`\n                absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50\n                ${M?"left-full ml-2 bottom-auto top-0":""}\n              `,children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800",children:(null==z?void 0:z.avatar)?a.jsx("img",{src:z.avatar,alt:z.name,className:"w-full h-full object-cover"}):a.jsx(N,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:(null==z?void 0:z.name)||"User"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(null==z?void 0:z.email)||"Loading..."})]})]})}),a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>B("profile"),children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{children:"Profile Settings"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:R,children:[A?a.jsx(d,{className:"w-4 h-4"}):a.jsx(c,{className:"w-4 h-4"}),a.jsx("span",{children:A?"Light Mode":"Dark Mode"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>window.open("/help","_blank"),children:[a.jsx(L,{className:"w-4 h-4"}),a.jsx("span",{children:"Help Center"})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:q,children:[a.jsx(m,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})]})]})]})]})]})})),A=e.memo((function(){var e,o;const x=s(),b=t(),{user:f,logout:p,loading:y}=l(),[j]=r.useState(null),[k,v]=r.useState(!1),[L,S]=r.useState(!1),{users:A,deleteUser:E,refreshUsers:z,loading:D}=g(),{tasks:O,createTask:$,updateTask:I,deleteTask:P,refreshTasks:_,loading:F}=u(null==f?void 0:f.id),B="section_admin"===(null==f?void 0:f.role),H=null==f?void 0:f.sectionId,R=null==f?void 0:f.sectionName,{isDark:V,toggle:q}=i(),[W,G]=r.useState(!1),J=r.useRef(null);r.useEffect((()=>{const e=e=>{J.current&&!J.current.contains(e.target)&&G(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),r.useEffect((()=>{y||(f?"admin"===f.role||"super-admin"===f.role||"section_admin"===f.role?"super-admin"!==f.role||"/admin"!==b.pathname&&"/admin/"!==b.pathname?"admin"!==f.role&&"section_admin"!==f.role||"/admin"!==b.pathname&&"/admin/"!==b.pathname||x("/admin/dashboard",{replace:!0}):x("/superadmin/dashboard",{replace:!0}):x("/",{replace:!0}):x("/auth",{replace:!0}))}),[f,x,b.pathname,y]);const K=r.useMemo((()=>(()=>{const e=b.pathname;return e.includes("/admin/users")?"users":e.includes("/admin/tasks")?"tasks":e.includes("/admin/task-management")?"task-management-v2":e.includes("/admin/announcements")?"announcements":e.includes("/admin/lecture-slides")?"lecture-slides":e.includes("/admin/fcm-management")?"fcm-management":e.includes("/admin/super-admin")?"super-admin":"dashboard"})()),[b.pathname]);r.useMemo((()=>(new Date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})),[]);const Q=r.useMemo((()=>({users:A,tasks:O,isSectionAdmin:B,sectionId:H,sectionName:R,deleteUser:E,refreshUsers:z,refreshTasks:_,onCreateTask:$,onDeleteTask:P,onUpdateTask:I,openTaskFormV2:k,setOpenTaskFormV2:v,usersLoading:D,tasksLoading:F})),[A,O,B,H,R,E,z,_,$,P,I,k,v,D,F]),X=r.useCallback((e=>{x({dashboard:"/admin/dashboard",users:"/admin/users",tasks:"/admin/tasks","task-management-v2":"/admin/task-management",announcements:"/admin/announcements","lecture-slides":"/admin/lecture-slides","fcm-management":"/admin/fcm-management","super-admin":"/admin/super-admin"}[e])}),[x]),Y=r.useCallback((()=>{x("/admin/task-management"),setTimeout((()=>{v(!0)}),150)}),[x]);return!f||"admin"!==f.role&&"super-admin"!==f.role&&"section_admin"!==f.role?a.jsx(T,{minimumLoadTime:300}):a.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[a.jsx(U,{activeTab:K,onTabChange:X,onLogout:p,isSectionAdmin:B,onCreateTask:Y,isOpen:L,onClose:()=>S(!1)}),a.jsx("main",{className:"flex-1 flex flex-col overflow-hidden w-full min-w-0 bg-gray-50 dark:bg-gray-900",children:a.jsxs("div",{className:"h-full overflow-y-auto",children:[a.jsxs("header",{className:"h-[72px] bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-8 sticky top-0 z-20 flex items-center justify-between gap-4 transition-all duration-200 ease-in-out",children:[a.jsxs("div",{className:"flex items-center gap-3 md:gap-4 min-w-0 overflow-hidden",children:[a.jsx("button",{onClick:()=>S(!0),className:"lg:hidden -ml-2 p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Open sidebar",children:a.jsx(h,{className:"w-6 h-6"})}),a.jsxs("h1",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white leading-none tracking-tight truncate",children:["dashboard"===K&&"Overview","users"===K&&"User Management","tasks"===K&&"Legacy Tasks","task-management-v2"===K&&"Task Management","announcements"===K&&"Announcements","lecture-slides"===K&&"Lecture Slides","super-admin"===K&&"Super Admin"]})]}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{className:"relative",ref:J,children:[a.jsxs("button",{onClick:()=>G(!W),className:"flex items-center gap-3 pl-3 pr-1 py-1 rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border border-transparent hover:border-gray-200 dark:hover:border-gray-700 group",children:[a.jsxs("div",{className:"flex flex-col items-end hidden md:flex",children:[a.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:(null==(e=null==f?void 0:f.name)?void 0:e.split(" ")[0])||"User"}),a.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 capitalize",children:(null==(o=null==f?void 0:f.role)?void 0:o.replace("_"," "))||"Admin"})]}),a.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center overflow-hidden shadow-sm ring-2 ring-white dark:ring-gray-800 group-hover:ring-blue-100 dark:group-hover:ring-blue-900 transition-all",children:(null==f?void 0:f.avatar)?a.jsx("img",{src:f.avatar,alt:f.name,className:"w-full h-full object-cover"}):a.jsx(N,{className:"w-4 h-4 text-white"})})]}),W&&a.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50 transform origin-top-right transition-all",children:[a.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:null==f?void 0:f.name}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:null==f?void 0:f.email})]}),a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:()=>{X("users"),G(!1)},children:[a.jsx(C,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{children:"Profile Settings"})]}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:q,children:[V?a.jsx(d,{className:"w-4 h-4 text-gray-400"}):a.jsx(c,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{children:V?"Light Mode":"Dark Mode"})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),a.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{G(!1),p()},children:[a.jsx(m,{className:"w-4 h-4"}),a.jsx("span",{children:"Sign Out"})]})]})]})]})})]}),a.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-full overflow-x-hidden",children:[j&&a.jsxs("div",{className:"mb-4 p-3 flex items-center gap-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm",children:[a.jsx(M,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{children:j})]}),a.jsx("div",{className:"space-y-4 sm:space-y-6",children:a.jsx(n,{context:Q})})]})]})}),a.jsx("button",{onClick:Y,className:"lg:hidden fixed bottom-20 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-40 active:scale-95","aria-label":"Create Task",children:a.jsx(w,{className:"w-6 h-6"})})]})}));export{A as AdminLayout};
