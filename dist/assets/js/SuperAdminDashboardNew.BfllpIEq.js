import{j as e,r as g,s as p,i as xr,u as pr,a as fr}from"./index.C6-aLomt.js";import{c as Ft}from"./clsx.B-dksMZM.js";import{X as ge}from"./x.CQbXoCLK.js";import{C as br}from"./chevron-right.W71womLZ.js";import{C as yr}from"./chevron-left.BTl1E1KT.js";import{L as wr,M as vr}from"./menu.DlVXifjd.js";import{S as ae}from"./shield.Lk1lTzmt.js";import{U as Se}from"./users.CK7tbjSJ.js";import{A as ce}from"./activity.CUPsha0a.js";import{F as Ie}from"./file-text.B9GY9uhS.js";import{S as jr,u as kr,a as Nr,M as _r,L as Sr}from"./sun.CmpU2xdP.js";import{C as Qe}from"./check-circle.MDyQqojq.js";import{D as yt,K as Lt,C as et,A as Cr,a as Ar,U as Er,c as Pt,Z as Tr,T as wt,B as Ur,b as at,d as Rr}from"./zap.RDXaODus.js";import{L as _e}from"./layers.BJ2Atn5w.js";import{T as he}from"./trending-up.DQFndILm.js";import{a as xe,s as H}from"./notifications.4_bC7DbS.js";import{R as Be}from"./refresh-cw.ABIlqhy5.js";import{P as Mr}from"./plus.DzmWYoxP.js";import{S as lt}from"./search.FiYiekd7.js";import{D as $t}from"./download.Dc6B30AZ.js";import{S as Fr}from"./square-pen.Cyc6NowF.js";import{M as Dt}from"./more-vertical.B2fR2JyX.js";import{F as Lr}from"./filter.7Diy5P4s.js";import{C as ot}from"./clock.FMJqGtfA.js";import{U as Ve}from"./user.U3O4EKTK.js";import{E as Pr}from"./eye-off.DswiHcBX.js";import{E as $r}from"./eye.Dkw8TwpT.js";import{C as Dr,S as zt}from"./shield-check.C-mIF9vr.js";import{C as zr}from"./copy.COC1boIT.js";import{A as Oe}from"./alert-triangle.C-cRyMTY.js";import{C as Ir}from"./calendar.B_Pv9U47.js";import{A as Or}from"./alert-circle.BNXWnTJ1.js";import{M as Br}from"./mail.B4Uhq-pp.js";import{P as Vr}from"./phone.7338zPZU.js";import{P as It}from"./pen.bH3-z3Df.js";import{T as Ot}from"./trash-2.CPUMynGf.js";import{U as Gr}from"./user-check.DJpLmCMm.js";import{C as vt}from"./check-circle-2.5YHUEzGb.js";import{P as qr}from"./pie-chart.B0j554H-.js";import{B as Bt}from"./bell.CzXVG055.js";import{u as Wr}from"./useAuth.DXjjOoD4.js";import"./createLucideIcon.BP2Vuyfb.js";import"./dataCache.CcjqYMC_.js";import"./authErrors.D8KAnYp0.js";const Hr=(t,s)=>{const r=new Array(t.length+s.length);for(let a=0;a<t.length;a++)r[a]=t[a];for(let a=0;a<s.length;a++)r[t.length+a]=s[a];return r},Yr=(t,s)=>({classGroupId:t,validator:s}),Vt=(t=new Map,s=null,r)=>({nextPart:t,validators:s,classGroupId:r}),Ge="-",jt=[],Zr="arbitrary..",Jr=t=>{const s=Xr(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:i=>{if(i.startsWith("[")&&i.endsWith("]"))return Kr(i);const c=i.split(Ge),l=c[0]===""&&c.length>1?1:0;return Gt(c,l,s)},getConflictingClassGroupIds:(i,c)=>{if(c){const l=a[i],d=r[i];return l?d?Hr(d,l):l:d||jt}return r[i]||jt}}},Gt=(t,s,r)=>{if(t.length-s===0)return r.classGroupId;const o=t[s],n=r.nextPart.get(o);if(n){const d=Gt(t,s+1,n);if(d)return d}const i=r.validators;if(i===null)return;const c=s===0?t.join(Ge):t.slice(s).join(Ge),l=i.length;for(let d=0;d<l;d++){const h=i[d];if(h.validator(c))return h.classGroupId}},Kr=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const s=t.slice(1,-1),r=s.indexOf(":"),a=s.slice(0,r);return a?Zr+a:void 0})(),Xr=t=>{const{theme:s,classGroups:r}=t;return Qr(r,s)},Qr=(t,s)=>{const r=Vt();for(const a in t){const o=t[a];ct(o,r,a,s)}return r},ct=(t,s,r,a)=>{const o=t.length;for(let n=0;n<o;n++){const i=t[n];es(i,s,r,a)}},es=(t,s,r,a)=>{if(typeof t=="string"){ts(t,s,r);return}if(typeof t=="function"){rs(t,s,r,a);return}ss(t,s,r,a)},ts=(t,s,r)=>{const a=t===""?s:qt(s,t);a.classGroupId=r},rs=(t,s,r,a)=>{if(as(t)){ct(t(a),s,r,a);return}s.validators===null&&(s.validators=[]),s.validators.push(Yr(r,t))},ss=(t,s,r,a)=>{const o=Object.entries(t),n=o.length;for(let i=0;i<n;i++){const[c,l]=o[i];ct(l,qt(s,c),r,a)}},qt=(t,s)=>{let r=t;const a=s.split(Ge),o=a.length;for(let n=0;n<o;n++){const i=a[n];let c=r.nextPart.get(i);c||(c=Vt(),r.nextPart.set(i,c)),r=c}return r},as=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,os=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,r=Object.create(null),a=Object.create(null);const o=(n,i)=>{r[n]=i,s++,s>t&&(s=0,a=r,r=Object.create(null))};return{get(n){let i=r[n];if(i!==void 0)return i;if((i=a[n])!==void 0)return o(n,i),i},set(n,i){n in r?r[n]=i:o(n,i)}}},nt="!",kt=":",ns=[],Nt=(t,s,r,a,o)=>({modifiers:t,hasImportantModifier:s,baseClassName:r,maybePostfixModifierPosition:a,isExternal:o}),is=t=>{const{prefix:s,experimentalParseClassName:r}=t;let a=o=>{const n=[];let i=0,c=0,l=0,d;const h=o.length;for(let y=0;y<h;y++){const b=o[y];if(i===0&&c===0){if(b===kt){n.push(o.slice(l,y)),l=y+1;continue}if(b==="/"){d=y;continue}}b==="["?i++:b==="]"?i--:b==="("?c++:b===")"&&c--}const x=n.length===0?o:o.slice(l);let _=x,v=!1;x.endsWith(nt)?(_=x.slice(0,-1),v=!0):x.startsWith(nt)&&(_=x.slice(1),v=!0);const f=d&&d>l?d-l:void 0;return Nt(n,v,_,f)};if(s){const o=s+kt,n=a;a=i=>i.startsWith(o)?n(i.slice(o.length)):Nt(ns,!1,i,void 0,!0)}if(r){const o=a;a=n=>r({className:n,parseClassName:o})}return a},ls=t=>{const s=new Map;return t.orderSensitiveModifiers.forEach((r,a)=>{s.set(r,1e6+a)}),r=>{const a=[];let o=[];for(let n=0;n<r.length;n++){const i=r[n],c=i[0]==="[",l=s.has(i);c||l?(o.length>0&&(o.sort(),a.push(...o),o=[]),a.push(i)):o.push(i)}return o.length>0&&(o.sort(),a.push(...o)),a}},cs=t=>({cache:os(t.cacheSize),parseClassName:is(t),sortModifiers:ls(t),...Jr(t)}),ds=/\s+/,ms=(t,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:o,sortModifiers:n}=s,i=[],c=t.trim().split(ds);let l="";for(let d=c.length-1;d>=0;d-=1){const h=c[d],{isExternal:x,modifiers:_,hasImportantModifier:v,baseClassName:f,maybePostfixModifierPosition:y}=r(h);if(x){l=h+(l.length>0?" "+l:l);continue}let b=!!y,u=a(b?f.substring(0,y):f);if(!u){if(!b){l=h+(l.length>0?" "+l:l);continue}if(u=a(f),!u){l=h+(l.length>0?" "+l:l);continue}b=!1}const m=_.length===0?"":_.length===1?_[0]:n(_).join(":"),N=v?m+nt:m,w=N+u;if(i.indexOf(w)>-1)continue;i.push(w);const E=o(u,b);for(let U=0;U<E.length;++U){const C=E[U];i.push(N+C)}l=h+(l.length>0?" "+l:l)}return l},us=(...t)=>{let s=0,r,a,o="";for(;s<t.length;)(r=t[s++])&&(a=Wt(r))&&(o&&(o+=" "),o+=a);return o},Wt=t=>{if(typeof t=="string")return t;let s,r="";for(let a=0;a<t.length;a++)t[a]&&(s=Wt(t[a]))&&(r&&(r+=" "),r+=s);return r},gs=(t,...s)=>{let r,a,o,n;const i=l=>{const d=s.reduce((h,x)=>x(h),t());return r=cs(d),a=r.cache.get,o=r.cache.set,n=c,c(l)},c=l=>{const d=a(l);if(d)return d;const h=ms(l,r);return o(l,h),h};return n=i,(...l)=>n(us(...l))},hs=[],z=t=>{const s=r=>r[t]||hs;return s.isThemeGetter=!0,s},Ht=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Yt=/^\((?:(\w[\w-]*):)?(.+)\)$/i,xs=/^\d+\/\d+$/,ps=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,fs=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,bs=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,ys=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ws=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,me=t=>xs.test(t),R=t=>!!t&&!Number.isNaN(Number(t)),ne=t=>!!t&&Number.isInteger(Number(t)),tt=t=>t.endsWith("%")&&R(t.slice(0,-1)),re=t=>ps.test(t),vs=()=>!0,js=t=>fs.test(t)&&!bs.test(t),Zt=()=>!1,ks=t=>ys.test(t),Ns=t=>ws.test(t),_s=t=>!j(t)&&!k(t),Ss=t=>fe(t,Xt,Zt),j=t=>Ht.test(t),le=t=>fe(t,Qt,js),rt=t=>fe(t,Us,R),_t=t=>fe(t,Jt,Zt),Cs=t=>fe(t,Kt,Ns),Pe=t=>fe(t,er,ks),k=t=>Yt.test(t),Ne=t=>be(t,Qt),As=t=>be(t,Rs),St=t=>be(t,Jt),Es=t=>be(t,Xt),Ts=t=>be(t,Kt),$e=t=>be(t,er,!0),fe=(t,s,r)=>{const a=Ht.exec(t);return a?a[1]?s(a[1]):r(a[2]):!1},be=(t,s,r=!1)=>{const a=Yt.exec(t);return a?a[1]?s(a[1]):r:!1},Jt=t=>t==="position"||t==="percentage",Kt=t=>t==="image"||t==="url",Xt=t=>t==="length"||t==="size"||t==="bg-size",Qt=t=>t==="length",Us=t=>t==="number",Rs=t=>t==="family-name",er=t=>t==="shadow",Ms=()=>{const t=z("color"),s=z("font"),r=z("text"),a=z("font-weight"),o=z("tracking"),n=z("leading"),i=z("breakpoint"),c=z("container"),l=z("spacing"),d=z("radius"),h=z("shadow"),x=z("inset-shadow"),_=z("text-shadow"),v=z("drop-shadow"),f=z("blur"),y=z("perspective"),b=z("aspect"),u=z("ease"),m=z("animate"),N=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],E=()=>[...w(),k,j],U=()=>["auto","hidden","clip","visible","scroll"],C=()=>["auto","contain","none"],A=()=>[k,j,l],P=()=>[me,"full","auto",...A()],Y=()=>[ne,"none","subgrid",k,j],Ee=()=>["auto",{span:["full",ne,k,j]},ne,k,j],de=()=>[ne,"auto",k,j],Te=()=>["auto","min","max","fr",k,j],ve=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],oe=()=>["start","end","center","stretch","center-safe","end-safe"],Z=()=>["auto",...A()],X=()=>[me,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...A()],T=()=>[t,k,j],Ue=()=>[...w(),St,_t,{position:[k,j]}],Re=()=>["no-repeat",{repeat:["","x","y","space","round"]}],S=()=>["auto","cover","contain",Es,Ss,{size:[k,j]}],B=()=>[tt,Ne,le],L=()=>["","none","full",d,k,j],I=()=>["",R,Ne,le],ie=()=>["solid","dashed","dotted","double"],je=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>[R,tt,St,_t],ke=()=>["","none",f,k,j],Me=()=>["none",R,k,j],Fe=()=>["none",R,k,j],Xe=()=>[R,k,j],Le=()=>[me,"full",...A()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[re],breakpoint:[re],color:[vs],container:[re],"drop-shadow":[re],ease:["in","out","in-out"],font:[_s],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[re],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[re],shadow:[re],spacing:["px",R],text:[re],"text-shadow":[re],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",me,j,k,b]}],container:["container"],columns:[{columns:[R,j,k,c]}],"break-after":[{"break-after":N()}],"break-before":[{"break-before":N()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:E()}],overflow:[{overflow:U()}],"overflow-x":[{"overflow-x":U()}],"overflow-y":[{"overflow-y":U()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:P()}],"inset-x":[{"inset-x":P()}],"inset-y":[{"inset-y":P()}],start:[{start:P()}],end:[{end:P()}],top:[{top:P()}],right:[{right:P()}],bottom:[{bottom:P()}],left:[{left:P()}],visibility:["visible","invisible","collapse"],z:[{z:[ne,"auto",k,j]}],basis:[{basis:[me,"full","auto",c,...A()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[R,me,"auto","initial","none",j]}],grow:[{grow:["",R,k,j]}],shrink:[{shrink:["",R,k,j]}],order:[{order:[ne,"first","last","none",k,j]}],"grid-cols":[{"grid-cols":Y()}],"col-start-end":[{col:Ee()}],"col-start":[{"col-start":de()}],"col-end":[{"col-end":de()}],"grid-rows":[{"grid-rows":Y()}],"row-start-end":[{row:Ee()}],"row-start":[{"row-start":de()}],"row-end":[{"row-end":de()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Te()}],"auto-rows":[{"auto-rows":Te()}],gap:[{gap:A()}],"gap-x":[{"gap-x":A()}],"gap-y":[{"gap-y":A()}],"justify-content":[{justify:[...ve(),"normal"]}],"justify-items":[{"justify-items":[...oe(),"normal"]}],"justify-self":[{"justify-self":["auto",...oe()]}],"align-content":[{content:["normal",...ve()]}],"align-items":[{items:[...oe(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...oe(),{baseline:["","last"]}]}],"place-content":[{"place-content":ve()}],"place-items":[{"place-items":[...oe(),"baseline"]}],"place-self":[{"place-self":["auto",...oe()]}],p:[{p:A()}],px:[{px:A()}],py:[{py:A()}],ps:[{ps:A()}],pe:[{pe:A()}],pt:[{pt:A()}],pr:[{pr:A()}],pb:[{pb:A()}],pl:[{pl:A()}],m:[{m:Z()}],mx:[{mx:Z()}],my:[{my:Z()}],ms:[{ms:Z()}],me:[{me:Z()}],mt:[{mt:Z()}],mr:[{mr:Z()}],mb:[{mb:Z()}],ml:[{ml:Z()}],"space-x":[{"space-x":A()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":A()}],"space-y-reverse":["space-y-reverse"],size:[{size:X()}],w:[{w:[c,"screen",...X()]}],"min-w":[{"min-w":[c,"screen","none",...X()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[i]},...X()]}],h:[{h:["screen","lh",...X()]}],"min-h":[{"min-h":["screen","lh","none",...X()]}],"max-h":[{"max-h":["screen","lh",...X()]}],"font-size":[{text:["base",r,Ne,le]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[a,k,rt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",tt,j]}],"font-family":[{font:[As,j,s]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[o,k,j]}],"line-clamp":[{"line-clamp":[R,"none",k,rt]}],leading:[{leading:[n,...A()]}],"list-image":[{"list-image":["none",k,j]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",k,j]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:T()}],"text-color":[{text:T()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ie(),"wavy"]}],"text-decoration-thickness":[{decoration:[R,"from-font","auto",k,le]}],"text-decoration-color":[{decoration:T()}],"underline-offset":[{"underline-offset":[R,"auto",k,j]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",k,j]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",k,j]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Ue()}],"bg-repeat":[{bg:Re()}],"bg-size":[{bg:S()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},ne,k,j],radial:["",k,j],conic:[ne,k,j]},Ts,Cs]}],"bg-color":[{bg:T()}],"gradient-from-pos":[{from:B()}],"gradient-via-pos":[{via:B()}],"gradient-to-pos":[{to:B()}],"gradient-from":[{from:T()}],"gradient-via":[{via:T()}],"gradient-to":[{to:T()}],rounded:[{rounded:L()}],"rounded-s":[{"rounded-s":L()}],"rounded-e":[{"rounded-e":L()}],"rounded-t":[{"rounded-t":L()}],"rounded-r":[{"rounded-r":L()}],"rounded-b":[{"rounded-b":L()}],"rounded-l":[{"rounded-l":L()}],"rounded-ss":[{"rounded-ss":L()}],"rounded-se":[{"rounded-se":L()}],"rounded-ee":[{"rounded-ee":L()}],"rounded-es":[{"rounded-es":L()}],"rounded-tl":[{"rounded-tl":L()}],"rounded-tr":[{"rounded-tr":L()}],"rounded-br":[{"rounded-br":L()}],"rounded-bl":[{"rounded-bl":L()}],"border-w":[{border:I()}],"border-w-x":[{"border-x":I()}],"border-w-y":[{"border-y":I()}],"border-w-s":[{"border-s":I()}],"border-w-e":[{"border-e":I()}],"border-w-t":[{"border-t":I()}],"border-w-r":[{"border-r":I()}],"border-w-b":[{"border-b":I()}],"border-w-l":[{"border-l":I()}],"divide-x":[{"divide-x":I()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":I()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ie(),"hidden","none"]}],"divide-style":[{divide:[...ie(),"hidden","none"]}],"border-color":[{border:T()}],"border-color-x":[{"border-x":T()}],"border-color-y":[{"border-y":T()}],"border-color-s":[{"border-s":T()}],"border-color-e":[{"border-e":T()}],"border-color-t":[{"border-t":T()}],"border-color-r":[{"border-r":T()}],"border-color-b":[{"border-b":T()}],"border-color-l":[{"border-l":T()}],"divide-color":[{divide:T()}],"outline-style":[{outline:[...ie(),"none","hidden"]}],"outline-offset":[{"outline-offset":[R,k,j]}],"outline-w":[{outline:["",R,Ne,le]}],"outline-color":[{outline:T()}],shadow:[{shadow:["","none",h,$e,Pe]}],"shadow-color":[{shadow:T()}],"inset-shadow":[{"inset-shadow":["none",x,$e,Pe]}],"inset-shadow-color":[{"inset-shadow":T()}],"ring-w":[{ring:I()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:T()}],"ring-offset-w":[{"ring-offset":[R,le]}],"ring-offset-color":[{"ring-offset":T()}],"inset-ring-w":[{"inset-ring":I()}],"inset-ring-color":[{"inset-ring":T()}],"text-shadow":[{"text-shadow":["none",_,$e,Pe]}],"text-shadow-color":[{"text-shadow":T()}],opacity:[{opacity:[R,k,j]}],"mix-blend":[{"mix-blend":[...je(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":je()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[R]}],"mask-image-linear-from-pos":[{"mask-linear-from":$()}],"mask-image-linear-to-pos":[{"mask-linear-to":$()}],"mask-image-linear-from-color":[{"mask-linear-from":T()}],"mask-image-linear-to-color":[{"mask-linear-to":T()}],"mask-image-t-from-pos":[{"mask-t-from":$()}],"mask-image-t-to-pos":[{"mask-t-to":$()}],"mask-image-t-from-color":[{"mask-t-from":T()}],"mask-image-t-to-color":[{"mask-t-to":T()}],"mask-image-r-from-pos":[{"mask-r-from":$()}],"mask-image-r-to-pos":[{"mask-r-to":$()}],"mask-image-r-from-color":[{"mask-r-from":T()}],"mask-image-r-to-color":[{"mask-r-to":T()}],"mask-image-b-from-pos":[{"mask-b-from":$()}],"mask-image-b-to-pos":[{"mask-b-to":$()}],"mask-image-b-from-color":[{"mask-b-from":T()}],"mask-image-b-to-color":[{"mask-b-to":T()}],"mask-image-l-from-pos":[{"mask-l-from":$()}],"mask-image-l-to-pos":[{"mask-l-to":$()}],"mask-image-l-from-color":[{"mask-l-from":T()}],"mask-image-l-to-color":[{"mask-l-to":T()}],"mask-image-x-from-pos":[{"mask-x-from":$()}],"mask-image-x-to-pos":[{"mask-x-to":$()}],"mask-image-x-from-color":[{"mask-x-from":T()}],"mask-image-x-to-color":[{"mask-x-to":T()}],"mask-image-y-from-pos":[{"mask-y-from":$()}],"mask-image-y-to-pos":[{"mask-y-to":$()}],"mask-image-y-from-color":[{"mask-y-from":T()}],"mask-image-y-to-color":[{"mask-y-to":T()}],"mask-image-radial":[{"mask-radial":[k,j]}],"mask-image-radial-from-pos":[{"mask-radial-from":$()}],"mask-image-radial-to-pos":[{"mask-radial-to":$()}],"mask-image-radial-from-color":[{"mask-radial-from":T()}],"mask-image-radial-to-color":[{"mask-radial-to":T()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":w()}],"mask-image-conic-pos":[{"mask-conic":[R]}],"mask-image-conic-from-pos":[{"mask-conic-from":$()}],"mask-image-conic-to-pos":[{"mask-conic-to":$()}],"mask-image-conic-from-color":[{"mask-conic-from":T()}],"mask-image-conic-to-color":[{"mask-conic-to":T()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Ue()}],"mask-repeat":[{mask:Re()}],"mask-size":[{mask:S()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",k,j]}],filter:[{filter:["","none",k,j]}],blur:[{blur:ke()}],brightness:[{brightness:[R,k,j]}],contrast:[{contrast:[R,k,j]}],"drop-shadow":[{"drop-shadow":["","none",v,$e,Pe]}],"drop-shadow-color":[{"drop-shadow":T()}],grayscale:[{grayscale:["",R,k,j]}],"hue-rotate":[{"hue-rotate":[R,k,j]}],invert:[{invert:["",R,k,j]}],saturate:[{saturate:[R,k,j]}],sepia:[{sepia:["",R,k,j]}],"backdrop-filter":[{"backdrop-filter":["","none",k,j]}],"backdrop-blur":[{"backdrop-blur":ke()}],"backdrop-brightness":[{"backdrop-brightness":[R,k,j]}],"backdrop-contrast":[{"backdrop-contrast":[R,k,j]}],"backdrop-grayscale":[{"backdrop-grayscale":["",R,k,j]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[R,k,j]}],"backdrop-invert":[{"backdrop-invert":["",R,k,j]}],"backdrop-opacity":[{"backdrop-opacity":[R,k,j]}],"backdrop-saturate":[{"backdrop-saturate":[R,k,j]}],"backdrop-sepia":[{"backdrop-sepia":["",R,k,j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":A()}],"border-spacing-x":[{"border-spacing-x":A()}],"border-spacing-y":[{"border-spacing-y":A()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",k,j]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[R,"initial",k,j]}],ease:[{ease:["linear","initial",u,k,j]}],delay:[{delay:[R,k,j]}],animate:[{animate:["none",m,k,j]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[y,k,j]}],"perspective-origin":[{"perspective-origin":E()}],rotate:[{rotate:Me()}],"rotate-x":[{"rotate-x":Me()}],"rotate-y":[{"rotate-y":Me()}],"rotate-z":[{"rotate-z":Me()}],scale:[{scale:Fe()}],"scale-x":[{"scale-x":Fe()}],"scale-y":[{"scale-y":Fe()}],"scale-z":[{"scale-z":Fe()}],"scale-3d":["scale-3d"],skew:[{skew:Xe()}],"skew-x":[{"skew-x":Xe()}],"skew-y":[{"skew-y":Xe()}],transform:[{transform:[k,j,"","none","gpu","cpu"]}],"transform-origin":[{origin:E()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Le()}],"translate-x":[{"translate-x":Le()}],"translate-y":[{"translate-y":Le()}],"translate-z":[{"translate-z":Le()}],"translate-none":["translate-none"],accent:[{accent:T()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:T()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",k,j]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",k,j]}],fill:[{fill:["none",...T()]}],"stroke-w":[{stroke:[R,Ne,le,rt]}],stroke:[{stroke:["none",...T()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Fs=gs(Ms);function M(...t){return Fs(Ft(t))}const Ct=[{id:"overview",label:"Overview",icon:wr},{id:"admins",label:"Admin Management",icon:ae},{id:"section-admins",label:"Section Admins",icon:Se},{id:"analytics",label:"Analytics",icon:ce},{id:"logs",label:"System Logs",icon:Ie},{id:"security",label:"Security Settings",icon:jr}];function Ls({activeTab:t,onTabChange:s,isCollapsed:r,onToggleCollapse:a,isMobile:o=!1,isOpen:n=!1,onClose:i}){return o?e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:i}),e.jsxs("div",{className:M("fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 lg:hidden",n?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"p-4 space-y-2",children:Ct.map(c=>{const l=c.icon,d=t===c.id;return e.jsxs("button",{onClick:()=>{s(c.id),i==null||i()},className:M("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",d?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(l,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:c.label})]},c.id)})})]})]}):e.jsxs("div",{className:M("hidden lg:flex flex-col bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transition-all duration-300",r?"w-20":"w-64"),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-800 h-16",children:[!r&&e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg ml-auto",children:r?e.jsx(br,{className:"w-5 h-5"}):e.jsx(yr,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:Ct.map(c=>{const l=c.icon,d=t===c.id;return e.jsxs("button",{onClick:()=>s(c.id),className:M("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",d?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",r&&"justify-center"),title:r?c.label:void 0,children:[e.jsx(l,{className:"w-5 h-5 flex-shrink-0"}),!r&&e.jsx("span",{className:"font-medium",children:c.label})]},c.id)})})]})}const F=g.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("rounded-xl border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-900 dark:text-gray-50",t),...s}));F.displayName="Card";const J=g.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("flex flex-col space-y-1.5 p-6",t),...s}));J.displayName="CardHeader";const K=g.forwardRef(({className:t,...s},r)=>e.jsx("h3",{ref:r,className:M("font-semibold leading-none tracking-tight",t),...s}));K.displayName="CardTitle";const Q=g.forwardRef(({className:t,...s},r)=>e.jsx("p",{ref:r,className:M("text-sm text-gray-500 dark:text-gray-400",t),...s}));Q.displayName="CardDescription";const ee=g.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("p-6 pt-0",t),...s}));ee.displayName="CardContent";const Ps=g.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("flex items-center p-6 pt-0",t),...s}));Ps.displayName="CardFooter";const At=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Et=Ft,dt=(t,s)=>r=>{var a;if((s==null?void 0:s.variants)==null)return Et(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:o,defaultVariants:n}=s,i=Object.keys(o).map(d=>{const h=r==null?void 0:r[d],x=n==null?void 0:n[d];if(h===null)return null;const _=At(h)||At(x);return o[d][_]}),c=r&&Object.entries(r).reduce((d,h)=>{let[x,_]=h;return _===void 0||(d[x]=_),d},{}),l=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((d,h)=>{let{class:x,className:_,...v}=h;return Object.entries(v).every(f=>{let[y,b]=f;return Array.isArray(b)?b.includes({...n,...c}[y]):{...n,...c}[y]===b})?[...d,x,_]:d},[]);return Et(t,i,l,r==null?void 0:r.class,r==null?void 0:r.className)},$s=dt("inline-flex items-center rounded-md border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",{variants:{variant:{default:"border-transparent bg-gray-900 text-gray-50 shadow hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",secondary:"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",destructive:"border-transparent bg-red-500 text-gray-50 shadow hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",outline:"text-gray-950 dark:text-gray-50",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"}},defaultVariants:{variant:"default"}});function O({className:t,variant:s,...r}){return e.jsx("div",{className:M($s({variant:s}),t),...r})}function Tt(){const[t,s]=g.useState(null),[r,a]=g.useState([]),[o,n]=g.useState(!0);g.useEffect(()=>{i()},[]);const i=async()=>{try{n(!0);const{data:l,error:d}=await p.rpc("get_dashboard_stats",{});if(d){const[x,_,v,f,y,b,u,m]=await Promise.all([p.from("users").select("*",{count:"exact",head:!0}),p.from("users").select("*",{count:"exact",head:!0}).eq("role","admin"),p.from("users").select("*",{count:"exact",head:!0}).eq("role","section_admin"),p.from("tasks").select("*",{count:"exact",head:!0}),p.from("tasks").select("*",{count:"exact",head:!0}).eq("status","completed"),p.from("departments").select("*",{count:"exact",head:!0}),p.from("batches").select("*",{count:"exact",head:!0}),p.from("sections").select("*",{count:"exact",head:!0})]);s({total_users:x.count||0,total_admins:_.count||0,total_section_admins:v.count||0,total_tasks:f.count||0,completed_tasks:y.count||0,total_departments:b.count||0,total_batches:u.count||0,total_sections:m.count||0})}else s(l);const{data:h}=await p.from("activities").select(`
          id,
          type,
          title,
          metadata,
          created_at,
          user:users(name, email)
        `).order("created_at",{ascending:!1}).limit(10);h&&a(h.map(x=>({...x,user:Array.isArray(x.user)?x.user[0]:x.user})))}catch(l){console.error("Error fetching dashboard data:",l)}finally{n(!1)}},c=t?[{title:"Total Users",value:t.total_users,change:"+12%",icon:Se,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{title:"Admins",value:t.total_admins,change:"+3%",icon:ae,color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{title:"Section Admins",value:t.total_section_admins,change:"+8%",icon:Se,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20"},{title:"Total Tasks",value:t.total_tasks,change:"+24%",icon:Qe,color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{title:"Completed Tasks",value:t.completed_tasks,change:`${t.total_tasks>0?Math.round(t.completed_tasks/t.total_tasks*100):0}%`,icon:Qe,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20"},{title:"Departments",value:t.total_departments,change:"",icon:yt,color:"text-indigo-600",bgColor:"bg-indigo-50 dark:bg-indigo-900/20"},{title:"Batches",value:t.total_batches,change:"",icon:_e,color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/20"},{title:"Sections",value:t.total_sections,change:"",icon:_e,color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/20"}]:[];return o?e.jsx("div",{className:"space-y-6 animate-pulse",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(l=>e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"},l))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map((l,d)=>{var x;const h=l.icon;return e.jsxs(F,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(J,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:l.title}),e.jsx("div",{className:`p-2 rounded-lg ${l.bgColor}`,children:e.jsx(h,{className:`w-5 h-5 ${l.color}`})})]}),e.jsxs(ee,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Number((x=l.value)!=null?x:0).toLocaleString()}),l.change&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1 mt-1",children:[e.jsx(he,{className:"w-3 h-3"}),l.change," from last month"]})]})]},d)})}),e.jsxs(F,{children:[e.jsxs(J,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Recent Activity"]}),e.jsx(Q,{children:"Latest system activities and updates"})]}),e.jsx(ee,{children:r.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:"No recent activities to display"}):e.jsx("div",{className:"space-y-4",children:r.map(l=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-50 dark:bg-blue-900/20",children:e.jsx(ce,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:l.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:l.user&&typeof l.user=="object"&&!Array.isArray(l.user)?l.user.name||l.user.email:"System"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(O,{variant:"secondary",className:"text-xs",children:l.type}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(l.created_at).toLocaleDateString()})]})]},l.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(F,{children:[e.jsxs(J,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5"}),"Organization Structure"]}),e.jsx(Q,{children:"Hierarchical breakdown"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Departments"}),e.jsx(O,{variant:"info",children:(t==null?void 0:t.total_departments)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Batches"}),e.jsx(O,{variant:"info",children:(t==null?void 0:t.total_batches)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sections"}),e.jsx(O,{variant:"info",children:(t==null?void 0:t.total_sections)||0})]})]})})]}),e.jsxs(F,{children:[e.jsxs(J,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),"Task Overview"]}),e.jsx(Q,{children:"Current task statistics"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Tasks"}),e.jsx(O,{variant:"info",children:(t==null?void 0:t.total_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completed"}),e.jsx(O,{variant:"success",children:(t==null?void 0:t.completed_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pending"}),e.jsx(O,{variant:"warning",children:((t==null?void 0:t.total_tasks)||0)-((t==null?void 0:t.completed_tasks)||0)})]})]})})]})]})]})}function Ut(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function Ds(...t){return s=>{let r=!1;const a=t.map(o=>{const n=Ut(o,s);return!r&&typeof n=="function"&&(r=!0),n});if(r)return()=>{for(let o=0;o<a.length;o++){const n=a[o];typeof n=="function"?n():Ut(t[o],null)}}}}var zs=Symbol.for("react.lazy"),qe=xr[" use ".trim().toString()];function Is(t){return typeof t=="object"&&t!==null&&"then"in t}function tr(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===zs&&"_payload"in t&&Is(t._payload)}function mt(t){const s=Bs(t),r=g.forwardRef((a,o)=>{let{children:n,...i}=a;tr(n)&&typeof qe=="function"&&(n=qe(n._payload));const c=g.Children.toArray(n),l=c.find(Gs);if(l){const d=l.props.children,h=c.map(x=>x===l?g.Children.count(d)>1?g.Children.only(null):g.isValidElement(d)?d.props.children:null:x);return e.jsx(s,{...i,ref:o,children:g.isValidElement(d)?g.cloneElement(d,void 0,h):null})}return e.jsx(s,{...i,ref:o,children:n})});return r.displayName=`${t}.Slot`,r}var Os=mt("Slot");function Bs(t){const s=g.forwardRef((r,a)=>{let{children:o,...n}=r;if(tr(o)&&typeof qe=="function"&&(o=qe(o._payload)),g.isValidElement(o)){const i=Ws(o),c=qs(n,o.props);return o.type!==g.Fragment&&(c.ref=a?Ds(a,i):i),g.cloneElement(o,c)}return g.Children.count(o)>1?g.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var Vs=Symbol("radix.slottable");function Gs(t){return g.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Vs}function qs(t,s){const r={...s};for(const a in s){const o=t[a],n=s[a];/^on[A-Z]/.test(a)?o&&n?r[a]=(...c)=>{const l=n(...c);return o(...c),l}:o&&(r[a]=o):a==="style"?r[a]={...o,...n}:a==="className"&&(r[a]=[o,n].filter(Boolean).join(" "))}return{...t,...r}}function Ws(t){var a,o;let s=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const Hs=dt("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50 dark:focus-visible:ring-gray-300",{variants:{variant:{default:"bg-gray-900 text-gray-50 shadow hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",destructive:"bg-red-500 text-gray-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",outline:"border border-gray-200 bg-white shadow-sm hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",secondary:"bg-gray-100 text-gray-900 shadow-sm hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",link:"text-gray-900 underline-offset-4 hover:underline dark:text-gray-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=g.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...o},n)=>{const i=a?Os:"button";return e.jsx(i,{className:M(Hs({variant:s,size:r,className:t})),ref:n,...o})});D.displayName="Button";const se=g.forwardRef(({className:t,type:s,...r},a)=>e.jsx("input",{type:s,className:M("flex h-9 w-full rounded-md border border-gray-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",t),ref:a,...r}));se.displayName="Input";const ut=g.forwardRef(({className:t,...s},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:M("w-full caption-bottom text-sm",t),...s})}));ut.displayName="Table";const gt=g.forwardRef(({className:t,...s},r)=>e.jsx("thead",{ref:r,className:M("[&_tr]:border-b",t),...s}));gt.displayName="TableHeader";const ht=g.forwardRef(({className:t,...s},r)=>e.jsx("tbody",{ref:r,className:M("[&_tr:last-child]:border-0",t),...s}));ht.displayName="TableBody";const Ys=g.forwardRef(({className:t,...s},r)=>e.jsx("tfoot",{ref:r,className:M("border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",t),...s}));Ys.displayName="TableFooter";const Ce=g.forwardRef(({className:t,...s},r)=>e.jsx("tr",{ref:r,className:M("border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",t),...s}));Ce.displayName="TableRow";const q=g.forwardRef(({className:t,...s},r)=>e.jsx("th",{ref:r,className:M("h-10 px-2 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-gray-400",t),...s}));q.displayName="TableHead";const W=g.forwardRef(({className:t,...s},r)=>e.jsx("td",{ref:r,className:M("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s}));W.displayName="TableCell";const Zs=g.forwardRef(({className:t,...s},r)=>e.jsx("caption",{ref:r,className:M("mt-4 text-sm text-gray-500 dark:text-gray-400",t),...s}));Zs.displayName="TableCaption";function Js(t,s=[]){let r=[];function a(n,i){const c=g.createContext(i);c.displayName=n+"Context";const l=r.length;r=[...r,i];const d=x=>{var u;const{scope:_,children:v,...f}=x,y=((u=_==null?void 0:_[t])==null?void 0:u[l])||c,b=g.useMemo(()=>f,Object.values(f));return e.jsx(y.Provider,{value:b,children:v})};d.displayName=n+"Provider";function h(x,_){var y;const v=((y=_==null?void 0:_[t])==null?void 0:y[l])||c,f=g.useContext(v);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${x}\` must be used within \`${n}\``)}return[d,h]}const o=()=>{const n=r.map(i=>g.createContext(i));return function(c){const l=(c==null?void 0:c[t])||n;return g.useMemo(()=>({[`__scope${t}`]:{...c,[t]:l}}),[c,l])}};return o.scopeName=t,[a,Ks(o,...s)]}function Ks(...t){const s=t[0];if(t.length===1)return s;const r=()=>{const a=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(n){const i=a.reduce((c,{useScope:l,scopeName:d})=>{const x=l(n)[`__scope${d}`];return{...c,...x}},{});return g.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}function Xs(t){const s=g.useRef(t);return g.useEffect(()=>{s.current=t}),g.useMemo(()=>(...r)=>{var a;return(a=s.current)==null?void 0:a.call(s,...r)},[])}var it=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{},Qs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xt=Qs.reduce((t,s)=>{const r=mt(`Primitive.${s}`),a=g.forwardRef((o,n)=>{const{asChild:i,...c}=o,l=i?r:s;return typeof window!="undefined"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...c,ref:n})});return a.displayName=`Primitive.${s}`,{...t,[s]:a}},{}),rr={exports:{}},sr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pe=g;function ea(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var ta=typeof Object.is=="function"?Object.is:ea,ra=pe.useState,sa=pe.useEffect,aa=pe.useLayoutEffect,oa=pe.useDebugValue;function na(t,s){var r=s(),a=ra({inst:{value:r,getSnapshot:s}}),o=a[0].inst,n=a[1];return aa(function(){o.value=r,o.getSnapshot=s,st(o)&&n({inst:o})},[t,r,s]),sa(function(){return st(o)&&n({inst:o}),t(function(){st(o)&&n({inst:o})})},[t]),oa(r),r}function st(t){var s=t.getSnapshot;t=t.value;try{var r=s();return!ta(t,r)}catch(a){return!0}}function ia(t,s){return s()}var la=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?ia:na;sr.useSyncExternalStore=pe.useSyncExternalStore!==void 0?pe.useSyncExternalStore:la;rr.exports=sr;var ca=rr.exports;function da(){return ca.useSyncExternalStore(ma,()=>!0,()=>!1)}function ma(){return()=>{}}var pt="Avatar",[ua,Yo]=Js(pt),[ga,ar]=ua(pt),or=g.forwardRef((t,s)=>{const{__scopeAvatar:r,...a}=t,[o,n]=g.useState("idle");return e.jsx(ga,{scope:r,imageLoadingStatus:o,onImageLoadingStatusChange:n,children:e.jsx(xt.span,{...a,ref:s})})});or.displayName=pt;var nr="AvatarImage",ir=g.forwardRef((t,s)=>{const{__scopeAvatar:r,src:a,onLoadingStatusChange:o=()=>{},...n}=t,i=ar(nr,r),c=ha(a,n),l=Xs(d=>{o(d),i.onImageLoadingStatusChange(d)});return it(()=>{c!=="idle"&&l(c)},[c,l]),c==="loaded"?e.jsx(xt.img,{...n,ref:s,src:a}):null});ir.displayName=nr;var lr="AvatarFallback",cr=g.forwardRef((t,s)=>{const{__scopeAvatar:r,delayMs:a,...o}=t,n=ar(lr,r),[i,c]=g.useState(a===void 0);return g.useEffect(()=>{if(a!==void 0){const l=window.setTimeout(()=>c(!0),a);return()=>window.clearTimeout(l)}},[a]),i&&n.imageLoadingStatus!=="loaded"?e.jsx(xt.span,{...o,ref:s}):null});cr.displayName=lr;function Rt(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ha(t,{referrerPolicy:s,crossOrigin:r}){const a=da(),o=g.useRef(null),n=a?(o.current||(o.current=new window.Image),o.current):null,[i,c]=g.useState(()=>Rt(n,t));return it(()=>{c(Rt(n,t))},[n,t]),it(()=>{const l=x=>()=>{c(x)};if(!n)return;const d=l("loaded"),h=l("error");return n.addEventListener("load",d),n.addEventListener("error",h),s&&(n.referrerPolicy=s),typeof r=="string"&&(n.crossOrigin=r),()=>{n.removeEventListener("load",d),n.removeEventListener("error",h)}},[n,r,s]),i}var dr=or,mr=ir,ur=cr;const ye=g.forwardRef(({className:t,...s},r)=>e.jsx(dr,{ref:r,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));ye.displayName=dr.displayName;const xa=g.forwardRef(({className:t,...s},r)=>e.jsx(mr,{ref:r,className:M("aspect-square h-full w-full",t),...s}));xa.displayName=mr.displayName;const we=g.forwardRef(({className:t,...s},r)=>e.jsx(ur,{ref:r,className:M("flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",t),...s}));we.displayName=ur.displayName;async function pa(){var t;try{console.log("Fetching admin users...");const{data:{user:s}}=await p.auth.getUser();console.log("Current user:",s),console.log("User metadata:",s==null?void 0:s.user_metadata),console.log("User role:",(t=s==null?void 0:s.user_metadata)==null?void 0:t.role);const{data:r,error:a}=await p.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").order("created_at",{ascending:!1});if(a)throw console.error("Error fetching admin users:",a),new Error(a.message||"Failed to fetch admin users");console.log("User data from database:",r),console.log("Number of users retrieved:",(r==null?void 0:r.length)||0);const{data:o}=await p.from("departments").select("id, name"),{data:n}=await p.from("batches").select("id, name"),{data:i}=await p.from("sections").select("id, name"),c=new Map((o==null?void 0:o.map(x=>[x.id,x.name]))||[]),l=new Map((n==null?void 0:n.map(x=>[x.id,x.name]))||[]),d=new Map((i==null?void 0:i.map(x=>[x.id,x.name]))||[]),h=(r==null?void 0:r.map(x=>({id:x.id,username:x.name||"",email:x.email||"",role:x.role||"user",department:c.get(x.department_id)||"",departmentId:x.department_id,batch:l.get(x.batch_id)||"",batchId:x.batch_id,section:d.get(x.section_id)||"",sectionId:x.section_id,permissions:[],status:"active",isActive:!0,lastLogin:x.last_active,createdAt:x.created_at,phone:x.phone||"",studentId:x.student_id||""})))||[];return console.log("Mapped admin users:",h),console.log("Number of mapped users:",h.length),h}catch(s){throw console.error("Error fetching admin users:",s),new Error(s.message||"Failed to fetch admin users")}}async function fa(t,s){try{const{data:{user:r}}=await p.auth.getUser();console.log("Current user in createAdminUser:",r),console.log("User metadata:",r==null?void 0:r.user_metadata);const{data:a,error:o}=await p.auth.admin.createUser({email:t.email,password:s,email_confirm:!0,user_metadata:{name:t.username,role:t.role,department:t.department||null}});if(o||!a.user)throw console.error("Error creating auth user:",o),new Error((o==null?void 0:o.message)||"Failed to create admin user");const{data:n,error:i}=await p.from("users").update({permissions:t.permissions,status:t.status,department:t.department}).eq("id",a.user.id).select();if(i)throw console.error("Error updating admin user data:",i),new Error(i.message||"Failed to create admin user");return r?await Ae(r.id,"create_admin",`Created admin user: ${t.email}`):console.log("Skipping log admin action - no user available"),{id:a.user.id,username:t.username,email:t.email,role:t.role,department:t.department,permissions:t.permissions,status:t.status,isActive:t.status==="active",createdAt:new Date().toISOString(),phone:t.phone,studentId:t.studentId}}catch(r){throw console.error("Error creating admin user:",r),new Error(r.message||"Failed to create admin user")}}async function ba(t,s){try{const{data:{user:r}}=await p.auth.getUser();if(console.log("Current user in updateAdminUser:",r),console.log("User metadata:",r==null?void 0:r.user_metadata),s.email||s.role||s.username){const{error:c}=await p.auth.admin.updateUserById(t,{email:s.email,user_metadata:{name:s.username,role:s.role,department:s.department}});if(c)throw console.error("Error updating auth user:",c),new Error(c.message||"Failed to update admin user")}const a={};s.permissions&&(a.permissions=s.permissions),s.status&&(a.status=s.status),s.department&&(a.department=s.department);const{data:o,error:n}=await p.from("users").update(a).eq("id",t).select();if(n)throw console.error("Error updating admin user data:",n),new Error(n.message||"Failed to update admin user");r?await Ae(r.id,"update_admin",`Updated admin user: ${t}`):console.log("Skipping log admin action - no user available");const i=o==null?void 0:o[0];return{id:i.id,username:i.name||"",email:i.email||"",role:i.role||"admin",department:i.department,permissions:i.permissions||[],status:i.status||"active",isActive:i.status==="active",lastLogin:i.last_active,createdAt:i.created_at,updatedAt:i.updated_at,phone:i.phone||"",studentId:i.student_id||""}}catch(r){throw console.error("Error updating admin user:",r),new Error(r.message||"Failed to update admin user")}}async function ya(t,s){try{const{data:{user:r}}=await p.auth.getUser();console.log("Current user in resetAdminPassword:",r),console.log("User metadata:",r==null?void 0:r.user_metadata);const{error:a}=await p.auth.admin.updateUserById(t,{password:s});if(a)throw console.error("Error resetting admin password:",a),new Error(a.message||"Failed to reset admin password");try{r?await Ae(r.id,"reset_password",`Reset password for admin: ${t}`):console.log("Skipping log admin action - no user available")}catch(o){console.error("Error logging password reset action:",o)}return!0}catch(r){throw console.error("Error resetting admin password:",r),new Error(r.message||"Failed to reset admin password")}}async function wa(t){try{const{data:{user:s}}=await p.auth.getUser();console.log("Current user in deleteAdminUser:",s),console.log("User metadata:",s==null?void 0:s.user_metadata);const{data:r,error:a}=await p.from("users").select("*").eq("id",t).single();if(a)throw console.error("Error fetching admin data for archiving:",a),new Error(a.message||"Failed to delete admin user");try{const{error:n}=await p.from("admin_archives").insert([{admin_id:t,admin_data:r,archived_by:(s==null?void 0:s.id)||"system",archived_at:new Date().toISOString()}]);n&&console.warn("Error archiving admin data (table might not exist):",n)}catch(n){console.warn("Failed to archive admin, table might not exist:",n)}const{error:o}=await p.auth.admin.deleteUser(t);if(o)throw console.error("Error deleting admin user:",o),new Error(o.message||"Failed to delete admin user");s?await Ae(s.id,"delete_admin",`Deleted admin user: ${t}`):console.log("Skipping log admin action - no user available")}catch(s){throw console.error("Error deleting admin user:",s),new Error(s.message||"Failed to delete admin user")}}async function Ae(t,s,r,a,o){try{const{data:n,error:i}=await p.from("users").select("name").eq("id",t).single();if(i){console.error("Error fetching admin name for logging:",i);return}const{error:c}=await p.from("admin_logs").insert([{admin_id:t,admin_name:(n==null?void 0:n.name)||"Unknown",action:s,details:r,timestamp:new Date().toISOString(),resource:a,resource_id:o}]);c&&console.error("Error logging admin action:",c)}catch(n){console.error("Error logging admin action:",n)}}async function va(t){var s,r;try{const{data:{user:a}}=await p.auth.getUser();console.log("Current user in promoteUserToAdmin:",a),console.log("User metadata:",a==null?void 0:a.user_metadata),console.log("User role from metadata:",(s=a==null?void 0:a.user_metadata)==null?void 0:s.role);let o=((r=a==null?void 0:a.user_metadata)==null?void 0:r.role)==="super-admin";if(!o){const{data:i,error:c}=await p.from("users").select("role").eq("id",a==null?void 0:a.id).single();!c&&i&&(console.log("User role from database:",i.role),o=i.role==="super-admin")}if(!o)throw console.error("User is not a super-admin:",a==null?void 0:a.id),new Error("Unauthorized: Only super admins can promote users to admin");const{error:n}=await p.from("users").update({role:"admin"}).eq("id",t);if(n)throw console.error("Error updating user role in database:",n),new Error(n.message||"Failed to promote user to admin");console.log("Successfully updated user role in database"),a?await Ae(a.id,"promote_to_admin",`Promoted user ${t} to admin role`):console.warn("Could not log admin action - user is null"),console.log("Successfully promoted user to admin role - user will need to log out and log back in for changes to take effect")}catch(a){throw console.error("Error promoting user to admin:",a),new Error(a.message||"Failed to promote user to admin")}}async function ja(t){try{console.log("Promoting user to section admin via database function:",t);const{data:s,error:r}=await p.rpc("promote_user_to_section_admin",{input_user_id:t});if(r)throw console.error("Error updating user role in database:",r),new Error(r.message||"Failed to promote user to section admin");console.log("Successfully updated user role to section_admin:",s)}catch(s){throw console.error("Error promoting user to section admin:",s),new Error(s.message||"Failed to promote user to section admin")}}async function ka(t){try{console.log("Demoting user via database function:",t);const{data:s,error:r}=await p.rpc("demote_user_to_regular",{user_id:t});if(r)throw console.error("Error updating user role in database:",r),new Error(r.message||"Failed to demote user");console.log("Successfully demoted user:",s)}catch(s){throw console.error("Error demoting user:",s),new Error(s.message||"Failed to demote user")}}async function Na(t){try{console.log("------- FETCH SECTION USERS SERVICE -------"),console.log("Fetching section users for section ID:",t);const{data:{user:s}}=await p.auth.getUser();if(console.log("Current user:",s==null?void 0:s.id,s==null?void 0:s.email),!t)throw console.error("No section ID provided"),new Error("No section ID provided");const{data:r,error:a}=await p.from("sections").select("id, name, batch_id").eq("id",t).single();a?(console.error("Error fetching section:",a),console.log("Section may not exist with ID:",t)):console.log("Found section:",r),console.log("Running query to fetch users with section_id =",t);const{data:o,error:n}=await p.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").eq("section_id",t).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching section users:",n),new Error(n.message||"Failed to fetch section users");console.log("Raw section user data from database:",o),console.log("Number of section users retrieved:",(o==null?void 0:o.length)||0);const{data:i}=await p.from("departments").select("id, name"),{data:c}=await p.from("batches").select("id, name"),{data:l}=await p.from("sections").select("id, name");console.log("Departments:",i),console.log("Batches:",c),console.log("Sections:",l);const d=new Map((i==null?void 0:i.map(v=>[v.id,v.name]))||[]),h=new Map((c==null?void 0:c.map(v=>[v.id,v.name]))||[]),x=new Map((l==null?void 0:l.map(v=>[v.id,v.name]))||[]),_=(o==null?void 0:o.map(v=>({id:v.id,username:v.name||"",email:v.email||"",role:v.role||"user",department:d.get(v.department_id)||"",departmentId:v.department_id,batch:h.get(v.batch_id)||"",batchId:v.batch_id,section:x.get(v.section_id)||"",sectionId:v.section_id,permissions:[],status:"active",isActive:!0,lastLogin:v.last_active,createdAt:v.created_at,phone:v.phone||"",studentId:v.student_id||""})))||[];if(console.log("Mapped section users:",_),_.length===0){console.log("No users found for section ID:",t);const{data:v,error:f}=await p.from("users").select("id, email, section_id").not("section_id","is",null).limit(5);f?console.error("Error checking for any users with sections:",f):(console.log("Users with any section assignment:",v),v.length===0&&console.log("No users have any section assignment in the database"))}return _}catch(s){throw console.error("Error fetching section users:",s),new Error(s.message||"Failed to fetch section users")}}async function _a(t,s){try{let r=p.from("sections").select("id, name, batch_id");t&&(r=r.eq("batch_id",t));const{data:a,error:o}=await r.order("name");if(o)throw console.error("Error fetching sections:",o),new Error(o.message||"Failed to fetch sections");if(s&&!t){const{data:n,error:i}=await p.from("batches").select("id").eq("department_id",s);if(i)throw console.error("Error fetching batches:",i),new Error(i.message||"Failed to fetch batches");const c=n.map(l=>l.id);return a.filter(l=>c.includes(l.batch_id))}return a||[]}catch(r){throw console.error("Error fetching sections:",r),new Error(r.message||"Failed to fetch sections")}}function ft(){const[t,s]=g.useState([]),[r,a]=g.useState(!0),[o,n]=g.useState(null),i=g.useCallback(async()=>{a(!0),n(null);try{const b=await pa();s(b)}catch(b){console.error("Error fetching admin users:",b),n(b.message||"Failed to fetch admin users")}finally{a(!1)}},[]);return g.useEffect(()=>{i()},[i]),{admins:t,loading:r,error:o,createAdmin:async b=>{a(!0),n(null);try{const u=Math.random().toString(36).slice(-8)+Math.random().toString(36).slice(-8).toUpperCase()+"!1",m=await fa(b,u);return await i(),m}catch(u){throw console.error("Error creating admin user:",u),n(u.message||"Failed to create admin user"),u}finally{a(!1)}},updateAdmin:async(b,u)=>{a(!0),n(null);try{await ba(b,u),await i()}catch(m){throw console.error("Error updating admin user:",m),n(m.message||"Failed to update admin user"),m}finally{a(!1)}},deleteAdmin:async b=>{a(!0),n(null);try{await wa(b),await i()}catch(u){throw console.error("Error deleting admin user:",u),n(u.message||"Failed to delete admin user"),u}finally{a(!1)}},resetPassword:async(b,u)=>{a(!0),n(null);try{const m=await ya(b,u);return await i(),m}catch(m){return console.error("Error resetting admin password:",m),n(m.message||"Failed to reset admin password"),!1}finally{a(!1)}},promoteToAdmin:async b=>{a(!0),n(null);try{await va(b),await i()}catch(u){throw console.error("Error promoting user to admin:",u),n(u.message||"Failed to promote user to admin"),u}finally{a(!1)}},promoteToSectionAdmin:async b=>{a(!0),n(null);try{console.log(`Attempting to promote user ${b} to section admin`);const u=t.find(m=>m.id===b);if(!u)throw new Error("User not found");if(!u.sectionId)throw new Error("User does not have a section assigned. Please assign a section first.");await ja(b),console.log(`Successfully promoted user ${b} to section admin`),await i()}catch(u){throw console.error("Error promoting user to section admin:",u),n(u.message||"Failed to promote user to section admin"),u}finally{a(!1)}},demoteUser:async b=>{a(!0),n(null);try{console.log(`Attempting to demote user ${b}`);const u=t.find(m=>m.id===b);if(!u)throw new Error("User not found");if(u.role==="super-admin")throw new Error("Super admins cannot be demoted through this interface");await ka(b),console.log(`Successfully demoted user ${b}`),await i()}catch(u){throw console.error("Error demoting user:",u),n(u.message||"Failed to demote user"),u}finally{a(!1)}},getSectionUsers:async b=>{a(!0),n(null);try{const u=await Na(b);return console.log("getSectionUsers result:",u),u}catch(u){throw console.error("Error fetching section users:",u),n(u.message||"Failed to fetch section users"),u}finally{a(!1)}},getSections:async(b,u)=>{a(!0),n(null);try{return await _a(b,u)}catch(m){throw console.error("Error fetching sections:",m),n(m.message||"Failed to fetch sections"),m}finally{a(!1)}},refreshAdmins:i}}function Sa(){const[t,s]=g.useState(""),[r,a]=g.useState("all"),[o,n]=g.useState("all"),{admins:i,loading:c,error:l,refreshAdmins:d}=ft(),h=i.filter(f=>{var m,N,w;const y=((m=f.username)==null?void 0:m.toLowerCase().includes(t.toLowerCase()))||((N=f.email)==null?void 0:N.toLowerCase().includes(t.toLowerCase()))||((w=f.department)==null?void 0:w.toLowerCase().includes(t.toLowerCase())),b=r==="all"||f.role===r,u=o==="all"||(o==="active"?f.isActive:!f.isActive);return y&&b&&u}),x=f=>{switch(f){case"super-admin":return e.jsx(O,{variant:"destructive",children:"Super Admin"});case"admin":return e.jsx(O,{variant:"info",children:"Admin"});case"section_admin":return e.jsx(O,{variant:"warning",children:"Section Admin"});default:return e.jsx(O,{variant:"secondary",children:"User"})}},_=f=>f?e.jsx(O,{variant:"success",children:"Active"}):e.jsx(O,{variant:"secondary",children:"Inactive"}),v=async()=>{try{await d(),xe("Admins refreshed successfully")}catch(f){H("Failed to refresh admins")}};return c&&i.length===0?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-800 rounded-xl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl",children:"Admin Management"}),e.jsx(Q,{children:"Manage system administrators and their permissions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:v,disabled:c,children:[e.jsx(Be,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),"Refresh"]}),e.jsxs(D,{size:"sm",children:[e.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Add Admin"]})]})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(se,{placeholder:"Search by name, email, or department...",value:t,onChange:f=>s(f.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r,onChange:f=>a(f.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"user",children:"User"})]}),e.jsxs("select",{value:o,onChange:f=>n(f.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(F,{children:e.jsxs(J,{className:"pb-2",children:[e.jsx(Q,{children:"Total Admins"}),e.jsx(K,{className:"text-3xl",children:i.length})]})}),e.jsx(F,{children:e.jsxs(J,{className:"pb-2",children:[e.jsx(Q,{children:"Active"}),e.jsx(K,{className:"text-3xl text-green-600",children:i.filter(f=>f.isActive).length})]})}),e.jsx(F,{children:e.jsxs(J,{className:"pb-2",children:[e.jsx(Q,{children:"Super Admins"}),e.jsx(K,{className:"text-3xl text-purple-600",children:i.filter(f=>f.role==="super-admin").length})]})}),e.jsx(F,{children:e.jsxs(J,{className:"pb-2",children:[e.jsx(Q,{children:"Section Admins"}),e.jsx(K,{className:"text-3xl text-blue-600",children:i.filter(f=>f.role==="section_admin").length})]})})]}),e.jsxs(F,{children:[e.jsxs(J,{children:[e.jsxs(K,{children:["Administrators (",h.length,")"]}),e.jsx(Q,{children:t||r!=="all"||o!=="all"?`Showing ${h.length} of ${i.length} admins`:"All system administrators"})]}),e.jsxs(ee,{children:[l&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:l}),h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No admins found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ut,{children:[e.jsx(gt,{children:e.jsxs(Ce,{children:[e.jsx(q,{children:"Admin"}),e.jsx(q,{children:"Role"}),e.jsx(q,{children:"Department"}),e.jsx(q,{children:"Status"}),e.jsx(q,{children:"Joined"}),e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(ht,{children:h.map(f=>{var y,b;return e.jsxs(Ce,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-10 w-10",children:e.jsx(we,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:((y=f.username)==null?void 0:y.charAt(0).toUpperCase())||((b=f.email)==null?void 0:b.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:f.username||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:f.email})]})]})}),e.jsx(W,{children:x(f.role||"user")}),e.jsx(W,{className:"text-gray-600 dark:text-gray-400",children:f.department||"N/A"}),e.jsx(W,{children:_(f.isActive)}),e.jsx(W,{className:"text-gray-600 dark:text-gray-400",children:f.createdAt?new Date(f.createdAt).toLocaleDateString():"N/A"}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Fr,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Dt,{className:"w-4 h-4"})})]})})]},f.id)})})]})})]})]})]})}function Ca({logs:t,loading:s}){const[r,a]=g.useState(""),[o,n]=g.useState([]),[i,c]=g.useState("all"),[l,d]=g.useState({from:"",to:""}),[h,x]=g.useState("desc"),_=["all","create_admin","update_admin","delete_admin","reset_password","login","logout"];g.useEffect(()=>{let m=[...t];if(r){const N=r.toLowerCase();m=m.filter(w=>w.adminName.toLowerCase().includes(N)||w.action.toLowerCase().includes(N)||w.details.toLowerCase().includes(N))}if(i!=="all"&&(m=m.filter(N=>N.action===i)),l.from){const N=new Date(l.from);m=m.filter(w=>new Date(w.timestamp)>=N)}if(l.to){const N=new Date(l.to);N.setHours(23,59,59,999),m=m.filter(w=>new Date(w.timestamp)<=N)}m.sort((N,w)=>{const E=new Date(N.timestamp),U=new Date(w.timestamp);return h==="desc"?+U-+E:+E-+U}),n(m)},[t,r,i,l,h]);const v=m=>{const{name:N,value:w}=m.target;d(E=>({...E,[N]:w}))},f=()=>{a(""),c("all"),d({from:"",to:""})},y=()=>{if(o.length===0)return;const N=[["Admin","Action","Details","Timestamp","IP Address"].join(","),...o.map(C=>[`"${C.adminName}"`,`"${C.action}"`,`"${C.details.replace(/"/g,'""')}"`,`"${new Date(C.timestamp).toLocaleString()}"`,`"${C.ipAddress||""}"`].join(","))].join(`
`),w=new Blob([N],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(w),U=document.createElement("a");U.setAttribute("href",E),U.setAttribute("download",`admin-logs-${new Date().toISOString().split("T")[0]}.csv`),U.style.visibility="hidden",document.body.appendChild(U),U.click(),document.body.removeChild(U)},b=m=>{switch(m){case"create_admin":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300";case"update_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300";case"delete_admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300";case"reset_password":return"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-300";case"login":return"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300";case"logout":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},u=m=>m.split("_").map(N=>N.charAt(0).toUpperCase()+N.slice(1)).join(" ");return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(et,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),"Admin Activity Logs"]}),e.jsxs("button",{onClick:y,disabled:o.length===0,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($t,{className:"h-4 w-4 mr-1.5"}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search logs...",value:r,onChange:m=>a(m.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"}),e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:i,onChange:m=>c(m.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white appearance-none",children:_.map(m=>e.jsx("option",{value:m,children:m==="all"?"All Actions":u(m)},m))}),e.jsx(Lr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"from",value:l.from,onChange:v,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"From date"}),e.jsx(et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"to",value:l.to,onChange:v,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"To date"}),e.jsx(et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-2",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(r||i!=="all"||l.from||l.to)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active filters:"}),r&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Search: ",r,e.jsx(ge,{size:14,className:"ml-1 cursor-pointer",onClick:()=>a("")})]}),i!=="all"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Action: ",u(i),e.jsx(ge,{size:14,className:"ml-1 cursor-pointer",onClick:()=>c("all")})]}),l.from&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["From: ",l.from,e.jsx(ge,{size:14,className:"ml-1 cursor-pointer",onClick:()=>d(m=>({...m,from:""}))})]}),l.to&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["To: ",l.to,e.jsx(ge,{size:14,className:"ml-1 cursor-pointer",onClick:()=>d(m=>({...m,to:""}))})]}),e.jsx("button",{onClick:f,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"Clear all"})]})}),e.jsxs("button",{onClick:()=>x(m=>m==="desc"?"asc":"desc"),className:"inline-flex items-center px-2 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(ot,{className:"h-4 w-4 mr-1"}),h==="desc"?e.jsxs(e.Fragment,{children:["Newest first ",e.jsx(Cr,{className:"h-3 w-3 ml-1"})]}):e.jsxs(e.Fragment,{children:["Oldest first ",e.jsx(Ar,{className:"h-3 w-3 ml-1"})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:s?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"}),[...Array(5)].map((m,N)=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},N))]})}):o.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:t.length===0?"No activity logs found in the system.":"No logs match your current filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Admin"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Details"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP Address"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-750 divide-y divide-gray-200 dark:divide-gray-700",children:o.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.adminName}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.adminId.substring(0,8)})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${b(m.action)}`,children:u(m.action)})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:m.details}),m.resource&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Resource: ",m.resource," ",m.resourceId&&`#${m.resourceId.substring(0,8)}`]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(m.timestamp).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:m.ipAddress||"-"})]},m.id))})]})})}),!s&&t.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:["Showing ",o.length," of ",t.length," logs"]})]})}function Aa({admins:t,onResetPassword:s}){const[r,a]=g.useState(""),[o,n]=g.useState(""),[i,c]=g.useState(!1),[l,d]=g.useState(!1),[h,x]=g.useState(!1),_=()=>{const b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";let u="";u+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],u+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],u+="0123456789"[Math.floor(Math.random()*10)],u+="!@#$%^&*()_+"[Math.floor(Math.random()*12)];for(let m=4;m<12;m++)u+=b[Math.floor(Math.random()*b.length)];u=u.split("").sort(()=>Math.random()-.5).join(""),n(u)},v=()=>{navigator.clipboard.writeText(o).then(()=>{x(!0),setTimeout(()=>x(!1),2e3)}).catch(y=>{console.error("Failed to copy:",y),H("Failed to copy password to clipboard")})},f=async()=>{if(!r){H("Please select an admin");return}if(!o||o.length<8){H("Please generate a secure password");return}d(!0);try{await s(r,o)?(xe("Password reset successfully"),a(""),n("")):H("Failed to reset password")}catch(y){H(y.message||"Failed to reset password")}finally{d(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:"Security Settings"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage security settings and reset passwords"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Password Reset"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"admin-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select User"}),e.jsxs("select",{id:"admin-select",value:r,onChange:y=>a(y.target.value),className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a user"}),t.filter(y=>y.role!=="super-admin").map(y=>e.jsxs("option",{value:y.id,children:[y.username," (",y.email,") - ",y.role]},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{id:"password",type:i?"text":"password",value:o,onChange:y=>n(y.target.value),className:"flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Generate a secure password",readOnly:!0}),e.jsx("button",{type:"button",onClick:()=>c(!i),className:"bg-gray-100 dark:bg-gray-600 border-y border-r border-gray-300 dark:border-gray-600 rounded-r-lg px-3",children:i?e.jsx(Pr,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}):e.jsx($r,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:_,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Lt,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate Password"})]}),o&&e.jsx("button",{type:"button",onClick:v,className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Dr,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(zr,{className:"h-4 w-4"}),e.jsx("span",{children:"Copy"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",onClick:f,disabled:!r||!o||l,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors disabled:bg-red-300 dark:disabled:bg-red-800/50 disabled:cursor-not-allowed",children:[l?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Reset Password"})]})}),r&&o&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg flex items-start gap-2 text-sm",children:[e.jsx(Oe,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Important:"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"You are about to reset the password for this user. Make sure to share the new password with them securely. They should change their password after logging in."})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Security Policies"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Two-factor Authentication"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Require 2FA for all admin accounts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Password Expiry"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Force password change every 90 days"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Session Timeout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Auto logout after 30 minutes of inactivity"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Failed Login Lockout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lock account after 5 failed login attempts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Security Settings"})]})})]})]})}var Ea=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ta=Ea.reduce((t,s)=>{const r=mt(`Primitive.${s}`),a=g.forwardRef((o,n)=>{const{asChild:i,...c}=o,l=i?r:s;return typeof window!="undefined"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...c,ref:n})});return a.displayName=`Primitive.${s}`,{...t,[s]:a}},{}),Ua="Label",gr=g.forwardRef((t,s)=>e.jsx(Ta.label,{...t,ref:s,onMouseDown:r=>{var o;r.target.closest("button, input, select, textarea")||((o=t.onMouseDown)==null||o.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));gr.displayName=Ua;var hr=gr;const Ra=dt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),G=g.forwardRef(({className:t,...s},r)=>e.jsx(hr,{ref:r,className:M(Ra(),t),...s}));G.displayName=hr.displayName;const bt=({open:t,onOpenChange:s,children:r})=>t?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>s(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:r})]}):null,We=g.forwardRef(({className:t,children:s,onClose:r,...a},o)=>e.jsxs("div",{ref:o,className:M("relative bg-white dark:bg-gray-950 rounded-lg shadow-xl border border-gray-200 dark:border-gray-800 w-full max-w-lg max-h-[90vh] overflow-y-auto",t),onClick:n=>n.stopPropagation(),...a,children:[r&&e.jsxs("button",{onClick:r,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none dark:ring-offset-gray-950 dark:focus:ring-gray-300",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),s]}));We.displayName="DialogContent";const He=({className:t,...s})=>e.jsx("div",{className:M("flex flex-col space-y-1.5 p-6 pb-4",t),...s});He.displayName="DialogHeader";const Ye=({className:t,...s})=>e.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-4",t),...s});Ye.displayName="DialogFooter";const Ze=g.forwardRef(({className:t,...s},r)=>e.jsx("h2",{ref:r,className:M("text-lg font-semibold leading-none tracking-tight text-gray-900 dark:text-white",t),...s}));Ze.displayName="DialogTitle";const Je=g.forwardRef(({className:t,...s},r)=>e.jsx("p",{ref:r,className:M("text-sm text-gray-500 dark:text-gray-400",t),...s}));Je.displayName="DialogDescription";const Ke=({className:t,...s})=>e.jsx("div",{className:M("px-6 py-2",t),...s});Ke.displayName="DialogBody";async function Ma(){try{const{data:t,error:s}=await p.from("users").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching users:",s),new Error(s.message);return t||[]}catch(t){throw console.error("Error in fetchAllUsers:",t),t}}async function Fa(){try{const{data:t,error:s}=await p.from("departments").select("*").order("name");if(s)throw console.error("Error fetching departments:",s),new Error(s.message);return t||[]}catch(t){throw console.error("Error in fetchDepartments:",t),t}}async function La(t){try{let s=p.from("batches").select("*").order("name");const{data:r,error:a}=await s;if(a)throw console.error("Error fetching batches:",a),new Error(a.message);return r||[]}catch(s){throw console.error("Error in fetchBatches:",s),s}}async function Pa(t){try{let s=p.from("sections").select("*").order("name");const{data:r,error:a}=await s;if(a)throw console.error("Error fetching sections:",a),new Error(a.message);return r||[]}catch(s){throw console.error("Error in fetchSections:",s),s}}async function $a(t){try{const{data:s}=await p.auth.getUser();if(!s.user)throw new Error("You must be logged in to create users");const{data:r,error:a}=await p.auth.signUp({email:t.email,password:t.password,options:{data:{name:t.name,role:t.role}}});if(a)throw console.error("Error creating auth user:",a),new Error(a.message);if(!r.user)throw new Error("Failed to create user account");const{data:o,error:n}=await p.from("users").upsert({id:r.user.id,email:t.email,name:t.name,role:t.role,phone:t.phone||null,student_id:t.student_id||null,department_id:t.department_id||null,batch_id:t.batch_id||null,section_id:t.section_id||null}).select().single();if(n)throw console.error("Error updating user record:",n),new Error(n.message);return await p.from("activities").insert({type:"user_created",title:`New user created: ${t.name}`,user_id:s.user.id,metadata:{target_user_id:r.user.id,email:t.email,role:t.role}}),o}catch(s){throw console.error("Error in createUser:",s),s}}async function Da(t,s){try{const{data:r}=await p.auth.getUser();if(!r.user)throw new Error("You must be logged in to update users");const{data:a}=await p.from("users").select("*").eq("id",t).single(),{data:o,error:n}=await p.from("users").update({name:s.name,role:s.role,phone:s.phone,student_id:s.student_id,department_id:s.department_id,batch_id:s.batch_id,section_id:s.section_id}).eq("id",t).select().single();if(n)throw console.error("Error updating user:",n),new Error(n.message);return s.role==="section_admin"&&s.section_id&&(a==null?void 0:a.role)!=="section_admin"&&await p.from("section_admins").upsert({user_id:t,section_id:s.section_id,assigned_by:r.user.id}),(a==null?void 0:a.role)==="section_admin"&&s.role!=="section_admin"&&await p.from("section_admins").delete().eq("user_id",t),await p.from("activities").insert({type:"user_updated",title:`User updated: ${o.name}`,user_id:r.user.id,metadata:{target_user_id:t,changes:s,previous:a}}),o}catch(r){throw console.error("Error in updateUser:",r),r}}async function za(t){try{const{data:s}=await p.auth.getUser();if(!s.user)throw new Error("You must be logged in to delete users");const{data:r}=await p.from("users").select("*").eq("id",t).single();await p.from("section_admins").delete().eq("user_id",t);const{error:a}=await p.from("users").delete().eq("id",t);if(a)throw console.error("Error deleting user:",a),new Error(a.message);await p.from("activities").insert({type:"user_deleted",title:`User deleted: ${(r==null?void 0:r.name)||(r==null?void 0:r.email)}`,user_id:s.user.id,metadata:{deleted_user:r}})}catch(s){throw console.error("Error in deleteUserById:",s),s}}async function Ia(t,s,r){try{const{data:a}=await p.auth.getUser();if(!a.user)throw new Error("You must be logged in to change user roles");const{data:o}=await p.from("users").select("*").eq("id",t).single(),n={role:s};r&&(n.section_id=r);const{data:i,error:c}=await p.from("users").update(n).eq("id",t).select().single();if(c)throw console.error("Error changing user role:",c),new Error(c.message);return s==="section_admin"&&r?(await p.from("section_admins").delete().eq("user_id",t),await p.from("section_admins").insert({user_id:t,section_id:r,assigned_by:a.user.id})):(o==null?void 0:o.role)==="section_admin"&&s!=="section_admin"&&await p.from("section_admins").delete().eq("user_id",t),await p.from("activities").insert({type:"role_change",title:`User role changed: ${o==null?void 0:o.role}  ${s}`,user_id:a.user.id,metadata:{target_user_id:t,previous_role:o==null?void 0:o.role,new_role:s,section_id:r}}),i}catch(a){throw console.error("Error in changeUserRole:",a),a}}function Oa(t){const s=t.length,r=t.filter(d=>d.role==="super-admin").length,a=t.filter(d=>d.role==="admin").length,o=t.filter(d=>d.role==="section_admin").length,n=t.filter(d=>d.role==="user").length,i=new Date;i.setDate(i.getDate()-7);const c=t.filter(d=>d.last_active&&new Date(d.last_active)>i).length,l=t.filter(d=>d.created_at&&new Date(d.created_at)>i).length;return{totalUsers:s,superAdmins:r,admins:a,sectionAdmins:o,regularUsers:n,activeUsers:c,newUsersThisWeek:l}}function Ba(t,s){if(!s)return t;const r=s.toLowerCase();return t.filter(a=>{var o,n,i,c;return((o=a.name)==null?void 0:o.toLowerCase().includes(r))||((n=a.email)==null?void 0:n.toLowerCase().includes(r))||((i=a.student_id)==null?void 0:i.toLowerCase().includes(r))||((c=a.phone)==null?void 0:c.toLowerCase().includes(r))})}function Va(t,s){return s==="all"?t:t.filter(r=>r.role===s)}const te={"super-admin":{label:"Super Admin",color:"text-red-600 dark:text-red-400",icon:Pt,badgeVariant:"destructive"},admin:{label:"Admin",color:"text-blue-600 dark:text-blue-400",icon:zt,badgeVariant:"info"},section_admin:{label:"Section Admin",color:"text-orange-600 dark:text-orange-400",icon:ae,badgeVariant:"warning"},user:{label:"User",color:"text-gray-600 dark:text-gray-400",icon:Ve,badgeVariant:"secondary"}};function Ga({open:t,onClose:s,user:r,departments:a,batches:o,sections:n,onSubmit:i,mode:c}){const[l,d]=g.useState({email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""}),[h,x]=g.useState(!1),[_,v]=g.useState([]),[f,y]=g.useState([]);g.useEffect(()=>{d(c==="edit"&&r?{email:r.email||"",password:"",name:r.name||"",role:r.role,phone:r.phone||"",student_id:r.student_id||"",department_id:r.department_id||"",batch_id:r.batch_id||"",section_id:r.section_id||""}:{email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""})},[r,c,t]),g.useEffect(()=>{l.department_id?v(o.filter(u=>u.department_id===l.department_id)):v(o)},[l.department_id,o]),g.useEffect(()=>{l.batch_id?y(n.filter(u=>u.batch_id===l.batch_id)):y(n)},[l.batch_id,n]);const b=async u=>{if(u.preventDefault(),c==="create"&&(!l.email||!l.password)){H("Email and password are required");return}if(!l.name){H("Name is required");return}x(!0);try{const m=c==="create"?l:{name:l.name,role:l.role,phone:l.phone||void 0,student_id:l.student_id||void 0,department_id:l.department_id||void 0,batch_id:l.batch_id||void 0,section_id:l.section_id||void 0};await i(m),s()}catch(m){H(m.message||"Failed to save user")}finally{x(!1)}};return e.jsx(bt,{open:t,onOpenChange:s,children:e.jsxs(We,{onClose:s,className:"max-w-2xl",children:[e.jsxs(He,{children:[e.jsx(Ze,{children:c==="create"?"Create New User":"Edit User"}),e.jsx(Je,{children:c==="create"?"Add a new user to the system with specified role and details.":`Update user information for ${(r==null?void 0:r.name)||(r==null?void 0:r.email)}`})]}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(Ke,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c==="create"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"email",children:"Email *"}),e.jsx(se,{id:"email",type:"email",placeholder:"user@example.com",value:l.email,onChange:u=>d(m=>({...m,email:u.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"password",children:"Password *"}),e.jsx(se,{id:"password",type:"password",placeholder:"",value:l.password,onChange:u=>d(m=>({...m,password:u.target.value})),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Full Name *"}),e.jsx(se,{id:"name",placeholder:"John Doe",value:l.name,onChange:u=>d(m=>({...m,name:u.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"role",children:"Role *"}),e.jsxs("select",{id:"role",value:l.role,onChange:u=>d(m=>({...m,role:u.target.value})),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super-admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"phone",children:"Phone"}),e.jsx(se,{id:"phone",placeholder:"+1234567890",value:l.phone,onChange:u=>d(m=>({...m,phone:u.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"student_id",children:"Student ID"}),e.jsx(se,{id:"student_id",placeholder:"STU-123456",value:l.student_id,onChange:u=>d(m=>({...m,student_id:u.target.value}))})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-4",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"department",children:"Department"}),e.jsxs("select",{id:"department",value:l.department_id,onChange:u=>d(m=>({...m,department_id:u.target.value,batch_id:"",section_id:""})),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Department"}),a.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"batch",children:"Batch"}),e.jsxs("select",{id:"batch",value:l.batch_id,onChange:u=>d(m=>({...m,batch_id:u.target.value,section_id:""})),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!l.department_id,children:[e.jsx("option",{value:"",children:"Select Batch"}),_.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"section",children:"Section"}),e.jsxs("select",{id:"section",value:l.section_id,onChange:u=>d(m=>({...m,section_id:u.target.value})),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!l.batch_id,children:[e.jsx("option",{value:"",children:"Select Section"}),f.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]})]})]})]}),e.jsxs(Ye,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:s,disabled:h,children:"Cancel"}),e.jsx(D,{type:"submit",disabled:h,children:h?"Saving...":c==="create"?"Create User":"Update User"})]})]})]})})}function qa({open:t,onClose:s,user:r,sections:a,onRoleChange:o}){var _,v;const[n,i]=g.useState("user"),[c,l]=g.useState(""),[d,h]=g.useState(!1);g.useEffect(()=>{r&&(i(r.role),l(r.section_id||""))},[r,t]);const x=async()=>{if(r){if(n==="section_admin"&&!c){H("Please select a section for section admin");return}h(!0);try{await o(r.id,n,c||void 0),xe(`Role changed to ${te[n].label}`),s()}catch(f){H(f.message||"Failed to change role")}finally{h(!1)}}};return r?e.jsx(bt,{open:t,onOpenChange:s,children:e.jsxs(We,{onClose:s,children:[e.jsxs(He,{children:[e.jsx(Ze,{children:"Change User Role"}),e.jsxs(Je,{children:["Change the role for ",r.name||r.email]})]}),e.jsxs(Ke,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx(ye,{className:"h-12 w-12",children:e.jsx(we,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 text-lg",children:((_=r.name)==null?void 0:_.charAt(0).toUpperCase())||((v=r.email)==null?void 0:v.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email}),e.jsxs(O,{variant:te[r.role].badgeVariant,className:"mt-1",children:["Current: ",te[r.role].label]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"New Role"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(te).map(([f,y])=>{const b=y.icon;return e.jsxs("button",{type:"button",onClick:()=>i(f),className:`flex items-center gap-2 p-3 border rounded-lg transition-all ${n===f?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-800 hover:border-gray-300"}`,children:[e.jsx(b,{className:`w-4 h-4 ${y.color}`}),e.jsx("span",{className:"text-sm font-medium",children:y.label})]},f)})})]}),n==="section_admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Assign to Section *"}),e.jsxs("select",{value:c,onChange:f=>l(f.target.value),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Section"}),a.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]})]}),e.jsxs(Ye,{children:[e.jsx(D,{variant:"outline",onClick:s,disabled:d,children:"Cancel"}),e.jsx(D,{onClick:x,disabled:d||n===r.role,children:d?"Updating...":"Change Role"})]})]})}):null}function Wa({open:t,onClose:s,user:r,onDelete:a}){var h,x;const[o,n]=g.useState(!1),[i,c]=g.useState("");g.useEffect(()=>{t||c("")},[t]);const l=async()=>{if(r){n(!0);try{await a(r.id),xe("User deleted successfully"),s()}catch(_){H(_.message||"Failed to delete user")}finally{n(!1)}}};if(!r)return null;const d=i.toLowerCase()==="delete";return e.jsx(bt,{open:t,onOpenChange:s,children:e.jsxs(We,{onClose:s,children:[e.jsxs(He,{children:[e.jsx(Ze,{className:"text-red-600",children:"Delete User"}),e.jsx(Je,{children:"This action cannot be undone. This will permanently delete the user account."})]}),e.jsxs(Ke,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx(ye,{className:"h-12 w-12",children:e.jsx(we,{className:"bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 text-lg",children:((h=r.name)==null?void 0:h.charAt(0).toUpperCase())||((x=r.email)==null?void 0:x.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email}),e.jsx(O,{variant:te[r.role].badgeVariant,className:"mt-1",children:te[r.role].label})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:'Type "delete" to confirm'}),e.jsx(se,{value:i,onChange:_=>c(_.target.value),placeholder:"delete",className:"border-red-200 dark:border-red-800 focus:border-red-500"})]})]}),e.jsxs(Ye,{children:[e.jsx(D,{variant:"outline",onClick:s,disabled:o,children:"Cancel"}),e.jsx(D,{variant:"destructive",onClick:l,disabled:o||!d,children:o?"Deleting...":"Delete User"})]})]})})}function Ha({onEdit:t,onChangeRole:s,onDelete:r}){const[a,o]=g.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>o(!a),children:e.jsx(Dt,{className:"w-4 h-4"})}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-48 py-1 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg shadow-lg z-50",children:[e.jsxs("button",{onClick:()=>{t(),o(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4"}),"Edit User"]}),e.jsxs("button",{onClick:()=>{s(),o(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Change Role"]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-800 my-1"}),e.jsxs("button",{onClick:()=>{r(),o(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Delete User"]})]})]})]})}function ue({title:t,value:s,icon:r,color:a,bgColor:o}){return e.jsx(F,{children:e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("p",{className:`text-2xl font-bold ${a}`,children:s})]}),e.jsx("div",{className:`p-3 rounded-full ${o}`,children:e.jsx(r,{className:`w-5 h-5 ${a}`})})]})})})}function Ya(){const[t,s]=g.useState([]),[r,a]=g.useState([]),[o,n]=g.useState([]),[i,c]=g.useState([]),[l,d]=g.useState(!0),[h,x]=g.useState(""),[_,v]=g.useState("all"),[f,y]=g.useState(!1),[b,u]=g.useState(!1),[m,N]=g.useState(!1),[w,E]=g.useState(null),[U,C]=g.useState("create"),A=g.useCallback(async()=>{try{d(!0);const[S,B,L,I]=await Promise.all([Ma(),Fa(),La(),Pa()]);s(S),a(B),n(L),c(I)}catch(S){console.error("Error fetching data:",S),H(S.message||"Failed to load data")}finally{d(!1)}},[]);g.useEffect(()=>{A()},[A]);const P=g.useMemo(()=>Oa(t),[t]),Y=g.useMemo(()=>{let S=Ba(t,h);return S=Va(S,_),S},[t,h,_]),Ee=async S=>{await $a(S),xe("User created successfully"),await A()},de=async S=>{w&&(await Da(w.id,S),xe("User updated successfully"),await A())},Te=async(S,B,L)=>{await Ia(S,B,L),await A()},ve=async S=>{await za(S),await A()},oe=()=>{E(null),C("create"),y(!0)},Z=S=>{E(S),C("edit"),y(!0)},X=S=>{E(S),u(!0)},T=S=>{E(S),N(!0)},Ue=S=>{var B;return S&&((B=r.find(L=>L.id===S))==null?void 0:B.name)||""},Re=S=>{var B;return S&&((B=i.find(L=>L.id===S))==null?void 0:B.name)||""};return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading users..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Manage all users, roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"outline",onClick:A,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(D,{onClick:oe,children:[e.jsx(Er,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(ue,{title:"Total Users",value:P.totalUsers,icon:Se,color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-100 dark:bg-gray-800"}),e.jsx(ue,{title:"Super Admins",value:P.superAdmins,icon:Pt,color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30"}),e.jsx(ue,{title:"Admins",value:P.admins,icon:zt,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30"}),e.jsx(ue,{title:"Section Admins",value:P.sectionAdmins,icon:ae,color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900/30"}),e.jsx(ue,{title:"Regular Users",value:P.regularUsers,icon:Ve,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30"}),e.jsx(ue,{title:"Active (7d)",value:P.activeUsers,icon:Ir,color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-100 dark:bg-purple-900/30"})]}),e.jsx(F,{children:e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(se,{placeholder:"Search by name, email, student ID or phone...",value:h,onChange:S=>x(S.target.value),className:"pl-10"})]}),e.jsxs("select",{value:_,onChange:S=>v(S.target.value),className:"h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm min-w-[150px]",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admins"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"section_admin",children:"Section Admins"}),e.jsx("option",{value:"user",children:"Users"})]})]})})}),e.jsxs(F,{children:[e.jsx(J,{children:e.jsx(K,{className:"flex items-center justify-between",children:e.jsxs("span",{children:["Users (",Y.length,")"]})})}),e.jsx(ee,{children:Y.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(Or,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ut,{children:[e.jsx(gt,{children:e.jsxs(Ce,{children:[e.jsx(q,{children:"User"}),e.jsx(q,{children:"Role"}),e.jsx(q,{className:"hidden lg:table-cell",children:"Department"}),e.jsx(q,{className:"hidden md:table-cell",children:"Section"}),e.jsx(q,{className:"hidden lg:table-cell",children:"Joined"}),e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(ht,{children:Y.map(S=>{var L,I,ie,je,$,ke;const B=((L=te[S.role])==null?void 0:L.icon)||Ve;return e.jsxs(Ce,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-10 w-10",children:e.jsx(we,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:((I=S.name)==null?void 0:I.charAt(0).toUpperCase())||((ie=S.email)==null?void 0:ie.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:S.name||""}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(Br,{className:"w-3 h-3"}),S.email]}),S.phone&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(Vr,{className:"w-3 h-3"}),S.phone]})]})]})}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:`w-4 h-4 ${((je=te[S.role])==null?void 0:je.color)||""}`}),e.jsx(O,{variant:(($=te[S.role])==null?void 0:$.badgeVariant)||"secondary",children:((ke=te[S.role])==null?void 0:ke.label)||S.role})]})}),e.jsx(W,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:Ue(S.department_id)}),e.jsx(W,{className:"hidden md:table-cell text-gray-600 dark:text-gray-400",children:Re(S.section_id)}),e.jsx(W,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:S.created_at?new Date(S.created_at).toLocaleDateString():""}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>X(S),className:"hidden sm:inline-flex",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Role"]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>Z(S),className:"hidden sm:inline-flex",children:e.jsx(It,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>T(S),className:"hidden sm:inline-flex text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(Ot,{className:"w-4 h-4"})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ha,{user:S,onEdit:()=>Z(S),onChangeRole:()=>X(S),onDelete:()=>T(S)})})]})})]},S.id)})})]})})})]}),e.jsx(Ga,{open:f,onClose:()=>y(!1),user:w,departments:r,batches:o,sections:i,onSubmit:U==="create"?Ee:de,mode:U}),e.jsx(qa,{open:b,onClose:()=>u(!1),user:w,sections:i,onRoleChange:Te}),e.jsx(Wa,{open:m,onClose:()=>N(!1),user:w,onDelete:ve})]})}function Za({className:t}){return e.jsx("div",{className:`animate-pulse bg-muted rounded ${t}`})}function V({title:t,value:s,icon:r,trend:a,subtitle:o,color:n="bg-blue-500"}){return e.jsx(F,{className:"p-6 hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold mb-2",children:s}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o}),a&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-sm ${a.isPositive?"text-green-600":"text-red-600"}`,children:[a.isPositive?e.jsx(he,{className:"w-4 h-4"}):e.jsx(Rr,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(a.value),"%"]})]})]}),e.jsx("div",{className:`p-3 rounded-xl ${n} bg-opacity-10`,children:e.jsx("div",{className:`text-${n.split("-")[1]}-600`,children:r})})]})})}function De({label:t,value:s,max:r,color:a="bg-blue-500"}){const o=r>0?s/r*100:0;return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:t}),e.jsxs("span",{className:"text-muted-foreground",children:[s," / ",r]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-3",children:e.jsx("div",{className:`${a} h-3 rounded-full transition-all duration-500`,style:{width:`${Math.min(o,100)}%`}})})]})}function Mt({data:t,color:s="#3b82f6"}){if(!t||t.length===0)return null;const r=Math.max(...t.map(l=>l.count),1),a=100,o=60,n=5,i=t.map((l,d)=>{const h=d/(t.length-1||1)*(a-n*2)+n,x=o-n-l.count/r*(o-n*2);return`${h},${x}`}).join(" "),c=`${n},${o-n} ${i} ${a-n},${o-n}`;return e.jsxs("svg",{viewBox:`0 0 ${a} ${o}`,className:"w-full h-24",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${s}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:s,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:s,stopOpacity:"0.05"})]})}),e.jsx("polygon",{points:c,fill:`url(#gradient-${s})`}),e.jsx("polyline",{points:i,fill:"none",stroke:s,strokeWidth:"2"}),t.map((l,d)=>{const h=d/(t.length-1||1)*(a-n*2)+n,x=o-n-l.count/r*(o-n*2);return e.jsx("circle",{cx:h,cy:x,r:"2.5",fill:s},d)})]})}function ze({data:t,maxValue:s,color:r="#3b82f6"}){const a=s||Math.max(...t.map(o=>o.value),1);return e.jsx("div",{className:"space-y-3",children:t.map((o,n)=>{const i=o.value/a*100;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[e.jsx("span",{className:"font-medium truncate",children:o.label}),e.jsx("span",{className:"text-muted-foreground ml-2",children:o.value})]}),e.jsx("div",{className:"relative w-full bg-muted rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out",style:{width:`${i}%`,background:`linear-gradient(90deg, ${r} 0%, ${r}dd 100%)`}})})]},n)})})}function Ja({data:t}){const s=t.reduce((l,d)=>l+d.value,0);if(s===0)return e.jsx("div",{className:"text-center text-muted-foreground text-sm",children:"No data"});let r=-90;const a=40,o=28,n=50,i=50,c=(l,d,h,x)=>{const _=l*Math.PI/180,v=d*Math.PI/180,f=n+h*Math.cos(_),y=i+h*Math.sin(_),b=n+h*Math.cos(v),u=i+h*Math.sin(v),m=n+x*Math.cos(v),N=i+x*Math.sin(v),w=n+x*Math.cos(_),E=i+x*Math.sin(_),U=d-l>180?1:0;return`M ${f} ${y} A ${h} ${h} 0 ${U} 1 ${b} ${u} L ${m} ${N} A ${x} ${x} 0 ${U} 0 ${w} ${E} Z`};return e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-40 h-40",children:[t.map((l,d)=>{const x=l.value/s*100/100*360,_=c(r,r+x,a,o);return r+=x,e.jsx("g",{children:e.jsx("path",{d:_,fill:l.color,className:"transition-all hover:opacity-80"})},d)}),e.jsx("circle",{cx:n,cy:i,r:o-2,fill:"currentColor",className:"text-background"}),e.jsx("text",{x:n,y:i-5,textAnchor:"middle",className:"text-xl font-bold",fill:"currentColor",children:s}),e.jsx("text",{x:n,y:i+8,textAnchor:"middle",className:"text-xs",fill:"currentColor",opacity:"0.6",children:"Total"})]}),e.jsx("div",{className:"flex-1 space-y-2",children:t.map((l,d)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.color}}),e.jsx("span",{className:"font-medium",children:l.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:l.value}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",(l.value/s*100).toFixed(0),"%)"]})]})]},d))})]})}function Ka({dept:t}){return e.jsx(F,{className:"p-5 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500 bg-opacity-10 rounded-lg",children:e.jsx(at,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-2 text-sm",children:t.department_name}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Users"}),e.jsx("p",{className:"font-bold text-lg",children:t.user_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tasks"}),e.jsx("p",{className:"font-bold text-lg",children:t.task_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Batches"}),e.jsx("p",{className:"font-bold text-lg",children:t.batch_count})]})]})]})]})})}function Xa(){const[t,s]=g.useState(null),[r,a]=g.useState(!0),[o,n]=g.useState(null);g.useEffect(()=>{i()},[]);const i=async()=>{try{a(!0),n(null);const[d,h,x,_,v,f,y,b]=await Promise.all([p.from("users").select("*").then(u=>{const m=u.data||[],N=new Date,w=new Date(N.getTime()-7*24*60*60*1e3),E=new Date(N.getTime()-30*24*60*60*1e3),U=new Date(N.getTime()-24*60*60*1e3);return{total_users:m.length,students:m.filter(C=>C.role==="user").length,admins:m.filter(C=>C.role==="admin").length,section_admins:m.filter(C=>C.role==="section_admin").length,super_admins:m.filter(C=>C.role==="super-admin").length,new_users_week:m.filter(C=>new Date(C.created_at)>w).length,new_users_month:m.filter(C=>new Date(C.created_at)>E).length,active_today:m.filter(C=>C.last_active&&new Date(C.last_active)>U).length,active_week:m.filter(C=>C.last_active&&new Date(C.last_active)>w).length}}),p.from("tasks").select("*").then(u=>{const m=u.data||[],N=new Date,w=new Date(N.getTime()-7*24*60*60*1e3),E=new Date(N.getTime()-30*24*60*60*1e3),U=N.toISOString().split("T")[0];return{total_tasks:m.length,completed_tasks:m.filter(C=>C.status==="completed").length,in_progress_tasks:m.filter(C=>C.status==="in-progress").length,pending_tasks:m.filter(C=>C.status==="pending").length,overdue_tasks:m.filter(C=>C.due_date<U&&C.status!=="completed").length,tasks_created_week:m.filter(C=>new Date(C.created_at)>w).length,tasks_created_month:m.filter(C=>new Date(C.created_at)>E).length,urgent_tasks:m.filter(C=>C.priority==="urgent").length,high_priority_tasks:m.filter(C=>C.priority==="high").length}}),Promise.all([p.from("departments").select("*",{count:"exact"}),p.from("batches").select("*",{count:"exact"}),p.from("sections").select("*",{count:"exact"}),p.from("task_assignments").select("*",{count:"exact"}),p.from("activities").select("*",{count:"exact"}),p.from("fcm_tokens").select("*",{count:"exact"}).eq("is_active",!0),p.from("task_templates").select("*",{count:"exact"})]).then(u=>({total_departments:u[0].count||0,total_batches:u[1].count||0,total_sections:u[2].count||0,total_assignments:u[3].count||0,total_activities:u[4].count||0,active_fcm_tokens:u[5].count||0,total_templates:u[6].count||0})),Promise.all([p.from("departments").select("id, name"),p.from("users").select("department_id"),p.from("tasks").select("department_id"),p.from("batches").select("department_id")]).then(([u,m,N,w])=>{const E=u.data||[],U=m.data||[],C=N.data||[],A=w.data||[];return E.map(P=>({department_name:P.name,user_count:U.filter(Y=>Y.department_id===P.id).length,task_count:C.filter(Y=>Y.department_id===P.id).length,batch_count:A.filter(Y=>Y.department_id===P.id).length}))}),p.from("users").select("created_at").gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()).then(u=>{const m=u.data||[],N={};return m.forEach(w=>{const E=w.created_at.split("T")[0];N[E]=(N[E]||0)+1}),Object.entries(N).map(([w,E])=>({date:w,count:E})).sort((w,E)=>E.date.localeCompare(w.date))}),p.from("tasks").select("created_at").gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()).then(u=>{const m=u.data||[],N={};return m.forEach(w=>{const E=w.created_at.split("T")[0];N[E]=(N[E]||0)+1}),Object.entries(N).map(([w,E])=>({date:w,count:E})).sort((w,E)=>E.date.localeCompare(w.date))}),p.from("tasks").select("category").then(u=>{const m=u.data||[],N={};return m.forEach(w=>{w.category&&(N[w.category]=(N[w.category]||0)+1)}),Object.entries(N).map(([w,E])=>({category:w,count:E})).sort((w,E)=>E.count-w.count)}),p.from("activities").select("type").then(u=>{const m=u.data||[],N={};return m.forEach(w=>{w.type&&(N[w.type]=(N[w.type]||0)+1)}),Object.entries(N).map(([w,E])=>({type:w,count:E})).sort((w,E)=>E.count-w.count).slice(0,10)})]);s({totalUsers:d.total_users||0,students:d.students||0,admins:d.admins||0,sectionAdmins:d.section_admins||0,superAdmins:d.super_admins||0,newUsersWeek:d.new_users_week||0,newUsersMonth:d.new_users_month||0,activeToday:d.active_today||0,activeWeek:d.active_week||0,totalTasks:h.total_tasks||0,completedTasks:h.completed_tasks||0,inProgressTasks:h.in_progress_tasks||0,pendingTasks:h.pending_tasks||0,overdueTasks:h.overdue_tasks||0,tasksCreatedWeek:h.tasks_created_week||0,tasksCreatedMonth:h.tasks_created_month||0,urgentTasks:h.urgent_tasks||0,highPriorityTasks:h.high_priority_tasks||0,totalDepartments:x.total_departments||0,totalBatches:x.total_batches||0,totalSections:x.total_sections||0,totalAssignments:x.total_assignments||0,totalActivities:x.total_activities||0,activeFcmTokens:x.active_fcm_tokens||0,totalTemplates:x.total_templates||0,departmentStats:_||[],userGrowth:v||[],taskGrowth:f||[],taskCategories:y||[],activityTypes:b||[]})}catch(d){console.error("Error fetching analytics:",d),n("Failed to load analytics data. Please try again.")}finally{a(!1)}};if(r)return e.jsx("div",{className:"p-6 space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map((d,h)=>e.jsx(Za,{className:"h-32"},h))})});if(o||!t)return e.jsx("div",{className:"p-6",children:e.jsxs(F,{className:"p-8 text-center",children:[e.jsx(Oe,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Analytics"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:o}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:opacity-90",children:"Retry"})]})});const c=t.totalTasks>0?(t.completedTasks/t.totalTasks*100).toFixed(1):"0",l=t.totalUsers>0?(t.activeWeek/t.totalUsers*100).toFixed(1):"0";return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(V,{title:"Total Users",value:t.totalUsers,icon:e.jsx(Se,{className:"w-6 h-6"}),subtitle:`${t.newUsersMonth} new this month`,color:"bg-blue-500"}),e.jsx(V,{title:"Students",value:t.students,icon:e.jsx(Gr,{className:"w-6 h-6"}),subtitle:`${(t.students/t.totalUsers*100).toFixed(1)}% of total`,color:"bg-green-500"}),e.jsx(V,{title:"Active Users (Week)",value:t.activeWeek,icon:e.jsx(ce,{className:"w-6 h-6"}),subtitle:`${l}% engagement rate`,color:"bg-purple-500"}),e.jsx(V,{title:"Active Today",value:t.activeToday,icon:e.jsx(Tr,{className:"w-6 h-6"}),subtitle:`${t.activeWeek} active this week`,color:"bg-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6",children:[e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"User Growth Trend"]}),e.jsx(Mt,{data:t.userGrowth.slice(0,14).reverse(),color:"#3b82f6"}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last 14 days"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["+",t.userGrowth.slice(0,14).reduce((d,h)=>d+h.count,0)," users"]})]})})]}),e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4"}),"User Roles Distribution"]}),e.jsx(De,{label:"Students",value:t.students,max:t.totalUsers,color:"bg-green-500"}),e.jsx(De,{label:"Section Admins",value:t.sectionAdmins,max:t.totalUsers,color:"bg-blue-500"}),e.jsx(De,{label:"Admins",value:t.admins,max:t.totalUsers,color:"bg-purple-500"}),e.jsx(De,{label:"Super Admins",value:t.superAdmins,max:t.totalUsers,color:"bg-red-500"})]}),e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Growth Summary"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Users (Week)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["+",t.newUsersWeek]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Users (Month)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["+",t.newUsersMonth]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Engagement Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[l,"%"]})]})]})]}),e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Active Users"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Active Today"}),e.jsx("p",{className:"text-4xl font-bold text-blue-600",children:t.activeToday}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(t.activeToday/t.totalUsers*100).toFixed(1),"% of total"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"text-lg font-bold text-purple-600",children:t.activeWeek})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Engagement"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[l,"%"]})]})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vt,{className:"w-5 h-5 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Task Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(V,{title:"Total Tasks",value:t.totalTasks,icon:e.jsx(Ie,{className:"w-6 h-6"}),subtitle:`${t.tasksCreatedMonth} created this month`,color:"bg-indigo-500"}),e.jsx(V,{title:"Completed",value:t.completedTasks,icon:e.jsx(vt,{className:"w-6 h-6"}),subtitle:`${c}% completion rate`,color:"bg-green-500"}),e.jsx(V,{title:"In Progress",value:t.inProgressTasks,icon:e.jsx(ot,{className:"w-6 h-6"}),subtitle:`${t.pendingTasks} pending`,color:"bg-yellow-500"}),e.jsx(V,{title:"Overdue",value:t.overdueTasks,icon:e.jsx(Oe,{className:"w-6 h-6"}),subtitle:`${t.urgentTasks} urgent tasks`,color:"bg-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(qr,{className:"w-4 h-4"}),"Task Status Overview"]}),e.jsx(Ja,{data:[{label:"Completed",value:t.completedTasks,color:"#22c55e"},{label:"In Progress",value:t.inProgressTasks,color:"#eab308"},{label:"Pending",value:t.pendingTasks,color:"#3b82f6"},{label:"Overdue",value:t.overdueTasks,color:"#ef4444"}]})]}),e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Task Creation Trend"]}),e.jsx(Mt,{data:t.taskGrowth.slice(0,14).reverse(),color:"#22c55e"}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last 14 days"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",t.taskGrowth.slice(0,14).reduce((d,h)=>d+h.count,0)," tasks"]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ur,{className:"w-4 h-4"}),"Task Categories"]}),e.jsx(ze,{data:t.taskCategories.slice(0,5).map(d=>({label:d.category.replace("-"," ").replace(/\b\w/g,h=>h.toUpperCase()),value:d.count})),color:"#6366f1"})]}),e.jsxs(F,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4"}),"Priority Distribution"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:"Urgent"})]}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:t.urgentTasks})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"High Priority"})]}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:t.highPriorityTasks})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Overdue"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:t.overdueTasks})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"w-5 h-5 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"System Overview"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(V,{title:"Departments",value:t.totalDepartments,icon:e.jsx(at,{className:"w-5 h-5"}),color:"bg-purple-500"}),e.jsx(V,{title:"Batches",value:t.totalBatches,icon:e.jsx(_e,{className:"w-5 h-5"}),color:"bg-blue-500"}),e.jsx(V,{title:"Sections",value:t.totalSections,icon:e.jsx(_e,{className:"w-5 h-5"}),color:"bg-indigo-500"}),e.jsx(V,{title:"Assignments",value:t.totalAssignments,icon:e.jsx(Ie,{className:"w-5 h-5"}),color:"bg-green-500"}),e.jsx(V,{title:"Activities",value:t.totalActivities,icon:e.jsx(ce,{className:"w-5 h-5"}),color:"bg-orange-500"}),e.jsx(V,{title:"FCM Tokens",value:t.activeFcmTokens,icon:e.jsx(Bt,{className:"w-5 h-5"}),color:"bg-red-500"}),e.jsx(V,{title:"Templates",value:t.totalTemplates,icon:e.jsx(Ie,{className:"w-5 h-5"}),color:"bg-teal-500"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(at,{className:"w-5 h-5 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Department Distribution"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t.departmentStats.map((d,h)=>e.jsx(Ka,{dept:d},h))}),e.jsxs(F,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-6",children:"Department Comparison"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Users by Department"}),e.jsx(ze,{data:t.departmentStats.map(d=>({label:d.department_name.split(" ")[0],value:d.user_count})),color:"#a855f7"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Tasks by Department"}),e.jsx(ze,{data:t.departmentStats.map(d=>({label:d.department_name.split(" ")[0],value:d.task_count})),color:"#3b82f6"})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"System Activity"})]}),e.jsxs(F,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Activity Breakdown"}),e.jsx(ze,{data:t.activityTypes.map(d=>({label:d.type.replace("_"," ").replace(/\b\w/g,h=>h.toUpperCase()),value:d.count})),color:"#f97316"})]})]})]})}function Qa(){return e.jsx(Ya,{})}function eo(){return e.jsx(Xa,{})}function to(){const[t,s]=g.useState([]),[r,a]=g.useState(!0);return g.useEffect(()=>{(async()=>{try{a(!0);const{data:n}=await p.from("activities").select("*").order("created_at",{ascending:!1}).limit(100);if(n){const i=n.map(c=>({id:c.id,timestamp:c.created_at,adminId:c.user_id||"",adminName:"Admin",action:c.type,target:c.title,details:{description:c.title,metadata:c.metadata},ipAddress:"0.0.0.0",userAgent:"N/A",status:"success"}));s(i)}}catch(n){console.error("Error fetching logs:",n)}finally{a(!1)}})()},[]),e.jsx(Ca,{logs:t,loading:r})}function ro(){const{admins:t,resetPassword:s}=ft();return e.jsx(Aa,{admins:t,onResetPassword:s})}function Zo(){var E;const t=pr(),s=fr(),[r,a]=g.useState("overview"),[o,n]=g.useState(!1),[i,c]=g.useState(!1),[l,d]=g.useState(!1),[h,x]=g.useState(!1),{isDark:_,toggle:v}=kr(),{logout:f,user:y}=Wr(),{refreshAdmins:b}=ft(),u=async()=>{if(!h)try{x(!0),await f(),t("/auth",{replace:!0})}catch(U){console.error("Logout failed:",U),x(!1)}};g.useEffect(()=>{const U=s.pathname,A={"/superadmin/dashboard":"overview","/superadmin/overview":"overview","/superadmin/admins":"admins","/superadmin/sectionadmins":"section-admins","/superadmin/analytics":"analytics","/superadmin/logs":"logs","/superadmin/security":"security"}[U]||"overview";a(A)},[s.pathname]);const m=U=>{a(U),t({overview:"/superadmin/dashboard",admins:"/superadmin/admins","section-admins":"/superadmin/sectionadmins",analytics:"/superadmin/analytics",logs:"/superadmin/logs",security:"/superadmin/security"}[U]||"/superadmin/dashboard",{replace:!0})};g.useEffect(()=>{const U=()=>{const C=window.innerWidth<1024;d(C),!C&&i&&c(!1)};return U(),window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U)}},[i]),g.useEffect(()=>{localStorage.setItem("is_super_admin","true"),sessionStorage.setItem("is_super_admin","true"),b()},[b]);const N=()=>{switch(r){case"overview":return e.jsx(Tt,{});case"admins":return e.jsx(Sa,{});case"section-admins":return e.jsx(Qa,{});case"analytics":return e.jsx(eo,{});case"logs":return e.jsx(to,{});case"security":return e.jsx(ro,{});default:return e.jsx(Tt,{})}},w=()=>({overview:"Dashboard Overview",admins:"Admin Management","section-admins":"Section Admin Management",analytics:"Analytics & Reports",logs:"System Logs",security:"Security Settings"})[r]||"Dashboard";return e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-950",children:[e.jsx(Ls,{activeTab:r,onTabChange:m,isCollapsed:o,onToggleCollapse:()=>n(!o),isMobile:l,isOpen:i,onClose:()=>c(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-6 py-4 h-16",children:e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c(!0),className:"lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(vr,{className:"w-5 h-5"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white",children:w()})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg relative",children:[e.jsx(Bt,{className:"w-5 h-5"}),e.jsx(O,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:"3"})]}),e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:_?e.jsx(Nr,{className:"w-5 h-5"}):e.jsx(_r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 pl-2 border-l border-gray-200 dark:border-gray-800",children:[e.jsx(ye,{className:"h-8 w-8",children:e.jsx(we,{className:"bg-blue-600 text-white text-sm",children:((E=y==null?void 0:y.name)==null?void 0:E.charAt(0).toUpperCase())||"SA"})}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(y==null?void 0:y.name)||"Super Admin"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:y==null?void 0:y.email})]})]}),e.jsxs(D,{variant:"ghost",size:"sm",onClick:u,disabled:h,className:"gap-2",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:h?"Logging out...":"Logout"})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-[1600px] mx-auto",children:N()})})]})]})}export{Zo as SuperAdminDashboard};
