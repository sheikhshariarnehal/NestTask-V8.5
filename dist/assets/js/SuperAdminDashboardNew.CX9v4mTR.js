import{j as e,r as t,s as r,k as s,u as a,a as o}from"./index.D5HgYyae.js";import{c as n}from"./clsx.BeLtu-UY.js";import{X as l}from"./x.T9mnuWR1.js";import{C as i}from"./chevron-right.JIwecHqT.js";import{C as d}from"./chevron-left.CO2Nxt1C.js";import{L as c,M as m}from"./menu.B5txSKpe.js";import{S as u}from"./shield.CSb0c9ko.js";import{U as g}from"./users.28Zp3XK7.js";import{A as h}from"./activity.CSZ2mtPY.js";import{F as x}from"./file-text.DSlNaGRz.js";import{S as p,u as f,a as b,M as y,L as v}from"./sun.CFYYIamz.js";import{C as j}from"./check-circle.DuWWpmyy.js";import{D as w,K as k,C as N,A as _,a as C,U as S,c as A,Z as E,T as U,B as T,b as D,d as F}from"./zap.CcnCRWdh.js";import{L as $}from"./layers.MUiHaUeA.js";import{T as z}from"./trending-up.DFRrbU6r.js";import{a as M,s as R}from"./notifications.DvTNppm3.js";import{R as P}from"./refresh-cw.CHATMbGT.js";import{P as I}from"./plus.D47O1wvq.js";import{S as L}from"./search.CIutKDVd.js";import{D as O}from"./download.RjYYxeRK.js";import{S as q}from"./square-pen.e7_N1_7j.js";import{M as G}from"./more-vertical.Dkzju8j8.js";import{F as W}from"./filter.CkQ8bkvn.js";import{C as B}from"./clock.B25PmJRC.js";import{U as V}from"./user.DbKNDHVL.js";import{E as H}from"./eye-off.CYtMKpZm.js";import{E as Y}from"./eye.CdqVfnmX.js";import{C as Z,S as J}from"./shield-check.C02qF5Pg.js";import{C as K}from"./copy.rgpm29wr.js";import{A as X}from"./alert-triangle.B1rn70lZ.js";import{C as Q}from"./calendar.DuEmmdvM.js";import{A as ee}from"./alert-circle.CQKj6s3K.js";import{M as te}from"./mail.DyYt0WgS.js";import{P as re}from"./phone.B8CUNdut.js";import{P as se}from"./pen.vWE_zFfb.js";import{T as ae}from"./trash-2.BqyRYTpe.js";import{U as oe}from"./user-check.zl2VTnz7.js";import{C as ne}from"./check-circle-2.FY7KOIHK.js";import{P as le}from"./pie-chart.Dee9iVrP.js";import{B as ie}from"./bell.C4ePAYHp.js";import{u as de}from"./useAuth.5IUqOc8a.js";import"./createLucideIcon.CgqYSU6F.js";import"./dataCache.jSzv44up.js";import"./authErrors.BDay5vyW.js";const ce=(e=new Map,t=null,r)=>({nextPart:e,validators:t,classGroupId:r}),me="-",ue=[],ge=e=>{const t=pe(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:e=>{if(e.startsWith("[")&&e.endsWith("]"))return xe(e);const r=e.split(me),s=""===r[0]&&r.length>1?1:0;return he(r,s,t)},getConflictingClassGroupIds:(e,t)=>{if(t){const t=s[e],a=r[e];return t?a?((e,t)=>{const r=new Array(e.length+t.length);for(let s=0;s<e.length;s++)r[s]=e[s];for(let s=0;s<t.length;s++)r[e.length+s]=t[s];return r})(a,t):t:a||ue}return r[e]||ue}}},he=(e,t,r)=>{if(0==e.length-t)return r.classGroupId;const s=e[t],a=r.nextPart.get(s);if(a){const r=he(e,t+1,a);if(r)return r}const o=r.validators;if(null===o)return;const n=0===t?e.join(me):e.slice(t).join(me),l=o.length;for(let i=0;i<l;i++){const e=o[i];if(e.validator(n))return e.classGroupId}},xe=e=>-1===e.slice(1,-1).indexOf(":")?void 0:(()=>{const t=e.slice(1,-1),r=t.indexOf(":"),s=t.slice(0,r);return s?"arbitrary.."+s:void 0})(),pe=e=>{const{theme:t,classGroups:r}=e;return fe(r,t)},fe=(e,t)=>{const r=ce();for(const s in e){const a=e[s];be(a,r,s,t)}return r},be=(e,t,r,s)=>{const a=e.length;for(let o=0;o<a;o++){const a=e[o];ye(a,t,r,s)}},ye=(e,t,r,s)=>{"string"!=typeof e?"function"!=typeof e?we(e,t,r,s):je(e,t,r,s):ve(e,t,r)},ve=(e,t,r)=>{(""===e?t:ke(t,e)).classGroupId=r},je=(e,t,r,s)=>{Ne(e)?be(e(s),t,r,s):(null===t.validators&&(t.validators=[]),t.validators.push(((e,t)=>({classGroupId:e,validator:t}))(r,e)))},we=(e,t,r,s)=>{const a=Object.entries(e),o=a.length;for(let n=0;n<o;n++){const[e,o]=a[n];be(o,ke(t,e),r,s)}},ke=(e,t)=>{let r=e;const s=t.split(me),a=s.length;for(let o=0;o<a;o++){const e=s[o];let t=r.nextPart.get(e);t||(t=ce(),r.nextPart.set(e,t)),r=t}return r},Ne=e=>"isThemeGetter"in e&&!0===e.isThemeGetter,_e=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=Object.create(null),s=Object.create(null);const a=(a,o)=>{r[a]=o,t++,t>e&&(t=0,s=r,r=Object.create(null))};return{get(e){let t=r[e];return void 0!==t?t:void 0!==(t=s[e])?(a(e,t),t):void 0},set(e,t){e in r?r[e]=t:a(e,t)}}},Ce=[],Se=(e,t,r,s,a)=>({modifiers:e,hasImportantModifier:t,baseClassName:r,maybePostfixModifierPosition:s,isExternal:a}),Ae=e=>{const{prefix:t,experimentalParseClassName:r}=e;let s=e=>{const t=[];let r,s=0,a=0,o=0;const n=e.length;for(let c=0;c<n;c++){const n=e[c];if(0===s&&0===a){if(":"===n){t.push(e.slice(o,c)),o=c+1;continue}if("/"===n){r=c;continue}}"["===n?s++:"]"===n?s--:"("===n?a++:")"===n&&a--}const l=0===t.length?e:e.slice(o);let i=l,d=!1;return l.endsWith("!")?(i=l.slice(0,-1),d=!0):l.startsWith("!")&&(i=l.slice(1),d=!0),Se(t,d,i,r&&r>o?r-o:void 0)};if(t){const e=t+":",r=s;s=t=>t.startsWith(e)?r(t.slice(e.length)):Se(Ce,!1,t,void 0,!0)}if(r){const e=s;s=t=>r({className:t,parseClassName:e})}return s},Ee=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach(((e,r)=>{t.set(e,1e6+r)})),e=>{const r=[];let s=[];for(let a=0;a<e.length;a++){const o=e[a],n="["===o[0],l=t.has(o);n||l?(s.length>0&&(s.sort(),r.push(...s),s=[]),r.push(o)):s.push(o)}return s.length>0&&(s.sort(),r.push(...s)),r}},Ue=/\s+/,Te=e=>{if("string"==typeof e)return e;let t,r="";for(let s=0;s<e.length;s++)e[s]&&(t=Te(e[s]))&&(r&&(r+=" "),r+=t);return r},De=[],Fe=e=>{const t=t=>t[e]||De;return t.isThemeGetter=!0,t},$e=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ze=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Me=/^\d+\/\d+$/,Re=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ie=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Le=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Oe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,qe=e=>Me.test(e),Ge=e=>!!e&&!Number.isNaN(Number(e)),We=e=>!!e&&Number.isInteger(Number(e)),Be=e=>e.endsWith("%")&&Ge(e.slice(0,-1)),Ve=e=>Re.test(e),He=()=>!0,Ye=e=>Pe.test(e)&&!Ie.test(e),Ze=()=>!1,Je=e=>Le.test(e),Ke=e=>Oe.test(e),Xe=e=>!et(e)&&!nt(e),Qe=e=>gt(e,ft,Ze),et=e=>$e.test(e),tt=e=>gt(e,bt,Ye),rt=e=>gt(e,yt,Ge),st=e=>gt(e,xt,Ze),at=e=>gt(e,pt,Ke),ot=e=>gt(e,jt,Je),nt=e=>ze.test(e),lt=e=>ht(e,bt),it=e=>ht(e,vt),dt=e=>ht(e,xt),ct=e=>ht(e,ft),mt=e=>ht(e,pt),ut=e=>ht(e,jt,!0),gt=(e,t,r)=>{const s=$e.exec(e);return!!s&&(s[1]?t(s[1]):r(s[2]))},ht=(e,t,r=!1)=>{const s=ze.exec(e);return!!s&&(s[1]?t(s[1]):r)},xt=e=>"position"===e||"percentage"===e,pt=e=>"image"===e||"url"===e,ft=e=>"length"===e||"size"===e||"bg-size"===e,bt=e=>"length"===e,yt=e=>"number"===e,vt=e=>"family-name"===e,jt=e=>"shadow"===e,wt=((e,...t)=>{let r,s,a,o;const n=e=>{const t=s(e);if(t)return t;const o=((e,t)=>{const{parseClassName:r,getClassGroupId:s,getConflictingClassGroupIds:a,sortModifiers:o}=t,n=[],l=e.trim().split(Ue);let i="";for(let d=l.length-1;d>=0;d-=1){const e=l[d],{isExternal:t,modifiers:c,hasImportantModifier:m,baseClassName:u,maybePostfixModifierPosition:g}=r(e);if(t){i=e+(i.length>0?" "+i:i);continue}let h=!!g,x=s(h?u.substring(0,g):u);if(!x){if(!h){i=e+(i.length>0?" "+i:i);continue}if(x=s(u),!x){i=e+(i.length>0?" "+i:i);continue}h=!1}const p=0===c.length?"":1===c.length?c[0]:o(c).join(":"),f=m?p+"!":p,b=f+x;if(n.indexOf(b)>-1)continue;n.push(b);const y=a(x,h);for(let r=0;r<y.length;++r){const e=y[r];n.push(f+e)}i=e+(i.length>0?" "+i:i)}return i})(e,r);return a(e,o),o};return o=l=>{const i=t.reduce(((e,t)=>t(e)),e());return r=(e=>({cache:_e(e.cacheSize),parseClassName:Ae(e),sortModifiers:Ee(e),...ge(e)}))(i),s=r.cache.get,a=r.cache.set,o=n,n(l)},(...e)=>o(((...e)=>{let t,r,s=0,a="";for(;s<e.length;)(t=e[s++])&&(r=Te(t))&&(a&&(a+=" "),a+=r);return a})(...e))})((()=>{const e=Fe("color"),t=Fe("font"),r=Fe("text"),s=Fe("font-weight"),a=Fe("tracking"),o=Fe("leading"),n=Fe("breakpoint"),l=Fe("container"),i=Fe("spacing"),d=Fe("radius"),c=Fe("shadow"),m=Fe("inset-shadow"),u=Fe("text-shadow"),g=Fe("drop-shadow"),h=Fe("blur"),x=Fe("perspective"),p=Fe("aspect"),f=Fe("ease"),b=Fe("animate"),y=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",nt,et],v=()=>[nt,et,i],j=()=>[qe,"full","auto",...v()],w=()=>[We,"none","subgrid",nt,et],k=()=>["auto",{span:["full",We,nt,et]},We,nt,et],N=()=>[We,"auto",nt,et],_=()=>["auto","min","max","fr",nt,et],C=()=>["auto",...v()],S=()=>[qe,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...v()],A=()=>[e,nt,et],E=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",dt,st,{position:[nt,et]}],U=()=>["auto","cover","contain",ct,Qe,{size:[nt,et]}],T=()=>[Be,lt,tt],D=()=>["","none","full",d,nt,et],F=()=>["",Ge,lt,tt],$=()=>[Ge,Be,dt,st],z=()=>["","none",h,nt,et],M=()=>["none",Ge,nt,et],R=()=>["none",Ge,nt,et],P=()=>[Ge,nt,et],I=()=>[qe,"full",...v()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ve],breakpoint:[Ve],color:[He],container:[Ve],"drop-shadow":[Ve],ease:["in","out","in-out"],font:[Xe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ve],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ve],shadow:[Ve],spacing:["px",Ge],text:[Ve],"text-shadow":[Ve],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",qe,et,nt,p]}],container:["container"],columns:[{columns:[Ge,et,nt,l]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:y()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[We,"auto",nt,et]}],basis:[{basis:[qe,"full","auto",l,...v()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ge,qe,"auto","initial","none",et]}],grow:[{grow:["",Ge,nt,et]}],shrink:[{shrink:["",Ge,nt,et]}],order:[{order:[We,"first","last","none",nt,et]}],"grid-cols":[{"grid-cols":w()}],"col-start-end":[{col:k()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":w()}],"row-start-end":[{row:k()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":_()}],"auto-rows":[{"auto-rows":_()}],gap:[{gap:v()}],"gap-x":[{"gap-x":v()}],"gap-y":[{"gap-y":v()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:v()}],px:[{px:v()}],py:[{py:v()}],ps:[{ps:v()}],pe:[{pe:v()}],pt:[{pt:v()}],pr:[{pr:v()}],pb:[{pb:v()}],pl:[{pl:v()}],m:[{m:C()}],mx:[{mx:C()}],my:[{my:C()}],ms:[{ms:C()}],me:[{me:C()}],mt:[{mt:C()}],mr:[{mr:C()}],mb:[{mb:C()}],ml:[{ml:C()}],"space-x":[{"space-x":v()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":v()}],"space-y-reverse":["space-y-reverse"],size:[{size:S()}],w:[{w:[l,"screen",...S()]}],"min-w":[{"min-w":[l,"screen","none",...S()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[n]},...S()]}],h:[{h:["screen","lh",...S()]}],"min-h":[{"min-h":["screen","lh","none",...S()]}],"max-h":[{"max-h":["screen","lh",...S()]}],"font-size":[{text:["base",r,lt,tt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,nt,rt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Be,et]}],"font-family":[{font:[it,et,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,nt,et]}],"line-clamp":[{"line-clamp":[Ge,"none",nt,rt]}],leading:[{leading:[o,...v()]}],"list-image":[{"list-image":["none",nt,et]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",nt,et]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:A()}],"text-color":[{text:A()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[Ge,"from-font","auto",nt,tt]}],"text-decoration-color":[{decoration:A()}],"underline-offset":[{"underline-offset":[Ge,"auto",nt,et]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:v()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",nt,et]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",nt,et]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:E()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:U()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},We,nt,et],radial:["",nt,et],conic:[We,nt,et]},mt,at]}],"bg-color":[{bg:A()}],"gradient-from-pos":[{from:T()}],"gradient-via-pos":[{via:T()}],"gradient-to-pos":[{to:T()}],"gradient-from":[{from:A()}],"gradient-via":[{via:A()}],"gradient-to":[{to:A()}],rounded:[{rounded:D()}],"rounded-s":[{"rounded-s":D()}],"rounded-e":[{"rounded-e":D()}],"rounded-t":[{"rounded-t":D()}],"rounded-r":[{"rounded-r":D()}],"rounded-b":[{"rounded-b":D()}],"rounded-l":[{"rounded-l":D()}],"rounded-ss":[{"rounded-ss":D()}],"rounded-se":[{"rounded-se":D()}],"rounded-ee":[{"rounded-ee":D()}],"rounded-es":[{"rounded-es":D()}],"rounded-tl":[{"rounded-tl":D()}],"rounded-tr":[{"rounded-tr":D()}],"rounded-br":[{"rounded-br":D()}],"rounded-bl":[{"rounded-bl":D()}],"border-w":[{border:F()}],"border-w-x":[{"border-x":F()}],"border-w-y":[{"border-y":F()}],"border-w-s":[{"border-s":F()}],"border-w-e":[{"border-e":F()}],"border-w-t":[{"border-t":F()}],"border-w-r":[{"border-r":F()}],"border-w-b":[{"border-b":F()}],"border-w-l":[{"border-l":F()}],"divide-x":[{"divide-x":F()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":F()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:A()}],"border-color-x":[{"border-x":A()}],"border-color-y":[{"border-y":A()}],"border-color-s":[{"border-s":A()}],"border-color-e":[{"border-e":A()}],"border-color-t":[{"border-t":A()}],"border-color-r":[{"border-r":A()}],"border-color-b":[{"border-b":A()}],"border-color-l":[{"border-l":A()}],"divide-color":[{divide:A()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[Ge,nt,et]}],"outline-w":[{outline:["",Ge,lt,tt]}],"outline-color":[{outline:A()}],shadow:[{shadow:["","none",c,ut,ot]}],"shadow-color":[{shadow:A()}],"inset-shadow":[{"inset-shadow":["none",m,ut,ot]}],"inset-shadow-color":[{"inset-shadow":A()}],"ring-w":[{ring:F()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:A()}],"ring-offset-w":[{"ring-offset":[Ge,tt]}],"ring-offset-color":[{"ring-offset":A()}],"inset-ring-w":[{"inset-ring":F()}],"inset-ring-color":[{"inset-ring":A()}],"text-shadow":[{"text-shadow":["none",u,ut,ot]}],"text-shadow-color":[{"text-shadow":A()}],opacity:[{opacity:[Ge,nt,et]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ge]}],"mask-image-linear-from-pos":[{"mask-linear-from":$()}],"mask-image-linear-to-pos":[{"mask-linear-to":$()}],"mask-image-linear-from-color":[{"mask-linear-from":A()}],"mask-image-linear-to-color":[{"mask-linear-to":A()}],"mask-image-t-from-pos":[{"mask-t-from":$()}],"mask-image-t-to-pos":[{"mask-t-to":$()}],"mask-image-t-from-color":[{"mask-t-from":A()}],"mask-image-t-to-color":[{"mask-t-to":A()}],"mask-image-r-from-pos":[{"mask-r-from":$()}],"mask-image-r-to-pos":[{"mask-r-to":$()}],"mask-image-r-from-color":[{"mask-r-from":A()}],"mask-image-r-to-color":[{"mask-r-to":A()}],"mask-image-b-from-pos":[{"mask-b-from":$()}],"mask-image-b-to-pos":[{"mask-b-to":$()}],"mask-image-b-from-color":[{"mask-b-from":A()}],"mask-image-b-to-color":[{"mask-b-to":A()}],"mask-image-l-from-pos":[{"mask-l-from":$()}],"mask-image-l-to-pos":[{"mask-l-to":$()}],"mask-image-l-from-color":[{"mask-l-from":A()}],"mask-image-l-to-color":[{"mask-l-to":A()}],"mask-image-x-from-pos":[{"mask-x-from":$()}],"mask-image-x-to-pos":[{"mask-x-to":$()}],"mask-image-x-from-color":[{"mask-x-from":A()}],"mask-image-x-to-color":[{"mask-x-to":A()}],"mask-image-y-from-pos":[{"mask-y-from":$()}],"mask-image-y-to-pos":[{"mask-y-to":$()}],"mask-image-y-from-color":[{"mask-y-from":A()}],"mask-image-y-to-color":[{"mask-y-to":A()}],"mask-image-radial":[{"mask-radial":[nt,et]}],"mask-image-radial-from-pos":[{"mask-radial-from":$()}],"mask-image-radial-to-pos":[{"mask-radial-to":$()}],"mask-image-radial-from-color":[{"mask-radial-from":A()}],"mask-image-radial-to-color":[{"mask-radial-to":A()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[Ge]}],"mask-image-conic-from-pos":[{"mask-conic-from":$()}],"mask-image-conic-to-pos":[{"mask-conic-to":$()}],"mask-image-conic-from-color":[{"mask-conic-from":A()}],"mask-image-conic-to-color":[{"mask-conic-to":A()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:E()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:U()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",nt,et]}],filter:[{filter:["","none",nt,et]}],blur:[{blur:z()}],brightness:[{brightness:[Ge,nt,et]}],contrast:[{contrast:[Ge,nt,et]}],"drop-shadow":[{"drop-shadow":["","none",g,ut,ot]}],"drop-shadow-color":[{"drop-shadow":A()}],grayscale:[{grayscale:["",Ge,nt,et]}],"hue-rotate":[{"hue-rotate":[Ge,nt,et]}],invert:[{invert:["",Ge,nt,et]}],saturate:[{saturate:[Ge,nt,et]}],sepia:[{sepia:["",Ge,nt,et]}],"backdrop-filter":[{"backdrop-filter":["","none",nt,et]}],"backdrop-blur":[{"backdrop-blur":z()}],"backdrop-brightness":[{"backdrop-brightness":[Ge,nt,et]}],"backdrop-contrast":[{"backdrop-contrast":[Ge,nt,et]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ge,nt,et]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ge,nt,et]}],"backdrop-invert":[{"backdrop-invert":["",Ge,nt,et]}],"backdrop-opacity":[{"backdrop-opacity":[Ge,nt,et]}],"backdrop-saturate":[{"backdrop-saturate":[Ge,nt,et]}],"backdrop-sepia":[{"backdrop-sepia":["",Ge,nt,et]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":v()}],"border-spacing-x":[{"border-spacing-x":v()}],"border-spacing-y":[{"border-spacing-y":v()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",nt,et]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ge,"initial",nt,et]}],ease:[{ease:["linear","initial",f,nt,et]}],delay:[{delay:[Ge,nt,et]}],animate:[{animate:["none",b,nt,et]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[x,nt,et]}],"perspective-origin":[{"perspective-origin":y()}],rotate:[{rotate:M()}],"rotate-x":[{"rotate-x":M()}],"rotate-y":[{"rotate-y":M()}],"rotate-z":[{"rotate-z":M()}],scale:[{scale:R()}],"scale-x":[{"scale-x":R()}],"scale-y":[{"scale-y":R()}],"scale-z":[{"scale-z":R()}],"scale-3d":["scale-3d"],skew:[{skew:P()}],"skew-x":[{"skew-x":P()}],"skew-y":[{"skew-y":P()}],transform:[{transform:[nt,et,"","none","gpu","cpu"]}],"transform-origin":[{origin:y()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:I()}],"translate-x":[{"translate-x":I()}],"translate-y":[{"translate-y":I()}],"translate-z":[{"translate-z":I()}],"translate-none":["translate-none"],accent:[{accent:A()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:A()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",nt,et]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":v()}],"scroll-mx":[{"scroll-mx":v()}],"scroll-my":[{"scroll-my":v()}],"scroll-ms":[{"scroll-ms":v()}],"scroll-me":[{"scroll-me":v()}],"scroll-mt":[{"scroll-mt":v()}],"scroll-mr":[{"scroll-mr":v()}],"scroll-mb":[{"scroll-mb":v()}],"scroll-ml":[{"scroll-ml":v()}],"scroll-p":[{"scroll-p":v()}],"scroll-px":[{"scroll-px":v()}],"scroll-py":[{"scroll-py":v()}],"scroll-ps":[{"scroll-ps":v()}],"scroll-pe":[{"scroll-pe":v()}],"scroll-pt":[{"scroll-pt":v()}],"scroll-pr":[{"scroll-pr":v()}],"scroll-pb":[{"scroll-pb":v()}],"scroll-pl":[{"scroll-pl":v()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",nt,et]}],fill:[{fill:["none",...A()]}],"stroke-w":[{stroke:[Ge,lt,tt,rt]}],stroke:[{stroke:["none",...A()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}}));function kt(...e){return wt(n(e))}const Nt=[{id:"overview",label:"Overview",icon:c},{id:"admins",label:"Admin Management",icon:u},{id:"section-admins",label:"Section Admins",icon:g},{id:"analytics",label:"Analytics",icon:h},{id:"logs",label:"System Logs",icon:x},{id:"security",label:"Security Settings",icon:p}];function _t({activeTab:t,onTabChange:r,isCollapsed:s,onToggleCollapse:a,isMobile:o=!1,isOpen:n=!1,onClose:c}){return o?e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:c}),e.jsxs("div",{className:kt("fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 lg:hidden",n?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(l,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"p-4 space-y-2",children:Nt.map((s=>{const a=s.icon,o=t===s.id;return e.jsxs("button",{onClick:()=>{r(s.id),null==c||c()},className:kt("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",o?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)}))})]})]}):e.jsxs("div",{className:kt("hidden lg:flex flex-col bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transition-all duration-300",s?"w-20":"w-64"),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-800 h-16",children:[!s&&e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Super Admin"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg ml-auto",children:s?e.jsx(i,{className:"w-5 h-5"}):e.jsx(d,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:Nt.map((a=>{const o=a.icon,n=t===a.id;return e.jsxs("button",{onClick:()=>r(a.id),className:kt("w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors",n?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",s&&"justify-center"),title:s?a.label:void 0,children:[e.jsx(o,{className:"w-5 h-5 flex-shrink-0"}),!s&&e.jsx("span",{className:"font-medium",children:a.label})]},a.id)}))})]})}const Ct=t.forwardRef((({className:t,...r},s)=>e.jsx("div",{ref:s,className:kt("rounded-xl border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-900 dark:text-gray-50",t),...r})));Ct.displayName="Card";const St=t.forwardRef((({className:t,...r},s)=>e.jsx("div",{ref:s,className:kt("flex flex-col space-y-1.5 p-6",t),...r})));St.displayName="CardHeader";const At=t.forwardRef((({className:t,...r},s)=>e.jsx("h3",{ref:s,className:kt("font-semibold leading-none tracking-tight",t),...r})));At.displayName="CardTitle";const Et=t.forwardRef((({className:t,...r},s)=>e.jsx("p",{ref:s,className:kt("text-sm text-gray-500 dark:text-gray-400",t),...r})));Et.displayName="CardDescription";const Ut=t.forwardRef((({className:t,...r},s)=>e.jsx("div",{ref:s,className:kt("p-6 pt-0",t),...r})));Ut.displayName="CardContent",t.forwardRef((({className:t,...r},s)=>e.jsx("div",{ref:s,className:kt("flex items-center p-6 pt-0",t),...r}))).displayName="CardFooter";const Tt=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Dt=n,Ft=(e,t)=>r=>{var s;if(null==(null==t?void 0:t.variants))return Dt(e,null==r?void 0:r.class,null==r?void 0:r.className);const{variants:a,defaultVariants:o}=t,n=Object.keys(a).map((e=>{const t=null==r?void 0:r[e],s=null==o?void 0:o[e];if(null===t)return null;const n=Tt(t)||Tt(s);return a[e][n]})),l=r&&Object.entries(r).reduce(((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e}),{}),i=null==t||null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce(((e,t)=>{let{class:r,className:s,...a}=t;return Object.entries(a).every((e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...l}[t]):{...o,...l}[t]===r}))?[...e,r,s]:e}),[]);return Dt(e,n,i,null==r?void 0:r.class,null==r?void 0:r.className)},$t=Ft("inline-flex items-center rounded-md border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",{variants:{variant:{default:"border-transparent bg-gray-900 text-gray-50 shadow hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",secondary:"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",destructive:"border-transparent bg-red-500 text-gray-50 shadow hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",outline:"text-gray-950 dark:text-gray-50",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"}},defaultVariants:{variant:"default"}});function zt({className:t,variant:r,...s}){return e.jsx("div",{className:kt($t({variant:r}),t),...s})}function Mt(){const[s,a]=t.useState(null),[o,n]=t.useState([]),[l,i]=t.useState(!0);t.useEffect((()=>{d()}),[]);const d=async()=>{try{i(!0);const{data:e,error:t}=await r.rpc("get_dashboard_stats",{});if(t){const[e,t,s,o,n,l,i,d]=await Promise.all([r.from("users").select("*",{count:"exact",head:!0}),r.from("users").select("*",{count:"exact",head:!0}).eq("role","admin"),r.from("users").select("*",{count:"exact",head:!0}).eq("role","section_admin"),r.from("tasks").select("*",{count:"exact",head:!0}),r.from("tasks").select("*",{count:"exact",head:!0}).eq("status","completed"),r.from("departments").select("*",{count:"exact",head:!0}),r.from("batches").select("*",{count:"exact",head:!0}),r.from("sections").select("*",{count:"exact",head:!0})]);a({total_users:e.count||0,total_admins:t.count||0,total_section_admins:s.count||0,total_tasks:o.count||0,completed_tasks:n.count||0,total_departments:l.count||0,total_batches:i.count||0,total_sections:d.count||0})}else a(e);const{data:s}=await r.from("activities").select("\n          id,\n          type,\n          title,\n          metadata,\n          created_at,\n          user:users(name, email)\n        ").order("created_at",{ascending:!1}).limit(10);s&&n(s.map((e=>({...e,user:Array.isArray(e.user)?e.user[0]:e.user}))))}catch(e){console.error("Error fetching dashboard data:",e)}finally{i(!1)}},c=s?[{title:"Total Users",value:s.total_users,change:"+12%",icon:g,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{title:"Admins",value:s.total_admins,change:"+3%",icon:u,color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{title:"Section Admins",value:s.total_section_admins,change:"+8%",icon:g,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20"},{title:"Total Tasks",value:s.total_tasks,change:"+24%",icon:j,color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{title:"Completed Tasks",value:s.completed_tasks,change:`${s.total_tasks>0?Math.round(s.completed_tasks/s.total_tasks*100):0}%`,icon:j,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20"},{title:"Departments",value:s.total_departments,change:"",icon:w,color:"text-indigo-600",bgColor:"bg-indigo-50 dark:bg-indigo-900/20"},{title:"Batches",value:s.total_batches,change:"",icon:$,color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/20"},{title:"Sections",value:s.total_sections,change:"",icon:$,color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/20"}]:[];return l?e.jsx("div",{className:"space-y-6 animate-pulse",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map((t=>e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"},t)))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(((t,r)=>{var s;const a=t.icon;return e.jsxs(Ct,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(St,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(At,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(a,{className:`w-5 h-5 ${t.color}`})})]}),e.jsxs(Ut,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Number(null!=(s=t.value)?s:0).toLocaleString()}),t.change&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1 mt-1",children:[e.jsx(z,{className:"w-3 h-3"}),t.change," from last month"]})]})]},r)}))}),e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsxs(At,{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5"}),"Recent Activity"]}),e.jsx(Et,{children:"Latest system activities and updates"})]}),e.jsx(Ut,{children:0===o.length?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:"No recent activities to display"}):e.jsx("div",{className:"space-y-4",children:o.map((t=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-50 dark:bg-blue-900/20",children:e.jsx(h,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.user&&"object"==typeof t.user&&!Array.isArray(t.user)?t.user.name||t.user.email:"System"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(zt,{variant:"secondary",className:"text-xs",children:t.type}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id)))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsxs(At,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Organization Structure"]}),e.jsx(Et,{children:"Hierarchical breakdown"})]}),e.jsx(Ut,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Departments"}),e.jsx(zt,{variant:"info",children:(null==s?void 0:s.total_departments)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Batches"}),e.jsx(zt,{variant:"info",children:(null==s?void 0:s.total_batches)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sections"}),e.jsx(zt,{variant:"info",children:(null==s?void 0:s.total_sections)||0})]})]})})]}),e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsxs(At,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Task Overview"]}),e.jsx(Et,{children:"Current task statistics"})]}),e.jsx(Ut,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Tasks"}),e.jsx(zt,{variant:"info",children:(null==s?void 0:s.total_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completed"}),e.jsx(zt,{variant:"success",children:(null==s?void 0:s.completed_tasks)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pending"}),e.jsx(zt,{variant:"warning",children:((null==s?void 0:s.total_tasks)||0)-((null==s?void 0:s.completed_tasks)||0)})]})]})})]})]})]})}function Rt(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var Pt=Symbol.for("react.lazy"),It=s[" use ".trim().toString()];function Lt(e){return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===Pt&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t;var t}function Ot(r){const s=Gt(r),a=t.forwardRef(((r,a)=>{let{children:o,...n}=r;Lt(o)&&"function"==typeof It&&(o=It(o._payload));const l=t.Children.toArray(o),i=l.find(Bt);if(i){const r=i.props.children,o=l.map((e=>e===i?t.Children.count(r)>1?t.Children.only(null):t.isValidElement(r)?r.props.children:null:e));return e.jsx(s,{...n,ref:a,children:t.isValidElement(r)?t.cloneElement(r,void 0,o):null})}return e.jsx(s,{...n,ref:a,children:o})}));return a.displayName=`${r}.Slot`,a}var qt=Ot("Slot");function Gt(e){const r=t.forwardRef(((e,r)=>{let{children:s,...a}=e;if(Lt(s)&&"function"==typeof It&&(s=It(s._payload)),t.isValidElement(s)){const e=function(e){var t,r;let s=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?e.ref:(s=null==(r=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:r.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?e.props.ref:e.props.ref||e.ref)}(s),o=function(e,t){const r={...t};for(const s in t){const a=e[s],o=t[s];/^on[A-Z]/.test(s)?a&&o?r[s]=(...e)=>{const t=o(...e);return a(...e),t}:a&&(r[s]=a):"style"===s?r[s]={...a,...o}:"className"===s&&(r[s]=[a,o].filter(Boolean).join(" "))}return{...e,...r}}(a,s.props);return s.type!==t.Fragment&&(o.ref=r?function(...e){return t=>{let r=!1;const s=e.map((e=>{const s=Rt(e,t);return r||"function"!=typeof s||(r=!0),s}));if(r)return()=>{for(let t=0;t<s.length;t++){const r=s[t];"function"==typeof r?r():Rt(e[t],null)}}}}(r,e):e),t.cloneElement(s,o)}return t.Children.count(s)>1?t.Children.only(null):null}));return r.displayName=`${e}.SlotClone`,r}var Wt=Symbol("radix.slottable");function Bt(e){return t.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Wt}const Vt=Ft("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:pointer-events-none disabled:opacity-50 dark:focus-visible:ring-gray-300",{variants:{variant:{default:"bg-gray-900 text-gray-50 shadow hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",destructive:"bg-red-500 text-gray-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",outline:"border border-gray-200 bg-white shadow-sm hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",secondary:"bg-gray-100 text-gray-900 shadow-sm hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",link:"text-gray-900 underline-offset-4 hover:underline dark:text-gray-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ht=t.forwardRef((({className:t,variant:r,size:s,asChild:a=!1,...o},n)=>{const l=a?qt:"button";return e.jsx(l,{className:kt(Vt({variant:r,size:s,className:t})),ref:n,...o})}));Ht.displayName="Button";const Yt=t.forwardRef((({className:t,type:r,...s},a)=>e.jsx("input",{type:r,className:kt("flex h-9 w-full rounded-md border border-gray-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",t),ref:a,...s})));Yt.displayName="Input";const Zt=t.forwardRef((({className:t,...r},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:kt("w-full caption-bottom text-sm",t),...r})})));Zt.displayName="Table";const Jt=t.forwardRef((({className:t,...r},s)=>e.jsx("thead",{ref:s,className:kt("[&_tr]:border-b",t),...r})));Jt.displayName="TableHeader";const Kt=t.forwardRef((({className:t,...r},s)=>e.jsx("tbody",{ref:s,className:kt("[&_tr:last-child]:border-0",t),...r})));Kt.displayName="TableBody",t.forwardRef((({className:t,...r},s)=>e.jsx("tfoot",{ref:s,className:kt("border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",t),...r}))).displayName="TableFooter";const Xt=t.forwardRef((({className:t,...r},s)=>e.jsx("tr",{ref:s,className:kt("border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",t),...r})));Xt.displayName="TableRow";const Qt=t.forwardRef((({className:t,...r},s)=>e.jsx("th",{ref:s,className:kt("h-10 px-2 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-gray-400",t),...r})));Qt.displayName="TableHead";const er=t.forwardRef((({className:t,...r},s)=>e.jsx("td",{ref:s,className:kt("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})));function tr(...e){const r=e[0];if(1===e.length)return r;const s=()=>{const s=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const a=s.reduce(((t,{useScope:r,scopeName:s})=>({...t,...r(e)[`__scope${s}`]})),{});return t.useMemo((()=>({[`__scope${r.scopeName}`]:a})),[a])}};return s.scopeName=r.scopeName,s}er.displayName="TableCell",t.forwardRef((({className:t,...r},s)=>e.jsx("caption",{ref:s,className:kt("mt-4 text-sm text-gray-500 dark:text-gray-400",t),...r}))).displayName="TableCaption";var rr=(null==globalThis?void 0:globalThis.document)?t.useLayoutEffect:()=>{},sr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce(((r,s)=>{const a=Ot(`Primitive.${s}`),o=t.forwardRef(((t,r)=>{const{asChild:o,...n}=t,l=o?a:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...n,ref:r})}));return o.displayName=`Primitive.${s}`,{...r,[s]:o}}),{}),ar={exports:{}},or={},nr=t,lr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ir=nr.useState,dr=nr.useEffect,cr=nr.useLayoutEffect,mr=nr.useDebugValue;function ur(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!lr(e,r)}catch(s){return!0}}var gr="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),s=ir({inst:{value:r,getSnapshot:t}}),a=s[0].inst,o=s[1];return cr((function(){a.value=r,a.getSnapshot=t,ur(a)&&o({inst:a})}),[e,r,t]),dr((function(){return ur(a)&&o({inst:a}),e((function(){ur(a)&&o({inst:a})}))}),[e]),mr(r),r};or.useSyncExternalStore=void 0!==nr.useSyncExternalStore?nr.useSyncExternalStore:gr,ar.exports=or;var hr=ar.exports;function xr(){return()=>{}}var pr="Avatar",[fr,br]=function(r,s=[]){let a=[];const o=()=>{const e=a.map((e=>t.createContext(e)));return function(s){const a=(null==s?void 0:s[r])||e;return t.useMemo((()=>({[`__scope${r}`]:{...s,[r]:a}})),[s,a])}};return o.scopeName=r,[function(s,o){const n=t.createContext(o);n.displayName=s+"Context";const l=a.length;a=[...a,o];const i=s=>{var a;const{scope:o,children:i,...d}=s,c=(null==(a=null==o?void 0:o[r])?void 0:a[l])||n,m=t.useMemo((()=>d),Object.values(d));return e.jsx(c.Provider,{value:m,children:i})};return i.displayName=s+"Provider",[i,function(e,a){var i;const d=(null==(i=null==a?void 0:a[r])?void 0:i[l])||n,c=t.useContext(d);if(c)return c;if(void 0!==o)return o;throw new Error(`\`${e}\` must be used within \`${s}\``)}]},tr(o,...s)]}(pr),[yr,vr]=fr(pr),jr=t.forwardRef(((r,s)=>{const{__scopeAvatar:a,...o}=r,[n,l]=t.useState("idle");return e.jsx(yr,{scope:a,imageLoadingStatus:n,onImageLoadingStatusChange:l,children:e.jsx(sr.span,{...o,ref:s})})}));jr.displayName=pr;var wr="AvatarImage",kr=t.forwardRef(((r,s)=>{const{__scopeAvatar:a,src:o,onLoadingStatusChange:n=()=>{},...l}=r,i=vr(wr,a),d=function(e,{referrerPolicy:r,crossOrigin:s}){const a=hr.useSyncExternalStore(xr,(()=>!0),(()=>!1)),o=t.useRef(null),n=a?(o.current||(o.current=new window.Image),o.current):null,[l,i]=t.useState((()=>Cr(n,e)));return rr((()=>{i(Cr(n,e))}),[n,e]),rr((()=>{const e=e=>()=>{i(e)};if(!n)return;const t=e("loaded"),a=e("error");return n.addEventListener("load",t),n.addEventListener("error",a),r&&(n.referrerPolicy=r),"string"==typeof s&&(n.crossOrigin=s),()=>{n.removeEventListener("load",t),n.removeEventListener("error",a)}}),[n,s,r]),l}(o,l),c=function(e){const r=t.useRef(e);return t.useEffect((()=>{r.current=e})),t.useMemo((()=>(...e)=>{var t;return null==(t=r.current)?void 0:t.call(r,...e)}),[])}((e=>{n(e),i.onImageLoadingStatusChange(e)}));return rr((()=>{"idle"!==d&&c(d)}),[d,c]),"loaded"===d?e.jsx(sr.img,{...l,ref:s,src:o}):null}));kr.displayName=wr;var Nr="AvatarFallback",_r=t.forwardRef(((r,s)=>{const{__scopeAvatar:a,delayMs:o,...n}=r,l=vr(Nr,a),[i,d]=t.useState(void 0===o);return t.useEffect((()=>{if(void 0!==o){const e=window.setTimeout((()=>d(!0)),o);return()=>window.clearTimeout(e)}}),[o]),i&&"loaded"!==l.imageLoadingStatus?e.jsx(sr.span,{...n,ref:s}):null}));function Cr(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}_r.displayName=Nr;var Sr=jr,Ar=kr,Er=_r;const Ur=t.forwardRef((({className:t,...r},s)=>e.jsx(Sr,{ref:s,className:kt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})));Ur.displayName=Sr.displayName,t.forwardRef((({className:t,...r},s)=>e.jsx(Ar,{ref:s,className:kt("aspect-square h-full w-full",t),...r}))).displayName=Ar.displayName;const Tr=t.forwardRef((({className:t,...r},s)=>e.jsx(Er,{ref:s,className:kt("flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",t),...r})));async function Dr(e,t,s,a,o){try{const{data:n,error:l}=await r.from("users").select("name").eq("id",e).single();if(l)return void console.error("Error fetching admin name for logging:",l);const{error:i}=await r.from("admin_logs").insert([{admin_id:e,admin_name:(null==n?void 0:n.name)||"Unknown",action:t,details:s,timestamp:(new Date).toISOString(),resource:a,resource_id:o}]);i&&console.error("Error logging admin action:",i)}catch(n){console.error("Error logging admin action:",n)}}function Fr(){const[e,s]=t.useState([]),[a,o]=t.useState(!0),[n,l]=t.useState(null),i=t.useCallback((async()=>{o(!0),l(null);try{const e=await async function(){var e;try{console.log("Fetching admin users...");const{data:{user:t}}=await r.auth.getUser();console.log("Current user:",t),console.log("User metadata:",null==t?void 0:t.user_metadata),console.log("User role:",null==(e=null==t?void 0:t.user_metadata)?void 0:e.role);const{data:s,error:a}=await r.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").order("created_at",{ascending:!1});if(a)throw console.error("Error fetching admin users:",a),new Error(a.message||"Failed to fetch admin users");console.log("User data from database:",s),console.log("Number of users retrieved:",(null==s?void 0:s.length)||0);const{data:o}=await r.from("departments").select("id, name"),{data:n}=await r.from("batches").select("id, name"),{data:l}=await r.from("sections").select("id, name"),i=new Map((null==o?void 0:o.map((e=>[e.id,e.name])))||[]),d=new Map((null==n?void 0:n.map((e=>[e.id,e.name])))||[]),c=new Map((null==l?void 0:l.map((e=>[e.id,e.name])))||[]),m=(null==s?void 0:s.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:i.get(e.department_id)||"",departmentId:e.department_id,batch:d.get(e.batch_id)||"",batchId:e.batch_id,section:c.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[];return console.log("Mapped admin users:",m),console.log("Number of mapped users:",m.length),m}catch(n){throw console.error("Error fetching admin users:",n),new Error(n.message||"Failed to fetch admin users")}}();s(e)}catch(e){console.error("Error fetching admin users:",e),l(e.message||"Failed to fetch admin users")}finally{o(!1)}}),[]);return t.useEffect((()=>{i()}),[i]),{admins:e,loading:a,error:n,createAdmin:async e=>{o(!0),l(null);try{const t=Math.random().toString(36).slice(-8)+Math.random().toString(36).slice(-8).toUpperCase()+"!1",s=await async function(e,t){try{const{data:{user:s}}=await r.auth.getUser();console.log("Current user in createAdminUser:",s),console.log("User metadata:",null==s?void 0:s.user_metadata);const{data:a,error:o}=await r.auth.admin.createUser({email:e.email,password:t,email_confirm:!0,user_metadata:{name:e.username,role:e.role,department:e.department||null}});if(o||!a.user)throw console.error("Error creating auth user:",o),new Error((null==o?void 0:o.message)||"Failed to create admin user");const{data:n,error:l}=await r.from("users").update({permissions:e.permissions,status:e.status,department:e.department}).eq("id",a.user.id).select();if(l)throw console.error("Error updating admin user data:",l),new Error(l.message||"Failed to create admin user");return s?await Dr(s.id,"create_admin",`Created admin user: ${e.email}`):console.log("Skipping log admin action - no user available"),{id:a.user.id,username:e.username,email:e.email,role:e.role,department:e.department,permissions:e.permissions,status:e.status,isActive:"active"===e.status,createdAt:(new Date).toISOString(),phone:e.phone,studentId:e.studentId}}catch(n){throw console.error("Error creating admin user:",n),new Error(n.message||"Failed to create admin user")}}(e,t);return await i(),s}catch(t){throw console.error("Error creating admin user:",t),l(t.message||"Failed to create admin user"),t}finally{o(!1)}},updateAdmin:async(e,t)=>{o(!0),l(null);try{await async function(e,t){try{const{data:{user:s}}=await r.auth.getUser();if(console.log("Current user in updateAdminUser:",s),console.log("User metadata:",null==s?void 0:s.user_metadata),t.email||t.role||t.username){const{error:s}=await r.auth.admin.updateUserById(e,{email:t.email,user_metadata:{name:t.username,role:t.role,department:t.department}});if(s)throw console.error("Error updating auth user:",s),new Error(s.message||"Failed to update admin user")}const a={};t.permissions&&(a.permissions=t.permissions),t.status&&(a.status=t.status),t.department&&(a.department=t.department);const{data:o,error:n}=await r.from("users").update(a).eq("id",e).select();if(n)throw console.error("Error updating admin user data:",n),new Error(n.message||"Failed to update admin user");s?await Dr(s.id,"update_admin",`Updated admin user: ${e}`):console.log("Skipping log admin action - no user available");const l=null==o?void 0:o[0];return{id:l.id,username:l.name||"",email:l.email||"",role:l.role||"admin",department:l.department,permissions:l.permissions||[],status:l.status||"active",isActive:"active"===l.status,lastLogin:l.last_active,createdAt:l.created_at,updatedAt:l.updated_at,phone:l.phone||"",studentId:l.student_id||""}}catch(n){throw console.error("Error updating admin user:",n),new Error(n.message||"Failed to update admin user")}}(e,t),await i()}catch(s){throw console.error("Error updating admin user:",s),l(s.message||"Failed to update admin user"),s}finally{o(!1)}},deleteAdmin:async e=>{o(!0),l(null);try{await async function(e){try{const{data:{user:s}}=await r.auth.getUser();console.log("Current user in deleteAdminUser:",s),console.log("User metadata:",null==s?void 0:s.user_metadata);const{data:a,error:o}=await r.from("users").select("*").eq("id",e).single();if(o)throw console.error("Error fetching admin data for archiving:",o),new Error(o.message||"Failed to delete admin user");try{const{error:t}=await r.from("admin_archives").insert([{admin_id:e,admin_data:a,archived_by:(null==s?void 0:s.id)||"system",archived_at:(new Date).toISOString()}]);t&&console.warn("Error archiving admin data (table might not exist):",t)}catch(t){console.warn("Failed to archive admin, table might not exist:",t)}const{error:n}=await r.auth.admin.deleteUser(e);if(n)throw console.error("Error deleting admin user:",n),new Error(n.message||"Failed to delete admin user");s?await Dr(s.id,"delete_admin",`Deleted admin user: ${e}`):console.log("Skipping log admin action - no user available")}catch(n){throw console.error("Error deleting admin user:",n),new Error(n.message||"Failed to delete admin user")}}(e),await i()}catch(t){throw console.error("Error deleting admin user:",t),l(t.message||"Failed to delete admin user"),t}finally{o(!1)}},resetPassword:async(e,t)=>{o(!0),l(null);try{const s=await async function(e,t){try{const{data:{user:a}}=await r.auth.getUser();console.log("Current user in resetAdminPassword:",a),console.log("User metadata:",null==a?void 0:a.user_metadata);const{error:o}=await r.auth.admin.updateUserById(e,{password:t});if(o)throw console.error("Error resetting admin password:",o),new Error(o.message||"Failed to reset admin password");try{a?await Dr(a.id,"reset_password",`Reset password for admin: ${e}`):console.log("Skipping log admin action - no user available")}catch(s){console.error("Error logging password reset action:",s)}return!0}catch(n){throw console.error("Error resetting admin password:",n),new Error(n.message||"Failed to reset admin password")}}(e,t);return await i(),s}catch(s){return console.error("Error resetting admin password:",s),l(s.message||"Failed to reset admin password"),!1}finally{o(!1)}},promoteToAdmin:async e=>{o(!0),l(null);try{await async function(e){var t,s;try{const{data:{user:a}}=await r.auth.getUser();console.log("Current user in promoteUserToAdmin:",a),console.log("User metadata:",null==a?void 0:a.user_metadata),console.log("User role from metadata:",null==(t=null==a?void 0:a.user_metadata)?void 0:t.role);let o="super-admin"===(null==(s=null==a?void 0:a.user_metadata)?void 0:s.role);if(!o){const{data:e,error:t}=await r.from("users").select("role").eq("id",null==a?void 0:a.id).single();!t&&e&&(console.log("User role from database:",e.role),o="super-admin"===e.role)}if(!o)throw console.error("User is not a super-admin:",null==a?void 0:a.id),new Error("Unauthorized: Only super admins can promote users to admin");const{error:n}=await r.from("users").update({role:"admin"}).eq("id",e);if(n)throw console.error("Error updating user role in database:",n),new Error(n.message||"Failed to promote user to admin");console.log("Successfully updated user role in database"),a?await Dr(a.id,"promote_to_admin",`Promoted user ${e} to admin role`):console.warn("Could not log admin action - user is null"),console.log("Successfully promoted user to admin role - user will need to log out and log back in for changes to take effect")}catch(n){throw console.error("Error promoting user to admin:",n),new Error(n.message||"Failed to promote user to admin")}}(e),await i()}catch(t){throw console.error("Error promoting user to admin:",t),l(t.message||"Failed to promote user to admin"),t}finally{o(!1)}},promoteToSectionAdmin:async t=>{o(!0),l(null);try{console.log(`Attempting to promote user ${t} to section admin`);const s=e.find((e=>e.id===t));if(!s)throw new Error("User not found");if(!s.sectionId)throw new Error("User does not have a section assigned. Please assign a section first.");await async function(e){try{console.log("Promoting user to section admin via database function:",e);const{data:t,error:s}=await r.rpc("promote_user_to_section_admin",{input_user_id:e});if(s)throw console.error("Error updating user role in database:",s),new Error(s.message||"Failed to promote user to section admin");console.log("Successfully updated user role to section_admin:",t)}catch(n){throw console.error("Error promoting user to section admin:",n),new Error(n.message||"Failed to promote user to section admin")}}(t),console.log(`Successfully promoted user ${t} to section admin`),await i()}catch(s){throw console.error("Error promoting user to section admin:",s),l(s.message||"Failed to promote user to section admin"),s}finally{o(!1)}},demoteUser:async t=>{o(!0),l(null);try{console.log(`Attempting to demote user ${t}`);const s=e.find((e=>e.id===t));if(!s)throw new Error("User not found");if("super-admin"===s.role)throw new Error("Super admins cannot be demoted through this interface");await async function(e){try{console.log("Demoting user via database function:",e);const{data:t,error:s}=await r.rpc("demote_user_to_regular",{user_id:e});if(s)throw console.error("Error updating user role in database:",s),new Error(s.message||"Failed to demote user");console.log("Successfully demoted user:",t)}catch(n){throw console.error("Error demoting user:",n),new Error(n.message||"Failed to demote user")}}(t),console.log(`Successfully demoted user ${t}`),await i()}catch(s){throw console.error("Error demoting user:",s),l(s.message||"Failed to demote user"),s}finally{o(!1)}},getSectionUsers:async e=>{o(!0),l(null);try{const t=await async function(e){try{console.log("------- FETCH SECTION USERS SERVICE -------"),console.log("Fetching section users for section ID:",e);const{data:{user:t}}=await r.auth.getUser();if(console.log("Current user:",null==t?void 0:t.id,null==t?void 0:t.email),!e)throw console.error("No section ID provided"),new Error("No section ID provided");const{data:s,error:a}=await r.from("sections").select("id, name, batch_id").eq("id",e).single();a?(console.error("Error fetching section:",a),console.log("Section may not exist with ID:",e)):console.log("Found section:",s),console.log("Running query to fetch users with section_id =",e);const{data:o,error:n}=await r.from("users").select("id, email, name, role, phone, student_id, last_active, created_at, department_id, batch_id, section_id").eq("section_id",e).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching section users:",n),new Error(n.message||"Failed to fetch section users");console.log("Raw section user data from database:",o),console.log("Number of section users retrieved:",(null==o?void 0:o.length)||0);const{data:l}=await r.from("departments").select("id, name"),{data:i}=await r.from("batches").select("id, name"),{data:d}=await r.from("sections").select("id, name");console.log("Departments:",l),console.log("Batches:",i),console.log("Sections:",d);const c=new Map((null==l?void 0:l.map((e=>[e.id,e.name])))||[]),m=new Map((null==i?void 0:i.map((e=>[e.id,e.name])))||[]),u=new Map((null==d?void 0:d.map((e=>[e.id,e.name])))||[]),g=(null==o?void 0:o.map((e=>({id:e.id,username:e.name||"",email:e.email||"",role:e.role||"user",department:c.get(e.department_id)||"",departmentId:e.department_id,batch:m.get(e.batch_id)||"",batchId:e.batch_id,section:u.get(e.section_id)||"",sectionId:e.section_id,permissions:[],status:"active",isActive:!0,lastLogin:e.last_active,createdAt:e.created_at,phone:e.phone||"",studentId:e.student_id||""}))))||[];if(console.log("Mapped section users:",g),0===g.length){console.log("No users found for section ID:",e);const{data:t,error:s}=await r.from("users").select("id, email, section_id").not("section_id","is",null).limit(5);s?console.error("Error checking for any users with sections:",s):(console.log("Users with any section assignment:",t),0===t.length&&console.log("No users have any section assignment in the database"))}return g}catch(n){throw console.error("Error fetching section users:",n),new Error(n.message||"Failed to fetch section users")}}(e);return console.log("getSectionUsers result:",t),t}catch(t){throw console.error("Error fetching section users:",t),l(t.message||"Failed to fetch section users"),t}finally{o(!1)}},getSections:async(e,t)=>{o(!0),l(null);try{const s=await async function(e,t){try{let s=r.from("sections").select("id, name, batch_id");e&&(s=s.eq("batch_id",e));const{data:a,error:o}=await s.order("name");if(o)throw console.error("Error fetching sections:",o),new Error(o.message||"Failed to fetch sections");if(t&&!e){const{data:e,error:s}=await r.from("batches").select("id").eq("department_id",t);if(s)throw console.error("Error fetching batches:",s),new Error(s.message||"Failed to fetch batches");const o=e.map((e=>e.id));return a.filter((e=>o.includes(e.batch_id)))}return a||[]}catch(n){throw console.error("Error fetching sections:",n),new Error(n.message||"Failed to fetch sections")}}(e,t);return s}catch(s){throw console.error("Error fetching sections:",s),l(s.message||"Failed to fetch sections"),s}finally{o(!1)}},refreshAdmins:i}}function $r(){const[r,s]=t.useState(""),[a,o]=t.useState("all"),[n,l]=t.useState("all"),{admins:i,loading:d,error:c,refreshAdmins:m}=Fr(),g=i.filter((e=>{var t,s,o;const l=(null==(t=e.username)?void 0:t.toLowerCase().includes(r.toLowerCase()))||(null==(s=e.email)?void 0:s.toLowerCase().includes(r.toLowerCase()))||(null==(o=e.department)?void 0:o.toLowerCase().includes(r.toLowerCase())),i="all"===a||e.role===a,d="all"===n||("active"===n?e.isActive:!e.isActive);return l&&i&&d})),h=t=>{switch(t){case"super-admin":return e.jsx(zt,{variant:"destructive",children:"Super Admin"});case"admin":return e.jsx(zt,{variant:"info",children:"Admin"});case"section_admin":return e.jsx(zt,{variant:"warning",children:"Section Admin"});default:return e.jsx(zt,{variant:"secondary",children:"User"})}};return d&&0===i.length?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-800 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-800 rounded-xl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ct,{children:[e.jsx(St,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(At,{className:"text-2xl",children:"Admin Management"}),e.jsx(Et,{children:"Manage system administrators and their permissions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ht,{variant:"outline",size:"sm",onClick:async()=>{try{await m(),M("Admins refreshed successfully")}catch(e){R("Failed to refresh admins")}},disabled:d,children:[e.jsx(P,{className:"w-4 h-4 mr-2 "+(d?"animate-spin":"")}),"Refresh"]}),e.jsxs(Ht,{size:"sm",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Admin"]})]})]})}),e.jsx(Ut,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Yt,{placeholder:"Search by name, email, or department...",value:r,onChange:e=>s(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:a,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"user",children:"User"})]}),e.jsxs("select",{value:n,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs(Ht,{variant:"outline",size:"sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Ct,{children:e.jsxs(St,{className:"pb-2",children:[e.jsx(Et,{children:"Total Admins"}),e.jsx(At,{className:"text-3xl",children:i.length})]})}),e.jsx(Ct,{children:e.jsxs(St,{className:"pb-2",children:[e.jsx(Et,{children:"Active"}),e.jsx(At,{className:"text-3xl text-green-600",children:i.filter((e=>e.isActive)).length})]})}),e.jsx(Ct,{children:e.jsxs(St,{className:"pb-2",children:[e.jsx(Et,{children:"Super Admins"}),e.jsx(At,{className:"text-3xl text-purple-600",children:i.filter((e=>"super-admin"===e.role)).length})]})}),e.jsx(Ct,{children:e.jsxs(St,{className:"pb-2",children:[e.jsx(Et,{children:"Section Admins"}),e.jsx(At,{className:"text-3xl text-blue-600",children:i.filter((e=>"section_admin"===e.role)).length})]})})]}),e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsxs(At,{children:["Administrators (",g.length,")"]}),e.jsx(Et,{children:r||"all"!==a||"all"!==n?`Showing ${g.length} of ${i.length} admins`:"All system administrators"})]}),e.jsxs(Ut,{children:[c&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:c}),0===g.length?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No admins found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Zt,{children:[e.jsx(Jt,{children:e.jsxs(Xt,{children:[e.jsx(Qt,{children:"Admin"}),e.jsx(Qt,{children:"Role"}),e.jsx(Qt,{children:"Department"}),e.jsx(Qt,{children:"Status"}),e.jsx(Qt,{children:"Joined"}),e.jsx(Qt,{className:"text-right",children:"Actions"})]})}),e.jsx(Kt,{children:g.map((t=>{var r,s,a;return e.jsxs(Xt,{children:[e.jsx(er,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ur,{className:"h-10 w-10",children:e.jsx(Tr,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:(null==(r=t.username)?void 0:r.charAt(0).toUpperCase())||(null==(s=t.email)?void 0:s.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.username||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.email})]})]})}),e.jsx(er,{children:h(t.role||"user")}),e.jsx(er,{className:"text-gray-600 dark:text-gray-400",children:t.department||"N/A"}),e.jsx(er,{children:(a=t.isActive,a?e.jsx(zt,{variant:"success",children:"Active"}):e.jsx(zt,{variant:"secondary",children:"Inactive"}))}),e.jsx(er,{className:"text-gray-600 dark:text-gray-400",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"}),e.jsx(er,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(Ht,{variant:"ghost",size:"sm",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx(Ht,{variant:"ghost",size:"sm",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsx(Ht,{variant:"ghost",size:"sm",children:e.jsx(G,{className:"w-4 h-4"})})]})})]},t.id)}))})]})})]})]})]})}function zr({logs:r,loading:s}){const[a,o]=t.useState(""),[n,i]=t.useState([]),[d,c]=t.useState("all"),[m,u]=t.useState({from:"",to:""}),[g,h]=t.useState("desc");t.useEffect((()=>{let e=[...r];if(a){const t=a.toLowerCase();e=e.filter((e=>e.adminName.toLowerCase().includes(t)||e.action.toLowerCase().includes(t)||e.details.toLowerCase().includes(t)))}if("all"!==d&&(e=e.filter((e=>e.action===d))),m.from){const t=new Date(m.from);e=e.filter((e=>new Date(e.timestamp)>=t))}if(m.to){const t=new Date(m.to);t.setHours(23,59,59,999),e=e.filter((e=>new Date(e.timestamp)<=t))}e.sort(((e,t)=>{const r=new Date(e.timestamp),s=new Date(t.timestamp);return"desc"===g?+s-+r:+r-+s})),i(e)}),[r,a,d,m,g]);const x=e=>{const{name:t,value:r}=e.target;u((e=>({...e,[t]:r})))},p=e=>{switch(e){case"create_admin":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300";case"update_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300";case"delete_admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300";case"reset_password":return"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-300";case"login":return"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},f=e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(N,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),"Admin Activity Logs"]}),e.jsxs("button",{onClick:()=>{if(0===n.length)return;const e=[["Admin","Action","Details","Timestamp","IP Address"].join(","),...n.map((e=>[`"${e.adminName}"`,`"${e.action}"`,`"${e.details.replace(/"/g,'""')}"`,`"${new Date(e.timestamp).toLocaleString()}"`,`"${e.ipAddress||""}"`].join(",")))].join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),s=document.createElement("a");s.setAttribute("href",r),s.setAttribute("download",`admin-logs-${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},disabled:0===n.length,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-700 bg-indigo-100 border border-transparent rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(O,{className:"h-4 w-4 mr-1.5"}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search logs...",value:a,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"}),e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:d,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white appearance-none",children:["all","create_admin","update_admin","delete_admin","reset_password","login","logout"].map((t=>e.jsx("option",{value:t,children:"all"===t?"All Actions":f(t)},t)))}),e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"from",value:m.from,onChange:x,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"From date"}),e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",name:"to",value:m.to,onChange:x,className:"w-full px-3 py-2 pl-9 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"To date"}),e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-2",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(a||"all"!==d||m.from||m.to)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active filters:"}),a&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Search: ",a,e.jsx(l,{size:14,className:"ml-1 cursor-pointer",onClick:()=>o("")})]}),"all"!==d&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["Action: ",f(d),e.jsx(l,{size:14,className:"ml-1 cursor-pointer",onClick:()=>c("all")})]}),m.from&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["From: ",m.from,e.jsx(l,{size:14,className:"ml-1 cursor-pointer",onClick:()=>u((e=>({...e,from:""})))})]}),m.to&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:["To: ",m.to,e.jsx(l,{size:14,className:"ml-1 cursor-pointer",onClick:()=>u((e=>({...e,to:""})))})]}),e.jsx("button",{onClick:()=>{o(""),c("all"),u({from:"",to:""})},className:"text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"Clear all"})]})}),e.jsxs("button",{onClick:()=>h((e=>"desc"===e?"asc":"desc")),className:"inline-flex items-center px-2 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"desc"===g?e.jsxs(e.Fragment,{children:["Newest first ",e.jsx(_,{className:"h-3 w-3 ml-1"})]}):e.jsxs(e.Fragment,{children:["Oldest first ",e.jsx(C,{className:"h-3 w-3 ml-1"})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-750 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:s?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"}),[...Array(5)].map(((t,r)=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},r)))]})}):0===n.length?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:0===r.length?"No activity logs found in the system.":"No logs match your current filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Admin"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Details"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP Address"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-750 divide-y divide-gray-200 dark:divide-gray-700",children:n.map((t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.adminName}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.adminId.substring(0,8)})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${p(t.action)}`,children:f(t.action)})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:t.details}),t.resource&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Resource: ",t.resource," ",t.resourceId&&`#${t.resourceId.substring(0,8)}`]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.ipAddress||"-"})]},t.id)))})]})})}),!s&&r.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:["Showing ",n.length," of ",r.length," logs"]})]})}function Mr({admins:r,onResetPassword:s}){const[a,o]=t.useState(""),[n,l]=t.useState(""),[i,d]=t.useState(!1),[c,m]=t.useState(!1),[g,h]=t.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:"Security Settings"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage security settings and reset passwords"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Password Reset"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"admin-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select User"}),e.jsxs("select",{id:"admin-select",value:a,onChange:e=>o(e.target.value),className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a user"}),r.filter((e=>"super-admin"!==e.role)).map((t=>e.jsxs("option",{value:t.id,children:[t.username," (",t.email,") - ",t.role]},t.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{id:"password",type:i?"text":"password",value:n,onChange:e=>l(e.target.value),className:"flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Generate a secure password",readOnly:!0}),e.jsx("button",{type:"button",onClick:()=>d(!i),className:"bg-gray-100 dark:bg-gray-600 border-y border-r border-gray-300 dark:border-gray-600 rounded-r-lg px-3",children:i?e.jsx(H,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}):e.jsx(Y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{let e="";e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],e+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],e+="0123456789"[Math.floor(10*Math.random())],e+="!@#$%^&*()_+"[Math.floor(12*Math.random())];for(let t=4;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+"[Math.floor(74*Math.random())];e=e.split("").sort((()=>Math.random()-.5)).join(""),l(e)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate Password"})]}),n&&e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(n).then((()=>{h(!0),setTimeout((()=>h(!1)),2e3)})).catch((e=>{console.error("Failed to copy:",e),R("Failed to copy password to clipboard")}))},className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Copy"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",onClick:async()=>{if(a)if(!n||n.length<8)R("Please generate a secure password");else{m(!0);try{await s(a,n)?(M("Password reset successfully"),o(""),l("")):R("Failed to reset password")}catch(e){R(e.message||"Failed to reset password")}finally{m(!1)}}else R("Please select an admin")},disabled:!a||!n||c,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors disabled:bg-red-300 dark:disabled:bg-red-800/50 disabled:cursor-not-allowed",children:[c?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:"Reset Password"})]})}),a&&n&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg flex items-start gap-2 text-sm",children:[e.jsx(X,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Important:"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"You are about to reset the password for this user. Make sure to share the new password with them securely. They should change their password after logging in."})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Security Policies"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Two-factor Authentication"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Require 2FA for all admin accounts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Password Expiry"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Force password change every 90 days"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Session Timeout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Auto logout after 30 minutes of inactivity"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Failed Login Lockout"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lock account after 5 failed login attempts"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Security Settings"})]})})]})]})}Tr.displayName=Er.displayName;var Rr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce(((r,s)=>{const a=Ot(`Primitive.${s}`),o=t.forwardRef(((t,r)=>{const{asChild:o,...n}=t,l=o?a:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...n,ref:r})}));return o.displayName=`Primitive.${s}`,{...r,[s]:o}}),{}),Pr=t.forwardRef(((t,r)=>e.jsx(Rr.label,{...t,ref:r,onMouseDown:e=>{var r;e.target.closest("button, input, select, textarea")||(null==(r=t.onMouseDown)||r.call(t,e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}})));Pr.displayName="Label";var Ir=Pr;const Lr=Ft("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Or=t.forwardRef((({className:t,...r},s)=>e.jsx(Ir,{ref:s,className:kt(Lr(),t),...r})));Or.displayName=Ir.displayName;const qr=({open:t,onOpenChange:r,children:s})=>t?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>r(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s})]}):null,Gr=t.forwardRef((({className:t,children:r,onClose:s,...a},o)=>e.jsxs("div",{ref:o,className:kt("relative bg-white dark:bg-gray-950 rounded-lg shadow-xl border border-gray-200 dark:border-gray-800 w-full max-w-lg max-h-[90vh] overflow-y-auto",t),onClick:e=>e.stopPropagation(),...a,children:[s&&e.jsxs("button",{onClick:s,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none dark:ring-offset-gray-950 dark:focus:ring-gray-300",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),r]})));Gr.displayName="DialogContent";const Wr=({className:t,...r})=>e.jsx("div",{className:kt("flex flex-col space-y-1.5 p-6 pb-4",t),...r});Wr.displayName="DialogHeader";const Br=({className:t,...r})=>e.jsx("div",{className:kt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-4",t),...r});Br.displayName="DialogFooter";const Vr=t.forwardRef((({className:t,...r},s)=>e.jsx("h2",{ref:s,className:kt("text-lg font-semibold leading-none tracking-tight text-gray-900 dark:text-white",t),...r})));Vr.displayName="DialogTitle";const Hr=t.forwardRef((({className:t,...r},s)=>e.jsx("p",{ref:s,className:kt("text-sm text-gray-500 dark:text-gray-400",t),...r})));Hr.displayName="DialogDescription";const Yr=({className:t,...r})=>e.jsx("div",{className:kt("px-6 py-2",t),...r});async function Zr(){try{const{data:e,error:t}=await r.from("users").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching users:",t),new Error(t.message);return e||[]}catch(e){throw console.error("Error in fetchAllUsers:",e),e}}async function Jr(){try{const{data:e,error:t}=await r.from("departments").select("*").order("name");if(t)throw console.error("Error fetching departments:",t),new Error(t.message);return e||[]}catch(e){throw console.error("Error in fetchDepartments:",e),e}}async function Kr(e){try{let e=r.from("batches").select("*").order("name");const{data:t,error:s}=await e;if(s)throw console.error("Error fetching batches:",s),new Error(s.message);return t||[]}catch(t){throw console.error("Error in fetchBatches:",t),t}}async function Xr(e){try{let e=r.from("sections").select("*").order("name");const{data:t,error:s}=await e;if(s)throw console.error("Error fetching sections:",s),new Error(s.message);return t||[]}catch(t){throw console.error("Error in fetchSections:",t),t}}Yr.displayName="DialogBody";const Qr={"super-admin":{label:"Super Admin",color:"text-red-600 dark:text-red-400",icon:A,badgeVariant:"destructive"},admin:{label:"Admin",color:"text-blue-600 dark:text-blue-400",icon:J,badgeVariant:"info"},section_admin:{label:"Section Admin",color:"text-orange-600 dark:text-orange-400",icon:u,badgeVariant:"warning"},user:{label:"User",color:"text-gray-600 dark:text-gray-400",icon:V,badgeVariant:"secondary"}};function es({open:r,onClose:s,user:a,departments:o,batches:n,sections:l,onSubmit:i,mode:d}){const[c,m]=t.useState({email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""}),[u,g]=t.useState(!1),[h,x]=t.useState([]),[p,f]=t.useState([]);return t.useEffect((()=>{m("edit"===d&&a?{email:a.email||"",password:"",name:a.name||"",role:a.role,phone:a.phone||"",student_id:a.student_id||"",department_id:a.department_id||"",batch_id:a.batch_id||"",section_id:a.section_id||""}:{email:"",password:"",name:"",role:"user",phone:"",student_id:"",department_id:"",batch_id:"",section_id:""})}),[a,d,r]),t.useEffect((()=>{c.department_id?x(n.filter((e=>e.department_id===c.department_id))):x(n)}),[c.department_id,n]),t.useEffect((()=>{c.batch_id?f(l.filter((e=>e.batch_id===c.batch_id))):f(l)}),[c.batch_id,l]),e.jsx(qr,{open:r,onOpenChange:s,children:e.jsxs(Gr,{onClose:s,className:"max-w-2xl",children:[e.jsxs(Wr,{children:[e.jsx(Vr,{children:"create"===d?"Create New User":"Edit User"}),e.jsx(Hr,{children:"create"===d?"Add a new user to the system with specified role and details.":`Update user information for ${(null==a?void 0:a.name)||(null==a?void 0:a.email)}`})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),"create"!==d||c.email&&c.password)if(c.name){g(!0);try{const e="create"===d?c:{name:c.name,role:c.role,phone:c.phone||void 0,student_id:c.student_id||void 0,department_id:c.department_id||void 0,batch_id:c.batch_id||void 0,section_id:c.section_id||void 0};await i(e),s()}catch(t){R(t.message||"Failed to save user")}finally{g(!1)}}else R("Name is required");else R("Email and password are required")},children:[e.jsxs(Yr,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["create"===d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"email",children:"Email *"}),e.jsx(Yt,{id:"email",type:"email",placeholder:"user@example.com",value:c.email,onChange:e=>m((t=>({...t,email:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"password",children:"Password *"}),e.jsx(Yt,{id:"password",type:"password",placeholder:"",value:c.password,onChange:e=>m((t=>({...t,password:e.target.value}))),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"name",children:"Full Name *"}),e.jsx(Yt,{id:"name",placeholder:"John Doe",value:c.name,onChange:e=>m((t=>({...t,name:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"role",children:"Role *"}),e.jsxs("select",{id:"role",value:c.role,onChange:e=>m((t=>({...t,role:e.target.value}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"section_admin",children:"Section Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super-admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"phone",children:"Phone"}),e.jsx(Yt,{id:"phone",placeholder:"+1234567890",value:c.phone,onChange:e=>m((t=>({...t,phone:e.target.value})))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"student_id",children:"Student ID"}),e.jsx(Yt,{id:"student_id",placeholder:"STU-123456",value:c.student_id,onChange:e=>m((t=>({...t,student_id:e.target.value})))})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-4",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"department",children:"Department"}),e.jsxs("select",{id:"department",value:c.department_id,onChange:e=>m((t=>({...t,department_id:e.target.value,batch_id:"",section_id:""}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Department"}),o.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"batch",children:"Batch"}),e.jsxs("select",{id:"batch",value:c.batch_id,onChange:e=>m((t=>({...t,batch_id:e.target.value,section_id:""}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!c.department_id,children:[e.jsx("option",{value:"",children:"Select Batch"}),h.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{htmlFor:"section",children:"Section"}),e.jsxs("select",{id:"section",value:c.section_id,onChange:e=>m((t=>({...t,section_id:e.target.value}))),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",disabled:!c.batch_id,children:[e.jsx("option",{value:"",children:"Select Section"}),p.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]})]})]})]}),e.jsxs(Br,{children:[e.jsx(Ht,{type:"button",variant:"outline",onClick:s,disabled:u,children:"Cancel"}),e.jsx(Ht,{type:"submit",disabled:u,children:u?"Saving...":"create"===d?"Create User":"Update User"})]})]})]})})}function ts({open:r,onClose:s,user:a,sections:o,onRoleChange:n}){var l,i;const[d,c]=t.useState("user"),[m,u]=t.useState(""),[g,h]=t.useState(!1);return t.useEffect((()=>{a&&(c(a.role),u(a.section_id||""))}),[a,r]),a?e.jsx(qr,{open:r,onOpenChange:s,children:e.jsxs(Gr,{onClose:s,children:[e.jsxs(Wr,{children:[e.jsx(Vr,{children:"Change User Role"}),e.jsxs(Hr,{children:["Change the role for ",a.name||a.email]})]}),e.jsxs(Yr,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx(Ur,{className:"h-12 w-12",children:e.jsx(Tr,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 text-lg",children:(null==(l=a.name)?void 0:l.charAt(0).toUpperCase())||(null==(i=a.email)?void 0:i.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email}),e.jsxs(zt,{variant:Qr[a.role].badgeVariant,className:"mt-1",children:["Current: ",Qr[a.role].label]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{children:"New Role"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Qr).map((([t,r])=>{const s=r.icon;return e.jsxs("button",{type:"button",onClick:()=>c(t),className:"flex items-center gap-2 p-3 border rounded-lg transition-all "+(d===t?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-800 hover:border-gray-300"),children:[e.jsx(s,{className:`w-4 h-4 ${r.color}`}),e.jsx("span",{className:"text-sm font-medium",children:r.label})]},t)}))})]}),"section_admin"===d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{children:"Assign to Section *"}),e.jsxs("select",{value:m,onChange:e=>u(e.target.value),className:"w-full h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm",children:[e.jsx("option",{value:"",children:"Select Section"}),o.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]})]}),e.jsxs(Br,{children:[e.jsx(Ht,{variant:"outline",onClick:s,disabled:g,children:"Cancel"}),e.jsx(Ht,{onClick:async()=>{if(a)if("section_admin"!==d||m){h(!0);try{await n(a.id,d,m||void 0),M(`Role changed to ${Qr[d].label}`),s()}catch(e){R(e.message||"Failed to change role")}finally{h(!1)}}else R("Please select a section for section admin")},disabled:g||d===a.role,children:g?"Updating...":"Change Role"})]})]})}):null}function rs({open:r,onClose:s,user:a,onDelete:o}){var n,l;const[i,d]=t.useState(!1),[c,m]=t.useState("");if(t.useEffect((()=>{r||m("")}),[r]),!a)return null;const u="delete"===c.toLowerCase();return e.jsx(qr,{open:r,onOpenChange:s,children:e.jsxs(Gr,{onClose:s,children:[e.jsxs(Wr,{children:[e.jsx(Vr,{className:"text-red-600",children:"Delete User"}),e.jsx(Hr,{children:"This action cannot be undone. This will permanently delete the user account."})]}),e.jsxs(Yr,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx(Ur,{className:"h-12 w-12",children:e.jsx(Tr,{className:"bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 text-lg",children:(null==(n=a.name)?void 0:n.charAt(0).toUpperCase())||(null==(l=a.email)?void 0:l.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email}),e.jsx(zt,{variant:Qr[a.role].badgeVariant,className:"mt-1",children:Qr[a.role].label})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Or,{children:'Type "delete" to confirm'}),e.jsx(Yt,{value:c,onChange:e=>m(e.target.value),placeholder:"delete",className:"border-red-200 dark:border-red-800 focus:border-red-500"})]})]}),e.jsxs(Br,{children:[e.jsx(Ht,{variant:"outline",onClick:s,disabled:i,children:"Cancel"}),e.jsx(Ht,{variant:"destructive",onClick:async()=>{if(a){d(!0);try{await o(a.id),M("User deleted successfully"),s()}catch(e){R(e.message||"Failed to delete user")}finally{d(!1)}}},disabled:i||!u,children:i?"Deleting...":"Delete User"})]})]})})}function ss({onEdit:r,onChangeRole:s,onDelete:a}){const[o,n]=t.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{variant:"ghost",size:"icon",onClick:()=>n(!o),children:e.jsx(G,{className:"w-4 h-4"})}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-48 py-1 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg shadow-lg z-50",children:[e.jsxs("button",{onClick:()=>{r(),n(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Edit User"]}),e.jsxs("button",{onClick:()=>{s(),n(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Change Role"]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-800 my-1"}),e.jsxs("button",{onClick:()=>{a(),n(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Delete User"]})]})]})]})}function as({title:t,value:r,icon:s,color:a,bgColor:o}){return e.jsx(Ct,{children:e.jsx(Ut,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("p",{className:`text-2xl font-bold ${a}`,children:r})]}),e.jsx("div",{className:`p-3 rounded-full ${o}`,children:e.jsx(s,{className:`w-5 h-5 ${a}`})})]})})})}function os(){const[s,a]=t.useState([]),[o,n]=t.useState([]),[l,i]=t.useState([]),[d,c]=t.useState([]),[m,h]=t.useState(!0),[x,p]=t.useState(""),[f,b]=t.useState("all"),[y,v]=t.useState(!1),[j,w]=t.useState(!1),[k,N]=t.useState(!1),[_,C]=t.useState(null),[E,U]=t.useState("create"),T=t.useCallback((async()=>{try{h(!0);const[e,t,r,s]=await Promise.all([Zr(),Jr(),Kr(),Xr()]);a(e),n(t),i(r),c(s)}catch(e){console.error("Error fetching data:",e),R(e.message||"Failed to load data")}finally{h(!1)}}),[]);t.useEffect((()=>{T()}),[T]);const D=t.useMemo((()=>function(e){const t=e.length,r=e.filter((e=>"super-admin"===e.role)).length,s=e.filter((e=>"admin"===e.role)).length,a=e.filter((e=>"section_admin"===e.role)).length,o=e.filter((e=>"user"===e.role)).length,n=new Date;return n.setDate(n.getDate()-7),{totalUsers:t,superAdmins:r,admins:s,sectionAdmins:a,regularUsers:o,activeUsers:e.filter((e=>e.last_active&&new Date(e.last_active)>n)).length,newUsersThisWeek:e.filter((e=>e.created_at&&new Date(e.created_at)>n)).length}}(s)),[s]),F=t.useMemo((()=>{let e=function(e,t){if(!t)return e;const r=t.toLowerCase();return e.filter((e=>{var t,s,a,o;return(null==(t=e.name)?void 0:t.toLowerCase().includes(r))||(null==(s=e.email)?void 0:s.toLowerCase().includes(r))||(null==(a=e.student_id)?void 0:a.toLowerCase().includes(r))||(null==(o=e.phone)?void 0:o.toLowerCase().includes(r))}))}(s,x);return e=function(e,t){return"all"===t?e:e.filter((e=>e.role===t))}(e,f),e}),[s,x,f]),$=e=>{C(e),U("edit"),v(!0)},z=e=>{C(e),w(!0)},I=e=>{C(e),N(!0)},O=e=>{var t;return e&&(null==(t=o.find((t=>t.id===e)))?void 0:t.name)||""},q=e=>{var t;return e&&(null==(t=d.find((t=>t.id===e)))?void 0:t.name)||""};return m?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading users..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Manage all users, roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ht,{variant:"outline",onClick:T,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(Ht,{onClick:()=>{C(null),U("create"),v(!0)},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(as,{title:"Total Users",value:D.totalUsers,icon:g,color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-100 dark:bg-gray-800"}),e.jsx(as,{title:"Super Admins",value:D.superAdmins,icon:A,color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30"}),e.jsx(as,{title:"Admins",value:D.admins,icon:J,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30"}),e.jsx(as,{title:"Section Admins",value:D.sectionAdmins,icon:u,color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900/30"}),e.jsx(as,{title:"Regular Users",value:D.regularUsers,icon:V,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30"}),e.jsx(as,{title:"Active (7d)",value:D.activeUsers,icon:Q,color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-100 dark:bg-purple-900/30"})]}),e.jsx(Ct,{children:e.jsx(Ut,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Yt,{placeholder:"Search by name, email, student ID or phone...",value:x,onChange:e=>p(e.target.value),className:"pl-10"})]}),e.jsxs("select",{value:f,onChange:e=>b(e.target.value),className:"h-9 px-3 border border-gray-200 dark:border-gray-800 rounded-md bg-white dark:bg-gray-950 text-sm min-w-[150px]",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super-admin",children:"Super Admins"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"section_admin",children:"Section Admins"}),e.jsx("option",{value:"user",children:"Users"})]})]})})}),e.jsxs(Ct,{children:[e.jsx(St,{children:e.jsx(At,{className:"flex items-center justify-between",children:e.jsxs("span",{children:["Users (",F.length,")"]})})}),e.jsx(Ut,{children:0===F.length?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Zt,{children:[e.jsx(Jt,{children:e.jsxs(Xt,{children:[e.jsx(Qt,{children:"User"}),e.jsx(Qt,{children:"Role"}),e.jsx(Qt,{className:"hidden lg:table-cell",children:"Department"}),e.jsx(Qt,{className:"hidden md:table-cell",children:"Section"}),e.jsx(Qt,{className:"hidden lg:table-cell",children:"Joined"}),e.jsx(Qt,{className:"text-right",children:"Actions"})]})}),e.jsx(Kt,{children:F.map((t=>{var r,s,a,o,n,l;const i=(null==(r=Qr[t.role])?void 0:r.icon)||V;return e.jsxs(Xt,{children:[e.jsx(er,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ur,{className:"h-10 w-10",children:e.jsx(Tr,{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400",children:(null==(s=t.name)?void 0:s.charAt(0).toUpperCase())||(null==(a=t.email)?void 0:a.charAt(0).toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.name||""}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),t.email]}),t.phone&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),t.phone]})]})]})}),e.jsx(er,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:`w-4 h-4 ${(null==(o=Qr[t.role])?void 0:o.color)||""}`}),e.jsx(zt,{variant:(null==(n=Qr[t.role])?void 0:n.badgeVariant)||"secondary",children:(null==(l=Qr[t.role])?void 0:l.label)||t.role})]})}),e.jsx(er,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:O(t.department_id)}),e.jsx(er,{className:"hidden md:table-cell text-gray-600 dark:text-gray-400",children:q(t.section_id)}),e.jsx(er,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400",children:t.created_at?new Date(t.created_at).toLocaleDateString():""}),e.jsx(er,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(Ht,{variant:"ghost",size:"sm",onClick:()=>z(t),className:"hidden sm:inline-flex",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"Role"]}),e.jsx(Ht,{variant:"ghost",size:"sm",onClick:()=>$(t),className:"hidden sm:inline-flex",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx(Ht,{variant:"ghost",size:"sm",onClick:()=>I(t),className:"hidden sm:inline-flex text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(ss,{user:t,onEdit:()=>$(t),onChangeRole:()=>z(t),onDelete:()=>I(t)})})]})})]},t.id)}))})]})})})]}),e.jsx(es,{open:y,onClose:()=>v(!1),user:_,departments:o,batches:l,sections:d,onSubmit:"create"===E?async e=>{await async function(e){try{const{data:t}=await r.auth.getUser();if(!t.user)throw new Error("You must be logged in to create users");const{data:s,error:a}=await r.auth.signUp({email:e.email,password:e.password,options:{data:{name:e.name,role:e.role}}});if(a)throw console.error("Error creating auth user:",a),new Error(a.message);if(!s.user)throw new Error("Failed to create user account");const{data:o,error:n}=await r.from("users").upsert({id:s.user.id,email:e.email,name:e.name,role:e.role,phone:e.phone||null,student_id:e.student_id||null,department_id:e.department_id||null,batch_id:e.batch_id||null,section_id:e.section_id||null}).select().single();if(n)throw console.error("Error updating user record:",n),new Error(n.message);return await r.from("activities").insert({type:"user_created",title:`New user created: ${e.name}`,user_id:t.user.id,metadata:{target_user_id:s.user.id,email:e.email,role:e.role}}),o}catch(t){throw console.error("Error in createUser:",t),t}}(e),M("User created successfully"),await T()}:async e=>{_&&(await async function(e,t){try{const{data:s}=await r.auth.getUser();if(!s.user)throw new Error("You must be logged in to update users");const{data:a}=await r.from("users").select("*").eq("id",e).single(),{data:o,error:n}=await r.from("users").update({name:t.name,role:t.role,phone:t.phone,student_id:t.student_id,department_id:t.department_id,batch_id:t.batch_id,section_id:t.section_id}).eq("id",e).select().single();if(n)throw console.error("Error updating user:",n),new Error(n.message);return"section_admin"===t.role&&t.section_id&&"section_admin"!==(null==a?void 0:a.role)&&await r.from("section_admins").upsert({user_id:e,section_id:t.section_id,assigned_by:s.user.id}),"section_admin"===(null==a?void 0:a.role)&&"section_admin"!==t.role&&await r.from("section_admins").delete().eq("user_id",e),await r.from("activities").insert({type:"user_updated",title:`User updated: ${o.name}`,user_id:s.user.id,metadata:{target_user_id:e,changes:t,previous:a}}),o}catch(s){throw console.error("Error in updateUser:",s),s}}(_.id,e),M("User updated successfully"),await T())},mode:E}),e.jsx(ts,{open:j,onClose:()=>w(!1),user:_,sections:d,onRoleChange:async(e,t,s)=>{await async function(e,t,s){try{const{data:a}=await r.auth.getUser();if(!a.user)throw new Error("You must be logged in to change user roles");const{data:o}=await r.from("users").select("*").eq("id",e).single(),n={role:t};s&&(n.section_id=s);const{data:l,error:i}=await r.from("users").update(n).eq("id",e).select().single();if(i)throw console.error("Error changing user role:",i),new Error(i.message);return"section_admin"===t&&s?(await r.from("section_admins").delete().eq("user_id",e),await r.from("section_admins").insert({user_id:e,section_id:s,assigned_by:a.user.id})):"section_admin"===(null==o?void 0:o.role)&&"section_admin"!==t&&await r.from("section_admins").delete().eq("user_id",e),await r.from("activities").insert({type:"role_change",title:`User role changed: ${null==o?void 0:o.role}  ${t}`,user_id:a.user.id,metadata:{target_user_id:e,previous_role:null==o?void 0:o.role,new_role:t,section_id:s}}),l}catch(a){throw console.error("Error in changeUserRole:",a),a}}(e,t,s),await T()}}),e.jsx(rs,{open:k,onClose:()=>N(!1),user:_,onDelete:async e=>{await async function(e){try{const{data:t}=await r.auth.getUser();if(!t.user)throw new Error("You must be logged in to delete users");const{data:s}=await r.from("users").select("*").eq("id",e).single();await r.from("section_admins").delete().eq("user_id",e);const{error:a}=await r.from("users").delete().eq("id",e);if(a)throw console.error("Error deleting user:",a),new Error(a.message);await r.from("activities").insert({type:"user_deleted",title:`User deleted: ${(null==s?void 0:s.name)||(null==s?void 0:s.email)}`,user_id:t.user.id,metadata:{deleted_user:s}})}catch(t){throw console.error("Error in deleteUserById:",t),t}}(e),await T()}})]})}function ns({className:t}){return e.jsx("div",{className:`animate-pulse bg-muted rounded ${t}`})}function ls({title:t,value:r,icon:s,trend:a,subtitle:o,color:n="bg-blue-500"}){return e.jsx(Ct,{className:"p-6 hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold mb-2",children:r}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o}),a&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm "+(a.isPositive?"text-green-600":"text-red-600"),children:[a.isPositive?e.jsx(z,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(a.value),"%"]})]})]}),e.jsx("div",{className:`p-3 rounded-xl ${n} bg-opacity-10`,children:e.jsx("div",{className:`text-${n.split("-")[1]}-600`,children:s})})]})})}function is({label:t,value:r,max:s,color:a="bg-blue-500"}){const o=s>0?r/s*100:0;return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:t}),e.jsxs("span",{className:"text-muted-foreground",children:[r," / ",s]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-3",children:e.jsx("div",{className:`${a} h-3 rounded-full transition-all duration-500`,style:{width:`${Math.min(o,100)}%`}})})]})}function ds({data:t,color:r="#3b82f6"}){if(!t||0===t.length)return null;const s=Math.max(...t.map((e=>e.count)),1),a=t.map(((e,r)=>`${r/(t.length-1||1)*90+5},${55-e.count/s*50}`)).join(" "),o=`5,55 ${a} 95,55`;return e.jsxs("svg",{viewBox:"0 0 100 60",className:"w-full h-24",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${r}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:r,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:r,stopOpacity:"0.05"})]})}),e.jsx("polygon",{points:o,fill:`url(#gradient-${r})`}),e.jsx("polyline",{points:a,fill:"none",stroke:r,strokeWidth:"2"}),t.map(((a,o)=>{const n=o/(t.length-1||1)*90+5,l=55-a.count/s*50;return e.jsx("circle",{cx:n,cy:l,r:"2.5",fill:r},o)}))]})}function cs({data:t,maxValue:r,color:s="#3b82f6"}){const a=r||Math.max(...t.map((e=>e.value)),1);return e.jsx("div",{className:"space-y-3",children:t.map(((t,r)=>{const o=t.value/a*100;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[e.jsx("span",{className:"font-medium truncate",children:t.label}),e.jsx("span",{className:"text-muted-foreground ml-2",children:t.value})]}),e.jsx("div",{className:"relative w-full bg-muted rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out",style:{width:`${o}%`,background:`linear-gradient(90deg, ${s} 0%, ${s}dd 100%)`}})})]},r)}))})}function ms({data:t}){const r=t.reduce(((e,t)=>e+t.value),0);if(0===r)return e.jsx("div",{className:"text-center text-muted-foreground text-sm",children:"No data"});let s=-90;const a=50;return e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-40 h-40",children:[t.map(((t,o)=>{const n=t.value/r*100/100*360,l=((e,t,r,s)=>{const o=e*Math.PI/180,n=t*Math.PI/180,l=t-e>180?1:0;return`M ${a+r*Math.cos(o)} ${50+r*Math.sin(o)} A 40 40 0 ${l} 1 ${a+r*Math.cos(n)} ${50+r*Math.sin(n)} L ${a+s*Math.cos(n)} ${50+s*Math.sin(n)} A 28 28 0 ${l} 0 ${a+s*Math.cos(o)} ${50+s*Math.sin(o)} Z`})(s,s+n,40,28);return s+=n,e.jsx("g",{children:e.jsx("path",{d:l,fill:t.color,className:"transition-all hover:opacity-80"})},o)})),e.jsx("circle",{cx:a,cy:50,r:26,fill:"currentColor",className:"text-background"}),e.jsx("text",{x:a,y:45,textAnchor:"middle",className:"text-xl font-bold",fill:"currentColor",children:r}),e.jsx("text",{x:a,y:58,textAnchor:"middle",className:"text-xs",fill:"currentColor",opacity:"0.6",children:"Total"})]}),e.jsx("div",{className:"flex-1 space-y-2",children:t.map(((t,s)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"font-medium",children:t.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:t.value}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",(t.value/r*100).toFixed(0),"%)"]})]})]},s)))})]})}function us({dept:t}){return e.jsx(Ct,{className:"p-5 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500 bg-opacity-10 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-2 text-sm",children:t.department_name}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Users"}),e.jsx("p",{className:"font-bold text-lg",children:t.user_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tasks"}),e.jsx("p",{className:"font-bold text-lg",children:t.task_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Batches"}),e.jsx("p",{className:"font-bold text-lg",children:t.batch_count})]})]})]})]})})}function gs(){const[s,a]=t.useState(null),[o,n]=t.useState(!0),[l,i]=t.useState(null);t.useEffect((()=>{d()}),[]);const d=async()=>{try{n(!0),i(null);const[e,t,s,o,l,d,c,m]=await Promise.all([r.from("users").select("*").then((e=>{const t=e.data||[],r=new Date,s=new Date(r.getTime()-6048e5),a=new Date(r.getTime()-2592e6),o=new Date(r.getTime()-864e5);return{total_users:t.length,students:t.filter((e=>"user"===e.role)).length,admins:t.filter((e=>"admin"===e.role)).length,section_admins:t.filter((e=>"section_admin"===e.role)).length,super_admins:t.filter((e=>"super-admin"===e.role)).length,new_users_week:t.filter((e=>new Date(e.created_at)>s)).length,new_users_month:t.filter((e=>new Date(e.created_at)>a)).length,active_today:t.filter((e=>e.last_active&&new Date(e.last_active)>o)).length,active_week:t.filter((e=>e.last_active&&new Date(e.last_active)>s)).length}})),r.from("tasks").select("*").then((e=>{const t=e.data||[],r=new Date,s=new Date(r.getTime()-6048e5),a=new Date(r.getTime()-2592e6),o=r.toISOString().split("T")[0];return{total_tasks:t.length,completed_tasks:t.filter((e=>"completed"===e.status)).length,in_progress_tasks:t.filter((e=>"in-progress"===e.status)).length,pending_tasks:t.filter((e=>"pending"===e.status)).length,overdue_tasks:t.filter((e=>e.due_date<o&&"completed"!==e.status)).length,tasks_created_week:t.filter((e=>new Date(e.created_at)>s)).length,tasks_created_month:t.filter((e=>new Date(e.created_at)>a)).length,urgent_tasks:t.filter((e=>"urgent"===e.priority)).length,high_priority_tasks:t.filter((e=>"high"===e.priority)).length}})),Promise.all([r.from("departments").select("*",{count:"exact"}),r.from("batches").select("*",{count:"exact"}),r.from("sections").select("*",{count:"exact"}),r.from("task_assignments").select("*",{count:"exact"}),r.from("activities").select("*",{count:"exact"}),r.from("fcm_tokens").select("*",{count:"exact"}).eq("is_active",!0),r.from("task_templates").select("*",{count:"exact"})]).then((e=>({total_departments:e[0].count||0,total_batches:e[1].count||0,total_sections:e[2].count||0,total_assignments:e[3].count||0,total_activities:e[4].count||0,active_fcm_tokens:e[5].count||0,total_templates:e[6].count||0}))),Promise.all([r.from("departments").select("id, name"),r.from("users").select("department_id"),r.from("tasks").select("department_id"),r.from("batches").select("department_id")]).then((([e,t,r,s])=>{const a=e.data||[],o=t.data||[],n=r.data||[],l=s.data||[];return a.map((e=>({department_name:e.name,user_count:o.filter((t=>t.department_id===e.id)).length,task_count:n.filter((t=>t.department_id===e.id)).length,batch_count:l.filter((t=>t.department_id===e.id)).length})))})),r.from("users").select("created_at").gte("created_at",new Date(Date.now()-2592e6).toISOString()).then((e=>{const t=e.data||[],r={};return t.forEach((e=>{const t=e.created_at.split("T")[0];r[t]=(r[t]||0)+1})),Object.entries(r).map((([e,t])=>({date:e,count:t}))).sort(((e,t)=>t.date.localeCompare(e.date)))})),r.from("tasks").select("created_at").gte("created_at",new Date(Date.now()-2592e6).toISOString()).then((e=>{const t=e.data||[],r={};return t.forEach((e=>{const t=e.created_at.split("T")[0];r[t]=(r[t]||0)+1})),Object.entries(r).map((([e,t])=>({date:e,count:t}))).sort(((e,t)=>t.date.localeCompare(e.date)))})),r.from("tasks").select("category").then((e=>{const t=e.data||[],r={};return t.forEach((e=>{e.category&&(r[e.category]=(r[e.category]||0)+1)})),Object.entries(r).map((([e,t])=>({category:e,count:t}))).sort(((e,t)=>t.count-e.count))})),r.from("activities").select("type").then((e=>{const t=e.data||[],r={};return t.forEach((e=>{e.type&&(r[e.type]=(r[e.type]||0)+1)})),Object.entries(r).map((([e,t])=>({type:e,count:t}))).sort(((e,t)=>t.count-e.count)).slice(0,10)}))]);a({totalUsers:e.total_users||0,students:e.students||0,admins:e.admins||0,sectionAdmins:e.section_admins||0,superAdmins:e.super_admins||0,newUsersWeek:e.new_users_week||0,newUsersMonth:e.new_users_month||0,activeToday:e.active_today||0,activeWeek:e.active_week||0,totalTasks:t.total_tasks||0,completedTasks:t.completed_tasks||0,inProgressTasks:t.in_progress_tasks||0,pendingTasks:t.pending_tasks||0,overdueTasks:t.overdue_tasks||0,tasksCreatedWeek:t.tasks_created_week||0,tasksCreatedMonth:t.tasks_created_month||0,urgentTasks:t.urgent_tasks||0,highPriorityTasks:t.high_priority_tasks||0,totalDepartments:s.total_departments||0,totalBatches:s.total_batches||0,totalSections:s.total_sections||0,totalAssignments:s.total_assignments||0,totalActivities:s.total_activities||0,activeFcmTokens:s.active_fcm_tokens||0,totalTemplates:s.total_templates||0,departmentStats:o||[],userGrowth:l||[],taskGrowth:d||[],taskCategories:c||[],activityTypes:m||[]})}catch(e){console.error("Error fetching analytics:",e),i("Failed to load analytics data. Please try again.")}finally{n(!1)}};if(o)return e.jsx("div",{className:"p-6 space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map(((t,r)=>e.jsx(ns,{className:"h-32"},r)))})});if(l||!s)return e.jsx("div",{className:"p-6",children:e.jsxs(Ct,{className:"p-8 text-center",children:[e.jsx(X,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Analytics"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:l}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:opacity-90",children:"Retry"})]})});const c=s.totalTasks>0?(s.completedTasks/s.totalTasks*100).toFixed(1):"0",m=s.totalUsers>0?(s.activeWeek/s.totalUsers*100).toFixed(1):"0";return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ls,{title:"Total Users",value:s.totalUsers,icon:e.jsx(g,{className:"w-6 h-6"}),subtitle:`${s.newUsersMonth} new this month`,color:"bg-blue-500"}),e.jsx(ls,{title:"Students",value:s.students,icon:e.jsx(oe,{className:"w-6 h-6"}),subtitle:`${(s.students/s.totalUsers*100).toFixed(1)}% of total`,color:"bg-green-500"}),e.jsx(ls,{title:"Active Users (Week)",value:s.activeWeek,icon:e.jsx(h,{className:"w-6 h-6"}),subtitle:`${m}% engagement rate`,color:"bg-purple-500"}),e.jsx(ls,{title:"Active Today",value:s.activeToday,icon:e.jsx(E,{className:"w-6 h-6"}),subtitle:`${s.activeWeek} active this week`,color:"bg-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6",children:[e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"User Growth Trend"]}),e.jsx(ds,{data:s.userGrowth.slice(0,14).reverse(),color:"#3b82f6"}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last 14 days"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["+",s.userGrowth.slice(0,14).reduce(((e,t)=>e+t.count),0)," users"]})]})})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"User Roles Distribution"]}),e.jsx(is,{label:"Students",value:s.students,max:s.totalUsers,color:"bg-green-500"}),e.jsx(is,{label:"Section Admins",value:s.sectionAdmins,max:s.totalUsers,color:"bg-blue-500"}),e.jsx(is,{label:"Admins",value:s.admins,max:s.totalUsers,color:"bg-purple-500"}),e.jsx(is,{label:"Super Admins",value:s.superAdmins,max:s.totalUsers,color:"bg-red-500"})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Growth Summary"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Users (Week)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["+",s.newUsersWeek]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Users (Month)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["+",s.newUsersMonth]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Engagement Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[m,"%"]})]})]})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Active Users"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Active Today"}),e.jsx("p",{className:"text-4xl font-bold text-blue-600",children:s.activeToday}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(s.activeToday/s.totalUsers*100).toFixed(1),"% of total"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"text-lg font-bold text-purple-600",children:s.activeWeek})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Engagement"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[m,"%"]})]})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Task Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ls,{title:"Total Tasks",value:s.totalTasks,icon:e.jsx(x,{className:"w-6 h-6"}),subtitle:`${s.tasksCreatedMonth} created this month`,color:"bg-indigo-500"}),e.jsx(ls,{title:"Completed",value:s.completedTasks,icon:e.jsx(ne,{className:"w-6 h-6"}),subtitle:`${c}% completion rate`,color:"bg-green-500"}),e.jsx(ls,{title:"In Progress",value:s.inProgressTasks,icon:e.jsx(B,{className:"w-6 h-6"}),subtitle:`${s.pendingTasks} pending`,color:"bg-yellow-500"}),e.jsx(ls,{title:"Overdue",value:s.overdueTasks,icon:e.jsx(X,{className:"w-6 h-6"}),subtitle:`${s.urgentTasks} urgent tasks`,color:"bg-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Task Status Overview"]}),e.jsx(ms,{data:[{label:"Completed",value:s.completedTasks,color:"#22c55e"},{label:"In Progress",value:s.inProgressTasks,color:"#eab308"},{label:"Pending",value:s.pendingTasks,color:"#3b82f6"},{label:"Overdue",value:s.overdueTasks,color:"#ef4444"}]})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Task Creation Trend"]}),e.jsx(ds,{data:s.taskGrowth.slice(0,14).reverse(),color:"#22c55e"}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last 14 days"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",s.taskGrowth.slice(0,14).reduce(((e,t)=>e+t.count),0)," tasks"]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Task Categories"]}),e.jsx(cs,{data:s.taskCategories.slice(0,5).map((e=>({label:e.category.replace("-"," ").replace(/\b\w/g,(e=>e.toUpperCase())),value:e.count}))),color:"#6366f1"})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Priority Distribution"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:"Urgent"})]}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:s.urgentTasks})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"High Priority"})]}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:s.highPriorityTasks})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Overdue"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:s.overdueTasks})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"w-5 h-5 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"System Overview"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(ls,{title:"Departments",value:s.totalDepartments,icon:e.jsx(D,{className:"w-5 h-5"}),color:"bg-purple-500"}),e.jsx(ls,{title:"Batches",value:s.totalBatches,icon:e.jsx($,{className:"w-5 h-5"}),color:"bg-blue-500"}),e.jsx(ls,{title:"Sections",value:s.totalSections,icon:e.jsx($,{className:"w-5 h-5"}),color:"bg-indigo-500"}),e.jsx(ls,{title:"Assignments",value:s.totalAssignments,icon:e.jsx(x,{className:"w-5 h-5"}),color:"bg-green-500"}),e.jsx(ls,{title:"Activities",value:s.totalActivities,icon:e.jsx(h,{className:"w-5 h-5"}),color:"bg-orange-500"}),e.jsx(ls,{title:"FCM Tokens",value:s.activeFcmTokens,icon:e.jsx(ie,{className:"w-5 h-5"}),color:"bg-red-500"}),e.jsx(ls,{title:"Templates",value:s.totalTemplates,icon:e.jsx(x,{className:"w-5 h-5"}),color:"bg-teal-500"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(D,{className:"w-5 h-5 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Department Distribution"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.departmentStats.map(((t,r)=>e.jsx(us,{dept:t},r)))}),e.jsxs(Ct,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-6",children:"Department Comparison"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Users by Department"}),e.jsx(cs,{data:s.departmentStats.map((e=>({label:e.department_name.split(" ")[0],value:e.user_count}))),color:"#a855f7"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Tasks by Department"}),e.jsx(cs,{data:s.departmentStats.map((e=>({label:e.department_name.split(" ")[0],value:e.task_count}))),color:"#3b82f6"})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(h,{className:"w-5 h-5 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"System Activity"})]}),e.jsxs(Ct,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Activity Breakdown"}),e.jsx(cs,{data:s.activityTypes.map((e=>({label:e.type.replace("_"," ").replace(/\b\w/g,(e=>e.toUpperCase())),value:e.count}))),color:"#f97316"})]})]})]})}function hs(){return e.jsx(os,{})}function xs(){return e.jsx(gs,{})}function ps(){const[s,a]=t.useState([]),[o,n]=t.useState(!0);return t.useEffect((()=>{(async()=>{try{n(!0);const{data:e}=await r.from("activities").select("*").order("created_at",{ascending:!1}).limit(100);if(e){const t=e.map((e=>({id:e.id,timestamp:e.created_at,adminId:e.user_id||"",adminName:"Admin",action:e.type,target:e.title,details:{description:e.title,metadata:e.metadata},ipAddress:"0.0.0.0",userAgent:"N/A",status:"success"})));a(t)}}catch(e){console.error("Error fetching logs:",e)}finally{n(!1)}})()}),[]),e.jsx(zr,{logs:s,loading:o})}function fs(){const{admins:t,resetPassword:r}=Fr();return e.jsx(Mr,{admins:t,onResetPassword:r})}function bs(){var r;const s=a(),n=o(),[l,i]=t.useState("overview"),[d,c]=t.useState(!1),[u,g]=t.useState(!1),[h,x]=t.useState(!1),[p,j]=t.useState(!1),{isDark:w,toggle:k}=f(),{logout:N,user:_}=de(),{refreshAdmins:C}=Fr();return t.useEffect((()=>{const e=n.pathname;i({"/superadmin/dashboard":"overview","/superadmin/overview":"overview","/superadmin/admins":"admins","/superadmin/sectionadmins":"section-admins","/superadmin/analytics":"analytics","/superadmin/logs":"logs","/superadmin/security":"security"}[e]||"overview")}),[n.pathname]),t.useEffect((()=>{const e=()=>{const e=window.innerWidth<1024;x(e),!e&&u&&g(!1)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[u]),t.useEffect((()=>{localStorage.setItem("is_super_admin","true"),sessionStorage.setItem("is_super_admin","true"),C()}),[C]),e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-950",children:[e.jsx(_t,{activeTab:l,onTabChange:e=>{i(e),s({overview:"/superadmin/dashboard",admins:"/superadmin/admins","section-admins":"/superadmin/sectionadmins",analytics:"/superadmin/analytics",logs:"/superadmin/logs",security:"/superadmin/security"}[e]||"/superadmin/dashboard",{replace:!0})},isCollapsed:d,onToggleCollapse:()=>c(!d),isMobile:h,isOpen:u,onClose:()=>g(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 lg:px-6 py-4 h-16",children:e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g(!0),className:"lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(m,{className:"w-5 h-5"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white",children:{overview:"Dashboard Overview",admins:"Admin Management","section-admins":"Section Admin Management",analytics:"Analytics & Reports",logs:"System Logs",security:"Security Settings"}[l]||"Dashboard"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg relative",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx(zt,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:"3"})]}),e.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:w?e.jsx(b,{className:"w-5 h-5"}):e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 pl-2 border-l border-gray-200 dark:border-gray-800",children:[e.jsx(Ur,{className:"h-8 w-8",children:e.jsx(Tr,{className:"bg-blue-600 text-white text-sm",children:(null==(r=null==_?void 0:_.name)?void 0:r.charAt(0).toUpperCase())||"SA"})}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(null==_?void 0:_.name)||"Super Admin"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:null==_?void 0:_.email})]})]}),e.jsxs(Ht,{variant:"ghost",size:"sm",onClick:async()=>{if(!p)try{j(!0),await N(),s("/auth",{replace:!0})}catch(e){console.error("Logout failed:",e),j(!1)}},disabled:p,className:"gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:p?"Logging out...":"Logout"})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-[1600px] mx-auto",children:(()=>{switch(l){case"overview":default:return e.jsx(Mt,{});case"admins":return e.jsx($r,{});case"section-admins":return e.jsx(hs,{});case"analytics":return e.jsx(xs,{});case"logs":return e.jsx(ps,{});case"security":return e.jsx(fs,{})}})()})})]})]})}export{bs as SuperAdminDashboard};
