const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnnouncementManager.iDwaWfeq.js","assets/js/index.G03YpSsJ.js","assets/css/index.KrsTFQ0K.css","assets/js/megaphone.Iw-RzU1s.js","assets/js/createLucideIcon.D0wOJrC3.js","assets/js/send.D7Rdmen3.js","assets/js/linkParser.CRNpH1Sh.js","assets/js/calendar.DyuQt31k.js","assets/js/trash-2.DCyQRQyM.js"])))=>i.map(i=>d[i]);
import{s as e,r as t,_ as n,b as a,j as r}from"./index.G03YpSsJ.js";import{a as s}from"./telegram.service.BTr96-Tu.js";import"./dateUtils.8XYiGfWV.js";const c=t.lazy((()=>n((()=>import("./AnnouncementManager.iDwaWfeq.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then((e=>({default:e.AnnouncementManager})))));function o(){const{isSectionAdmin:n,sectionId:o}=a(),{announcements:i,createAnnouncement:u,deleteAnnouncement:l}=function(){const[n,a]=t.useState([]),[r,c]=t.useState(!0),[o,i]=t.useState(null),u=t.useCallback((async(t=!1)=>{try{c(!0);const t=await async function(){try{const{data:t,error:n}=await e.from("announcements").select("*").order("created_at",{ascending:!1});if(n)throw n;return t}catch(o){return[]}}();a(t)}catch(n){i(n.message)}finally{c(!1)}}),[]);return t.useEffect((()=>{u()}),[u]),{announcements:n,loading:r,error:o,createAnnouncement:async t=>{try{i(null),await async function(t){const{data:{user:n}}=await e.auth.getUser();if(!n)throw new Error("Not authenticated");try{const a=(new Date).toISOString(),{data:r,error:c}=await e.from("announcements").insert({title:t.title,content:t.content,created_by:n.id,created_at:a}).select().single();if(c)throw c;const o={...r,createdAt:a};return await s(o),o}catch(o){throw o}}(t),await u()}catch(n){throw i(n.message),n}},deleteAnnouncement:async t=>{try{i(null),await async function(t){const{data:{user:n}}=await e.auth.getUser();if(!n)throw new Error("Not authenticated");try{const{error:n}=await e.from("announcements").delete().eq("id",t);if(n)throw n}catch(o){throw o}}(t),await u()}catch(n){throw i(n.message),n}},refreshAnnouncements:t.useCallback((async()=>{try{return await u(!0)}catch(e){throw i(e.message),e}}),[u])}}(),m=t.useMemo((()=>n&&o?i.filter((e=>!e.sectionId||e.sectionId===o)):i),[i,n,o]);return r.jsx(t.Suspense,{fallback:r.jsxs("div",{className:"space-y-4 animate-pulse",children:[r.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"}),[1,2,3].map((e=>r.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-xl"},e)))]}),children:r.jsx(c,{announcements:m,onCreateAnnouncement:u,onDeleteAnnouncement:l})})}export{o as AnnouncementsPage};
