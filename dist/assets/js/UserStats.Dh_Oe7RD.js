import{r as e,j as s}from"./react-vendor.ChEovXhk.js";import{s as t}from"./index.8xORY5Vo.js";import{LucideX as a,AlertCircle as l,LucideTag as r,Calendar as i,Clock as n,LucideUserCheck as d,LucideUsers as c,ListTodo as o}from"./icons.Be68WOzY.js";import"./charts.B0xhc6u6.js";import"./vendor.puyDUvHC.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.lbvV8mvR.js";import"./supabase-vendor.CQkAbalq.js";function x({title:e,value:t,icon:a,color:l,onClick:r,loading:i=!1}){return s.jsx("button",{onClick:r,disabled:i,className:`\n        w-full bg-white rounded-2xl p-6 shadow-sm \n        transition-all duration-300 \n        ${r?"hover:shadow-lg hover:-translate-y-1 cursor-pointer":"cursor-default"}\n      `,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500 mb-1",children:e}),i?s.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"}):s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t})]}),s.jsx("div",{className:`p-3 rounded-xl transition-colors ${(()=>{switch(l){case"blue":return"bg-blue-50 text-blue-600 hover:bg-blue-100";case"green":return"bg-green-50 text-green-600 hover:bg-green-100";case"purple":return"bg-purple-50 text-purple-600 hover:bg-purple-100";case"indigo":return"bg-indigo-50 text-indigo-600 hover:bg-indigo-100"}})()}`,children:s.jsx(a,{className:"w-6 h-6"})})]})})}function m({users:e=[],onClose:t}){return(null==e?void 0:e.length)?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),s.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5 text-gray-500"})})]}),s.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:s.jsx("div",{className:"divide-y",children:e.map((e=>s.jsxs("div",{className:"py-4 first:pt-0 last:pb-0",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-medium",children:e.name.charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-sm text-gray-500",children:e.email})]}),s.jsx("span",{className:"ml-auto px-2.5 py-0.5 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role})]}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Joined ",new Date(e.createdAt).toLocaleDateString()]})]},e.id)))})})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),s.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5 text-gray-500"})})]}),s.jsx("div",{className:"p-6",children:s.jsx("p",{className:"text-gray-500 text-center",children:"No users found"})})]})]})}function u({tasks:e=[],onClose:t}){const d=[...e].sort(((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),c=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}};return(null==e?void 0:e.length)?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),s.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-4xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:s.jsx(l,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"All Tasks"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Total ",e.length," tasks in the system"]})]})]}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5 text-gray-500"})})]}),s.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:s.jsx("div",{className:"grid gap-4",children:d.map((e=>s.jsx("div",{className:"bg-white border rounded-xl p-4 hover:shadow-md transition-shadow",children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex-grow",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),s.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${c(e.status)}`,children:"my-tasks"===e.status?"To Do":"in-progress"===e.status?"In Progress":"Completed"}),e.isAdminTask&&s.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-800 rounded-full",children:"Admin Task"})]}),s.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(r,{className:"w-4 h-4"}),s.jsx("span",{children:e.category})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(i,{className:"w-4 h-4"}),s.jsxs("span",{children:["Due: ",new Date(e.dueDate).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(n,{className:"w-4 h-4"}),s.jsxs("span",{children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]})]})]})})},e.id)))})})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),s.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Task Details"}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5 text-gray-500"})})]}),s.jsx("div",{className:"p-6",children:s.jsx("p",{className:"text-gray-500 text-center",children:"No tasks found"})})]})]})}function h({users:e,type:t,onClose:l}){const r=e.filter((e=>{if(!e.lastActive&&!e.createdAt)return!1;const s=new Date;if("active"===t){const t=e.lastActive?new Date(e.lastActive):null;if(!t)return!1;const a=new Date(s);a.setHours(0,0,0,0);const l=new Date(s);return l.setHours(23,59,59,999),t>=a&&t<=l}{const t=new Date(s.getTime()-6048e5);return new Date(e.createdAt)>=t}}));return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm z-40",onClick:l}),s.jsxs("div",{className:"fixed inset-x-4 top-[5%] sm:top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl z-50 max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:"active"===t?s.jsx(d,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}):s.jsx(i,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"active"===t?"Active Users Today":"New Users This Week"}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length," ",1===r.length?"user":"users"]})]})]}),s.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close modal",children:s.jsx(a,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),s.jsx("div",{className:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:0===r.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center",children:"active"===t?s.jsx(d,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}):s.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:"No users found"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"active"===t?"No users have been active today":"No new users have joined this week"})]}):s.jsx("div",{className:"space-y-3",children:r.map((e=>s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-grow min-w-0",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white font-medium flex-shrink-0",children:e.name.charAt(0).toUpperCase()}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:e.email})]})]}),s.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-3 ml-13 sm:ml-0",children:[s.jsx("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300"),children:e.role}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:new Date("active"===t&&e.lastActive||e.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},e.id)))})})]})]})}function g({users:a,tasks:l}){const{stats:r,loading:i}=function(){const[s,a]=e.useState({totalUsers:0,activeToday:0,newThisWeek:0}),[l,r]=e.useState(!0),[i,n]=e.useState(null);e.useEffect((()=>{d()}),[]);const d=async()=>{try{r(!0);const{data:e,error:s}=await t.rpc("get_user_stats");if(s)throw s;a({totalUsers:e.total_users,activeToday:e.active_today,newThisWeek:e.new_this_week})}catch(e){n(e.message)}finally{r(!1)}};return{stats:s,loading:l,error:i,refresh:d}}(),[g,p]=e.useState(!1),[b,j]=e.useState(!1),[f,v]=e.useState(null),w=(()=>{const e=new Date(new Date);return e.setHours(0,0,0,0),a.filter((s=>!!s.lastActive&&new Date(s.lastActive)>=e))})(),N=(()=>{const e=new Date((new Date).getTime()-6048e5);return a.filter((s=>new Date(s.createdAt)>=e))})(),y=[{title:"Total Users",value:a.length,icon:c,color:"blue",onClick:()=>p(!0)},{title:"Active Today",value:w.length,icon:d,color:"green",onClick:()=>v("active")},{title:"New This Week",value:N.length,icon:n,color:"purple",onClick:()=>v("new")},{title:"Total Tasks",value:l.length,icon:o,color:"indigo",onClick:()=>j(!0)}];return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:y.map((e=>s.jsx(x,{...e,loading:i},e.title)))}),g&&s.jsx(m,{users:a,onClose:()=>p(!1)}),b&&s.jsx(u,{tasks:l,onClose:()=>j(!1)}),f&&s.jsx(h,{users:"active"===f?w:N,type:f,onClose:()=>v(null)})]})}export{g as UserStats};
