class o{constructor(){this.cache=new Map,this.defaultTTL=5*60*1e3}get(t,a){const s=this.cache.get(t);if(!s)return null;const n=a!=null?a:this.defaultTTL;return Date.now()-s.timestamp>n?(this.cache.delete(t),null):s.data}set(t,a){this.cache.set(t,{data:a,timestamp:Date.now()})}async getOrFetch(t,a,s){const n=this.get(t,s);if(n!==null)return n;const c=this.cache.get(t);if(c!=null&&c.promise)return c.promise;const h=a();this.cache.set(t,{data:null,timestamp:Date.now(),promise:h});try{const i=await h;return this.cache.set(t,{data:i,timestamp:Date.now()}),i}catch(i){throw this.cache.delete(t),i}}invalidate(t){this.cache.delete(t)}invalidatePattern(t){for(const a of this.cache.keys())t.test(a)&&this.cache.delete(a)}clear(){this.cache.clear()}clearAll(){console.log("[DataCache] Clearing all cache"),this.cache.clear(),typeof window!="undefined"&&window.dispatchEvent(new CustomEvent("cache-cleared"))}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}cleanup(){const t=Date.now();for(const[a,s]of this.cache.entries())t-s.timestamp>this.defaultTTL&&this.cache.delete(a)}}const r=new o;typeof window!="undefined"&&(setInterval(()=>{r.cleanup()},5*60*1e3),window.addEventListener("app-resume",()=>{console.log("[DataCache] App resumed, clearing cache"),r.clearAll()}),window.addEventListener("supabase-session-refreshed",()=>{console.log("[DataCache] Session refreshed, clearing cache"),r.clearAll()}));const l={user:e=>`user:${e}`,userWithFullInfo:e=>`user_full:${e}`,department:e=>`department:${e}`,departments:()=>"departments:all",batch:e=>`batch:${e}`,batches:e=>e?`batches:dept:${e}`:"batches:all",section:e=>`section:${e}`,sections:e=>e?`sections:batch:${e}`:"sections:all",tasks:e=>`tasks:${e}`,tasksEnhanced:(e,t)=>t?`tasks_enhanced:${e}:${t}`:`tasks_enhanced:${e}`,taskById:e=>`task:${e}`,announcements:()=>"announcements:all",sectionUsers:e=>`section_users:${e}`,userRole:e=>`user_role:${e}`};export{l as c,r as d};
