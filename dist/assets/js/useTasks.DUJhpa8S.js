import{s as g,r as h,t as B}from"./index.C_acLESD.js";import{s as J}from"./telegram.service.B5vX6-Oo.js";async function W(){try{const{data:{user:t}}=await g.auth.getUser();if(!t)return console.warn("No authenticated user found"),[];const{data:e}=await g.from("users").select("role, section_id").eq("id",t.id).single();let i=g.from("users").select(`
        id, 
        email, 
        name, 
        role, 
        created_at, 
        last_active, 
        phone,
        student_id,
        section_id
      `).order("created_at",{ascending:!1});(e==null?void 0:e.role)!=="admin"&&(e==null?void 0:e.role)!=="super-admin"&&(e!=null&&e.section_id)&&(i=i.eq("section_id",e.section_id));const{data:c,error:s}=await i;if(s)return console.error("Error fetching users:",s),[];const u=(c==null?void 0:c.filter(o=>o.section_id).map(o=>o.section_id))||[];let E={};if(u.length>0){const{data:o,error:p}=await g.from("sections").select("id, name").in("id",u);!p&&o&&(E=o.reduce((f,y)=>(f[y.id]=y.name,f),{}))}return(c==null?void 0:c.map(o=>{var p;return{id:o.id,email:o.email||"",name:o.name||((p=o.email)==null?void 0:p.split("@")[0])||"",role:o.role||"user",createdAt:o.created_at,lastActive:o.last_active,phone:o.phone||"",studentId:o.student_id||"",sectionId:o.section_id||"",sectionName:o.section_id&&E[o.section_id]||""}}))||[]}catch(t){return console.error("Error fetching users:",t),[]}}async function X(t){try{const{data:{user:e}}=await g.auth.getUser();if(!e)throw new Error("Unauthorized: You must be logged in");const{data:i,error:c}=await g.from("users").select("role, section_id").eq("id",e.id).single();if(c||!i)throw console.error("Error fetching user role:",c),new Error("Failed to get user role");const{data:s,error:u}=await g.from("users").select("section_id").eq("id",t).single();if(u)throw console.error("Error fetching target user:",u),new Error("Failed to get target user information");if((o=>o==="section-admin"||o==="section_admin")(i.role)){if(i.section_id!==(s==null?void 0:s.section_id))throw new Error("You can only delete users from your own section");console.log("Attempting to delete user as section admin:",{userId:t,adminSection:i.section_id,targetSection:s==null?void 0:s.section_id});const{error:o}=await g.rpc("delete_section_user",{user_id:t});if(o)throw console.error("Error deleting user as section admin:",o),new Error(o.message||"Failed to delete user")}else if(i.role==="admin"||i.role==="super-admin"){const{error:o}=await g.from("users").delete().eq("id",t);if(o)throw console.error("Error deleting user as admin:",o),new Error(o.message||"Failed to delete user")}else throw new Error("Unauthorized: Only administrators can delete users")}catch(e){throw console.error("Error deleting user:",e),new Error(e.message||"Failed to delete user")}}async function Y(t,e){try{const{data:{user:i}}=await g.auth.getUser();if(!i)throw new Error("Unauthorized: You must be logged in");const{data:c}=await g.from("users").select("role").eq("id",i.id).single();if((c==null?void 0:c.role)!=="admin"&&(c==null?void 0:c.role)!=="super-admin")throw new Error("Unauthorized: Only admins can promote users");const{error:s}=await g.from("users").update({role:e}).eq("id",t);if(s)throw console.error("Error promoting user:",s),new Error(s.message||"Failed to promote user")}catch(i){throw console.error("Error promoting user:",i),new Error(i.message||"Failed to promote user")}}async function G(t,e){try{const{data:{user:i}}=await g.auth.getUser();if(!i)throw new Error("Unauthorized: You must be logged in");const{data:c}=await g.from("users").select("role").eq("id",i.id).single();if((c==null?void 0:c.role)!=="admin"&&(c==null?void 0:c.role)!=="super-admin")throw new Error("Unauthorized: Only admins can demote users");const{error:s}=await g.from("users").update({role:e}).eq("id",t);if(s)throw console.error("Error demoting user:",s),new Error(s.message||"Failed to demote user")}catch(i){throw console.error("Error demoting user:",i),new Error(i.message||"Failed to demote user")}}function ne(){const[t,e]=h.useState([]),[i,c]=h.useState(!0),[s,u]=h.useState(null),E=h.useRef(0),o=h.useRef(!1),p=h.useCallback(async(m=!1)=>{if(o.current&&!m)return;const l=Date.now();if(!(!m&&l-E.current<1e4))try{o.current=!0,c(!0);const d=await W();e(d),E.current=Date.now()}catch(d){u(d.message)}finally{c(!1),o.current=!1}},[]);h.useEffect(()=>{p(!0)},[p]);const f=h.useRef();return h.useEffect(()=>{f.current=()=>{p(!0)}},[p]),h.useEffect(()=>{const m=()=>{var l;(l=f.current)==null||l.call(f)};return window.addEventListener("app-resume",m),window.addEventListener("supabase-resume",m),window.addEventListener("supabase-session-refreshed",m),window.addEventListener("supabase-network-reconnect",m),window.addEventListener("supabase-visibility-refresh",m),()=>{window.removeEventListener("app-resume",m),window.removeEventListener("supabase-resume",m),window.removeEventListener("supabase-session-refreshed",m),window.removeEventListener("supabase-network-reconnect",m),window.removeEventListener("supabase-visibility-refresh",m)}},[]),{users:t,loading:i,error:s,refreshUsers:()=>p(!0),deleteUser:async m=>{try{u(null),await X(m),e(l=>l.filter(d=>d.id!==m))}catch(l){throw u(l.message),await p(!0),l}},promoteUser:async(m,l)=>{try{u(null),await Y(m,l),e(d=>d.map(_=>_.id===m?{..._,role:l}:_))}catch(d){throw u(d.message),await p(!0),d}},demoteUser:async(m,l)=>{try{u(null),await G(m,l),e(d=>d.map(_=>_.id===m?{..._,role:l}:_))}catch(d){throw u(d.message),await p(!0),d}}}}function I(t){return{id:t.id,name:t.name,category:t.category,dueDate:t.due_date,description:t.description,status:t.status,createdAt:t.created_at,isAdminTask:t.is_admin_task,sectionId:t.section_id||null,googleDriveLinks:t.google_drive_links||[],attachments:t.attachments||[]}}const H=async(t,e)=>{var i,c;try{const s=8e3,u=new AbortController,E=setTimeout(()=>u.abort(),s),{data:{user:o}}=await g.auth.getUser(),p=(i=o==null?void 0:o.user_metadata)==null?void 0:i.role,f=e||((c=o==null?void 0:o.user_metadata)==null?void 0:c.section_id);let y=g.from("tasks").select("id,name,description,due_date,status,category,is_admin_task,user_id,section_id,created_at");y=y.order("created_at",{ascending:!1});const{data:k,error:v}=await y;if(clearTimeout(E),v)throw console.error("Error fetching tasks:",v),v;const m=k.map(I);if(f){const l=m.filter(d=>d.sectionId===f);console.log(`[Debug] Found ${l.length} section tasks with sectionId: ${f}`),l.length>0&&console.log("[Debug] Section task IDs:",l.map(d=>d.id))}return m}catch(s){throw s.name==="AbortError"?(console.error("Task fetch timed out"),new Error("Task fetch timed out. Please try again.")):(console.error("Error in fetchTasks:",s),new Error(`Failed to fetch tasks: ${s.message}`))}};async function j(t){try{const e=t.name.split(".").pop(),c=`task-files/${`${crypto.randomUUID()}.${e}`}`,{error:s}=await g.storage.from("task-attachments").upload(c,t,{contentType:t.type,cacheControl:"3600",upsert:!1});if(s)throw s;const{data:{publicUrl:u}}=g.storage.from("task-attachments").getPublicUrl(c);return{url:u,originalName:t.name,path:c}}catch(e){throw console.error("Error uploading file:",e),e}}const K=async(t,e,i)=>{var c,s,u,E;try{console.log("[Debug] Creating task with data:",{userId:t,task:e,sectionId:i,hasMobileFiles:!!e._mobileFiles,isSectionAdminMobile:!!e._isSectionAdminMobile});const{data:{user:o}}=await g.auth.getUser(),p=(c=o==null?void 0:o.user_metadata)==null?void 0:c.role,f=(s=o==null?void 0:o.user_metadata)==null?void 0:s.section_id;console.log("[Debug] User role and section when creating task:",{userRole:p,userSectionId:f});const y=e._mobileFiles,k=!!y&&y.length>0,v=!!e._isSectionAdminMobile,m=e._sectionId||i;k&&(console.log("[Debug] Processing mobile file upload with",y.length,"files"),v&&console.log("[Debug] This is a section admin mobile upload with section ID:",m));let l=e.description;const d=[];let _=null,O=0;const L=async(r,n=6e4)=>new Promise(async(a,w)=>{const b=new AbortController,$=b.signal,R=setTimeout(()=>{b.abort(),w(new Error(`Upload timed out for file ${r.name} after ${n/1e3}s`))},n);try{const D=await(async()=>{if(!r.name||r.size===0)throw new Error(`Invalid file: ${r.name||"unnamed"} (${r.size} bytes)`);if(r.size>26214400)throw new Error(`File too large: ${r.name} (${Math.round(r.size/1024/1024)}MB). Mobile file limit is 25MB.`);const T=r.name.split(".").pop(),S=`task-files/${`${crypto.randomUUID()}.${T}`}`;console.log(`[Debug] Starting upload for ${r.name} (${Math.round(r.size/1024)}KB) to ${S}`);const{error:z}=await g.storage.from("task-attachments").upload(S,r,{contentType:r.type,cacheControl:"3600",upsert:!1});if(z)throw z;const{data:{publicUrl:q}}=g.storage.from("task-attachments").getPublicUrl(S);return console.log(`[Debug] Successfully uploaded ${r.name} to ${S} (${q.slice(-20)})`),q})();clearTimeout(R),a(D)}catch(F){clearTimeout(R),$.aborted?w(new Error(`Upload timed out for file ${r.name}`)):w(F)}});if(k&&y)try{console.log("[Debug] Uploading mobile files",y.map(n=>({name:n.name,size:n.size})));const r=y.reduce((n,a)=>n+a.size,0);if(console.log(`[Debug] Total mobile upload size: ${Math.round(r/1024/1024)}MB`),r>100*1024*1024)throw new Error(`Total upload size too large: ${Math.round(r/1024/1024)}MB exceeds 100MB limit for mobile uploads`);for(const n of y){if(!n.name||n.size===0){console.warn("[Warning] Skipping invalid file",n);continue}try{console.log(`[Debug] Uploading mobile file: ${n.name} (${Math.round(n.size/1024)}KB)`);let a=null,w=0,b=null;for(;w<3&&!a;)try{w++;const D=Math.min(3e4+n.size/1024/10,6e4),T=await L(n,D);a={url:T,originalName:n.name,path:new URL(T).pathname.split("/").pop()||""},d.push(a),O+=n.size;break}catch(D){if(console.error(`[Error] Failed to upload mobile file (attempt ${w}/3):`,n.name,D),b=D instanceof Error?D:new Error(String(D)),w<3){const T=1e3*Math.pow(2,w-1);await new Promise(U=>setTimeout(U,T))}}if(!a)throw _=b||new Error(`Failed to upload file after 3 attempts: ${n.name}`),_;const $=new RegExp(`\\[${n.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\]\\(attachment:${n.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),R=`[${n.name}](${a.url})`,F=l;l=l.replace($,R),F===l&&(console.warn("[Warning] Failed to find exact attachment reference, trying general pattern"),l=l.replace(/\[(.*?)\]\(attachment:(.*?)\)/g,(D,T,U)=>T===n.name?`[${T}](${a.url})`:D),F===l&&v&&(console.log("[Debug] Using fallback for section admin mobile file:",n.name),l.includes(`[${n.name}]`)||(l+=`
[${n.name}](${a.url})`))),console.log("[Debug] Replaced attachment reference with permanent URL")}catch(a){console.error("[Error] Failed to upload mobile file:",n.name,a),_||(_=a instanceof Error?a:new Error(String(a)));continue}}if(_&&d.length===0)throw _;_&&console.warn("[Warning] Some files failed to upload, but continuing with successful uploads",{successful:d.length,failed:y.length-d.length}),console.log(`[Debug] Successfully uploaded ${d.length}/${y.length} files, total size: ${Math.round(O/1024/1024)}MB`),l=l.replace(/\n<!-- mobile-uploads -->\n/g,"")}catch(r){console.error("[Error] Mobile file upload process failed:",r);try{d&&d.length>0&&(console.log(`[Debug] Cleaning up ${d.length} uploaded files after error`),await Promise.allSettled(d.map(async n=>{if(n.path)try{const{error:a}=await g.storage.from("task-attachments").remove([`task-files/${n.path}`]);a?console.error(`[Error] Failed to clean up file ${n.path}:`,a):console.log(`[Debug] Successfully cleaned up file: ${n.path}`)}catch(a){console.error(`[Error] Error during file cleanup for ${n.path}:`,a)}})))}catch(n){console.error("[Error] Failed during cleanup after upload error:",n)}throw r}else{const r=l.match(/\[([^\]]+)\]\((blob:.*?)\)/g)||[];console.log("[Debug] Found file matches in description:",r);for(const n of r)try{const a=n.match(/\[(.*?)\]\((blob:(.*?))\)/);if(!a)continue;const[,w,b]=a;if(console.log("[Debug] Processing file match:",{match:n,fileName:w,blobUrl:b}),w&&b)try{const $=new Promise(async(U,S)=>{try{console.log("[Debug] Fetching blob URL:",b);const z=await fetch(b);if(!z.ok){S(new Error(`Failed to fetch blob: ${z.status}`));return}const q=await z.blob();U(q)}catch(z){S(z)}}),R=new Promise((U,S)=>{setTimeout(()=>S(new Error("Blob fetch timed out")),1e4)}),F=await Promise.race([$,R]),D=new File([F],w,{type:F.type}),T=await j(D);d.push(T),l=l.replace(n,`[${w}](${T.url})`),console.log("[Debug] Uploaded file and replaced URL with:",T.url)}catch($){console.error("[Error] Processing file failed:",{fileName:w,error:$})}}catch(a){console.error("[Error] Invalid file match format:",{match:n,error:a})}}const M={name:e.name,category:e.category,due_date:e.dueDate,description:l,status:e.status,user_id:t,is_admin_task:p==="admin"||p==="section_admin"||p==="section-admin"||!1};d.length>0&&(M.attachments=d.map(r=>r.url),M.original_file_names=d.map(r=>r.name),console.log("[Debug] Added attachments to task:",{count:d.length,files:d.map(r=>({name:r.name,url:r.url.slice(-30)}))})),e.googleDriveLinks&&e.googleDriveLinks.length>0&&(M.google_drive_links=e.googleDriveLinks),(p==="section_admin"||p==="section-admin")&&f?(M.section_id=f,console.log("[Debug] Section admin creating task for section:",f),!l.includes("For section:")&&!l.includes("Section ID:")&&(M.description+=`

For section: ${f}`)):i?(M.section_id=i,console.log("[Debug] Using provided section_id:",i)):f&&p==="user"&&(M.section_id=f,console.log("[Debug] Regular user creating task for their section:",f)),console.log("[Debug] Final task insert data:",M);let P,A;try{const r=await g.from("tasks").insert(M).select().single();P=r.data,A=r.error}catch(r){if((u=r.message)!=null&&u.includes("google_drive_links")||(E=r.message)!=null&&E.includes("schema cache")){console.log("[Debug] Google Drive links column not found, retrying without it...");const{google_drive_links:n,...a}=M,w=await g.from("tasks").insert(a).select().single();P=w.data,A=w.error}else throw r}if(A)throw console.error("Error creating task:",A),new Error(`Failed to create task: ${A.message}`);if(!P)throw new Error("No data returned from task creation");console.log("[Debug] Successfully created task with ID:",P.id);const N=I(P);if(N.isAdminTask){console.log("[FCM] Task is admin task, sending notifications...");try{await Q(N),console.log("[FCM] Push notification sent successfully")}catch(r){console.error("[FCM] Failed to send push notification:",r)}await J(N)}else console.log("[FCM] Task is not admin task, skipping push notification");return N}catch(o){throw console.error("Error in createTask:",o),new Error(`Task creation failed: ${o.message}`)}};async function Z(t,e){var i,c;try{const s={};e.name!==void 0&&(s.name=e.name),e.category!==void 0&&(s.category=e.category),e.dueDate!==void 0&&(s.due_date=e.dueDate),e.description!==void 0&&(s.description=e.description),e.status!==void 0&&(s.status=e.status),e.sectionId!==void 0&&(s.section_id=e.sectionId),e.googleDriveLinks!==void 0&&e.googleDriveLinks.length>0&&(s.google_drive_links=e.googleDriveLinks);let u,E;try{const o=await g.from("tasks").update(s).eq("id",t).select("id, name, category, due_date, description, status, created_at, is_admin_task, section_id").single();u=o.data,E=o.error}catch(o){if((i=o.message)!=null&&i.includes("google_drive_links")||(c=o.message)!=null&&c.includes("schema cache")){console.log("Google Drive links column not found, retrying update without it...");const{google_drive_links:p,...f}=s,y=await g.from("tasks").update(f).eq("id",t).select("id, name, category, due_date, description, status, created_at, is_admin_task, section_id").single();u=y.data,E=y.error}else throw o}if(E)throw console.error("Database error:",E),new Error("Failed to update task");if(!u)throw new Error("Task not found");return{id:u.id,name:u.name,category:u.category,dueDate:u.due_date,description:u.description,status:u.status,createdAt:u.created_at,isAdminTask:u.is_admin_task,sectionId:u.section_id}}catch(s){throw console.error("Error updating task:",s),s}}async function V(t){try{const{error:e}=await g.from("tasks").delete().eq("id",t);if(e)throw e}catch(e){throw console.error("Error deleting task:",e),new Error(e.message||"Failed to delete task")}}async function Q(t){try{const e="https://nglfbbdoyyfslzyjarqs.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5nbGZiYmRveXlmc2x6eWphcnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1OTgyMTQsImV4cCI6MjA4MzE3NDIxNH0.3sXujO3rtin57rTcHpXHi6Zfi9XJCEX3-mmcnnB8cJE";console.log("[FCM] Sending push notification for task:",t.id),console.log("[FCM] Supabase URL:",e?"Set":"Missing"),console.log("[FCM] Supabase Anon Key:",i?"Set":"Missing");const c=new Date(t.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),s={taskId:t.id,title:"New Task",body:`${t.name} - Due: ${c}`,sectionId:t.sectionId||void 0,data:{category:t.category,priority:t.priority||"medium"}};console.log("[FCM] Calling edge function with payload:",JSON.stringify(s));const u=await fetch(`${e}/functions/v1/send-fcm-push`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(s)});if(console.log("[FCM] Edge function response status:",u.status),!u.ok){const o=await u.json().catch(()=>({}));throw console.error("[FCM] Push notification failed:",o),new Error(`FCM push failed: ${JSON.stringify(o)}`)}const E=await u.json();console.log(`[FCM] Push notification sent: ${E.sent}/${E.total} devices`,E)}catch(e){throw console.error("[FCM] Error sending FCM push notification:",e),e}}const x=45e3,C=new Map,ee=5,te=3;function se(t){const[e,i]=h.useState([]),[c,s]=h.useState(!0),[u,E]=h.useState(null),[o,p]=h.useState(0),f=h.useRef(!1),y=h.useRef(0),k=h.useRef(!0),v=h.useRef(null),m=h.useRef(t),l=h.useRef(!1),d=h.useRef(!1),_=h.useRef(Date.now()),O=h.useRef(0);h.useEffect(()=>{m.current=t},[t]),h.useEffect(()=>{const r=()=>{if(document.visibilityState==="hidden")d.current=!0,_.current=Date.now();else if(document.visibilityState==="visible"){const n=Date.now()-_.current;_.current=Date.now(),f.current&&(console.log("[useTasks] Resetting stuck loading state after visibility change"),f.current=!1,k.current&&s(!1)),n<3e4?(d.current=!0,setTimeout(()=>{d.current=!1},1e3)):d.current=!1}};return document.addEventListener("visibilitychange",r),()=>{document.removeEventListener("visibilitychange",r)}},[]);const L=h.useCallback(async(r={})=>{if(!t)return;v.current&&v.current.abort(),v.current=new AbortController;const n=v.current.signal;if(r.force&&(l.current=!0,f.current=!1,k.current&&p(0)),f.current&&!r.force){console.log("[useTasks] Loading already in progress, skipping");return}const a=Date.now(),w=l.current?1e3:3e3;if(!r.force&&a-y.current<w){console.log("Task loading throttled - too soon since last load");return}try{const b=e.length>0,$=!d.current||!b;k.current&&$&&s(!0),f.current=!0,k.current&&E(null);let R=!0;{const{data:{user:U}}=await g.auth.getUser();if(R=await B(),!R)throw new Error("Unable to connect to database");const{data:S}=await g.auth.getSession();if(!S.session)throw console.log("No session found during task fetch, skipping reload"),new Error("Session expired - please refresh the page")}if(n.aborted){console.log("Task loading aborted");return}const F=async()=>await H(t,void 0),D=new Promise((U,S)=>{setTimeout(()=>S(new Error("Task fetch timeout")),x)}),T=await Promise.race([F(),D]);k.current&&!n.aborted&&(i(T),E(null),y.current=Date.now(),p(0),l.current=!1)}catch(b){if(k.current&&(!v.current||!v.current.signal.aborted)){console.error("Error fetching tasks:",b),b.message==="Task fetch timeout"?E(`Failed to refresh: Task fetch timeout after ${x/1e3}s. Network may be slow or server overloaded.`):E(b.message||"Failed to load tasks");const $=b.message==="Task fetch timeout"?ee:te;if(o<$){const R=Math.floor(Math.random()*1e3),F=Math.min(1e3*Math.pow(2,o)+R,15e3);console.log(`Retrying task fetch in ${F}ms (attempt ${o+1}/${$})`),setTimeout(()=>{k.current&&p(D=>D+1)},F)}else o>=$&&(l.current=!0,console.warn(`Maximum retries (${$}) reached for task fetching. Will force refresh next time.`))}}finally{f.current=!1,k.current&&s(!1)}},[t,o]);h.useEffect(()=>{const r=()=>{const n=Date.now();n-O.current<1500||(O.current=n,m.current&&(console.log("[useTasks] Resume/reconnect detected, forcing task refresh"),L({force:!0})))};return window.addEventListener("app-resume",r),window.addEventListener("supabase-resume",r),window.addEventListener("supabase-session-refreshed",r),window.addEventListener("supabase-network-reconnect",r),window.addEventListener("supabase-visibility-refresh",r),()=>{window.removeEventListener("app-resume",r),window.removeEventListener("supabase-resume",r),window.removeEventListener("supabase-session-refreshed",r),window.removeEventListener("supabase-network-reconnect",r),window.removeEventListener("supabase-visibility-refresh",r)}},[L]),h.useEffect(()=>{if(!t){i([]),s(!1);return}return k.current=!0,s(!0),L(),()=>{k.current=!1,v.current&&v.current.abort()}},[t,L]);const M=async(r,n)=>{if(!t)throw new Error("User ID is required");f.current&&(console.log("[useTasks] Resetting stuck loading state before task creation"),f.current=!1);try{const a=await K(t,r,n);if(k.current&&(i(w=>[...w,a]),C.has(t))){const w=C.get(t);C.set(t,{tasks:[...w.tasks,a],timestamp:Date.now()})}return a}catch(a){throw console.error("Error creating task:",a),a}},P=async(r,n)=>{try{const a=await Z(r,n);if(k.current&&(i(w=>w.map(b=>b.id===r?{...b,...a}:b)),t&&C.has(t))){const w=C.get(t);C.set(t,{tasks:w.tasks.map(b=>b.id===r?{...b,...a}:b),timestamp:Date.now()})}return a}catch(a){throw console.error("Error updating task:",a),a}},A=async r=>{try{if(await V(r),k.current&&(i(n=>n.filter(a=>a.id!==r)),t&&C.has(t))){const n=C.get(t);C.set(t,{tasks:n.tasks.filter(a=>a.id!==r),timestamp:Date.now()})}return!0}catch(n){throw console.error("Error deleting task:",n),n}},N=h.useCallback(async(r=!1)=>{try{return await L({force:r}),!0}catch(n){return console.error("[useTasks] Refresh failed:",n),!1}},[L]);return{tasks:e,loading:c,error:u,createTask:M,updateTask:P,deleteTask:A,refreshTasks:N}}export{se as a,ne as u};
