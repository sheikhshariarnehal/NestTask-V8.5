import{r as o,j as e,s as j}from"./index.BsUn6o1f.js";import{A as Y,a as k,b as U,c as D}from"./AuthSubmitButton.vz_8j8Ko.js";import{a as b}from"./authErrors.D8KAnYp0.js";import{S as F,C as m}from"./shield-check.BuU-cRkU.js";import{L as N}from"./lock.BgASxx5g.js";import{E as v}from"./eye-off.Cfbmtz3O.js";import{E as P}from"./eye.CK8RlaQH.js";import{L as M}from"./loader-2.BWvTzIKP.js";import{X as h}from"./x.BCXIWhyP.js";import"./createLucideIcon.ZiJ1qpVt.js";import"./alert-circle.DEXd6BUr.js";const O=s=>{if(!s)return{strength:"weak",score:0};let r=0;s.length>=8&&(r+=1),s.length>=12&&(r+=1),/[A-Z]/.test(s)&&(r+=1),/[a-z]/.test(s)&&(r+=1),/[0-9]/.test(s)&&(r+=1),/[^A-Za-z0-9]/.test(s)&&(r+=1);let n="weak";return r>=5?n="very-strong":r>=4?n="strong":r>=3&&(n="medium"),{strength:n,score:Math.min(r,6)}};function te(){const[s,r]=o.useState(""),[n,S]=o.useState(""),[u,w]=o.useState(!1),[p,l]=o.useState(null),[x,C]=o.useState(!1),[i,A]=o.useState({password:!1,confirmPassword:!1}),[f,z]=o.useState(!1),[g,E]=o.useState(!1),[c,L]=o.useState(3),{strength:d,score:R}=O(s),Z={weak:"bg-red-500",medium:"bg-yellow-500",strong:"bg-green-500","very-strong":"bg-emerald-500"};o.useEffect(()=>{(async()=>{try{const{data:{session:t}}=await j.auth.getSession();t?console.log("Valid session found for password reset"):(console.error("No active session found for password reset"),l("Your password reset link appears to be invalid or has expired. Please request a new link."))}catch(t){console.error("Session check error:",t),l("Unable to verify your session. Please try again or request a new reset link.")}})()},[]),o.useEffect(()=>{if(x&&c>0){const a=setTimeout(()=>L(c-1),1e3);return()=>clearTimeout(a)}else x&&c===0&&(window.location.href="/")},[x,c]);const $=()=>b(s)?s!==n?(l("Passwords do not match"),!1):d==="weak"?(l("Your password is too weak. Please choose a stronger password."),!1):!0:(l("Password must be at least 6 characters long"),!1),I=async a=>{if(a.preventDefault(),l(null),!!$()){w(!0);try{console.log("Attempting to update password");const{error:t}=await j.auth.updateUser({password:s});if(t)throw console.error("Password update error:",t),t;console.log("Password updated successfully"),C(!0),window.history.pushState&&window.history.pushState("","","/")}catch(t){console.error("Password reset error:",t),l(t.message||"An error occurred while resetting your password. Please try again.")}finally{w(!1)}}},y=(a,t)=>{a==="password"?r(t):S(t),A(B=>({...B,[a]:!0})),l(null)},q=()=>{window.history.pushState&&window.history.pushState("","","/"),window.location.reload()},T=()=>e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Password requirements:"}),e.jsxs("ul",{className:"space-y-1 pl-1",children:[e.jsxs("li",{className:`flex items-center ${s.length>=6?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:[s.length>=6?e.jsx(m,{size:16,className:"mr-2 flex-shrink-0"}):e.jsx(h,{size:16,className:"mr-2 flex-shrink-0"}),"At least 6 characters"]}),e.jsxs("li",{className:`flex items-center ${/[A-Z]/.test(s)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:[/[A-Z]/.test(s)?e.jsx(m,{size:16,className:"mr-2 flex-shrink-0"}):e.jsx(h,{size:16,className:"mr-2 flex-shrink-0"}),"At least one uppercase letter"]}),e.jsxs("li",{className:`flex items-center ${/[0-9]/.test(s)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:[/[0-9]/.test(s)?e.jsx(m,{size:16,className:"mr-2 flex-shrink-0"}):e.jsx(h,{size:16,className:"mr-2 flex-shrink-0"}),"At least one number"]}),e.jsxs("li",{className:`flex items-center ${/[^A-Za-z0-9]/.test(s)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:[/[^A-Za-z0-9]/.test(s)?e.jsx(m,{size:16,className:"mr-2 flex-shrink-0"}):e.jsx(h,{size:16,className:"mr-2 flex-shrink-0"}),"At least one special character"]})]})]});return e.jsx("div",{className:"h-screen w-full bg-gray-50 dark:bg-gray-900 overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 overflow-y-auto safe-area-inset-bottom",children:e.jsx("div",{className:"min-h-full flex flex-col justify-center py-6 sm:py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 py-8 px-4 shadow-xl shadow-gray-200/50 dark:shadow-none rounded-2xl sm:px-10 border border-gray-100 dark:border-gray-700 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl mb-4",children:e.jsx(F,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white tracking-tight",children:"Reset Password"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Create a new secure password for your account"})]}),p&&e.jsx(Y,{message:p}),x?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-green-50 dark:bg-green-900/20 rounded-full mb-4 ring-8 ring-green-50/50 dark:ring-green-900/10",children:e.jsx(m,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your password has been changed successfully."}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Redirecting to login in ",e.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:c})," seconds..."]})]}):e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{type:f?"text":"password",value:s,onChange:a=>y("password",a),label:"New Password",placeholder:"Enter your new password",icon:N,error:i.password&&!b(s)?"Password must be at least 6 characters":"",rightElement:e.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500 transition-colors",onClick:()=>z(!f),tabIndex:-1,children:f?e.jsx(v,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})}),i.password&&s&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-xs font-medium capitalize text-gray-700 dark:text-gray-300",children:d.replace("-"," ")})}),e.jsx("div",{className:"h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${Z[d]} transition-all duration-500 ease-out`,style:{width:`${R/6*100}%`}})})]}),i.password&&s&&d==="weak"&&e.jsx("p",{className:"mt-1 text-xs text-red-500 dark:text-red-400",children:"Choose a stronger password for better security"})]}),e.jsx(k,{type:g?"text":"password",value:n,onChange:a=>y("confirmPassword",a),label:"Confirm Password",placeholder:"Confirm your new password",icon:N,error:i.confirmPassword&&s!==n?"Passwords do not match":"",rightElement:e.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500 transition-colors",onClick:()=>E(!g),tabIndex:-1,children:g?e.jsx(v,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})}),i.password&&s&&T(),e.jsx(U,{label:u?"Resetting Password...":"Reset Password",isLoading:u,icon:u?M:void 0,disabled:!s||!n||s!==n||d==="weak"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{type:"button",onClick:q,className:"inline-flex items-center justify-center text-sm font-medium text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Back to Login"]})})]})]})})})})})}export{te as ResetPasswordPage};
