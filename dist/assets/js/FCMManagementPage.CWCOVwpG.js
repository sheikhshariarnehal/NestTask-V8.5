import{r as e,j as t,s as a,b as r}from"./index.DKgkbjjM.js";import{B as s}from"./bell.CH3vX7OS.js";import{S as i}from"./smartphone.1-wcBAiY.js";import{T as n,M as d}from"./tablet.BLKWg5er.js";import{T as o}from"./trending-up.Btr2XspN.js";import{U as l}from"./users.DzIhdFjc.js";import{C as c}from"./check-circle.CoJyQNw4.js";import{X as g}from"./x-circle.fORvbVv9.js";import{C as x}from"./clock.C7szXKwP.js";import{X as m}from"./x.AsJhua7L.js";import{A as u}from"./alert-circle.CE6e8T-w.js";import{L as h}from"./loader-2.DOw-WVaD.js";import{S as p}from"./send.Cj85wzxY.js";import{s as b,a as y}from"./notifications.DvTNppm3.js";import{R as k}from"./refresh-cw.CULTp-SV.js";import{D as f}from"./download.BVePPpU1.js";import{S as j}from"./search.CpX_H1TR.js";import{F as v}from"./filter.Dzf5lkqt.js";import{u as w}from"./useAuth.CD0Ieqgj.js";import"./createLucideIcon.DLdkJiYI.js";import"./dataCache.yGM8Zd45.js";import"./authErrors.BDay5vyW.js";function N({stats:a,loading:r}){const c=e.useMemo((()=>[{title:"Total Active Tokens",value:a.activeTokens,total:a.totalTokens,icon:s,color:"blue",description:`${a.inactiveTokens} inactive`},{title:"Android Devices",value:a.androidTokens,icon:i,color:"green",description:`${(a.androidTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"iOS Devices",value:a.iosTokens,icon:n,color:"purple",description:`${(a.iosTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"Web Tokens",value:a.webTokens,icon:d,color:"orange",description:`${(a.webTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"User Coverage",value:`${a.coveragePercentage.toFixed(1)}%`,icon:o,color:"indigo",description:`${a.usersWithTokens} of ${a.totalUsers} users`},{title:"Users with Tokens",value:a.usersWithTokens,total:a.totalUsers,icon:l,color:"cyan",description:a.totalUsers-a.usersWithTokens+" without tokens"}]),[a]);return r?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[...Array(6)].map(((e,a)=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),t.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"})]},a)))}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:c.map(((e,a)=>{const r=(e=>{const t={blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-600 dark:text-blue-400"},green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-600 dark:text-green-400"},purple:{bg:"bg-purple-50 dark:bg-purple-900/20",text:"text-purple-700 dark:text-purple-300",icon:"text-purple-600 dark:text-purple-400"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-600 dark:text-orange-400"},indigo:{bg:"bg-indigo-50 dark:bg-indigo-900/20",text:"text-indigo-700 dark:text-indigo-300",icon:"text-indigo-600 dark:text-indigo-400"},cyan:{bg:"bg-cyan-50 dark:bg-cyan-900/20",text:"text-cyan-700 dark:text-cyan-300",icon:"text-cyan-600 dark:text-cyan-400"}};return t[e]||t.blue})(e.color),s=e.icon;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${r.bg}`,children:t.jsx(s,{className:`h-5 w-5 ${r.icon}`})}),void 0!==e.total&&t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["/ ",e.total]})]}),t.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:e.title}),t.jsx("p",{className:`text-2xl font-bold ${r.text} mb-1`,children:e.value}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]},a)}))})}function T({tokens:e,loading:a,onSendTest:r}){const o=e=>{switch(e){case"android":default:return t.jsx(i,{className:"h-4 w-4"});case"ios":return t.jsx(n,{className:"h-4 w-4"});case"web":return t.jsx(d,{className:"h-4 w-4"})}},l=e=>{switch(e){case"android":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"ios":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400";case"web":return"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}},m=e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),r=Math.floor(a/6e4),s=Math.floor(a/36e5),i=Math.floor(a/864e5);return r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:i<7?`${i}d ago`:t.toLocaleDateString()};return a?t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[...Array(5)].map(((e,a)=>t.jsxs("tr",{className:"animate-pulse",children:[t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 ml-auto"})})]},a)))})]})})}):0===e.length?t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-12 text-center",children:[t.jsx(s,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No FCM Tokens Found"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No users in this section have registered for push notifications yet."})]}):t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800",children:e.map((e=>{var a,s;return t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm",children:(null==(s=null==(a=e.users.name||e.users.email)?void 0:a[0])?void 0:s.toUpperCase())||"U"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.users.name||"Unnamed User"}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.users.email}),e.users.student_id&&t.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["ID: ",e.users.student_id]})]})]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${l(e.platform)}`,children:[o(e.platform),e.platform.charAt(0).toUpperCase()+e.platform.slice(1)]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.is_active?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[t.jsx(c,{className:"h-3 w-3"}),"Active"]}):t.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",children:[t.jsx(g,{className:"h-3 w-3"}),"Inactive"]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx(x,{className:"h-3.5 w-3.5"}),m(e.updated_at)]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.is_active&&r&&t.jsx("button",{onClick:()=>r(e.users.id,e.users.name||e.users.email),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium transition-colors",children:"Send Test"})})]},e.id)}))})]})}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",e.length," token",1!==e.length?"s":""]})})]})}function C({isOpen:a,onClose:r,onSend:s,userName:i,userId:n}){const[d,o]=e.useState("Test Notification"),[l,g]=e.useState("This is a test notification from FCM Manager"),[x,b]=e.useState(!1),[y,k]=e.useState(null),f=()=>{x||(r(),k(null))};return a?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:f}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Send Test Notification"}),i&&t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["To: ",i]})]}),t.jsx("button",{onClick:f,disabled:x,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors disabled:opacity-50",children:t.jsx(m,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Title"}),t.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),disabled:x,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors disabled:opacity-50",placeholder:"Enter notification title",maxLength:100}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.length,"/100 characters"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Body"}),t.jsx("textarea",{value:l,onChange:e=>g(e.target.value),disabled:x,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none disabled:opacity-50",placeholder:"Enter notification message",maxLength:200}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[l.length,"/200 characters"]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[t.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Preview:"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:d||"Title"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:l||"Message body"})]})]}),y&&t.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg "+(y.success?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"),children:[y.success?t.jsx(c,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):t.jsx(u,{className:"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0"}),t.jsx("p",{className:"text-sm "+(y.success?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:y.message})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:f,disabled:x,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(d.trim()&&l.trim()){b(!0),k(null);try{const e={title:d.trim(),body:l.trim(),data:{type:"test",timestamp:(new Date).toISOString()},userIds:n?[n]:void 0},t=await s(e);k(t),t.success&&setTimeout((()=>{r(),o("Test Notification"),g("This is a test notification from FCM Manager"),k(null)}),2e3)}catch(e){k({success:!1,message:e.message||"Failed to send notification"})}finally{b(!1)}}else k({success:!1,message:"Title and body are required"})},disabled:x||!d.trim()||!l.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:x?t.jsxs(t.Fragment,{children:[t.jsx(h,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(p,{className:"h-4 w-4"}),"Send Notification"]})})]})]})]})}):null}async function S(e,t){const{data:r,error:s}=await a.from("section_admins").select("id").eq("user_id",e).eq("section_id",t).single();return!s&&!!r}async function _(e,t){if(!(await S(t,e)))throw new Error("Unauthorized: You are not a section admin for this section");const{data:r,error:s}=await a.from("users").select("id, name, email, student_id, section_id").eq("section_id",e);if(s)throw s;if(!r||0===r.length)return[];const i=r.map((e=>e.id)),{data:n,error:d}=await a.from("fcm_tokens").select("*").in("user_id",i).order("updated_at",{ascending:!1});if(d)throw d;const o=new Map(r.map((e=>[e.id,e])));return(n||[]).map((e=>{const t=o.get(e.user_id);return t?{...e,users:t}:null})).filter((e=>null!==e))}async function U(e,t){if(!(await S(t,e)))throw new Error("Unauthorized: You are not a section admin for this section");const{data:r,error:s}=await a.from("users").select("id").eq("section_id",e);if(s)throw s;const i=(null==r?void 0:r.length)||0;if(0===i)return{totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null};const n=r.map((e=>e.id)),{data:d,error:o}=await a.from("fcm_tokens").select("*").in("user_id",n).order("created_at",{ascending:!1});if(o)throw o;const l=d||[],c=l.filter((e=>e.is_active)),g=new Set(c.map((e=>e.user_id))).size;return{totalTokens:l.length,activeTokens:c.length,inactiveTokens:l.length-c.length,androidTokens:c.filter((e=>"android"===e.platform)).length,iosTokens:c.filter((e=>"ios"===e.platform)).length,webTokens:c.filter((e=>"web"===e.platform)).length,totalUsers:i||0,usersWithTokens:g,coveragePercentage:i?g/i*100:0,lastRegistration:l.length>0?l[0].created_at:null}}function F({sectionId:r,sectionName:i,userId:n}){const[d,o]=e.useState([]),[l,c]=e.useState({totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null}),[g,x]=e.useState(!0),[u,h]=e.useState(!1),[w,F]=e.useState(""),[L,A]=e.useState("all"),[I,M]=e.useState("all"),[$,D]=e.useState(!1),[E,O]=e.useState(null);e.useEffect((()=>{r&&n&&P()}),[r,n]);const P=e.useCallback((async()=>{try{x(!0);const[e,t]=await Promise.all([_(r,n),U(r,n)]);o(e),c(t)}catch(e){b(e.message||"Failed to load FCM tokens")}finally{x(!1)}}),[r,n]),R=e.useCallback((async()=>{try{h(!0),await P(),y("FCM tokens refreshed successfully")}catch(e){b("Failed to refresh tokens")}finally{h(!1)}}),[P]),W=e.useCallback((()=>{try{const e=function(e){const t=e.map((e=>[e.users.name||"N/A",e.users.email,e.users.student_id||"N/A",e.platform,e.is_active?"Active":"Inactive",new Date(e.updated_at).toLocaleString()]));return[["User Name","Email","Student ID","Platform","Status","Last Updated"].join(","),...t.map((e=>e.map((e=>`"${e}"`)).join(",")))].join("\n")}(d.filter((e=>{var t,a;const r=w.toLowerCase(),s=!w||(null==(t=e.users.name)?void 0:t.toLowerCase().includes(r))||e.users.email.toLowerCase().includes(r)||(null==(a=e.users.student_id)?void 0:a.toLowerCase().includes(r)),i="all"===L||e.platform===L,n="all"===I||"active"===I&&e.is_active||"inactive"===I&&!e.is_active;return s&&i&&n}))),t=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`fcm-tokens-${i}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),y("Tokens exported successfully")}catch(e){b("Failed to export tokens")}}),[d,w,L,I,i]),z=e.useCallback(((e,t)=>{O({id:e,name:t}),D(!0)}),[]),q=e.useCallback((async e=>{try{const t=await async function(e,t,r){if(!(await S(r,t)))throw new Error("Unauthorized: You are not a section admin for this section");try{const{data:r,error:s}=await a.functions.invoke("send-fcm-push",{body:{title:e.title,body:e.body,data:e.data||{},sectionId:t,userIds:e.userIds}});return s?{success:!1,message:`Failed to send notification: ${s.message}`,details:s}:{success:!0,message:`Notification sent successfully to ${(null==r?void 0:r.sent)||0} device(s)`,details:r}}catch(s){return{success:!1,message:s.message||"Failed to send notification",details:s}}}(e,r,n);return t.success?y(t.message):b(t.message),t}catch(t){const e=t.message||"Failed to send notification";return b(e),{success:!1,message:e}}}),[r,n]),B=e.useCallback((()=>{O(null),D(!0)}),[]),Y=e.useMemo((()=>d.filter((e=>{var t,a;const r=w.toLowerCase(),s=!w||(null==(t=e.users.name)?void 0:t.toLowerCase().includes(r))||e.users.email.toLowerCase().includes(r)||(null==(a=e.users.student_id)?void 0:a.toLowerCase().includes(r)),i="all"===L||e.platform===L,n="all"===I||"active"===I&&e.is_active||"inactive"===I&&!e.is_active;return s&&i&&n}))),[d,w,L,I]),V=w||"all"!==L||"all"!==I,X=e.useCallback((()=>{F(""),A("all"),M("all")}),[]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(s,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),"FCM Token Management"]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Monitor and manage push notification tokens for ",i]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:R,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Refresh data",children:[t.jsx(k,{className:"h-4 w-4 "+(u?"animate-spin":"")}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),t.jsxs("button",{onClick:W,disabled:0===Y.length,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Export to CSV",children:[t.jsx(f,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),t.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm",title:"Send broadcast notification",children:[t.jsx(p,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Broadcast"})]})]})]}),t.jsx(N,{stats:l,loading:g}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:w,onChange:e=>F(e.target.value),placeholder:"Search by name, email, or student ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]})}),t.jsx("div",{className:"w-full lg:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:L,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[t.jsx("option",{value:"all",children:"All Platforms"}),t.jsx("option",{value:"android",children:"Android"}),t.jsx("option",{value:"ios",children:"iOS"}),t.jsx("option",{value:"web",children:"Web"})]})]})}),t.jsx("div",{className:"w-full lg:w-48",children:t.jsxs("select",{value:I,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active Only"}),t.jsx("option",{value:"inactive",children:"Inactive Only"})]})}),V&&t.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:[t.jsx(m,{className:"h-4 w-4"}),"Clear"]})]}),V&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",Y.length," of ",d.length," tokens"]})})]}),t.jsx(T,{tokens:Y,loading:g,onSendTest:z}),t.jsx(C,{isOpen:$,onClose:()=>{D(!1),O(null)},onSend:q,userName:null==E?void 0:E.name,userId:null==E?void 0:E.id})]})}function L(){const{user:e}=w(),{isSectionAdmin:a,sectionId:s,sectionName:i}=r();return a&&s&&(null==e?void 0:e.id)?t.jsx(F,{sectionId:s,sectionName:i||"Unknown Section",userId:e.id}):t.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 max-w-md",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(u,{className:"h-6 w-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-red-800 dark:text-red-300 font-semibold mb-1",children:"Access Denied"}),t.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm",children:"Only section admins can access FCM token management."})]})]})})})}export{L as FCMManagementPage,L as default};
