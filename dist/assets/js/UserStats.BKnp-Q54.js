import{r as o,s as k,j as e}from"./index.D6B7_sTU.js";import{X as m}from"./x.B_FsHtPn.js";import{A as D}from"./alert-circle.DWKx4yBC.js";import{T as A}from"./tag.CK0Uhtxb.js";import{C as f}from"./calendar.CKLlhBKc.js";import{C as w}from"./clock.aElnGpw7.js";import{U as p}from"./user-check.CIBYMDKB.js";import{U as T}from"./users.Bn6RLipW.js";import{L as U}from"./list-todo.CsVNu9aJ.js";import"./createLucideIcon.BhiB5r5E.js";function C(){const[a,s]=o.useState({totalUsers:0,activeToday:0,newThisWeek:0}),[l,r]=o.useState(!0),[t,i]=o.useState(null);o.useEffect(()=>{n()},[]);const n=async()=>{try{r(!0);const{data:d,error:c}=await k.rpc("get_user_stats");if(c)throw c;s({totalUsers:d.total_users,activeToday:d.active_today,newThisWeek:d.new_this_week})}catch(d){console.error("Error fetching user stats:",d),i(d.message)}finally{r(!1)}};return{stats:a,loading:l,error:t,refresh:n}}function S({title:a,value:s,icon:l,color:r,onClick:t,loading:i=!1}){const n=()=>{switch(r){case"blue":return"bg-blue-50 text-blue-600 hover:bg-blue-100";case"green":return"bg-green-50 text-green-600 hover:bg-green-100";case"purple":return"bg-purple-50 text-purple-600 hover:bg-purple-100";case"indigo":return"bg-indigo-50 text-indigo-600 hover:bg-indigo-100"}};return e.jsx("button",{onClick:t,disabled:i,className:`
        w-full bg-white rounded-2xl p-6 shadow-sm 
        transition-all duration-300 
        ${t?"hover:shadow-lg hover:-translate-y-1 cursor-pointer":"cursor-default"}
      `,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a}),i?e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl transition-colors ${n()}`,children:e.jsx(l,{className:"w-6 h-6"})})]})})}function z({users:a=[],onClose:s}){return a!=null&&a.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(m,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:e.jsx("div",{className:"divide-y",children:a.map(l=>e.jsxs("div",{className:"py-4 first:pt-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-medium",children:l.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:l.email})]}),e.jsx("span",{className:`ml-auto px-2.5 py-0.5 text-xs font-medium rounded-full ${l.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:l.role})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Joined ",new Date(l.createdAt).toLocaleDateString()]})]},l.id))})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User Details"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(m,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No users found"})})]})]})}function L({tasks:a=[],onClose:s}){const l=[...a].sort((t,i)=>new Date(i.createdAt).getTime()-new Date(t.createdAt).getTime()),r=t=>{switch(t){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}};return a!=null&&a.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-4xl bg-white rounded-2xl shadow-xl z-50 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"All Tasks"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Total ",a.length," tasks in the system"]})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(m,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-80px)]",children:e.jsx("div",{className:"grid gap-4",children:l.map(t=>e.jsx("div",{className:"bg-white border rounded-xl p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${r(t.status)}`,children:t.status==="my-tasks"?"To Do":t.status==="in-progress"?"In Progress":"Completed"}),t.isAdminTask&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-800 rounded-full",children:"Admin Task"})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:t.category})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsxs("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]})]})]})})},t.id))})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsxs("div",{className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-2xl shadow-xl z-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Task Details"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(m,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No tasks found"})})]})]})}function F({users:a,type:s,onClose:l}){const r=a.filter(t=>{if(!t.lastActive&&!t.createdAt)return!1;const i=new Date;if(s==="active"){const n=t.lastActive?new Date(t.lastActive):null;if(!n)return!1;const d=new Date(i);d.setHours(0,0,0,0);const c=new Date(i);return c.setHours(23,59,59,999),n>=d&&n<=c}else{const n=new Date(i.getTime()-6048e5);return new Date(t.createdAt)>=n}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm z-40",onClick:l}),e.jsxs("div",{className:"fixed inset-x-4 top-[5%] sm:top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl z-50 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:s==="active"?e.jsx(p,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}):e.jsx(f,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:s==="active"?"Active Users Today":"New Users This Week"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length," ",r.length===1?"user":"users"]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close modal",children:e.jsx(m,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),e.jsx("div",{className:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center",children:s==="active"?e.jsx(p,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}):e.jsx(f,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s==="active"?"No users have been active today":"No new users have joined this week"})]}):e.jsx("div",{className:"space-y-3",children:r.map(t=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-grow min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white font-medium flex-shrink-0",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-3 ml-13 sm:ml-0",children:[e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${t.role==="admin"?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300"}`,children:t.role}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:new Date(s==="active"&&t.lastActive||t.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},t.id))})})]})]})}function X({users:a,tasks:s}){const{stats:l,loading:r}=C(),[t,i]=o.useState(!1),[n,d]=o.useState(!1),[c,u]=o.useState(null),v=()=>{const x=new Date,h=new Date(x);return h.setHours(0,0,0,0),a.filter(g=>g.lastActive?new Date(g.lastActive)>=h:!1)},N=()=>{const x=new Date,h=new Date(x.getTime()-7*24*60*60*1e3);return a.filter(g=>new Date(g.createdAt)>=h)},b=v(),j=N(),y=[{title:"Total Users",value:a.length,icon:T,color:"blue",onClick:()=>i(!0)},{title:"Active Today",value:b.length,icon:p,color:"green",onClick:()=>u("active")},{title:"New This Week",value:j.length,icon:w,color:"purple",onClick:()=>u("new")},{title:"Total Tasks",value:s.length,icon:U,color:"indigo",onClick:()=>d(!0)}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:y.map(x=>e.jsx(S,{...x,loading:r},x.title))}),t&&e.jsx(z,{users:a,onClose:()=>i(!1)}),n&&e.jsx(L,{tasks:s,onClose:()=>d(!1)}),c&&e.jsx(F,{users:c==="active"?b:j,type:c,onClose:()=>u(null)})]})}export{X as UserStats};
