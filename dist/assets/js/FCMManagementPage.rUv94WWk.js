import{r as e,j as t,h as a}from"./react-vendor.ChEovXhk.js";import{Bell as r,LucideSmartphone as s,LucideTablet as i,LucideMonitor as n,LucideTrendingUp as d,LucideUsers as o,CheckCircle as l,LucideXCircle as c,Clock as g,LucideX as x,AlertCircle as m,Loader2 as u,LucideSend as h,LucideRefreshCw as b,Download as p,LucideSearch as y,Filter as k}from"./icons.Be68WOzY.js";import{s as f}from"./index.8xORY5Vo.js";import{s as v,a as j}from"./notifications.DvTNppm3.js";import{u as w}from"./useAuth.lHsxTFl1.js";import"./charts.B0xhc6u6.js";import"./vendor.puyDUvHC.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.lbvV8mvR.js";import"./supabase-vendor.CQkAbalq.js";import"./dataCache.DP4PyhNH.js";import"./authErrors.BDay5vyW.js";function N({stats:a,loading:l}){const c=e.useMemo((()=>[{title:"Total Active Tokens",value:a.activeTokens,total:a.totalTokens,icon:r,color:"blue",description:`${a.inactiveTokens} inactive`},{title:"Android Devices",value:a.androidTokens,icon:s,color:"green",description:`${(a.androidTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"iOS Devices",value:a.iosTokens,icon:i,color:"purple",description:`${(a.iosTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"Web Tokens",value:a.webTokens,icon:n,color:"orange",description:`${(a.webTokens/a.activeTokens*100||0).toFixed(0)}% of active`},{title:"User Coverage",value:`${a.coveragePercentage.toFixed(1)}%`,icon:d,color:"indigo",description:`${a.usersWithTokens} of ${a.totalUsers} users`},{title:"Users with Tokens",value:a.usersWithTokens,total:a.totalUsers,icon:o,color:"cyan",description:a.totalUsers-a.usersWithTokens+" without tokens"}]),[a]);return l?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[...Array(6)].map(((e,a)=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),t.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"})]},a)))}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:c.map(((e,a)=>{const r=(e=>{const t={blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-600 dark:text-blue-400"},green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-600 dark:text-green-400"},purple:{bg:"bg-purple-50 dark:bg-purple-900/20",text:"text-purple-700 dark:text-purple-300",icon:"text-purple-600 dark:text-purple-400"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-600 dark:text-orange-400"},indigo:{bg:"bg-indigo-50 dark:bg-indigo-900/20",text:"text-indigo-700 dark:text-indigo-300",icon:"text-indigo-600 dark:text-indigo-400"},cyan:{bg:"bg-cyan-50 dark:bg-cyan-900/20",text:"text-cyan-700 dark:text-cyan-300",icon:"text-cyan-600 dark:text-cyan-400"}};return t[e]||t.blue})(e.color),s=e.icon;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${r.bg}`,children:t.jsx(s,{className:`h-5 w-5 ${r.icon}`})}),void 0!==e.total&&t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["/ ",e.total]})]}),t.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:e.title}),t.jsx("p",{className:`text-2xl font-bold ${r.text} mb-1`,children:e.value}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]},a)}))})}function T({tokens:e,loading:a,onSendTest:d}){const o=e=>{switch(e){case"android":default:return t.jsx(s,{className:"h-4 w-4"});case"ios":return t.jsx(i,{className:"h-4 w-4"});case"web":return t.jsx(n,{className:"h-4 w-4"})}},x=e=>{switch(e){case"android":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"ios":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400";case"web":return"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}},m=e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),r=Math.floor(a/6e4),s=Math.floor(a/36e5),i=Math.floor(a/864e5);return r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:i<7?`${i}d ago`:t.toLocaleDateString()};return a?t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[...Array(5)].map(((e,a)=>t.jsxs("tr",{className:"animate-pulse",children:[t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 ml-auto"})})]},a)))})]})})}):0===e.length?t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-12 text-center",children:[t.jsx(r,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No FCM Tokens Found"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No users in this section have registered for push notifications yet."})]}):t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800",children:e.map((e=>{var a,r;return t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm",children:(null==(r=null==(a=e.users.name||e.users.email)?void 0:a[0])?void 0:r.toUpperCase())||"U"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.users.name||"Unnamed User"}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.users.email}),e.users.student_id&&t.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["ID: ",e.users.student_id]})]})]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${x(e.platform)}`,children:[o(e.platform),e.platform.charAt(0).toUpperCase()+e.platform.slice(1)]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.is_active?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[t.jsx(l,{className:"h-3 w-3"}),"Active"]}):t.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",children:[t.jsx(c,{className:"h-3 w-3"}),"Inactive"]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx(g,{className:"h-3.5 w-3.5"}),m(e.updated_at)]})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.is_active&&d&&t.jsx("button",{onClick:()=>d(e.users.id,e.users.name||e.users.email),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium transition-colors",children:"Send Test"})})]},e.id)}))})]})}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",e.length," token",1!==e.length?"s":""]})})]})}function C({isOpen:a,onClose:r,onSend:s,userName:i,userId:n}){const[d,o]=e.useState("Test Notification"),[c,g]=e.useState("This is a test notification from FCM Manager"),[b,p]=e.useState(!1),[y,k]=e.useState(null),f=()=>{b||(r(),k(null))};return a?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:f}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Send Test Notification"}),i&&t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["To: ",i]})]}),t.jsx("button",{onClick:f,disabled:b,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors disabled:opacity-50",children:t.jsx(x,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Title"}),t.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),disabled:b,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors disabled:opacity-50",placeholder:"Enter notification title",maxLength:100}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.length,"/100 characters"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Body"}),t.jsx("textarea",{value:c,onChange:e=>g(e.target.value),disabled:b,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none disabled:opacity-50",placeholder:"Enter notification message",maxLength:200}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[c.length,"/200 characters"]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[t.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Preview:"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:d||"Title"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:c||"Message body"})]})]}),y&&t.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg "+(y.success?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"),children:[y.success?t.jsx(l,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):t.jsx(m,{className:"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0"}),t.jsx("p",{className:"text-sm "+(y.success?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:y.message})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:f,disabled:b,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(d.trim()&&c.trim()){p(!0),k(null);try{const e={title:d.trim(),body:c.trim(),data:{type:"test",timestamp:(new Date).toISOString()},userIds:n?[n]:void 0},t=await s(e);k(t),t.success&&setTimeout((()=>{r(),o("Test Notification"),g("This is a test notification from FCM Manager"),k(null)}),2e3)}catch(e){k({success:!1,message:e.message||"Failed to send notification"})}finally{p(!1)}}else k({success:!1,message:"Title and body are required"})},disabled:b||!d.trim()||!c.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:b?t.jsxs(t.Fragment,{children:[t.jsx(u,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(h,{className:"h-4 w-4"}),"Send Notification"]})})]})]})]})}):null}async function S(e,t){const{data:a,error:r}=await f.from("section_admins").select("id").eq("user_id",e).eq("section_id",t).single();return!r&&!!a}async function _(e,t){if(!(await S(t,e)))throw new Error("Unauthorized: You are not a section admin for this section");const{data:a,error:r}=await f.from("users").select("id, name, email, student_id, section_id").eq("section_id",e);if(r)throw r;if(!a||0===a.length)return[];const s=a.map((e=>e.id)),{data:i,error:n}=await f.from("fcm_tokens").select("*").in("user_id",s).order("updated_at",{ascending:!1});if(n)throw n;const d=new Map(a.map((e=>[e.id,e])));return(i||[]).map((e=>{const t=d.get(e.user_id);return t?{...e,users:t}:null})).filter((e=>null!==e))}async function L(e,t){if(!(await S(t,e)))throw new Error("Unauthorized: You are not a section admin for this section");const{data:a,error:r}=await f.from("users").select("id").eq("section_id",e);if(r)throw r;const s=(null==a?void 0:a.length)||0;if(0===s)return{totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null};const i=a.map((e=>e.id)),{data:n,error:d}=await f.from("fcm_tokens").select("*").in("user_id",i).order("created_at",{ascending:!1});if(d)throw d;const o=n||[],l=o.filter((e=>e.is_active)),c=new Set(l.map((e=>e.user_id))).size;return{totalTokens:o.length,activeTokens:l.length,inactiveTokens:o.length-l.length,androidTokens:l.filter((e=>"android"===e.platform)).length,iosTokens:l.filter((e=>"ios"===e.platform)).length,webTokens:l.filter((e=>"web"===e.platform)).length,totalUsers:s||0,usersWithTokens:c,coveragePercentage:s?c/s*100:0,lastRegistration:o.length>0?o[0].created_at:null}}function U({sectionId:a,sectionName:s,userId:i}){const[n,d]=e.useState([]),[o,l]=e.useState({totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null}),[c,g]=e.useState(!0),[m,u]=e.useState(!1),[w,U]=e.useState(""),[F,M]=e.useState("all"),[I,$]=e.useState("all"),[A,D]=e.useState(!1),[E,O]=e.useState(null);e.useEffect((()=>{a&&i&&P()}),[a,i]);const P=e.useCallback((async()=>{try{g(!0);const[e,t]=await Promise.all([_(a,i),L(a,i)]);d(e),l(t)}catch(e){v(e.message||"Failed to load FCM tokens")}finally{g(!1)}}),[a,i]),R=e.useCallback((async()=>{try{u(!0),await P(),j("FCM tokens refreshed successfully")}catch(e){v("Failed to refresh tokens")}finally{u(!1)}}),[P]),W=e.useCallback((()=>{try{const e=function(e){const t=e.map((e=>[e.users.name||"N/A",e.users.email,e.users.student_id||"N/A",e.platform,e.is_active?"Active":"Inactive",new Date(e.updated_at).toLocaleString()]));return[["User Name","Email","Student ID","Platform","Status","Last Updated"].join(","),...t.map((e=>e.map((e=>`"${e}"`)).join(",")))].join("\n")}(n.filter((e=>{var t,a;const r=w.toLowerCase(),s=!w||(null==(t=e.users.name)?void 0:t.toLowerCase().includes(r))||e.users.email.toLowerCase().includes(r)||(null==(a=e.users.student_id)?void 0:a.toLowerCase().includes(r)),i="all"===F||e.platform===F,n="all"===I||"active"===I&&e.is_active||"inactive"===I&&!e.is_active;return s&&i&&n}))),t=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`fcm-tokens-${s}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),j("Tokens exported successfully")}catch(e){v("Failed to export tokens")}}),[n,w,F,I,s]),z=e.useCallback(((e,t)=>{O({id:e,name:t}),D(!0)}),[]),q=e.useCallback((async e=>{try{const t=await async function(e,t,a){if(!(await S(a,t)))throw new Error("Unauthorized: You are not a section admin for this section");try{const{data:a,error:r}=await f.functions.invoke("send-fcm-push",{body:{title:e.title,body:e.body,data:e.data||{},sectionId:t,userIds:e.userIds}});return r?{success:!1,message:`Failed to send notification: ${r.message}`,details:r}:{success:!0,message:`Notification sent successfully to ${(null==a?void 0:a.sent)||0} device(s)`,details:a}}catch(r){return{success:!1,message:r.message||"Failed to send notification",details:r}}}(e,a,i);return t.success?j(t.message):v(t.message),t}catch(t){const e=t.message||"Failed to send notification";return v(e),{success:!1,message:e}}}),[a,i]),B=e.useCallback((()=>{O(null),D(!0)}),[]),Y=e.useMemo((()=>n.filter((e=>{var t,a;const r=w.toLowerCase(),s=!w||(null==(t=e.users.name)?void 0:t.toLowerCase().includes(r))||e.users.email.toLowerCase().includes(r)||(null==(a=e.users.student_id)?void 0:a.toLowerCase().includes(r)),i="all"===F||e.platform===F,n="all"===I||"active"===I&&e.is_active||"inactive"===I&&!e.is_active;return s&&i&&n}))),[n,w,F,I]),X=w||"all"!==F||"all"!==I,J=e.useCallback((()=>{U(""),M("all"),$("all")}),[]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(r,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),"FCM Token Management"]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Monitor and manage push notification tokens for ",s]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:R,disabled:m,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Refresh data",children:[t.jsx(b,{className:"h-4 w-4 "+(m?"animate-spin":"")}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),t.jsxs("button",{onClick:W,disabled:0===Y.length,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Export to CSV",children:[t.jsx(p,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),t.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm",title:"Send broadcast notification",children:[t.jsx(h,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Broadcast"})]})]})]}),t.jsx(N,{stats:o,loading:c}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:w,onChange:e=>U(e.target.value),placeholder:"Search by name, email, or student ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]})}),t.jsx("div",{className:"w-full lg:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:F,onChange:e=>M(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[t.jsx("option",{value:"all",children:"All Platforms"}),t.jsx("option",{value:"android",children:"Android"}),t.jsx("option",{value:"ios",children:"iOS"}),t.jsx("option",{value:"web",children:"Web"})]})]})}),t.jsx("div",{className:"w-full lg:w-48",children:t.jsxs("select",{value:I,onChange:e=>$(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active Only"}),t.jsx("option",{value:"inactive",children:"Inactive Only"})]})}),X&&t.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:[t.jsx(x,{className:"h-4 w-4"}),"Clear"]})]}),X&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",Y.length," of ",n.length," tokens"]})})]}),t.jsx(T,{tokens:Y,loading:c,onSendTest:z}),t.jsx(C,{isOpen:A,onClose:()=>{D(!1),O(null)},onSend:q,userName:null==E?void 0:E.name,userId:null==E?void 0:E.id})]})}function F(){const{user:e}=w(),{isSectionAdmin:r,sectionId:s,sectionName:i}=a();return r&&s&&(null==e?void 0:e.id)?t.jsx(U,{sectionId:s,sectionName:i||"Unknown Section",userId:e.id}):t.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 max-w-md",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(m,{className:"h-6 w-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-red-800 dark:text-red-300 font-semibold mb-1",children:"Access Denied"}),t.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm",children:"Only section admins can access FCM token management."})]})]})})})}export{F as FCMManagementPage,F as default};
