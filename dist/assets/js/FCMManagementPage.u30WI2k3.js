import{r as x,j as e,s as T,b as re}from"./index.DnzR6Xw6.js";import{B as $}from"./bell.DIPPkzHL.js";import{S as E}from"./smartphone.DINdtTO9.js";import{T as W,M as B}from"./tablet.9cgAUjKE.js";import{T as se}from"./trending-up.jNgeh261.js";import{U as ae}from"./users.CtLFlfDg.js";import{C as q}from"./check-circle.HvqvT-kl.js";import{X as ie}from"./x-circle.C52Jd-lF.js";import{C as ne}from"./clock.2gWByGTN.js";import{X as z}from"./x.Ct24nNjz.js";import{A as X}from"./alert-circle.CNMjXFwL.js";import{L as oe}from"./loader-2.CmW34WUp.js";import{S as Y}from"./send.BRqIJIcc.js";import{s as S,a as L}from"./notifications.4_bC7DbS.js";import{R as de}from"./refresh-cw.ge7Zi8d-.js";import{D as le}from"./download.D1_62RyD.js";import{S as ce}from"./search.C5vurUH_.js";import{F as ge}from"./filter.Bjco3nhG.js";import{u as xe}from"./useAuth.Dl3Mkbuu.js";import"./createLucideIcon.DdHo_Q5I.js";import"./dataCache.CcjqYMC_.js";import"./authErrors.D8KAnYp0.js";function me({stats:t,loading:c}){const o=x.useMemo(()=>[{title:"Total Active Tokens",value:t.activeTokens,total:t.totalTokens,icon:$,color:"blue",description:`${t.inactiveTokens} inactive`},{title:"Android Devices",value:t.androidTokens,icon:E,color:"green",description:`${(t.androidTokens/t.activeTokens*100||0).toFixed(0)}% of active`},{title:"iOS Devices",value:t.iosTokens,icon:W,color:"purple",description:`${(t.iosTokens/t.activeTokens*100||0).toFixed(0)}% of active`},{title:"Web Tokens",value:t.webTokens,icon:B,color:"orange",description:`${(t.webTokens/t.activeTokens*100||0).toFixed(0)}% of active`},{title:"User Coverage",value:`${t.coveragePercentage.toFixed(1)}%`,icon:se,color:"indigo",description:`${t.usersWithTokens} of ${t.totalUsers} users`},{title:"Users with Tokens",value:t.usersWithTokens,total:t.totalUsers,icon:ae,color:"cyan",description:`${t.totalUsers-t.usersWithTokens} without tokens`}],[t]),i=r=>{const a={blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-600 dark:text-blue-400"},green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-600 dark:text-green-400"},purple:{bg:"bg-purple-50 dark:bg-purple-900/20",text:"text-purple-700 dark:text-purple-300",icon:"text-purple-600 dark:text-purple-400"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-600 dark:text-orange-400"},indigo:{bg:"bg-indigo-50 dark:bg-indigo-900/20",text:"text-indigo-700 dark:text-indigo-300",icon:"text-indigo-600 dark:text-indigo-400"},cyan:{bg:"bg-cyan-50 dark:bg-cyan-900/20",text:"text-cyan-700 dark:text-cyan-300",icon:"text-cyan-600 dark:text-cyan-400"}};return a[r]||a.blue};return c?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[...Array(6)].map((r,a)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"})]},a))}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:o.map((r,a)=>{const s=i(r.color),d=r.icon;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.bg}`,children:e.jsx(d,{className:`h-5 w-5 ${s.icon}`})}),r.total!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["/ ",r.total]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:r.title}),e.jsx("p",{className:`text-2xl font-bold ${s.text} mb-1`,children:r.value}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.description})]},a)})})}function ue({tokens:t,loading:c,onSendTest:o}){const i=s=>{switch(s){case"android":return e.jsx(E,{className:"h-4 w-4"});case"ios":return e.jsx(W,{className:"h-4 w-4"});case"web":return e.jsx(B,{className:"h-4 w-4"});default:return e.jsx(E,{className:"h-4 w-4"})}},r=s=>{switch(s){case"android":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"ios":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400";case"web":return"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}},a=s=>{const d=new Date(s),u=new Date().getTime()-d.getTime(),n=Math.floor(u/6e4),g=Math.floor(u/36e5),b=Math.floor(u/864e5);return n<1?"Just now":n<60?`${n}m ago`:g<24?`${g}h ago`:b<7?`${b}d ago`:d.toLocaleDateString()};return c?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[...Array(5)].map((s,d)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 ml-auto"})})]},d))})]})})}):t.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-12 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No FCM Tokens Found"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No users in this section have registered for push notifications yet."})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Platform"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800",children:t.map(s=>{var d,f;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm",children:((f=(d=s.users.name||s.users.email)==null?void 0:d[0])==null?void 0:f.toUpperCase())||"U"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.users.name||"Unnamed User"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.users.email}),s.users.student_id&&e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["ID: ",s.users.student_id]})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${r(s.platform)}`,children:[i(s.platform),s.platform.charAt(0).toUpperCase()+s.platform.slice(1)]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:s.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(q,{className:"h-3 w-3"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",children:[e.jsx(ie,{className:"h-3 w-3"}),"Inactive"]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(ne,{className:"h-3.5 w-3.5"}),a(s.updated_at)]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.is_active&&o&&e.jsx("button",{onClick:()=>o(s.users.id,s.users.name||s.users.email),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium transition-colors",children:"Send Test"})})]},s.id)})})]})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",t.length," token",t.length!==1?"s":""]})})]})}function he({isOpen:t,onClose:c,onSend:o,userName:i,userId:r}){const[a,s]=x.useState("Test Notification"),[d,f]=x.useState("This is a test notification from FCM Manager"),[u,n]=x.useState(!1),[g,b]=x.useState(null),m=async()=>{if(!a.trim()||!d.trim()){b({success:!1,message:"Title and body are required"});return}n(!0),b(null);try{const h={title:a.trim(),body:d.trim(),data:{type:"test",timestamp:new Date().toISOString()},userIds:r?[r]:void 0},C=await o(h);b(C),C.success&&setTimeout(()=>{c(),s("Test Notification"),f("This is a test notification from FCM Manager"),b(null)},2e3)}catch(h){b({success:!1,message:h.message||"Failed to send notification"})}finally{n(!1)}},w=()=>{u||(c(),b(null))};return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:w}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Send Test Notification"}),i&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["To: ",i]})]}),e.jsx("button",{onClick:w,disabled:u,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors disabled:opacity-50",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Title"}),e.jsx("input",{type:"text",value:a,onChange:h=>s(h.target.value),disabled:u,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors disabled:opacity-50",placeholder:"Enter notification title",maxLength:100}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.length,"/100 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notification Body"}),e.jsx("textarea",{value:d,onChange:h=>f(h.target.value),disabled:u,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none disabled:opacity-50",placeholder:"Enter notification message",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.length,"/200 characters"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Preview:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:a||"Title"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:d||"Message body"})]})]}),g&&e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg ${g.success?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[g.success?e.jsx(q,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):e.jsx(X,{className:"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0"}),e.jsx("p",{className:`text-sm ${g.success?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:g.message})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:w,disabled:u,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:u||!a.trim()||!d.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),"Send Notification"]})})]})]})]})}):null}async function D(t,c){const{data:o,error:i}=await T.from("section_admins").select("id").eq("user_id",t).eq("section_id",c).single();return!i&&!!o}async function pe(t,c){if(!await D(c,t))throw new Error("Unauthorized: You are not a section admin for this section");const{data:i,error:r}=await T.from("users").select("id, name, email, student_id, section_id").eq("section_id",t);if(r)throw console.error("Error fetching users:",r),r;if(!i||i.length===0)return[];const a=i.map(n=>n.id),{data:s,error:d}=await T.from("fcm_tokens").select("*").in("user_id",a).order("updated_at",{ascending:!1});if(d)throw console.error("Error fetching FCM tokens:",d),d;const f=new Map(i.map(n=>[n.id,n]));return(s||[]).map(n=>{const g=f.get(n.user_id);return g?{...n,users:g}:null}).filter(n=>n!==null)}async function fe(t,c){if(!await D(c,t))throw new Error("Unauthorized: You are not a section admin for this section");const{data:i,error:r}=await T.from("users").select("id").eq("section_id",t);if(r)throw console.error("Error fetching users:",r),r;const a=(i==null?void 0:i.length)||0;if(a===0)return{totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null};const s=i.map(m=>m.id),{data:d,error:f}=await T.from("fcm_tokens").select("*").in("user_id",s).order("created_at",{ascending:!1});if(f)throw console.error("Error fetching tokens for stats:",f),f;const u=d||[],n=u.filter(m=>m.is_active),g=new Set(n.map(m=>m.user_id)).size;return{totalTokens:u.length,activeTokens:n.length,inactiveTokens:u.length-n.length,androidTokens:n.filter(m=>m.platform==="android").length,iosTokens:n.filter(m=>m.platform==="ios").length,webTokens:n.filter(m=>m.platform==="web").length,totalUsers:a||0,usersWithTokens:g,coveragePercentage:a?g/a*100:0,lastRegistration:u.length>0?u[0].created_at:null}}async function be(t,c,o){if(!await D(o,c))throw new Error("Unauthorized: You are not a section admin for this section");try{const{data:r,error:a}=await T.functions.invoke("send-fcm-push",{body:{title:t.title,body:t.body,data:t.data||{},sectionId:c,userIds:t.userIds}});return a?(console.error("Error sending test notification:",a),{success:!1,message:`Failed to send notification: ${a.message}`,details:a}):{success:!0,message:`Notification sent successfully to ${(r==null?void 0:r.sent)||0} device(s)`,details:r}}catch(r){return console.error("Error invoking send-fcm-push function:",r),{success:!1,message:r.message||"Failed to send notification",details:r}}}function ye(t){const c=["User Name","Email","Student ID","Platform","Status","Last Updated"],o=t.map(r=>[r.users.name||"N/A",r.users.email,r.users.student_id||"N/A",r.platform,r.is_active?"Active":"Inactive",new Date(r.updated_at).toLocaleString()]);return[c.join(","),...o.map(r=>r.map(a=>`"${a}"`).join(","))].join(`
`)}function ke({sectionId:t,sectionName:c,userId:o}){const[i,r]=x.useState([]),[a,s]=x.useState({totalTokens:0,activeTokens:0,inactiveTokens:0,androidTokens:0,iosTokens:0,webTokens:0,totalUsers:0,usersWithTokens:0,coveragePercentage:0,lastRegistration:null}),[d,f]=x.useState(!0),[u,n]=x.useState(!1),[g,b]=x.useState(""),[m,w]=x.useState("all"),[h,C]=x.useState("all"),[I,M]=x.useState(!1),[v,_]=x.useState(null);x.useEffect(()=>{t&&o&&U()},[t,o]);const U=x.useCallback(async()=>{try{f(!0);const[l,p]=await Promise.all([pe(t,o),fe(t,o)]);r(l),s(p)}catch(l){console.error("Error loading FCM data:",l),S(l.message||"Failed to load FCM tokens")}finally{f(!1)}},[t,o]),V=x.useCallback(async()=>{try{n(!0),await U(),L("FCM tokens refreshed successfully")}catch(l){S("Failed to refresh tokens")}finally{n(!1)}},[U]),H=x.useCallback(()=>{try{const l=i.filter(y=>{var R,O;const N=g.toLowerCase(),Z=!g||((R=y.users.name)==null?void 0:R.toLowerCase().includes(N))||y.users.email.toLowerCase().includes(N)||((O=y.users.student_id)==null?void 0:O.toLowerCase().includes(N)),ee=m==="all"||y.platform===m,te=h==="all"||h==="active"&&y.is_active||h==="inactive"&&!y.is_active;return Z&&ee&&te}),p=ye(l),j=new Blob([p],{type:"text/csv"}),F=window.URL.createObjectURL(j),k=document.createElement("a");k.href=F,k.download=`fcm-tokens-${c}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(F),L("Tokens exported successfully")}catch(l){S("Failed to export tokens")}},[i,g,m,h,c]),J=x.useCallback((l,p)=>{_({id:l,name:p}),M(!0)},[]),G=x.useCallback(async l=>{try{const p=await be(l,t,o);return p.success?L(p.message):S(p.message),p}catch(p){const j=p.message||"Failed to send notification";return S(j),{success:!1,message:j}}},[t,o]),K=x.useCallback(()=>{_(null),M(!0)},[]),A=x.useMemo(()=>i.filter(l=>{var y,N;const p=g.toLowerCase(),j=!g||((y=l.users.name)==null?void 0:y.toLowerCase().includes(p))||l.users.email.toLowerCase().includes(p)||((N=l.users.student_id)==null?void 0:N.toLowerCase().includes(p)),F=m==="all"||l.platform===m,k=h==="all"||h==="active"&&l.is_active||h==="inactive"&&!l.is_active;return j&&F&&k}),[i,g,m,h]),P=g||m!=="all"||h!=="all",Q=x.useCallback(()=>{b(""),w("all"),C("all")},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),"FCM Token Management"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Monitor and manage push notification tokens for ",c]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:V,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Refresh data",children:[e.jsx(de,{className:`h-4 w-4 ${u?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("button",{onClick:H,disabled:A.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 shadow-sm",title:"Export to CSV",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),e.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm",title:"Send broadcast notification",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Broadcast"})]})]})]}),e.jsx(me,{stats:a,loading:d}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:l=>b(l.target.value),placeholder:"Search by name, email, or student ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:m,onChange:l=>w(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[e.jsx("option",{value:"all",children:"All Platforms"}),e.jsx("option",{value:"android",children:"Android"}),e.jsx("option",{value:"ios",children:"iOS"}),e.jsx("option",{value:"web",children:"Web"})]})]})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsxs("select",{value:h,onChange:l=>C(l.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors appearance-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]})}),P&&e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(z,{className:"h-4 w-4"}),"Clear"]})]}),P&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",A.length," of ",i.length," tokens"]})})]}),e.jsx(ue,{tokens:A,loading:d,onSendTest:J}),e.jsx(he,{isOpen:I,onClose:()=>{M(!1),_(null)},onSend:G,userName:v==null?void 0:v.name,userId:v==null?void 0:v.id})]})}function ze(){const{user:t}=xe(),{isSectionAdmin:c,sectionId:o,sectionName:i}=re();return!c||!o||!(t!=null&&t.id)?e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"h-6 w-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 dark:text-red-300 font-semibold mb-1",children:"Access Denied"}),e.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm",children:"Only section admins can access FCM token management."})]})]})})}):e.jsx(ke,{sectionId:o,sectionName:i||"Unknown Section",userId:t.id})}export{ze as FCMManagementPage,ze as default};
