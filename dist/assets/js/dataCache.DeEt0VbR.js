class o{constructor(){this.cache=new Map,this.defaultTTL=5*60*1e3}get(t,s){const a=this.cache.get(t);if(!a)return null;const n=s!=null?s:this.defaultTTL;return Date.now()-a.timestamp>n?(this.cache.delete(t),null):a.data}set(t,s){this.cache.set(t,{data:s,timestamp:Date.now()})}async getOrFetch(t,s,a){const n=this.get(t,a);if(n!==null)return n;const c=this.cache.get(t);if(c!=null&&c.promise)return c.promise;const h=s();this.cache.set(t,{data:null,timestamp:Date.now(),promise:h});try{const i=await h;return this.set(t,i),i}catch(i){throw this.cache.delete(t),i}}invalidate(t){this.cache.delete(t)}invalidatePattern(t){for(const s of this.cache.keys())t.test(s)&&this.cache.delete(s)}clear(){this.cache.clear()}clearAll(){console.log("[DataCache] Clearing all cache"),this.cache.clear(),typeof window!="undefined"&&window.dispatchEvent(new CustomEvent("cache-cleared"))}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}cleanup(){const t=Date.now();for(const[s,a]of this.cache.entries())t-a.timestamp>this.defaultTTL&&this.cache.delete(s)}}const r=new o;typeof window!="undefined"&&(setInterval(()=>{r.cleanup()},5*60*1e3),window.addEventListener("app-resume",()=>{console.log("[DataCache] App resumed, clearing cache"),r.clearAll()}),window.addEventListener("supabase-session-refreshed",()=>{console.log("[DataCache] Session refreshed, clearing cache"),r.clearAll()}));const l={user:e=>`user:${e}`,userWithFullInfo:e=>`user_full:${e}`,department:e=>`department:${e}`,departments:()=>"departments:all",batch:e=>`batch:${e}`,batches:e=>e?`batches:dept:${e}`:"batches:all",section:e=>`section:${e}`,sections:e=>e?`sections:batch:${e}`:"sections:all",tasks:e=>`tasks:${e}`,announcements:()=>"announcements:all",sectionUsers:e=>`section_users:${e}`};export{l as c,r as d};
