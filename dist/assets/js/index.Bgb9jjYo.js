const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AdminLayout.CbeFZwQC.js","assets/js/react-vendor.ChEovXhk.js","assets/js/charts.B0xhc6u6.js","assets/js/vendor.puyDUvHC.js","assets/js/useAuth.B9Ufs7sW.js","assets/js/dataCache.DP4PyhNH.js","assets/js/authErrors.BDay5vyW.js","assets/js/capacitor-vendor.WkpnXCg6.js","assets/js/useTheme.nyyjoGfu.js","assets/js/useTasks.NT75ylVQ.js","assets/js/telegram.service.BTr96-Tu.js","assets/js/dateUtils.8XYiGfWV.js","assets/js/icons.Be68WOzY.js","assets/js/LoadingScreen.BOD2bfhY.js","assets/js/ionic-vendor.lbvV8mvR.js","assets/css/ionic-vendor.5aKpPXL6.css","assets/js/supabase-vendor.CQkAbalq.js","assets/js/DashboardPage.BhtRLzCe.js","assets/js/App.BGQNsAMj.js","assets/js/AuthPage.kRrj9Obq.js","assets/js/AuthSubmitButton.IZeObC6O.js","assets/js/framer-vendor.D2G-fJbw.js","assets/js/date-utils.CA8GdWm1.js","assets/js/ResetPasswordPage.Bh27Oguc.js","assets/js/linkParser.CRNpH1Sh.js","assets/js/googleDriveUtils.DgFtRDYK.js","assets/js/UsersPage.usQBg-7W.js","assets/js/TasksPage.BvU28g4X.js","assets/js/TaskManagementPage.DVXbBWKV.js","assets/js/AnnouncementsPage.BlMGm0KN.js","assets/js/LectureSlidesPage.DdvevqhX.js","assets/js/FCMManagementPage.BK-DIdPS.js","assets/js/notifications.DvTNppm3.js","assets/js/SuperAdminPage._ux9VFEx.js"])))=>i.map(i=>d[i]);
import{C as e,P as t,_ as n}from"./capacitor-vendor.WkpnXCg6.js";import{j as a,r as s,d as i,e as r,f as o}from"./react-vendor.ChEovXhk.js";import{ab as l}from"./vendor.puyDUvHC.js";import"./ionic-vendor.lbvV8mvR.js";import{c as d}from"./supabase-vendor.CQkAbalq.js";import"./charts.B0xhc6u6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const c=()=>a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white dark:bg-gray-900 z-50",children:a.jsxs("div",{className:"w-8 h-8 relative",children:[a.jsx("div",{className:"absolute inset-0 border-2 border-gray-200 dark:border-gray-700 rounded-full"}),a.jsx("div",{className:"absolute inset-0 border-t-2 border-blue-600 rounded-full animate-spin"})]})});Boolean("undefined"!=typeof window&&(window.location.hostname.includes("stackblitz.io")||window.location.hostname.includes(".webcontainer.io")));const u=d("https://nglfbbdoyyfslzyjarqs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5nbGZiYmRveXlmc2x6eWphcnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1OTgyMTQsImV4cCI6MjA4MzE3NDIxNH0.3sXujO3rtin57rTcHpXHi6Zfi9XJCEX3-mmcnnB8cJE",{auth:{persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:localStorage,storageKey:"nesttask_supabase_auth"},global:{headers:{"X-Client-Info":"nesttask@1.0.0","Cache-Control":"no-cache",Pragma:"no-cache"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}});let m=0,p=!1,h=null,f=0,j=Date.now(),_=!1;async function w(){if(!_){_=!0;try{const{data:{session:e},error:t}=await u.auth.getSession();if(t)return;if(!e)return;const n=e.expires_at;if(n){if(1e3*n-Date.now()<=3e5){const{error:e}=await u.auth.refreshSession()}}}catch(e){}finally{_=!1}}}async function g(e=!1){return j=Date.now(),Date.now()-f>3e5&&(e=!0),!(!p||e)||h||(h=(async()=>{try{if(m>=3)return!0;m++;const{data:e,error:t}=await u.auth.getSession();if(t)return!1;if(!e.session)return!0;const{error:n}=await u.from("tasks").select("count",{count:"exact",head:!0});return n?"PGRST301"!==n.code&&!n.message.includes("JWT")||(await u.auth.signOut(),!1):(p=!0,f=Date.now(),!0)}catch(e){return!0}finally{setTimeout((()=>{h=null}),2e3)}})(),h)}"undefined"!=typeof document&&(document.addEventListener("visibilitychange",(async()=>{if("visible"===document.visibilityState){const e=Date.now(),t=e-j;await w(),t>12e4&&(h=null,p=!1),j=e,window.dispatchEvent(new CustomEvent("supabase-visibility-refresh"))}})),window.addEventListener("online",(async()=>{await w(),window.dispatchEvent(new CustomEvent("supabase-network-reconnect"))}))),setTimeout((()=>{g().catch(console.error)}),1e3);let x=null,b=!1,v=[];function y(){const e=x;return x=null,e}function E(e){var t;const n=null==(t=e.notification)?void 0:t.data,a=null==n?void 0:n.taskId,s=function(e){return e&&e.route&&"string"==typeof e.route?e.route:null}(n);if(a&&"string"==typeof a)return x=a,window.dispatchEvent(new CustomEvent("open-task-from-notification",{detail:{taskId:a,data:n,actionId:e.actionId,notification:e.notification}})),setTimeout((()=>{window.dispatchEvent(new CustomEvent("open-task-from-notification",{detail:{taskId:a,data:n,actionId:e.actionId,notification:e.notification}}))}),500),void setTimeout((()=>{window.dispatchEvent(new CustomEvent("open-task-from-notification",{detail:{taskId:a,data:n,actionId:e.actionId,notification:e.notification}}))}),1500);if(s){const e=document.getElementById("root");e&&e.children.length>0&&setTimeout((()=>{window.location.href=s}),150)}}function k(e){}"requestIdleCallback"in window&&requestIdleCallback((()=>{const e=window.location.pathname;e.startsWith("/admin")||e.startsWith("/superadmin")?(n((()=>import("./AdminLayout.CbeFZwQC.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])),n((()=>import("./DashboardPage.BhtRLzCe.js")),__vite__mapDeps([17,7,1,2,3]))):(n((()=>import("./App.BGQNsAMj.js").then((e=>e.A))),__vite__mapDeps([18,7,1,2,3,4,5,6,9,10,11,19,20,12,14,15,16,8,21,22,23,24,25])),n((()=>import("./AuthPage.kRrj9Obq.js")),__vite__mapDeps([19,1,2,3,20,12,6,5,7,14,15,16])))}),{timeout:2e3});const P=s.lazy((()=>n((()=>import("./App.BGQNsAMj.js").then((e=>e.A))),__vite__mapDeps([18,7,1,2,3,4,5,6,9,10,11,19,20,12,14,15,16,8,21,22,23,24,25])))),I=s.lazy((()=>n((()=>import("./ResetPasswordPage.Bh27Oguc.js")),__vite__mapDeps([23,1,2,3,20,12,6,7,14,15,16])).then((e=>({default:e.ResetPasswordPage}))))),S=s.lazy((()=>n((()=>import("./AuthPage.kRrj9Obq.js")),__vite__mapDeps([19,1,2,3,20,12,6,5,7,14,15,16])).then((e=>({default:e.AuthPage}))))),L=s.lazy((()=>n((()=>import("./AdminLayout.CbeFZwQC.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then((e=>({default:e.AdminLayout}))))),A=s.lazy((()=>n((()=>import("./DashboardPage.BhtRLzCe.js")),__vite__mapDeps([17,7,1,2,3])).then((e=>({default:e.DashboardPage}))))),T=s.lazy((()=>n((()=>import("./UsersPage.usQBg-7W.js")),__vite__mapDeps([26,7,1,2,3])).then((e=>({default:e.UsersPage}))))),D=s.lazy((()=>n((()=>import("./TasksPage.BvU28g4X.js")),__vite__mapDeps([27,7,1,2,3])).then((e=>({default:e.TasksPage}))))),R=s.lazy((()=>n((()=>import("./TaskManagementPage.DVXbBWKV.js")),__vite__mapDeps([28,7,1,2,3,4,5,6,14,15,16])).then((e=>({default:e.TaskManagementPage}))))),O=s.lazy((()=>n((()=>import("./AnnouncementsPage.BlMGm0KN.js")),__vite__mapDeps([29,7,1,2,3,10,11,14,15,16])).then((e=>({default:e.AnnouncementsPage}))))),z=s.lazy((()=>n((()=>import("./LectureSlidesPage.DdvevqhX.js")),__vite__mapDeps([30,7,1,2,3])).then((e=>({default:e.LectureSlidesPage}))))),C=s.lazy((()=>n((()=>import("./FCMManagementPage.BK-DIdPS.js")),__vite__mapDeps([31,1,2,3,12,32,4,5,6,7,14,15,16])))),V=s.lazy((()=>n((()=>import("./SuperAdminPage._ux9VFEx.js")),__vite__mapDeps([33,7,1,2,3])).then((e=>({default:e.SuperAdminPage}))))),N=s.lazy((()=>n((()=>import("./vendor.puyDUvHC.js").then((e=>e.ax))),__vite__mapDeps([3,1,2])).then((e=>({default:e.Analytics}))))),W=!e.isNativePlatform(),J=({children:e})=>W?a.jsx(a.Fragment,{children:e}):null,M=i([{path:"/auth",loader:async()=>{const{data:{session:e}}=await u.auth.getSession();if(null==e?void 0:e.user){const{data:t}=await u.from("users").select("role").eq("id",e.user.id).single();return"super-admin"===(null==t?void 0:t.role)?Response.redirect("/superadmin/dashboard"):"admin"===(null==t?void 0:t.role)||"section_admin"===(null==t?void 0:t.role)?Response.redirect("/admin/dashboard"):Response.redirect("/")}return null},element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(S,{onLogin:async e=>{const{data:t,error:n}=await u.auth.signInWithPassword({email:e.email,password:e.password});if(n)throw n;if(t.user){const{data:e}=await u.from("users").select("role").eq("id",t.user.id).single();"super-admin"===(null==e?void 0:e.role)?window.location.href="/superadmin/dashboard":"admin"===(null==e?void 0:e.role)||"section_admin"===(null==e?void 0:e.role)?window.location.href="/admin/dashboard":window.location.href="/"}},onSignup:async e=>{const{error:t}=await u.auth.signUp({email:e.email,password:e.password,options:{data:{name:e.name}}});if(t)throw t},onForgotPassword:async e=>{const{error:t}=await u.auth.resetPasswordForEmail(e);if(t)throw t}})})},{path:"/reset-password",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(I,{})})},{path:"/admin",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(L,{})}),children:[{path:"dashboard",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(A,{})})},{path:"users",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(T,{})})},{path:"tasks",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(D,{})})},{path:"task-management",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(R,{})})},{path:"announcements",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(O,{})})},{path:"lecture-slides",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(z,{})})},{path:"fcm-management",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(C,{})})},{path:"super-admin",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})}]},{path:"/superadmin/dashboard",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/overview",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/admins",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/sectionadmins",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/analytics",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/logs",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"/superadmin/security",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(V,{})})},{path:"*",element:a.jsx(s.Suspense,{fallback:a.jsx(c,{}),children:a.jsx(P,{})})}]);!async function(){if(!b&&e.isNativePlatform())try{const e=await t.addListener("pushNotificationActionPerformed",E);v.push((()=>e.remove()));const n=await t.addListener("pushNotificationReceived",k);v.push((()=>n.remove())),b=!0}catch(n){}}(),function(){try{const e=new URL("https://nglfbbdoyyfslzyjarqs.supabase.co"),t=document.createElement("link");t.rel="dns-prefetch",t.href=e.origin,document.head.appendChild(t)}catch(n){}const t=document.getElementById("root");t&&(r(t).render(a.jsx(s.StrictMode,{children:a.jsxs(s.Suspense,{fallback:a.jsx(c,{}),children:[a.jsx(o,{router:M}),W&&a.jsx(J,{children:a.jsxs(s.Suspense,{fallback:null,children:[a.jsx(N,{}),a.jsx(l,{})]})})]})})),!e.isNativePlatform()&&"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((()=>{setTimeout((()=>{"undefined"!=typeof window&&window.Capacitor||("serviceWorker"in navigator&&navigator.serviceWorker.controller&&setInterval((()=>{navigator.serviceWorker.getRegistration().then((e=>{e&&e.update()}))}),36e5),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault()})),window.addEventListener("appinstalled",(()=>{})),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",(()=>{navigator.serviceWorker.controller})))}),500)})).catch((()=>{})))}();export{y as g,u as s,g as t};
