import{s as R,r as i,c as _e,j as e,R as Fe}from"./index.DCF7NBy-.js";import{d as Le,c as Ae}from"./dataCache.CcjqYMC_.js";import{X as ye}from"./x.BjNJq03j.js";import{A as ne}from"./alert-circle.CjrBIapv.js";import{R as ee}from"./refresh-cw.D7zqGkZh.js";import{U as ge}from"./upload.D_37k0ry.js";import{F as fe}from"./file-text.CT2AbUn_.js";import{T as J}from"./trash-2.BJn0eqbc.js";import{L as te}from"./link.VU5V8c3m.js";import{C as re}from"./calendar.C3yUpeaE.js";import{E as ue}from"./eye.BU63vPV7.js";import{P as K}from"./pen.DZvkjoVB.js";import{C as Me}from"./chevron-up.D3dEAXL5.js";import{C as $e}from"./chevron-down.Bl9z1bRh.js";import{M as je,H as Re}from"./message-square.C2c9tSRr.js";import{S as ze}from"./send.Cmk6d9U_.js";import{C as he}from"./check-circle-2.BVuhxu0l.js";import{C as be}from"./clock.D58LqiWP.js";import{U as Oe}from"./user.DBK-xTq6.js";import{U as Pe}from"./users.CxuWwfN5.js";import{T as Ue}from"./tag.CinLygyy.js";import{D as ae}from"./download.C6N3ir59.js";import{S as Ie}from"./search.D3jqWY6j.js";import{F as Be}from"./filter.CFWsWA5u.js";import{C as qe}from"./check-square.CssXvllL.js";import{P as Ve}from"./plus.DITOKAMJ.js";import"./createLucideIcon.mo1mEAkz.js";const H={MAX_RETRIES:2,RETRY_DELAY_MS:1e3};class W{static async execute(r,a="Operation",o){var c,x;let l=null;for(let m=0;m<=H.MAX_RETRIES;m++)try{if(o!=null&&o.aborted)throw new Error("Operation cancelled");const{data:u,error:y}=await r();if(y)throw new Error(y.message||`${a} failed`);if(u===null)throw new Error(`${a}: No data returned`);return u}catch(u){if(l=u,u.message==="Operation cancelled"||o!=null&&o.aborted)throw new Error("Operation cancelled");if((c=u.message)!=null&&c.includes("JWT")||(x=u.message)!=null&&x.includes("session"))throw new Error("Session expired. Please refresh the page.");if(m<H.MAX_RETRIES){await new Promise(y=>setTimeout(y,H.RETRY_DELAY_MS));continue}}throw l||new Error(`${a} failed`)}static async executeVoid(r,a="Operation"){var l,c;let o=null;for(let x=0;x<=H.MAX_RETRIES;x++)try{const{error:m}=await r();if(m)throw new Error(m.message||`${a} failed`);return}catch(m){if(o=m,(l=m.message)!=null&&l.includes("JWT")||(c=m.message)!=null&&c.includes("session"))throw new Error("Session expired. Please refresh the page.");if(x<H.MAX_RETRIES){await new Promise(u=>setTimeout(u,H.RETRY_DELAY_MS));continue}}throw o||new Error(`${a} failed`)}}function le(t,r){if(!r)return t;const a=t;return typeof(a==null?void 0:a.abortSignal)=="function"?a.abortSignal(r):t}async function He(t,r={}){const{page:a=1,pageSize:o=50,filters:l={},sort:c,sectionId:x,abortSignal:m,bypassCache:u=!1}=r,y=JSON.stringify({filters:l,sort:c,sectionId:x,page:a,pageSize:o}),s=Ae.tasksEnhanced(t,y);if(!u&&!m)try{return await Le.getOrFetch(s,()=>pe(t,{page:a,pageSize:o,filters:l,sort:c,sectionId:x,abortSignal:m}),6e4)}catch(v){console.warn("[TaskService] Cache fetch failed, fetching directly:",v)}return pe(t,{page:a,pageSize:o,filters:l,sort:c,sectionId:x,abortSignal:m})}async function pe(t,r){var k,n;const{page:a,pageSize:o,filters:l,sort:c,sectionId:x,abortSignal:m}=r,u=(a-1)*o,y=u+o-1;let s=R.from("tasks").select("*",{count:"exact"});if(x&&(s=s.eq("section_id",x)),l.search&&(s=s.or(`name.ilike.%${l.search}%,description.ilike.%${l.search}%`)),l.category&&l.category!=="all"&&(s=s.eq("category",l.category)),l.status&&l.status!=="all"&&(s=s.eq("status",l.status)),l.priority&&l.priority!=="all"&&(s=s.eq("priority",l.priority)),l.assignedTo&&(s=s.eq("assigned_to",l.assignedTo)),l.tags&&l.tags.length>0&&(s=s.contains("tags",l.tags)),(k=l.dateRange)!=null&&k.start&&(s=s.gte("due_date",l.dateRange.start)),(n=l.dateRange)!=null&&n.end&&(s=s.lte("due_date",l.dateRange.end)),l.overdue){const j=new Date().toISOString().split("T")[0];s=s.lt("due_date",j).neq("status","completed")}if(c){const j=c.field==="dueDate"?"due_date":c.field==="createdAt"?"created_at":c.field;s=s.order(j,{ascending:c.direction==="asc"})}else s=s.order("created_at",{ascending:!1});s=s.range(u,y);const v=le(s,m),{data:S,error:w,count:b}=await v;if(w)throw new Error(`Failed to fetch tasks: ${w.message}`);return{tasks:(S||[]).map(ie),total:b||0,page:a,pageSize:o,hasMore:b?b>y+1:!1}}async function Xe(t,r,a,o){const l={name:r.name,description:r.description,category:r.category,due_date:r.dueDate,priority:r.priority||"medium",tags:r.tags||[],assigned_to:r.assignedTo||null,assigned_by:r.assignedTo?t:null,section_id:a||r.sectionId||null,attachments:r.attachments||[],google_drive_links:r.googleDriveLinks||[],status:r.status||"pending",user_id:t,is_admin_task:!!a,is_template:!1},c=await W.execute(()=>le(R.from("tasks").insert(l).select("*").single(),o),"Create task",o),x=ie(c);return x.isAdminTask&&rt(x).catch(()=>{}),x}async function we(t,r,a){const o={};r.name!==void 0&&(o.name=r.name),r.description!==void 0&&(o.description=r.description),r.category!==void 0&&(o.category=r.category),r.dueDate!==void 0&&(o.due_date=r.dueDate),r.status!==void 0&&(o.status=r.status,r.status==="completed"&&(o.completed_at=new Date().toISOString())),r.priority!==void 0&&(o.priority=r.priority),r.tags!==void 0&&(o.tags=r.tags),r.assignedTo!==void 0&&(o.assigned_to=r.assignedTo),r.attachments!==void 0&&(o.attachments=r.attachments),r.googleDriveLinks!==void 0&&(o.google_drive_links=r.googleDriveLinks);const l=await W.execute(()=>le(R.from("tasks").update(o).eq("id",t).select("*").single(),a),"Update task");return ie(l)}async function ve(t){await W.executeVoid(()=>R.from("tasks").delete().eq("id",t),"Delete task")}async function Je(t){await W.executeVoid(()=>R.from("tasks").delete().in("id",t),"Bulk delete tasks")}async function Ye(t,r){const a={status:r};r==="completed"&&(a.completed_at=new Date().toISOString()),await W.executeVoid(()=>R.from("tasks").update(a).in("id",t),"Bulk update status")}async function We(t,r,a){const{data:o,error:l}=await R.from("task_comments").insert({task_id:t,user_id:r,comment:a}).select(`
      *,
      user:users(id, name, email)
    `).single();if(l)throw new Error(`Failed to add comment: ${l.message}`);return oe(o)}async function Ke(t){const{data:r,error:a}=await R.from("task_comments").select(`
      *,
      user:users(id, name, email)
    `).eq("task_id",t).order("created_at",{ascending:!0});if(a)throw new Error(`Failed to fetch comments: ${a.message}`);return(r||[]).map(oe)}async function Ze(t,r){const{data:a,error:o}=await R.from("task_comments").update({comment:r,is_edited:!0}).eq("id",t).select(`
      *,
      user:users(id, name, email)
    `).single();if(o)throw new Error(`Failed to update comment: ${o.message}`);return oe(a)}async function Ge(t){const{error:r}=await R.from("task_comments").delete().eq("id",t);if(r)throw new Error(`Failed to delete comment: ${r.message}`)}async function Qe(t){const{data:r,error:a}=await R.from("task_history").select(`
      *,
      user:users(id, name, email)
    `).eq("task_id",t).order("created_at",{ascending:!1});if(a)throw new Error(`Failed to fetch history: ${a.message}`);return(r||[]).map(tt)}async function et(t,r,a){var S;const l=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","csv","jpg","jpeg","png","gif","svg","zip","rar","7z","mp4","mp3","wav"];if(t.size>52428800)throw new Error(`File size exceeds 50MB limit. Your file: ${(t.size/1024/1024).toFixed(2)}MB`);const c=(S=t.name.split(".").pop())==null?void 0:S.toLowerCase();if(!c||!l.includes(c))throw new Error(`File type .${c} is not allowed. Allowed types: ${l.join(", ")}`);const x=w=>w.substring(0,w.lastIndexOf(".")).replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")||"file",m=Date.now(),u=x(t.name),y=Math.random().toString(36).substring(2,8),s=`${u}_${m}_${y}.${c}`,v=r?`tasks/${r}/${s}`:`temp/${s}`;try{const{data:w,error:b}=await R.storage.from("task-attachments").upload(v,t,{cacheControl:"3600",upsert:!1});if(b)throw b.message.includes("already exists")?new Error("A file with this name already exists. Please rename and try again."):new Error(`Upload failed: ${b.message}`);const{data:k}=R.storage.from("task-attachments").getPublicUrl(w.path);return a&&a(100),{url:k.publicUrl,name:t.name,size:t.size}}catch(w){throw new Error(w.message||"Failed to upload file. Please try again.")}}function ie(t){return{id:t.id,name:t.name,category:t.category,dueDate:t.due_date,description:t.description,status:t.status,createdAt:t.created_at,updatedAt:t.updated_at,isAdminTask:t.is_admin_task||!1,sectionId:t.section_id,departmentId:t.department_id,batchId:t.batch_id,priority:t.priority||"medium",tags:t.tags||[],assignedTo:t.assigned_to,assignedBy:t.assigned_by,completedAt:t.completed_at,completedBy:t.completed_by,attachments:t.attachments||[],googleDriveLinks:t.google_drive_links||[],isTemplate:t.is_template||!1,templateName:t.template_name,userId:t.user_id,assignedToUser:t.assignedToUser,assignedByUser:t.assignedByUser,section:t.section,department:t.department,batch:t.batch}}function oe(t){return{id:t.id,taskId:t.task_id,userId:t.user_id,comment:t.comment,createdAt:t.created_at,updatedAt:t.updated_at,isEdited:t.is_edited||!1,user:t.user}}function tt(t){return{id:t.id,taskId:t.task_id,userId:t.user_id,action:t.action,fieldName:t.field_name,oldValue:t.old_value,newValue:t.new_value,metadata:t.metadata,createdAt:t.created_at,user:t.user}}async function rt(t){try{const r="https://nglfbbdoyyfslzyjarqs.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5nbGZiYmRveXlmc2x6eWphcnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1OTgyMTQsImV4cCI6MjA4MzE3NDIxNH0.3sXujO3rtin57rTcHpXHi6Zfi9XJCEX3-mmcnnB8cJE";console.log("[FCM Enhanced] Sending push notification for task:",t.id),console.log("[FCM Enhanced] Supabase URL:",r?"Set":"Missing"),console.log("[FCM Enhanced] Supabase Anon Key:",a?"Set":"Missing");const o=new Date(t.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),l={presentation:"ðŸ“Š",assignment:"ðŸ“",quiz:"â“","lab-report":"ðŸ”¬","lab-final":"ðŸ§ª","lab-performance":"âš—ï¸",task:"âœ“",documents:"ðŸ“„",blc:"ðŸ“š",groups:"ðŸ‘¥",project:"ðŸš€",midterm:"ðŸ“–","final-exam":"ðŸŽ“",others:"ðŸ“Œ"},c=t.category.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),x=l[t.category]||"ðŸ“Œ",m={taskId:t.id,title:`${x} New ${c}`,body:`${t.name}
ðŸ“… Due: ${o}`,sectionId:t.sectionId||void 0,data:{taskId:t.id,category:t.category,categoryName:c,priority:t.priority||"medium",dueDate:t.dueDate,taskName:t.name}};console.log("[FCM Enhanced] Calling edge function with payload:",JSON.stringify(m));const u=await fetch(`${r}/functions/v1/send-fcm-push`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(m)});if(console.log("[FCM Enhanced] Edge function response status:",u.status),!u.ok){const s=await u.json().catch(()=>({}));throw console.error("[FCM Enhanced] Push notification failed:",s),new Error(`FCM push failed: ${JSON.stringify(s)}`)}const y=await u.json();console.log("[FCM Enhanced] Push notification result:",y)}catch(r){throw console.error("[FCM Enhanced] Error sending push notification:",r),r}}const at=({userId:t,sectionId:r,task:a,onClose:o,onTaskCreated:l,onTaskUpdated:c})=>{var L,V;const x=!!a,m=i.useRef(!0),u=i.useRef(),y=i.useRef(!1),[s,v]=i.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",category:(a==null?void 0:a.category)||"assignment",dueDate:(a==null?void 0:a.dueDate)||"",priority:(a==null?void 0:a.priority)||"medium",googleDriveLinks:((L=a==null?void 0:a.googleDriveLinks)==null?void 0:L.join(`
`))||""}),[S,w]=i.useState(!1),[b,k]=i.useState(!1),[n,j]=i.useState(null),[_,f]=i.useState({}),[T,N]=i.useState(((V=a==null?void 0:a.attachments)==null?void 0:V.map(g=>{var p;return{url:g,name:((p=g.split("/").pop())==null?void 0:p.split("_").slice(0,-2).join("_"))||"file",size:0}}))||[]),F=i.useRef(null),O=i.useRef(null);i.useEffect(()=>(m.current=!0,k(!1),w(!1),()=>{m.current=!1,u.current&&u.current.abort()}),[]),i.useEffect(()=>{y.current=b},[b]),i.useEffect(()=>{const g=()=>{document.visibilityState==="visible"&&b&&O.current&&Date.now()-O.current>2e4&&(console.warn("[TaskEnhancedForm] Resetting stuck saving state after visibility change"),k(!1),j("Operation may have timed out. Please try again."),u.current&&u.current.abort())};return document.addEventListener("visibilitychange",g),()=>{document.removeEventListener("visibilitychange",g)}},[b]),i.useEffect(()=>{const g=()=>{var A;if(!y.current||!O.current)return;Date.now()-O.current>2e4&&(console.warn("[TaskEnhancedForm] Resetting stuck saving state after app resume"),k(!1),j("Operation may have timed out. Please try again."),(A=u.current)==null||A.abort())};return window.addEventListener("app-resume",g),window.addEventListener("supabase-resume",g),window.addEventListener("supabase-session-refreshed",g),()=>{window.removeEventListener("app-resume",g),window.removeEventListener("supabase-resume",g),window.removeEventListener("supabase-session-refreshed",g)}},[]),i.useEffect(()=>{b?O.current=Date.now():O.current=null},[b]);const de=async g=>{const p=g.target.files;if(!p||p.length===0)return;const A=T.length+p.length;if(A>10){j(`Maximum 10 files allowed. You're trying to upload ${A} files.`);return}w(!0),j(null);const C={};try{const M=Array.from(p).map(async $=>{const U=`${$.name}-${Date.now()}`;C[U]=0,f({...C});try{return await et($,a==null?void 0:a.id,z=>{m.current&&(C[U]=z,f({...C}))})}catch(q){throw new Error(`${$.name}: ${q.message}`)}}),D=await Promise.all(M);m.current&&(N($=>[...$,...D]),f({}),F.current&&(F.current.value=""))}catch(M){m.current&&(j((M==null?void 0:M.message)||"Failed to upload files. Please try again."),f({}))}finally{m.current&&w(!1)}},Y=i.useCallback(g=>{N(p=>p.filter((A,C)=>C!==g))},[]),I=g=>{if(g===0)return"Unknown size";const p=1024,A=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(g)/Math.log(p));return Math.round(g/Math.pow(p,C)*100)/100+" "+A[C]},P=i.useCallback(async g=>{if(g.preventDefault(),b){console.log("[TaskEnhancedForm] Already saving, ignoring submit");return}k(!0),j(null),O.current=Date.now(),u.current=new AbortController;const p=3e4,A=setTimeout(()=>{var D;if(!m.current||!y.current)return;const C=O.current;(C?Date.now()-C:p)>=p&&(console.warn("[TaskEnhancedForm] Safety timeout triggered - resetting saving state"),(D=u.current)==null||D.abort(),k(!1),j("Request timed out. Please try again."))},p);try{const C=s.googleDriveLinks.split(`
`).map(M=>M.trim()).filter(Boolean);if(x){const M={name:s.name,description:s.description,category:s.category,dueDate:s.dueDate,priority:s.priority,attachments:T.map($=>$.url),googleDriveLinks:C},D=await we(a.id,M,u.current.signal);clearTimeout(A),m.current&&(c==null||c(D),o())}else{const M={name:s.name,description:s.description,category:s.category,dueDate:s.dueDate,priority:s.priority,status:"in-progress",sectionId:r,attachments:T.map($=>$.url),googleDriveLinks:C},D=await Xe(t,M,r,u.current.signal);clearTimeout(A),m.current&&(k(!1),l==null||l(D),o())}}catch(C){if(clearTimeout(A),(C==null?void 0:C.message)==="Operation cancelled"){console.log("[TaskEnhancedForm] Operation was cancelled");return}if(console.error("[TaskEnhancedForm] Error saving task:",C),m.current){const M=(C==null?void 0:C.message)||"Failed to save task. Please try again.";j(M),k(!1)}}},[b,s,x,a,T,t,r,l,c,o]);return _e.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-2 sm:p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-xl border border-gray-200 dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 py-2.5 sm:py-3 border-b border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 shrink-0",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:x?"Edit Task":"Create New Task"})}),e.jsx("button",{onClick:o,disabled:b,className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200","aria-label":"Close form",children:e.jsx(ye,{className:"w-4 h-4"})})]}),n&&e.jsxs("div",{className:"mx-3 sm:mx-4 mt-2 p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md flex items-start gap-2 shrink-0",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300",children:n}),e.jsxs("button",{type:"button",onClick:()=>j(null),className:"mt-1 text-xs text-red-600 dark:text-red-400 hover:underline flex items-center gap-1 font-medium",children:[e.jsx(ee,{className:"w-3 h-3"}),"Dismiss and try again"]})]})]}),e.jsx("div",{className:"overflow-y-auto flex-1 admin-scrollbar",children:e.jsxs("form",{onSubmit:P,className:"p-3 sm:p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Task Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:g=>v({...s,name:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm placeholder:text-gray-400",placeholder:"Enter a clear and concise task name"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:s.category,onChange:g=>v({...s,category:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm appearance-none",children:[e.jsx("option",{value:"assignment",children:"ðŸ“ Assignment"}),e.jsx("option",{value:"quiz",children:"â“ Quiz"}),e.jsx("option",{value:"presentation",children:"ðŸŽ¯ Presentation"}),e.jsx("option",{value:"project",children:"ðŸ› ï¸ Project"}),e.jsx("option",{value:"lab-report",children:"ðŸ”¬ Lab Report"}),e.jsx("option",{value:"lab-final",children:"ðŸ† Lab Final"}),e.jsx("option",{value:"lab-performance",children:"ðŸ“ˆ Lab Performance"}),e.jsx("option",{value:"task",children:"âœ”ï¸ Task"}),e.jsx("option",{value:"documents",children:"ðŸ“„ Documents"}),e.jsx("option",{value:"blc",children:"ðŸ“š BLC"}),e.jsx("option",{value:"groups",children:"ðŸ‘¥ Groups"}),e.jsx("option",{value:"midterm",children:"ðŸ“Š Midterm"}),e.jsx("option",{value:"final-exam",children:"ðŸŽ“ Final Exam"}),e.jsx("option",{value:"others",children:"ðŸ”¹ Others"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Priority ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:s.priority,onChange:g=>v({...s,priority:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm appearance-none",children:[e.jsx("option",{value:"low",children:"ðŸŸ¢ Low Priority"}),e.jsx("option",{value:"medium",children:"ðŸ”µ Medium Priority"}),e.jsx("option",{value:"high",children:"ðŸŸ  High Priority"}),e.jsx("option",{value:"urgent",children:"ðŸ”´ Urgent Priority"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",required:!0,value:s.dueDate,onChange:g=>v({...s,dueDate:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,value:s.description,onChange:g=>v({...s,description:g.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm resize-none placeholder:text-gray-400",placeholder:"Provide detailed information about the task..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),"Attachments"]}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"Max 10 files, 50MB each"})]})}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{ref:F,type:"file",multiple:!0,onChange:de,disabled:S||T.length>=10,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv,.jpg,.jpeg,.png,.gif,.svg,.zip,.rar,.7z,.mp4,.mp3,.wav",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10 disabled:cursor-not-allowed"}),e.jsx("div",{className:"w-full px-4 py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800/50 text-center group-hover:border-blue-500 dark:group-hover:border-blue-400 group-hover:bg-blue-50/50 dark:group-hover:bg-blue-900/10 transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[e.jsx("div",{className:"p-2 bg-white dark:bg-gray-700 rounded-full shadow-sm group-hover:scale-110 transition-transform duration-200",children:e.jsx(ge,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 dark:text-white",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"Support for documents, images, and archives"})]})]})})]}),S&&Object.keys(_).length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:Object.entries(_).map(([g,p])=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate flex-1",children:g.split("-")[0]}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-semibold ml-2",children:[p,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-500 h-full transition-all duration-300 ease-out",style:{width:`${p}%`}})})]},g))}),T.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:T.map((g,p)=>e.jsxs("div",{className:"group flex items-center gap-2 bg-white dark:bg-gray-700/50 px-2 py-2 rounded-md border border-gray-200 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all duration-200",children:[e.jsx("div",{className:"p-1.5 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:e.jsx(fe,{className:"w-3.5 h-3.5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 dark:text-white truncate",children:g.name}),g.size>0&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:I(g.size)})]}),e.jsx("button",{type:"button",onClick:()=>Y(p),disabled:b,className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all duration-200 opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Remove file",children:e.jsx(J,{className:"w-3.5 h-3.5"})})]},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5"}),"Google Drive Links"]})}),e.jsx("textarea",{value:s.googleDriveLinks,onChange:g=>v({...s,googleDriveLinks:g.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:border-blue-500 dark:focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10 transition-all outline-none shadow-sm resize-none placeholder:text-gray-400 font-mono",placeholder:"https://drive.google.com/file/d/..."}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter one link per line. Supported: Drive files, folders, Docs, Sheets, Slides."})]})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 shrink-0",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),o()},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-white dark:hover:bg-gray-700 font-medium transition-all duration-200 disabled:opacity-50 shadow-sm hover:shadow text-sm",disabled:b,children:"Cancel"}),e.jsx("button",{onClick:g=>P(g),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium shadow-md shadow-blue-500/20 hover:shadow-blue-500/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 flex items-center gap-1.5 text-sm",disabled:b||S,children:b?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-3.5 h-3.5 animate-spin"}),"Saving..."]}):x?"Update Task":"Create Task"})]})})]})}),document.body)},se=i.memo(at),st=Fe.memo(function({tasks:r,selectedTaskIds:a,onSelectTasks:o,onTaskClick:l,onTaskEdit:c,onTaskDelete:x,sort:m,onSortChange:u}){const y=n=>{o(n?r.map(j=>j.id):[])},s=(n,j)=>{o(j?[...a,n]:a.filter(_=>_!==n))},v=n=>{m.field===n?u({field:n,direction:m.direction==="asc"?"desc":"asc"}):u({field:n,direction:"asc"})},S=async n=>{if(confirm("Delete this task?"))try{await ve(n),x(n)}catch(j){alert("Failed to delete task")}},w={low:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",medium:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"},b={"my-tasks":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","in-progress":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",completed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"},k=({field:n})=>m.field!==n?null:m.direction==="asc"?e.jsx(Me,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"});return r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 flex items-center justify-center",children:e.jsx(fe,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-white text-sm",children:"âœ¨"})})]}),e.jsx("h3",{className:"text-base font-bold text-gray-900 dark:text-white mb-1",children:"No Tasks Found"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-center max-w-md",children:"Try adjusting your search or filters, or create your first task to get started"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden space-y-2",children:r.map((n,j)=>{const _=new Date(n.dueDate)<new Date&&n.status!=="completed";return e.jsxs("div",{className:`group relative bg-white dark:bg-gray-800 rounded-lg border transition-all duration-200 shadow-sm hover:shadow-md ${_?"border-red-200 dark:border-red-800 bg-red-50/40 dark:bg-red-900/15":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600"}`,children:[_&&e.jsx("div",{className:"absolute top-0 right-0 bg-gradient-to-l from-red-500 to-red-600 text-white px-2 py-0.5 rounded-bl-lg text-xs font-semibold",children:"Overdue"}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>l(n),className:"font-semibold text-sm text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 text-left mb-1 line-clamp-2 transition-colors",children:n.name}),n.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 line-clamp-1 leading-relaxed",children:n.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mb-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 capitalize",children:n.category.replace("-"," ")}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full capitalize whitespace-nowrap ${b[n.status]||b["my-tasks"]}`,children:n.status==="my-tasks"?"To Do":n.status==="pending"?"Pending":n.status.replace("-"," ")}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full capitalize ${w[n.priority]}`,children:n.priority})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 dark:text-gray-400 font-medium",children:[e.jsx(re,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(n.dueDate).toLocaleDateString()}),_&&e.jsxs("span",{className:"ml-1 inline-flex items-center gap-1 text-red-600 dark:text-red-400 font-medium",children:[e.jsx("span",{className:"w-1 h-1 bg-red-600 dark:bg-red-400 rounded-full animate-pulse"}),"Overdue"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>l(n),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-md transition-all duration-200 touch-manipulation active:scale-95",title:"View details",children:e.jsx(ue,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>c(n),className:"p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 dark:text-gray-400 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-md transition-all duration-200 touch-manipulation active:scale-95",title:"Edit task",children:e.jsx(K,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>S(n.id),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-md transition-all duration-200 touch-manipulation active:scale-95",title:"Delete",children:e.jsx(J,{className:"w-3.5 h-3.5"})})]})]})]})})]},n.id)})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-md shadow-gray-200/30 dark:shadow-gray-900/30 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/80 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-3 py-2 text-left",children:e.jsx("input",{type:"checkbox",checked:a.length===r.length,onChange:n=>y(n.target.checked),className:"w-4 h-4 rounded border-2 border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-2 focus:ring-blue-500"})}),e.jsx("th",{onClick:()=>v("name"),className:"w-auto px-3 py-2 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Task Name",e.jsx(k,{field:"name"})]})}),e.jsx("th",{onClick:()=>v("category"),className:"w-32 px-3 py-2 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Category",e.jsx(k,{field:"category"})]})}),e.jsx("th",{onClick:()=>v("status"),className:"w-24 px-3 py-2 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",e.jsx(k,{field:"status"})]})}),e.jsx("th",{onClick:()=>v("priority"),className:"w-24 px-3 py-2 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Priority",e.jsx(k,{field:"priority"})]})}),e.jsx("th",{onClick:()=>v("dueDate"),className:"w-28 px-3 py-2 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Due Date",e.jsx(k,{field:"dueDate"})]})}),e.jsx("th",{className:"w-24 px-3 py-2 text-right text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map(n=>{const j=new Date(n.dueDate)<new Date&&n.status!=="completed";return e.jsxs("tr",{className:`group task-table-row transition-all duration-200 border-b border-gray-100 dark:border-gray-700/50 last:border-0 text-sm ${j?"bg-red-50/40 dark:bg-red-900/10 hover:bg-red-50/60 dark:hover:bg-red-900/15":"hover:bg-blue-50/30 dark:hover:bg-gray-800/70"}`,children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"checkbox",checked:a.includes(n.id),onChange:_=>s(n.id,_.target.checked),className:"w-4 h-4 rounded border-2 border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-2 focus:ring-blue-500 transition-colors"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:()=>l(n),className:"font-semibold text-xs text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 text-left transition-colors line-clamp-1",children:n.name}),n.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-1",children:n.description})]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 capitalize whitespace-nowrap",children:n.category.replace("-"," ")})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full capitalize whitespace-nowrap ${b[n.status]||b["my-tasks"]}`,children:n.status==="my-tasks"?"To Do":n.status==="pending"?"Pending":n.status.replace("-"," ")})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full uppercase ${w[n.priority]}`,children:n.priority})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-700 dark:text-gray-300",children:[e.jsx(re,{className:"w-3 h-3 text-gray-400 dark:text-gray-500"}),e.jsx("span",{children:new Date(n.dueDate).toLocaleDateString()})]}),j&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600 dark:text-red-400 font-medium",children:[e.jsx("span",{className:"w-1 h-1 bg-red-600 dark:bg-red-400 rounded-full animate-pulse"}),"Overdue"]})]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-0.5 task-action-buttons",children:[e.jsx("button",{onClick:()=>l(n),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-md transition-all duration-200",title:"View details","aria-label":"View task details",children:e.jsx(ue,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>c(n),className:"p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 dark:text-gray-400 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-md transition-all duration-200",title:"Edit task","aria-label":"Edit task",children:e.jsx(K,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>S(n.id),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-md transition-all duration-200",title:"Delete","aria-label":"Delete task",children:e.jsx(J,{className:"w-3.5 h-3.5"})})]})})]},n.id)})})]})})})})]})});function nt(){return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600/20 dark:border-blue-400/20 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Loading..."})]})})}function lt({taskId:t,userId:r,userName:a}){const[o,l]=i.useState([]),[c,x]=i.useState(!0),[m,u]=i.useState(""),[y,s]=i.useState(!1),[v,S]=i.useState(null),[w,b]=i.useState("");i.useEffect(()=>{k()},[t]),i.useEffect(()=>()=>{s(!1)},[]);const k=async()=>{try{x(!0);const f=await Ke(t);l(f)}catch(f){console.error("Failed to load comments:",f)}finally{x(!1)}},n=async f=>{if(f.preventDefault(),!(!m.trim()||y)){s(!0);try{const T=await We(t,r,m.trim());l([...o,T]),u("")}catch(T){console.error("Failed to add comment:",T),alert("Failed to add comment")}finally{s(!1)}}},j=async f=>{if(w.trim())try{const T=await Ze(f,w.trim());l(o.map(N=>N.id===f?T:N)),S(null),b("")}catch(T){console.error("Failed to update comment:",T),alert("Failed to update comment")}},_=async f=>{if(confirm("Delete this comment?"))try{await Ge(f),l(o.filter(T=>T.id!==f))}catch(T){console.error("Failed to delete comment:",T),alert("Failed to delete comment")}};return c?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(nt,{})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(je,{className:"w-5 h-5"}),e.jsxs("h3",{className:"font-semibold",children:["Comments (",o.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:o.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:"No comments yet. Be the first to comment!"}):o.map(f=>e.jsx(it,{comment:f,isOwner:f.userId===r,isEditing:v===f.id,editText:w,onEditTextChange:b,onStartEdit:()=>{S(f.id),b(f.comment)},onCancelEdit:()=>{S(null),b("")},onSaveEdit:()=>j(f.id),onDelete:()=>_(f.id)},f.id))}),e.jsxs("form",{onSubmit:n,className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:m,onChange:f=>u(f.target.value),placeholder:"Write a comment...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:2,disabled:y})}),e.jsxs("button",{type:"submit",disabled:!m.trim()||y,className:"self-end px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),y?"Sending...":"Send"]})]})]})}function it({comment:t,isOwner:r,isEditing:a,editText:o,onEditTextChange:l,onStartEdit:c,onCancelEdit:x,onSaveEdit:m,onDelete:u}){var s,v,S;const y=w=>{const b=new Date(w),n=new Date().getTime()-b.getTime(),j=Math.floor(n/6e4),_=Math.floor(n/36e5),f=Math.floor(n/864e5);return j<1?"Just now":j<60?`${j}m ago`:_<24?`${_}h ago`:f<7?`${f}d ago`:b.toLocaleDateString()};return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium",children:((v=(s=t.user)==null?void 0:s.name)==null?void 0:v.charAt(0).toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:((S=t.user)==null?void 0:S.name)||"Unknown"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[y(t.createdAt),t.isEdited&&" (edited)"]})]})]}),r&&!a&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:c,className:"p-1 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"Edit comment",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:u,className:"p-1 text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete comment",children:e.jsx(J,{className:"w-4 h-4"})})]})]}),a?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:o,onChange:w=>l(w.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none",rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:x,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 text-sm rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"})]})]}):e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap",children:t.comment})]})}function ot({task:t,userId:r,onClose:a,onTaskUpdated:o,onTaskDeleted:l}){const[c,x]=i.useState("details"),[m,u]=i.useState(!1),[y,s]=i.useState([]),[v,S]=i.useState(!1),[w,b]=i.useState(!1);i.useEffect(()=>{c==="history"&&k()},[c]);const k=async()=>{try{S(!0);const N=await Qe(t.id);s(N)}catch(N){console.error("Failed to load history:",N)}finally{S(!1)}},n=async N=>{try{b(!0);const F=await we(t.id,{status:N});o(F)}catch(F){console.error("Failed to update status:",F),alert("Failed to update status")}finally{b(!1)}},j=async()=>{if(confirm("Delete this task? This action cannot be undone."))try{await ve(t.id),l(t.id),a()}catch(N){console.error("Failed to delete task:",N),alert("Failed to delete task")}},_=new Date(t.dueDate)<new Date&&t.status!=="completed",f={low:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",medium:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"},T={"my-tasks":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300","in-progress":"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",completed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"};return m?e.jsx(se,{userId:r,task:t,onClose:()=>u(!1),onTaskUpdated:N=>{o(N),u(!1)}}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-2",children:t.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${f[t.priority]}`,children:t.priority.toUpperCase()}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${T[t.status]}`,children:t.status==="my-tasks"?"To Do":t.status.replace("-"," ")}),_&&e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 rounded-full text-xs font-medium",children:[e.jsx(ne,{className:"w-3 h-3"}),"Overdue"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(!0),className:"p-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Edit task",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("button",{onClick:j,className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Delete task",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(ye,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 overflow-x-auto no-scrollbar",children:[e.jsx("button",{onClick:()=>x("details"),className:`px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap ${c==="details"?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Details"}),e.jsxs("button",{onClick:()=>x("comments"),className:`flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap ${c==="comments"?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(je,{className:"w-4 h-4"}),"Comments"]}),e.jsxs("button",{onClick:()=>x("history"),className:`flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors whitespace-nowrap ${c==="history"?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(Re,{className:"w-4 h-4"}),"History"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:[c==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:t.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.status!=="in-progress"&&e.jsx("button",{onClick:()=>n("in-progress"),disabled:w,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50",children:"Start Working"}),t.status!=="completed"&&e.jsxs("button",{onClick:()=>n("completed"),disabled:w,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Mark Complete"]}),t.status==="completed"&&e.jsx("button",{onClick:()=>n("my-tasks"),disabled:w,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:"Reopen Task"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(X,{icon:e.jsx(re,{className:"w-5 h-5"}),label:"Due Date",value:new Date(t.dueDate).toLocaleDateString()}),e.jsx(X,{icon:e.jsx(be,{className:"w-5 h-5"}),label:"Category",value:t.category.replace("-"," ")}),t.assignedToUser&&e.jsx(X,{icon:e.jsx(Oe,{className:"w-5 h-5"}),label:"Assigned To",value:t.assignedToUser.name}),t.assignedByUser&&e.jsx(X,{icon:e.jsx(Pe,{className:"w-5 h-5"}),label:"Assigned By",value:t.assignedByUser.name}),e.jsx(X,{icon:e.jsx(be,{className:"w-5 h-5"}),label:"Created",value:new Date(t.createdAt).toLocaleString()}),t.completedAt&&e.jsx(X,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"Completed",value:new Date(t.completedAt).toLocaleString()})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((N,F)=>e.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 rounded-full text-sm",children:N},F))})]}),t.attachments&&t.attachments.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Attachments"]}),e.jsx("div",{className:"space-y-2",children:t.attachments.map((N,F)=>e.jsxs("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(ae,{className:"w-4 h-4"}),N.split("/").pop()]},F))})]}),t.googleDriveLinks&&t.googleDriveLinks.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Google Drive Links"]}),e.jsx("div",{className:"space-y-2",children:t.googleDriveLinks.map((N,F)=>e.jsxs("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 break-all",children:[e.jsx(te,{className:"w-4 h-4 flex-shrink-0"}),N]},F))})]})]}),c==="comments"&&e.jsx(lt,{taskId:t.id,userId:r,userName:"Current User"}),c==="history"&&e.jsx("div",{className:"space-y-4",children:v?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Loading history..."}):y.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No history yet"}):y.map(N=>e.jsx(dt,{entry:N},N.id))})]})]})})}function X({icon:t,label:r,value:a}){return e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-750 rounded-lg",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white capitalize",children:a})]})]})}function dt({entry:t}){var o,l,c;const r=x=>new Date(x).toLocaleString(),a=x=>({created:"Created task",status_changed:"Changed status",priority_changed:"Changed priority",assigned:"Assigned task",deleted:"Deleted task"})[x]||x;return e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-gray-750 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium flex-shrink-0",children:((l=(o=t.user)==null?void 0:o.name)==null?void 0:l.charAt(0).toUpperCase())||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((c=t.user)==null?void 0:c.name)||"Unknown User"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r(t.createdAt)})]})}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-2",children:[a(t.action),t.fieldName&&e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"font-medium",children:t.fieldName}),t.oldValue&&t.newValue&&e.jsxs(e.Fragment,{children:[" from ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:t.oldValue})," to ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:t.newValue})]})]})]})]})]})}const ct=()=>e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"md:hidden space-y-4",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl border-2 border-gray-200 dark:border-gray-700 p-5 overflow-hidden relative",style:{animationDelay:`${t*.1}s`},children:[e.jsx("div",{className:"absolute inset-0 shimmer"}),e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded mt-1"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-16"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"})]})]})]})]})]},t))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl border-2 border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm relative",children:[e.jsx("div",{className:"absolute inset-0 shimmer z-10 pointer-events-none"}),e.jsxs("table",{className:"w-full relative z-0",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-750 border-b-2 border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"})}),e.jsx("th",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 ml-auto"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[1,2,3,4,5,6,7].map(t=>e.jsxs("tr",{style:{animationDelay:`${t*.05}s`},children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-48"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-64"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 dark:bg-gray-700 rounded-lg"})]})})]},t))})]})]})})]}),mt=({userId:t,sectionId:r,isSectionAdmin:a=!1,isAdmin:o=!1,openCreateForm:l=!1,onCloseCreateForm:c})=>{const[x,m]=i.useState(!1),[u,y]=i.useState(l),[s,v]=i.useState(null),[S,w]=i.useState(null),[b,k]=i.useState(0);i.useEffect(()=>{l&&y(!0)},[l]);const n=i.useCallback(()=>{y(!1),w(null),c&&c()},[c]),[j,_]=i.useState([]),[f,T]=i.useState(!0),[N,F]=i.useState(null),[O]=i.useState(1),[de,Y]=i.useState(0),I=i.useRef(null),P=i.useRef(null),L=i.useRef(!0),[V,g]=i.useState(""),[p,A]=i.useState({search:"",category:"all",status:"all",priority:"all"}),[C,M]=i.useState({field:"createdAt",direction:"desc"}),[D,$]=i.useState([]),[U,q]=i.useState(!1),z=i.useCallback(async(d=!1)=>{I.current&&I.current.abort();const h=new AbortController;I.current=h;try{d||T(!0),F(null);const E=await He(t,{page:O,pageSize:50,filters:p,sort:C,sectionId:r,abortSignal:h.signal,bypassCache:d});L.current&&!h.signal.aborted&&(_(E.tasks),Y(E.total),F(null))}catch(E){if(L.current&&!h.signal.aborted&&(E==null?void 0:E.name)!=="AbortError"&&(E==null?void 0:E.message)!=="Operation cancelled"){const G=E.message||"Failed to load tasks";F(G),console.error("Error loading tasks:",E)}}finally{L.current&&!h.signal.aborted&&T(!1),I.current===h&&(I.current=null)}},[t,O,p,C,r]);i.useEffect(()=>(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{A(d=>({...d,search:V}))},300),()=>{P.current&&clearTimeout(P.current)}),[V]),i.useEffect(()=>{z()},[z]),i.useEffect(()=>(L.current=!0,()=>{L.current=!1,I.current&&(I.current.abort(),I.current=null),P.current&&(clearTimeout(P.current),P.current=null),y(!1)}),[]),i.useEffect(()=>{l&&(k(d=>d+1),y(!0))},[l]);const ke=i.useCallback(d=>{y(!1),k(h=>h+1),z(!0)},[z]),ce=i.useCallback(d=>{L.current&&(_(h=>h.map(E=>E.id===d.id?d:E)),v(h=>(h==null?void 0:h.id)===d.id?d:h))},[]),Ne=i.useCallback(d=>{w(d)},[]),me=i.useCallback(d=>{L.current&&(_(h=>h.filter(E=>E.id!==d)),Y(h=>h-1),$(h=>h.filter(E=>E!==d)),v(h=>(h==null?void 0:h.id)===d?null:h))},[]),Ce=i.useCallback(async()=>{if(!(D.length===0||U)&&confirm(`Delete ${D.length} selected task${D.length>1?"s":""}?`)){q(!0);try{await Je(D),L.current&&(_(d=>d.filter(h=>!D.includes(h.id))),Y(d=>d-D.length),$([]),z(!0))}catch(d){L.current&&(F(d.message||"Failed to delete tasks"),z(!0))}finally{L.current&&q(!1)}}},[D,U,z]),De=i.useCallback(async d=>{if(!(D.length===0||U)){q(!0);try{await Ye(D,d),L.current&&($([]),await z(!0))}catch(h){L.current&&F(h.message||"Failed to update tasks")}finally{L.current&&q(!1)}}},[D,U,z]),Ee=i.useCallback(()=>{const d=["Name","Category","Status","Priority","Due Date","Created At"],h=j.map(B=>[B.name,B.category,B.status,B.priority,B.dueDate,new Date(B.createdAt).toLocaleDateString()]),E=[d,...h].map(B=>B.join(",")).join(`
`),G=new Blob([E],{type:"text/csv"}),xe=URL.createObjectURL(G),Q=document.createElement("a");Q.href=xe,Q.download=`tasks-${new Date().toISOString().split("T")[0]}.csv`,Q.click(),URL.revokeObjectURL(xe)},[j]),Z=i.useCallback((d,h)=>{A(E=>({...E,[d]:h}))},[]),Se=i.useCallback(d=>{M(d)},[]),Te=i.useMemo(()=>{let d=j;if(p.search){const h=p.search.toLowerCase();d=d.filter(E=>E.name.toLowerCase().includes(h)||E.description.toLowerCase().includes(h))}return p.category!=="all"&&(d=d.filter(h=>h.category===p.category)),p.status!=="all"&&(d=d.filter(h=>h.status===p.status)),p.priority!=="all"&&(d=d.filter(h=>h.priority===p.priority)),d},[j,p]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-1 lg:max-w-3xl",children:[e.jsx("div",{className:"flex-1 sm:max-w-md",children:e.jsxs("div",{className:"relative group",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 group-focus-within:text-blue-600 transition-colors"}),e.jsx("input",{type:"text",placeholder:"Search tasks...",value:V,onChange:d=>g(d.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 dark:focus:border-blue-500 dark:focus:ring-blue-900/30 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all outline-none shadow-sm","aria-label":"Search tasks"})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 overflow-x-auto pb-1 sm:pb-0 no-scrollbar sm:flex-wrap",children:[e.jsxs("button",{onClick:()=>m(!x),className:`flex items-center gap-1.5 px-3 py-2 border rounded-md font-medium transition-all duration-200 whitespace-nowrap shadow-sm text-sm ${x?"border-blue-600 bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-500 shadow-blue-100 dark:shadow-blue-900/20":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500"}`,"aria-label":x?"Hide filters":"Show filters","aria-expanded":x,children:[e.jsx(Be,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-medium",children:"Filters"})]}),D.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>De("completed"),disabled:U,className:"flex items-center gap-1.5 px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed font-medium transition-colors duration-200 whitespace-nowrap shadow-sm text-sm","aria-label":`Mark ${D.length} selected task${D.length>1?"s":""} as completed`,children:[e.jsx(qe,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs",children:U?"Processing...":"Complete"})]}),e.jsxs("button",{onClick:Ce,disabled:U,className:"flex items-center gap-1.5 px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed font-medium transition-colors duration-200 whitespace-nowrap shadow-sm text-sm","aria-label":`Delete ${D.length} selected task${D.length>1?"s":""}`,children:[e.jsx(J,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs",children:U?"Deleting...":"Delete"})]})]}),e.jsxs("button",{onClick:Ee,className:"flex items-center gap-1.5 px-3 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500 font-medium transition-all duration-200 whitespace-nowrap shadow-sm text-sm","aria-label":"Export tasks to CSV",children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-medium",children:"Export"})]})]})]}),e.jsx("div",{className:"flex items-center justify-end sm:w-auto w-full",children:e.jsxs("button",{onClick:()=>{k(d=>d+1),y(!0)},className:"w-full sm:w-auto flex items-center justify-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-md font-semibold transition-all duration-200 whitespace-nowrap shadow-md hover:shadow-lg text-sm","aria-label":"Create new task",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Create Task"})]})})]})}),x&&e.jsx("div",{className:"mt-2 p-3 bg-white dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsxs("select",{id:"category-filter",value:p.category,onChange:d=>Z("category",d.target.value),className:"w-full px-2.5 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none text-sm","aria-label":"Filter by category",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"assignment",children:"Assignment"}),e.jsx("option",{value:"quiz",children:"Quiz"}),e.jsx("option",{value:"presentation",children:"Presentation"}),e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"lab-report",children:"Lab Report"}),e.jsx("option",{value:"midterm",children:"Midterm"}),e.jsx("option",{value:"final-exam",children:"Final Exam"}),e.jsx("option",{value:"task",children:"Task"}),e.jsx("option",{value:"others",children:"Others"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{id:"status-filter",value:p.status,onChange:d=>Z("status",d.target.value),className:"w-full px-2.5 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none text-sm","aria-label":"Filter by status",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"my-tasks",children:"To Do"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority-filter",className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority-filter",value:p.priority,onChange:d=>Z("priority",d.target.value),className:"w-full px-2.5 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 dark:focus:border-blue-500 transition-colors outline-none text-sm","aria-label":"Filter by priority",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{g(""),A({search:"",category:"all",status:"all",priority:"all"})},className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors duration-200 text-sm","aria-label":"Reset all filters",children:"Reset"})})]})})]}),N?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] gap-3 p-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30",children:e.jsx(ne,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Failed to Load Tasks"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-md",children:N})]}),e.jsxs("button",{onClick:()=>z(!1),disabled:f,className:"flex items-center gap-1.5 px-4 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-md font-medium transition-colors duration-200 disabled:cursor-not-allowed text-sm",children:[e.jsx(ee,{className:`w-3.5 h-3.5 ${f?"animate-spin":""}`}),e.jsx("span",{children:"Retry"})]})]}):f?e.jsx(ct,{}):e.jsx(st,{tasks:Te,selectedTaskIds:D,onSelectTasks:$,onTaskClick:v,onTaskEdit:Ne,onTaskDelete:me,sort:C,onSortChange:Se}),u&&e.jsx(se,{userId:t,sectionId:r,onClose:n,onTaskCreated:ke},b),S&&e.jsx(se,{userId:t,sectionId:r,task:S,onClose:n,onTaskUpdated:d=>{ce(d),w(null)}}),s&&e.jsx(ot,{task:s,userId:t,onClose:()=>v(null),onTaskUpdated:ce,onTaskDeleted:me})]})},Pt=i.memo(mt);export{Pt as TaskManagerEnhanced};
