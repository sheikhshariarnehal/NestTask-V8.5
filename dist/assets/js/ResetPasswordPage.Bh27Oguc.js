import{r as e,j as s}from"./react-vendor.ChEovXhk.js";import{s as t}from"./index.Bgb9jjYo.js";import{A as a,a as r,b as n}from"./AuthSubmitButton.IZeObC6O.js";import{a as l}from"./authErrors.BDay5vyW.js";import{LucideShieldCheck as o,Check as i,Lock as d,EyeOff as c,Eye as x,Loader2 as m,ArrowLeft as h,LucideX as g}from"./icons.Be68WOzY.js";import"./charts.B0xhc6u6.js";import"./vendor.puyDUvHC.js";import"./capacitor-vendor.WkpnXCg6.js";import"./ionic-vendor.lbvV8mvR.js";import"./supabase-vendor.CQkAbalq.js";function u(){const[u,w]=e.useState(""),[y,p]=e.useState(""),[f,j]=e.useState(!1),[b,k]=e.useState(null),[N,v]=e.useState(!1),[P,S]=e.useState({password:!1,confirmPassword:!1}),[z,A]=e.useState(!1),[C,E]=e.useState(!1),[Z,R]=e.useState(3),{strength:L,score:q}=(e=>{if(!e)return{strength:"weak",score:0};let s=0;e.length>=8&&(s+=1),e.length>=12&&(s+=1),/[A-Z]/.test(e)&&(s+=1),/[a-z]/.test(e)&&(s+=1),/[0-9]/.test(e)&&(s+=1),/[^A-Za-z0-9]/.test(e)&&(s+=1);let t="weak";return s>=5?t="very-strong":s>=4?t="strong":s>=3&&(t="medium"),{strength:t,score:Math.min(s,6)}})(u);e.useEffect((()=>{(async()=>{try{const{data:{session:e}}=await t.auth.getSession();e||k("Your password reset link appears to be invalid or has expired. Please request a new link.")}catch(e){k("Unable to verify your session. Please try again or request a new reset link.")}})()}),[]),e.useEffect((()=>{if(N&&Z>0){const e=setTimeout((()=>R(Z-1)),1e3);return()=>clearTimeout(e)}N&&0===Z&&(window.location.href="/")}),[N,Z]);const Y=(e,s)=>{"password"===e?w(s):p(s),S((s=>({...s,[e]:!0}))),k(null)};return s.jsx("div",{className:"h-screen w-full bg-gray-50 dark:bg-gray-900 overflow-hidden relative",children:s.jsx("div",{className:"absolute inset-0 overflow-y-auto safe-area-inset-bottom",children:s.jsx("div",{className:"min-h-full flex flex-col justify-center py-6 sm:py-12 px-4 sm:px-6 lg:px-8",children:s.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 py-8 px-4 shadow-xl shadow-gray-200/50 dark:shadow-none rounded-2xl sm:px-10 border border-gray-100 dark:border-gray-700 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl mb-4",children:s.jsx(o,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white tracking-tight",children:"Reset Password"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Create a new secure password for your account"})]}),b&&s.jsx(a,{message:b}),N?s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-green-50 dark:bg-green-900/20 rounded-full mb-4 ring-8 ring-green-50/50 dark:ring-green-900/10",children:s.jsx(i,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Password Reset Successful!"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your password has been changed successfully."}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Redirecting to login in ",s.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:Z})," seconds..."]})]}):s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k(null),l(u)?u!==y?(k("Passwords do not match"),0):"weak"!==L||(k("Your password is too weak. Please choose a stronger password."),0):(k("Password must be at least 6 characters long"),0)){j(!0);try{const{error:e}=await t.auth.updateUser({password:u});if(e)throw e;v(!0),window.history.pushState&&window.history.pushState("","","/")}catch(s){k(s.message||"An error occurred while resetting your password. Please try again.")}finally{j(!1)}}},className:"space-y-5",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx(r,{type:z?"text":"password",value:u,onChange:e=>Y("password",e),label:"New Password",placeholder:"Enter your new password",icon:d,error:P.password&&!l(u)?"Password must be at least 6 characters":"",rightElement:s.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500 transition-colors",onClick:()=>A(!z),tabIndex:-1,children:z?s.jsx(c,{className:"w-4 h-4"}):s.jsx(x,{className:"w-4 h-4"})})}),P.password&&u&&s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-1",children:s.jsx("span",{className:"text-xs font-medium capitalize text-gray-700 dark:text-gray-300",children:L.replace("-"," ")})}),s.jsx("div",{className:"h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${{weak:"bg-red-500",medium:"bg-yellow-500",strong:"bg-green-500","very-strong":"bg-emerald-500"}[L]} transition-all duration-500 ease-out`,style:{width:q/6*100+"%"}})})]}),P.password&&u&&"weak"===L&&s.jsx("p",{className:"mt-1 text-xs text-red-500 dark:text-red-400",children:"Choose a stronger password for better security"})]}),s.jsx(r,{type:C?"text":"password",value:y,onChange:e=>Y("confirmPassword",e),label:"Confirm Password",placeholder:"Confirm your new password",icon:d,error:P.confirmPassword&&u!==y?"Passwords do not match":"",rightElement:s.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500 transition-colors",onClick:()=>E(!C),tabIndex:-1,children:C?s.jsx(c,{className:"w-4 h-4"}):s.jsx(x,{className:"w-4 h-4"})})}),P.password&&u&&s.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[s.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Password requirements:"}),s.jsxs("ul",{className:"space-y-1 pl-1",children:[s.jsxs("li",{className:"flex items-center "+(u.length>=6?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:[u.length>=6?s.jsx(i,{size:16,className:"mr-2 flex-shrink-0"}):s.jsx(g,{size:16,className:"mr-2 flex-shrink-0"}),"At least 6 characters"]}),s.jsxs("li",{className:"flex items-center "+(/[A-Z]/.test(u)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:[/[A-Z]/.test(u)?s.jsx(i,{size:16,className:"mr-2 flex-shrink-0"}):s.jsx(g,{size:16,className:"mr-2 flex-shrink-0"}),"At least one uppercase letter"]}),s.jsxs("li",{className:"flex items-center "+(/[0-9]/.test(u)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:[/[0-9]/.test(u)?s.jsx(i,{size:16,className:"mr-2 flex-shrink-0"}):s.jsx(g,{size:16,className:"mr-2 flex-shrink-0"}),"At least one number"]}),s.jsxs("li",{className:"flex items-center "+(/[^A-Za-z0-9]/.test(u)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:[/[^A-Za-z0-9]/.test(u)?s.jsx(i,{size:16,className:"mr-2 flex-shrink-0"}):s.jsx(g,{size:16,className:"mr-2 flex-shrink-0"}),"At least one special character"]})]})]}),s.jsx(n,{label:f?"Resetting Password...":"Reset Password",isLoading:f,icon:f?m:void 0,disabled:!u||!y||u!==y||"weak"===L}),s.jsx("div",{className:"mt-6 text-center",children:s.jsxs("button",{type:"button",onClick:()=>{window.history.pushState&&window.history.pushState("","","/"),window.location.reload()},className:"inline-flex items-center justify-center text-sm font-medium text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:[s.jsx(h,{className:"w-4 h-4 mr-1"}),"Back to Login"]})})]})]})})})})})}export{u as ResetPasswordPage};
