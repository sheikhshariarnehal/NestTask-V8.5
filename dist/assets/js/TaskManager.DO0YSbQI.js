import{r as e,j as r,s as t}from"./index.D5HgYyae.js";import{i as a,n as s,g as l,E as n,P as i}from"./googleDriveUtils.Bs4em4N2.js";import{L as o}from"./list-todo.B_jOqh-E.js";import{T as d}from"./tag.BBEq3Fec.js";import{C as c}from"./calendar.DuEmmdvM.js";import{A as m,S as u,C as x,b as g,a as p,c as b,L as h,R as y}from"./square.C9sHHkK_.js";import{U as f}from"./upload.9KbqQAm-.js";import{L as k}from"./link.BW2TzQyJ.js";import{P as j}from"./plus.D47O1wvq.js";import{A as v}from"./alert-circle.CQKj6s3K.js";import{C as w}from"./check-circle.DuWWpmyy.js";import{X as N}from"./x.T9mnuWR1.js";import{F as D}from"./file-text.DSlNaGRz.js";import{T as S}from"./trash-2.BqyRYTpe.js";import{S as C}from"./save.DptjPAdh.js";import{i as E,f as T}from"./dateUtils.8XYiGfWV.js";import{C as R}from"./check-square.B23TFc9X.js";import{A as L}from"./alert-triangle.B1rn70lZ.js";import{C as $}from"./copy.rgpm29wr.js";import{P as A}from"./pen.vWE_zFfb.js";import{C as _}from"./clock.B25PmJRC.js";import{a as I,s as U}from"./notifications.DvTNppm3.js";import{C as O}from"./chevron-up.BHl-PrSC.js";import{F}from"./filter.CkQ8bkvn.js";import{D as P}from"./download.RjYYxeRK.js";import{R as G}from"./refresh-cw.CHATMbGT.js";import{S as M}from"./search.CIutKDVd.js";import{L as z}from"./loader-2.D3eri1qP.js";import"./createLucideIcon.CgqYSU6F.js";const B=e=>({taskDetails:{name:"",category:"task",dueDate:"",description:"",status:"in-progress",sectionId:e||void 0,googleDriveLinks:[]},errors:{},files:[],fileUrls:[],googleDriveLinks:[],currentGoogleDriveLink:"",isSubmitting:!1,success:!1,uploadProgress:0});function q(e,r){switch(r.type){case"SET_TASK_FIELD":return{...e,taskDetails:{...e.taskDetails,[r.field]:r.value}};case"SET_ERRORS":return{...e,errors:r.errors};case"CLEAR_ERROR":const{[r.field]:t,...a}=e.errors;return{...e,errors:a};case"ADD_FILES":return{...e,files:[...e.files,...r.newFiles],fileUrls:[...e.fileUrls,...r.newUrls]};case"REMOVE_FILE":return{...e,files:e.files.filter(((e,t)=>t!==r.index)),fileUrls:e.fileUrls.filter(((e,t)=>t!==r.index))};case"SET_CURRENT_GOOGLE_DRIVE_LINK":return{...e,currentGoogleDriveLink:r.link};case"ADD_GOOGLE_DRIVE_LINK":return{...e,googleDriveLinks:[...e.googleDriveLinks,r.link],currentGoogleDriveLink:"",taskDetails:{...e.taskDetails,googleDriveLinks:[...e.taskDetails.googleDriveLinks||[],r.link]}};case"REMOVE_GOOGLE_DRIVE_LINK":const s=e.googleDriveLinks.filter(((e,t)=>t!==r.index));return{...e,googleDriveLinks:s,taskDetails:{...e.taskDetails,googleDriveLinks:s}};case"SET_SUBMITTING":return{...e,isSubmitting:r.isSubmitting};case"SET_SUCCESS":return{...e,success:r.success};case"SET_UPLOAD_PROGRESS":return{...e,uploadProgress:r.progress};case"RESET_FORM":return B(r.sectionId);default:return e}}const V=({id:e,label:t,required:a=!1,error:s,children:l})=>r.jsxs("div",{children:[r.jsxs("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t," ",a&&r.jsx("span",{className:"text-red-500",children:"*"})]}),l,s&&r.jsxs("p",{id:`${e}-error`,className:"mt-1 text-xs text-red-500 flex items-center gap-1",role:"alert",children:[r.jsx(v,{className:"w-3 h-3"}),s]})]}),K=()=>r.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg mb-4 flex items-start gap-2 shadow-sm",role:"alert",children:[r.jsx(w,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"text-green-700 dark:text-green-300",children:"Task created successfully!"})]}),H=({progress:e})=>r.jsxs("div",{className:"mb-4","aria-live":"polite",children:[r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:r.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${e}%`},role:"progressbar","aria-valuenow":e,"aria-valuemin":0,"aria-valuemax":100})}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Uploading files... ",e,"%"]})]}),W=({file:e,onRemove:t})=>{return r.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 group",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r.jsx("span",{className:"text-2xl flex-shrink-0",children:(e=>{var r;const t=null==(r=e.split(".").pop())?void 0:r.toLowerCase();return["jpg","jpeg","png","gif","svg","webp"].includes(t||"")?"ğŸ–¼ï¸":["pdf"].includes(t||"")?"ğŸ“„":["doc","docx"].includes(t||"")?"ğŸ“":["xls","xlsx"].includes(t||"")?"ğŸ“Š":["zip","rar","7z"].includes(t||"")?"ğŸ—œï¸":"ğŸ“"})(e.name)}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 truncate",children:e.name}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:(a=e.size,a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB")})]})]}),r.jsx("button",{type:"button",onClick:t,className:"flex-shrink-0 p-1.5 text-gray-400 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200 opacity-0 group-hover:opacity-100","aria-label":"Remove file",children:r.jsx(N,{className:"w-4 h-4"})})]});var a},Q=({url:e,onRemove:t})=>r.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[r.jsxs("div",{className:"flex items-center gap-2 truncate max-w-[85%]",children:[r.jsx(k,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),r.jsxs("div",{className:"flex flex-col min-w-0",children:[r.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300 truncate",children:l(e)}),r.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 truncate",children:e})]})]}),r.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[r.jsx("button",{type:"button",onClick:()=>window.open(e,"_blank","noopener,noreferrer"),className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300 p-1 rounded-full hover:bg-blue-100 dark:hover:bg-blue-800 touch-manipulation","aria-label":"Open Google Drive link",children:r.jsx(n,{className:"w-4 h-4"})}),r.jsx("button",{type:"button",onClick:t,className:"text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 touch-manipulation","aria-label":"Remove Google Drive link",children:r.jsx(N,{className:"w-4 h-4"})})]})]});function X({onSubmit:t,sectionId:l,isSectionAdmin:n=!1,isSubmitting:i=!1}){const[u,x]=e.useReducer(q,B(l)),{taskDetails:g,errors:p,files:b,fileUrls:h,googleDriveLinks:y,currentGoogleDriveLink:v,isSubmitting:w,success:N,uploadProgress:D}=u,S=e.useRef(),C=e.useRef(!0),E=e.useRef(),T=e.useRef(null);e.useEffect((()=>(C.current=!0,()=>{C.current=!1,x({type:"SET_SUBMITTING",isSubmitting:!1}),S.current&&clearTimeout(S.current),E.current&&E.current.abort(),h.forEach((e=>{e&&!e.startsWith("placeholder-")&&URL.revokeObjectURL(e)}))})),[h,x]);const R=e.useCallback((()=>/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768),[]);e.useEffect((()=>{if(R()&&T.current){const e=T.current;e.addEventListener("focus",(()=>{e.classList.add("mobile-date-focused")})),e.addEventListener("blur",(()=>{e.classList.remove("mobile-date-focused")}))}}),[R]);const L=e.useCallback((()=>{const e={};let r=!0;if(g.name.trim()||(e.name="Task name is required",r=!1),g.dueDate){const t=new Date(g.dueDate),a=new Date;a.setHours(0,0,0,0),t<a&&(e.dueDate="Due date cannot be in the past",r=!1)}else e.dueDate="Due date is required",r=!1;return g.description.trim()||(e.description="Description is required",r=!1),x({type:"SET_ERRORS",errors:e}),r}),[g]),$=e.useCallback((e=>{const{name:r,value:t}=e.target;x({type:"SET_TASK_FIELD",field:r,value:t}),p[r]&&x({type:"CLEAR_ERROR",field:r})}),[p]),A=e.useCallback((e=>{var r;if(!(null==(r=e.target.files)?void 0:r.length))return;const t=Array.from(e.target.files),a=t.filter((e=>e.size>52428800));if(a.length>0)x({type:"SET_ERRORS",errors:{...p,files:`Some files exceed the 50MB size limit: ${a.map((e=>e.name)).join(", ")}`}});else{if(R()){const e=t.map((e=>`placeholder-${e.name}-${Date.now()}`));x({type:"ADD_FILES",newFiles:t,newUrls:e})}else{const e=t.map((e=>URL.createObjectURL(e)));x({type:"ADD_FILES",newFiles:t,newUrls:e})}p.files&&x({type:"CLEAR_ERROR",field:"files"})}}),[p,R]),_=e.useCallback((e=>{h[e]&&!h[e].startsWith("placeholder-")&&URL.revokeObjectURL(h[e]),x({type:"REMOVE_FILE",index:e})}),[h]),I=e.useCallback((e=>{const r=e.target.value;x({type:"SET_CURRENT_GOOGLE_DRIVE_LINK",link:r}),p.googleDriveLinks&&x({type:"CLEAR_ERROR",field:"googleDriveLinks"})}),[p.googleDriveLinks]),U=e.useCallback((()=>{const e=v.trim();if(!e)return void x({type:"SET_ERRORS",errors:{...p,googleDriveLinks:"Please enter a Google Drive link"}});if(!a(e))return void x({type:"SET_ERRORS",errors:{...p,googleDriveLinks:"Please enter a valid Google Drive URL"}});const r=s(e);y.includes(r)?x({type:"SET_ERRORS",errors:{...p,googleDriveLinks:"This Google Drive link has already been added"}}):x({type:"ADD_GOOGLE_DRIVE_LINK",link:r})}),[v,y,p]),O=e.useCallback((e=>{x({type:"REMOVE_GOOGLE_DRIVE_LINK",index:e})}),[]),F=e.useCallback((e=>{"Enter"===e.key&&(e.preventDefault(),U())}),[U]),P=e.useCallback((()=>(new Date).toISOString().split("T")[0]),[]),G=e.useCallback((async e=>{if(e.preventDefault(),w)console.log("[TaskForm] Already submitting, ignoring duplicate submission");else if(console.log("[TaskForm] Starting task submission"),S.current&&clearTimeout(S.current),E.current=new AbortController,L()){x({type:"SET_SUBMITTING",isSubmitting:!0}),x({type:"SET_UPLOAD_PROGRESS",progress:0}),S.current=setTimeout((()=>{var e;C.current&&(console.error("[Error] Task submission timed out after 45 seconds"),x({type:"SET_SUBMITTING",isSubmitting:!1}),x({type:"SET_ERRORS",errors:{name:"Submission timed out. Please try again with smaller files or check your connection."}}),null==(e=E.current)||e.abort())}),45e3);try{let e=g.description;const r=R();b.length>0&&(e+="\n\n**Attachments:**\n",r?(b.filter((e=>e.size>0&&e.name&&"string"==typeof e.name)).forEach((r=>{e+=`- [${r.name}](attachment:${r.name})\n`})),e+="\n\x3c!-- mobile-uploads --\x3e\n"):b.forEach((r=>{const t=URL.createObjectURL(r);e+=`- [${r.name}](${t})\n`}))),n&&l&&(e+=`\n\n*This task is assigned to section ID: ${l}*`);const a={...g,description:e,sectionId:l};if(r&&b.length>0){const e=b.filter((e=>e.name&&e.size>0));a._mobileFiles=e,n&&l&&(console.log("[Debug] Setting section admin mobile flags:",{isSectionAdmin:n,sectionId:l}),a._isSectionAdminMobile=!0,a._sectionId=l,a.sectionId=l),a._mobileTimestamp=Date.now()}await t(a),console.log("[TaskForm] Task submitted successfully"),S.current&&clearTimeout(S.current),C.current&&(x({type:"SET_SUBMITTING",isSubmitting:!1}),x({type:"RESET_FORM",sectionId:l}),x({type:"SET_SUCCESS",success:!0}),setTimeout((()=>{C.current&&x({type:"SET_SUCCESS",success:!1})}),3e3))}catch(r){console.error("[Error] Task creation failed:",r),S.current&&clearTimeout(S.current),C.current&&(x({type:"SET_ERRORS",errors:{name:`Failed to create task: ${r instanceof Error?r.message:"Unknown error"}`}}),x({type:"SET_SUBMITTING",isSubmitting:!1}),x({type:"SET_UPLOAD_PROGRESS",progress:0}))}}}),[L,g,b,R,n,l,t]);return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700",children:[r.jsx("div",{className:"px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center bg-gradient-to-r from-blue-50 to-white dark:from-gray-800 dark:to-gray-750",children:r.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-gray-800 dark:text-white flex items-center",children:[r.jsx(o,{className:"w-5 h-5 mr-2 text-blue-600 dark:text-blue-400"}),"Create New Task",n&&l&&r.jsx("span",{className:"ml-2 text-xs sm:text-sm text-green-600 dark:text-green-400 font-normal px-2 py-0.5 bg-green-100 dark:bg-green-900/30 rounded-full",children:"Section Task"})]})}),r.jsxs("form",{onSubmit:G,className:"p-4 sm:p-6 space-y-5 sm:space-y-6",children:[N&&r.jsx(K,{}),w&&D>0&&D<100&&r.jsx(H,{progress:D}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5",children:[r.jsx("div",{className:"col-span-1 sm:col-span-2",children:r.jsx(V,{id:"name",label:"Task Name",required:!0,error:p.name,children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none",children:r.jsx(o,{className:"w-5 h-5"})}),r.jsx("input",{type:"text",id:"name",name:"name",value:g.name,onChange:$,className:`w-full pl-10 pr-4 py-3 border ${p.name?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"} rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm sm:text-base touch-manipulation`,placeholder:"Enter task name","aria-required":"true","aria-invalid":!!p.name,"aria-describedby":p.name?"name-error":void 0,autoComplete:"off"})]})})}),r.jsx("div",{children:r.jsx(V,{id:"category",label:"Category",error:p.category,children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none",children:r.jsx(d,{className:"w-5 h-5"})}),r.jsxs("select",{id:"category",name:"category",value:g.category,onChange:$,className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white appearance-none text-sm sm:text-base touch-manipulation",children:[r.jsx("option",{value:"task",children:"Task"}),r.jsx("option",{value:"assignment",children:"Assignment"}),r.jsx("option",{value:"project",children:"Project"}),r.jsx("option",{value:"quiz",children:"Quiz"}),r.jsx("option",{value:"midterm",children:"Midterm"}),r.jsx("option",{value:"final-exam",children:"Final Exam"}),r.jsx("option",{value:"lab-report",children:"Lab Report"}),r.jsx("option",{value:"lab-performance",children:"Lab Performance"}),r.jsx("option",{value:"lab-final",children:"Lab Final"}),r.jsx("option",{value:"presentation",children:"Presentation"}),r.jsx("option",{value:"blc",children:"BLC"}),r.jsx("option",{value:"documents",children:"Documents"}),r.jsx("option",{value:"groups",children:"Groups"}),r.jsx("option",{value:"others",children:"Others"})]})]})})}),r.jsx("div",{children:r.jsx(V,{id:"dueDate",label:"Due Date",required:!0,error:p.dueDate,children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none",children:r.jsx(c,{className:"w-5 h-5"})}),r.jsx("input",{type:"date",id:"dueDate",name:"dueDate",ref:T,value:g.dueDate,onChange:$,min:P(),className:`w-full pl-10 pr-4 py-3 border ${p.dueDate?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"} rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm sm:text-base touch-manipulation mobile-date-input`,"aria-required":"true","aria-invalid":!!p.dueDate,"aria-describedby":p.dueDate?"dueDate-error":void 0})]})})}),r.jsx("div",{className:"col-span-1 sm:col-span-2",children:r.jsx(V,{id:"description",label:"Description",required:!0,error:p.description,children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-3 top-3 text-gray-400 pointer-events-none",children:r.jsx(m,{className:"w-5 h-5"})}),r.jsx("textarea",{id:"description",name:"description",value:g.description,onChange:$,rows:4,className:`w-full pl-10 pr-4 py-2 border ${p.description?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"} rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm sm:text-base touch-manipulation`,placeholder:"Enter task description","aria-required":"true","aria-invalid":!!p.description,"aria-describedby":p.description?"description-error":void 0})]})})}),r.jsx("div",{className:"col-span-1 sm:col-span-2",children:r.jsxs(V,{id:"files",label:"Attachments",error:p.files,children:[r.jsx("div",{className:"flex items-center justify-center w-full",children:r.jsxs("label",{htmlFor:"file-upload",className:"w-full flex flex-col items-center justify-center px-6 py-8 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-750 text-gray-600 dark:text-gray-400 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-all duration-200 touch-manipulation group","aria-label":"Upload files - tap to select files",children:[r.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[r.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full group-hover:scale-110 transition-transform duration-200",children:r.jsx(f,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:R()?"Tap to select files":"Click to upload or drag & drop"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"PDF, DOC, Images, etc. (Max 50MB per file)"})]})]}),r.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:A,multiple:!0,accept:"image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","aria-label":"File upload"})]})}),h.length>0&&r.jsxs("div",{className:"mt-4 space-y-2 max-h-48 overflow-y-auto pr-1",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsxs("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400",children:["Attached Files (",b.length,")"]})}),b.map(((e,t)=>r.jsx(W,{file:e,onRemove:()=>_(t)},`${e.name}-${t}`)))]})]})}),n&&r.jsx("div",{className:"col-span-1 sm:col-span-2",children:r.jsx(V,{id:"googleDriveLinks",label:"Google Drive Links",error:p.googleDriveLinks,children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none",children:r.jsx(k,{className:"w-5 h-5"})}),r.jsx("input",{type:"url",id:"googleDriveLink",value:v,onChange:I,onKeyPress:F,placeholder:"Paste Google Drive link here...",className:`w-full pl-10 pr-4 py-3 border ${p.googleDriveLinks?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"} rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm sm:text-base touch-manipulation`,"aria-describedby":p.googleDriveLinks?"googleDriveLinks-error":void 0})]}),r.jsx("button",{type:"button",onClick:U,disabled:!v.trim(),className:"px-4 py-3 rounded-xl font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 touch-manipulation "+(v.trim()?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"),"aria-label":"Add Google Drive link",children:r.jsx(j,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.jsx("p",{children:"Supported: Google Drive files, folders, Docs, Sheets, Slides, and Forms"}),r.jsx("p",{children:"Only section administrators can attach Google Drive links"})]}),y.length>0&&r.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-1",children:y.map(((e,t)=>r.jsx(Q,{url:e,onRemove:()=>O(t)},`${e}-${t}`)))})]})})})]}),r.jsx("div",{className:"flex justify-end pt-2",children:r.jsx("button",{type:"submit",disabled:w||i,className:`px-4 py-2 rounded-md text-white font-medium shadow-sm \n              ${w||i?"bg-blue-400 dark:bg-blue-600 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600"}\n              transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 w-full sm:w-auto`,children:w||i?"Creating...":"Create Task"})})]})]})}function Z({task:a,onClose:s,onUpdate:l}){const[o,m]=e.useState({name:a.name||"",category:a.category||"task",dueDate:a.dueDate||"",description:(e=>{if(!e)return"";let r=e.replace(/(?:^- |\n- )?\[([^\]]+)\]\(([^)]+)\)/g,((e,r,t)=>t.includes("supabase.co/storage")||t.includes("task-attachments")||r.match(/\.[a-zA-Z0-9]+$/)?"":e));return r=r.replace(/\n*\*\*Attachments:\*\*\n*((?:- \[.*?\]\(.*?\)\n*)*)/g,""),r=r.replace(/\n*\*\*Links:\*\*\n*((?:- \[.*?\]\(.*?\)\n*)*)/g,""),r=r.replace(/\*This task is assigned to section ID: [a-f0-9-]+\*/g,""),r=r.replace(/\n{3,}/g,"\n\n").replace(/^\n+|\n+$/g,"").trim(),r})(a.description||""),status:a.status||"my-tasks"}),[u,x]=e.useState((e=>{if(!e)return[];const r=[],t=/(?:^- |\n- )?\[([^\]]+)\]\(([^)]+)\)/g;let a;for(;null!==(a=t.exec(e));){const[,e,t]=a;if(t.includes("supabase.co/storage")||t.includes("task-attachments")||e.match(/\.[a-zA-Z0-9]+$/)){const a=t.match(/task-files\/([^?]+)/),s=a?a[1]:void 0;r.push({name:e,url:t,path:s})}}return r})(a.description||"")),[g,p]=e.useState([]),[b,h]=e.useState({}),[y,k]=e.useState(!1),j=e.useRef(null);e.useEffect((()=>{const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[s]);const v=e=>{const{name:r,value:t}=e.target;m((e=>({...e,[r]:t})))},w=async e=>{const r=e.name.split(".").pop(),a=`${"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const r=16*Math.random()|0;return("x"==e?r:3&r|8).toString(16)}))}.${r}`,s=`task-files/${a}`,{data:l,error:n}=await t.storage.from("task-attachments").upload(s,e,{cacheControl:"3600",upsert:!1,contentType:e.type});if(n)throw new Error(`Upload failed: ${n.message}`);if(!l)throw new Error("Upload completed but no data returned");const{data:{publicUrl:i}}=t.storage.from("task-attachments").getPublicUrl(s);return{url:i,path:a}};return r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",children:r.jsx(D,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Edit Task"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Update task information"})]})]}),r.jsx("button",{onClick:s,className:"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center transition-colors",children:r.jsx(N,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o.name.trim()&&o.dueDate&&o.description.trim()){k(!0);try{const e=[];for(const a of g)try{h((e=>({...e,[a.name]:25})));const{url:r,path:t}=await w(a);e.push({name:a.name,url:r,path:t}),h((e=>({...e,[a.name]:100})))}catch(r){throw h((e=>({...e,[a.name]:0}))),new Error(`Failed to upload ${a.name}: ${r instanceof Error?r.message:"Unknown error"}`)}let t=o.description.trim();const n=[...u,...e.map((e=>({name:e.name,url:e.url})))];n.length>0&&(t+="\n\n**Attachments:**\n",n.forEach((e=>{t+=`- [${e.name}](${e.url})\n`}))),a.sectionId&&(t+=`\n\n*This task is assigned to section ID: ${a.sectionId}*`);const i={...o,description:t};await l(a.id,i),s()}catch(r){console.error("Failed to update task:",r),alert(`Error: ${r instanceof Error?r.message:"Unknown error occurred"}`)}finally{k(!1),h({})}}},className:"p-6 space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Task Name *"}),r.jsx("input",{type:"text",name:"name",value:o.name,onChange:v,className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter task name",required:!0})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category *"}),r.jsxs("div",{className:"relative",children:[r.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("select",{name:"category",value:o.category,onChange:v,className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none",required:!0,children:[{value:"assignment",label:"Assignment"},{value:"blc",label:"BLC"},{value:"documents",label:"Documents"},{value:"final-exam",label:"Final Exam"},{value:"groups",label:"Groups"},{value:"lab-final",label:"Lab Final"},{value:"lab-performance",label:"Lab Performance"},{value:"lab-report",label:"Lab Report"},{value:"midterm",label:"Midterm"},{value:"presentation",label:"Presentation"},{value:"project",label:"Project"},{value:"quiz",label:"Quiz"},{value:"task",label:"Task"},{value:"others",label:"Others"}].map((e=>r.jsx("option",{value:e.value,children:e.label},e.value)))})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Due Date *"}),r.jsxs("div",{className:"relative",children:[r.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"date",name:"dueDate",value:o.dueDate,onChange:v,className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",required:!0})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),r.jsx("div",{className:"flex gap-2",children:[{value:"my-tasks",label:"To Do"},{value:"in-progress",label:"In Progress"},{value:"completed",label:"Completed"}].map((e=>r.jsx("button",{type:"button",onClick:()=>m((r=>({...r,status:e.value}))),className:"flex-1 py-2.5 px-4 rounded-lg text-sm font-medium transition-all "+(o.status===e.value?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-2 border-blue-200 dark:border-blue-700":"bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-2 border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700"),children:e.label},e.value)))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description *"}),r.jsx("textarea",{name:"description",value:o.description,onChange:v,rows:4,className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",placeholder:"Describe the task details...",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(i,{className:"w-4 h-4"}),"Attachments",u.length+g.length>0&&r.jsxs("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full",children:[u.length+g.length," file",u.length+g.length!==1?"s":""]})]})}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors cursor-pointer",onClick:()=>{var e;null==(e=j.current)||e.click()},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragEnter:e=>{e.preventDefault(),e.stopPropagation()},onDragLeave:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();const r=Array.from(e.dataTransfer.files);if(0===r.length)return;const t=r.filter((e=>!(e.size>10485760&&(alert(`File "${e.name}" is too large. Maximum size is 10MB.`),1))));if(t.length>0){p((e=>[...e,...t]));const e={};t.forEach((r=>{e[r.name]=0})),h((r=>({...r,...e})))}},children:[r.jsx("input",{ref:j,type:"file",multiple:!0,onChange:e=>{const r=e.target.files;if(!r||0===r.length)return;const t=Array.from(r).filter((e=>!(e.size>10485760&&(alert(`File "${e.name}" is too large. Maximum size is 10MB.`),1))));if(t.length>0){p((e=>[...e,...t]));const e={};t.forEach((r=>{e[r.name]=0})),h((r=>({...r,...e})))}e.target.value=""},className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.zip,.rar"}),r.jsx(f,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[r.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium hover:underline",children:"Click to upload"})," or drag and drop"]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:"PDF, DOC, TXT, Images up to 10MB"}),g.length>0&&r.jsxs("div",{className:"mt-3 text-xs text-green-600 dark:text-green-400",children:[g.length," file",1!==g.length?"s":""," ready to upload"]})]}),u.length>0&&r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Current Attachments"}),u.map(((e,a)=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:r.jsx(D,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate max-w-[200px]",children:e.name}),r.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Existing file"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{type:"button",onClick:()=>window.open(e.url,"_blank"),className:"w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 flex items-center justify-center transition-colors",title:"View file",children:r.jsx(n,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),r.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(async e=>{const r=u[e];if(r)try{r.path&&await(async e=>{if(!e)return;const{error:r}=await t.storage.from("task-attachments").remove([`task-files/${e}`]);if(r)throw console.error("Error deleting file:",r),r})(r.path),x((r=>r.filter(((r,t)=>t!==e))))}catch(a){console.error("Error removing attachment:",a),x((r=>r.filter(((r,t)=>t!==e))))}})(a)},className:"w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 flex items-center justify-center transition-colors",title:"Remove file",disabled:y,children:r.jsx(S,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})]},`existing-${e.name}-${a}`)))]}),g.length>0&&r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"New Attachments"}),g.map(((e,t)=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:r.jsx(D,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:[(e.size/1024).toFixed(1)," KB â€¢ New"]}),void 0!==b[e.name]&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-16 h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${b[e.name]||0}%`}})}),r.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[Math.round(b[e.name]||0),"%"]})]})]})]})]}),r.jsx("button",{type:"button",onClick:e=>{var r;e.preventDefault(),e.stopPropagation(),r=t,p((e=>e.filter(((e,t)=>t!==r))))},className:"w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 flex items-center justify-center transition-colors",disabled:y,children:r.jsx(S,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]},`new-${e.name}-${e.size}-${t}`)))]})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:s,className:"flex-1 py-3 px-4 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-medium",disabled:y,children:"Cancel"}),r.jsx("button",{type:"submit",disabled:y||!o.name.trim()||!o.dueDate||!o.description.trim(),className:"flex-1 py-3 px-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 dark:disabled:bg-gray-700 text-white rounded-xl transition-colors font-medium flex items-center justify-center gap-2",children:y?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),g.length>0?"Uploading & Saving...":"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(C,{className:"w-4 h-4"}),"Save Changes"]})})]})]})]})})}function J({tasks:t,onDeleteTask:a,onUpdateTask:s,isSectionAdmin:l=!1,viewMode:n="table",selectedTaskIds:i=[],onToggleSelection:d=()=>{},onSelectAll:c=()=>{},sortBy:m="dueDate",sortOrder:b="asc",onSort:h=()=>{}}){const[y,f]=e.useState(null);e.useState(null);const[k,j]=e.useState(!1);e.useState(null),e.useState(null);const[v,N]=e.useState(null);e.useRef(null),e.useEffect((()=>{const e=()=>{j(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const D=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"in-progress":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"}},C=e=>{switch(e){case"completed":return r.jsx(w,{className:"w-3 h-3"});case"in-progress":return r.jsx(_,{className:"w-3 h-3"});default:return r.jsx(o,{className:"w-3 h-3"})}},I=e=>{switch(e){case"completed":return"Completed";case"in-progress":return"In Progress";default:return"To Do"}},U=e=>{switch(e){case"high":return r.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",children:"High"});case"medium":return r.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",children:"Medium"});case"low":return r.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:"Low"});default:return null}},O=e=>m!==e?null:"asc"===b?r.jsx(g,{className:"w-3.5 h-3.5 ml-1 inline-block"}):r.jsx(p,{className:"w-3.5 h-3.5 ml-1 inline-block"}),F=async e=>{const r=e.description.replace(/\*\*Attachments:\*\*[\s\S]*?(?=\n\n|$)/g,"").trim(),t=`\nğŸ“‹ TASK: ${e.name}\nğŸ“… Due Date: ${T(e.dueDate)}\nğŸ·ï¸ Category: ${e.category}\n\nğŸ“ Description:\n${r}\n\nğŸŒ View: https://nesttask.vercel.app/\n    `.trim();try{await navigator.clipboard.writeText(t),N(e.id),setTimeout((()=>N(null)),2e3)}catch(a){console.error("Failed to copy task details:",a)}};return 0===t.length?r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-8 text-center",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No tasks available"})}):r.jsxs(r.Fragment,{children:["table"===n?r.jsx("div",{className:"relative overflow-hidden rounded-lg",children:r.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:r.jsx("div",{className:"inline-block min-w-full align-middle",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"w-12 sm:w-8 px-2 sm:px-4 py-3",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("button",{onClick:c,className:"p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Select all tasks",children:i.length>0&&i.length===t.length?r.jsx(R,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-500 dark:text-blue-400"}):r.jsx(u,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 dark:text-gray-500"})})})}),r.jsx("th",{className:"px-2 sm:px-4 py-3 text-left",children:r.jsxs("button",{onClick:()=>h("name"),className:"flex items-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-gray-200",children:[r.jsx("span",{className:"hidden sm:inline",children:"Task "}),"Name",O("name")]})}),r.jsx("th",{className:"hidden sm:table-cell px-4 py-3 text-left",children:r.jsxs("button",{onClick:()=>h("category"),className:"flex items-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-gray-200",children:["Category",O("category")]})}),r.jsx("th",{className:"px-2 sm:px-4 py-3 text-left",children:r.jsxs("button",{onClick:()=>h("dueDate"),className:"flex items-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-gray-200",children:[r.jsx("span",{className:"hidden sm:inline",children:"Due "}),"Date",O("dueDate")]})}),r.jsx("th",{className:"px-2 sm:px-4 py-3 text-left",children:r.jsxs("button",{onClick:()=>h("status"),className:"flex items-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-gray-200",children:["Status",O("status")]})}),r.jsx("th",{className:"px-2 sm:px-4 py-3 text-right",children:r.jsx("span",{className:"sr-only",children:"Actions"})})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:t.map((e=>r.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors "+(i.includes(e.id)?"bg-blue-50 dark:bg-blue-900/20":""),children:[r.jsx("td",{className:"w-12 sm:w-8 px-2 sm:px-4 py-2",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("button",{onClick:()=>d(e.id),className:"p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:i.includes(e.id)?r.jsx(R,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-500 dark:text-blue-400"}):r.jsx(u,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 dark:text-gray-500"})})})}),r.jsx("td",{className:"px-2 sm:px-4 py-2",children:r.jsxs("div",{className:"max-w-xs sm:max-w-sm",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-1 sm:hidden",children:e.category.replace(/-/g," ")})]})}),r.jsxs("td",{className:"hidden sm:table-cell px-4 py-2",children:[r.jsx("div",{className:"text-sm capitalize text-gray-900 dark:text-white",children:e.category.replace(/-/g," ")}),e.priority&&r.jsx("div",{className:"mt-1",children:U(e.priority)})]}),r.jsx("td",{className:"px-2 sm:px-4 py-2",children:r.jsxs("span",{className:"text-xs sm:text-sm flex items-center gap-1 "+(E(e.dueDate,e.status)?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"),children:[E(e.dueDate,e.status)&&r.jsx(L,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),r.jsx("span",{className:"whitespace-nowrap",children:T(e.dueDate)})]})}),r.jsx("td",{className:"px-2 sm:px-4 py-2",children:r.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${D(e.status)}`,children:[C(e.status),r.jsx("span",{className:"hidden xs:inline",children:I(e.status)})]})}),r.jsx("td",{className:"px-2 sm:px-4 py-2 text-right",children:r.jsxs("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[r.jsx("button",{onClick:()=>F(e),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 "+(v===e.id?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":"hover:bg-gray-100 text-gray-500 dark:text-gray-400 dark:hover:bg-gray-700"),title:"Copy task details",children:v===e.id?r.jsx(x,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}):r.jsx($,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>f(e),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 hover:bg-blue-100 text-blue-600 dark:text-blue-400 dark:hover:bg-blue-900/30",title:"Edit task",children:r.jsx(A,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>s(e.id,{status:"completed"===e.status?"my-tasks":"completed"}),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 "+("completed"===e.status?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":"hover:bg-gray-100 text-gray-500 dark:text-gray-400 dark:hover:bg-gray-700"),title:"completed"===e.status?"Mark as incomplete":"Mark as complete",children:r.jsx(w,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>a(e.id),className:"p-1 sm:p-1.5 hover:bg-red-100 text-red-600 dark:hover:bg-red-900/30 dark:text-red-400 rounded-lg transition-colors duration-200",title:"Delete task",children:r.jsx(S,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})})]},e.id)))})]})})})}):r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:t.map((e=>r.jsxs("div",{className:"group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all "+(i.includes(e.id)?"ring-2 ring-blue-500 dark:ring-blue-400":""),children:[r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white line-clamp-2",children:e.name}),r.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:e.description})]})}),r.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-xs",children:[r.jsx("span",{className:"px-2 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.category}),r.jsx("span",{className:"px-2 py-1 rounded-md "+(E(e.dueDate)&&"completed"!==e.status?"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300"),children:T(e.dueDate)})]}),r.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[r.jsx("button",{onClick:()=>F(e),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 "+(v===e.id?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":"hover:bg-gray-100 text-gray-500 dark:text-gray-400 dark:hover:bg-gray-700"),title:"Copy task details",children:v===e.id?r.jsx(x,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}):r.jsx($,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>f(e),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 hover:bg-blue-100 text-blue-600 dark:text-blue-400 dark:hover:bg-blue-900/30",title:"Edit task",children:r.jsx(A,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>s(e.id,{status:"completed"===e.status?"my-tasks":"completed"}),className:"p-1 sm:p-1.5 rounded-lg transition-colors duration-200 "+("completed"===e.status?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":"hover:bg-gray-100 text-gray-500 dark:text-gray-400 dark:hover:bg-gray-700"),title:"completed"===e.status?"Mark as incomplete":"Mark as complete",children:r.jsx(w,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{onClick:()=>a(e.id),className:"p-1 sm:p-1.5 hover:bg-red-100 text-red-600 dark:hover:bg-red-900/30 dark:text-red-400 rounded-lg transition-colors duration-200",title:"Delete task",children:r.jsx(S,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]},e.id)))}),y&&r.jsx(Z,{task:y,onClose:()=>f(null),onUpdate:async(e,r)=>{try{await s(e,r),f(null)}catch(t){console.error("Error updating task:",t)}},isSectionAdmin:l})]})}function Y({tasks:t,onCreateTask:a,onDeleteTask:s,onUpdateTask:l,showTaskForm:n=!1,sectionId:i,isSectionAdmin:o=!1,isLoading:d=!1,isCreatingTask:c=!1,onTaskCreateStart:m,onTaskCreateEnd:u,onRefresh:x}){const[g,p]=e.useState(!0),[f,k]=e.useState(!1),[v,w]=e.useState("table"),[D,C]=e.useState({category:"all",status:"all",search:"",startDate:"",endDate:""}),[E,T]=e.useState({by:"createdAt",order:"desc"}),[L,$]=e.useState([]),[A,_]=e.useState(!1),[B,q]=e.useState([]),[V,K]=e.useState(0),H=e.useRef(null),[W,Q]=e.useState(""),Z=e.useRef(!1),Y=e.useRef([]);e.useEffect((()=>{p(!0)}),[n]),e.useEffect((()=>{if(!Z.current&&t!==Y.current){const e=Date.now();e-V>100&&(q(t),K(e),Y.current=t)}}),[t,V]),e.useEffect((()=>(H.current&&window.clearTimeout(H.current),H.current=window.setTimeout((()=>{Q(D.search)}),300),()=>{H.current&&window.clearTimeout(H.current)})),[D.search]);const ee=e.useMemo((()=>B.filter((e=>{if("all"!==D.category&&e.category!==D.category)return!1;if("all"!==D.status&&e.status!==D.status)return!1;if(D.startDate&&new Date(e.dueDate)<new Date(D.startDate))return!1;if(D.endDate){const r=new Date(D.endDate);if(r.setHours(23,59,59,999),new Date(e.dueDate)>r)return!1}if(W){const r=W.toLowerCase();return e.name.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||e.category.toLowerCase().includes(r)}return!0}))),[B,D.category,D.status,D.startDate,D.endDate,W]),re=e.useMemo((()=>[...ee].sort(((e,r)=>{let t=0;switch(E.by){case"dueDate":t=new Date(e.dueDate).getTime()-new Date(r.dueDate).getTime();break;case"name":t=e.name.localeCompare(r.name);break;case"category":t=e.category.localeCompare(r.category);break;case"createdAt":t=(e.createdAt?new Date(e.createdAt).getTime():Date.now())-(r.createdAt?new Date(r.createdAt).getTime():Date.now());break;case"priority":const a={high:3,medium:2,low:1},s=e.priority||"medium",l=r.priority||"medium";t=(a[s]||0)-(a[l]||0)}return"asc"===E.order?t:-t}))),[ee,E.by,E.order]),te=e.useCallback((async e=>{if(Z.current)console.log("Task creation already in progress");else{Z.current=!0;try{null==m||m();const r={...e};if(o&&i){const e={...r,sectionId:i};await a(e,i)}else await a(r);C({category:"all",status:"all",startDate:"",endDate:"",search:""}),I("Task created successfully")}catch(r){console.error("Error creating task:",r),U(`Failed to create task: ${r.message||"Please try again."}`)}finally{Z.current=!1,null==u||u()}}}),[o,a,i,m,u]),ae=e.useCallback((async e=>{if(!Z.current){Z.current=!0;try{await s(e),q((r=>r.filter((r=>r.id!==e)))),I("Task deleted successfully")}catch(r){console.error("Error deleting task:",r),U(`Error deleting task: ${r.message||"Please try again."}`)}finally{Z.current=!1}}}),[s]),se=e.useCallback((async(e,r)=>{if(!Z.current){Z.current=!0;try{await l(e,r),q((t=>t.map((t=>t.id===e?{...t,...r,updatedAt:(new Date).toISOString()}:t)))),I("Task updated successfully")}catch(t){console.error("Error updating task:",t),U(`Error updating task: ${t.message||"Please try again."}`)}finally{Z.current=!1}}}),[l]),le=async e=>{if(0!==L.length&&!A){_(!0);try{let t=0;const a=[];for(const s of L)try{await l(s,{status:e,updatedAt:(new Date).toISOString()}),t++,q((r=>r.map((r=>r.id===s?{...r,status:e,updatedAt:(new Date).toISOString()}:r))))}catch(r){a.push(`Task ${s}: ${r.message}`)}t>0&&I(`Updated ${t} tasks to ${e}`),a.length>0&&U(`Failed to update ${a.length} tasks`),$([])}catch(r){U(`Error updating task status: ${r.message||"Please try again."}`)}finally{_(!1)}}};return r.jsxs("div",{className:"space-y-4",children:[g&&r.jsx("div",{children:r.jsx(X,{onSubmit:te,sectionId:i,isSectionAdmin:o,isSubmitting:c})}),r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm",children:r.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"flex flex-col space-y-3 sm:space-y-0 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("button",{className:"inline-flex items-center justify-center px-3 sm:px-4 py-1.5 sm:py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",onClick:()=>p(!g),disabled:d,children:g?r.jsxs(r.Fragment,{children:[r.jsx(O,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1"}),r.jsx("span",{className:"hidden xs:inline",children:"Hide Form"}),r.jsx("span",{className:"xs:hidden",children:"Hide"})]}):r.jsxs(r.Fragment,{children:[r.jsx(j,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1"}),r.jsx("span",{className:"hidden xs:inline",children:"Create Task"}),r.jsx("span",{className:"xs:hidden",children:"Create"})]})}),r.jsxs("button",{className:`\n                  inline-flex items-center justify-center px-3 sm:px-4 py-1.5 sm:py-2 text-sm font-medium rounded-lg transition-colors duration-200\n                  ${d?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":f?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"}\n                `,onClick:()=>k(!f),disabled:d,children:[r.jsx(F,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1"}),r.jsx("span",{className:"hidden xs:inline",children:"Filters"})]}),r.jsxs("div",{className:"inline-flex rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[r.jsx("button",{className:"px-2 sm:px-3 py-1.5 sm:py-2 rounded-l-lg transition-colors duration-200 "+("table"===v?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-700"),onClick:()=>w("table"),title:"Table view",children:r.jsx(b,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r.jsx("button",{className:"px-2 sm:px-3 py-1.5 sm:py-2 rounded-r-lg transition-colors duration-200 "+("grid"===v?"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-700"),onClick:()=>w("grid"),title:"Grid view",children:r.jsx(h,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),r.jsxs("button",{className:"inline-flex items-center justify-center px-3 sm:px-4 py-1.5 sm:py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{try{const e=["Name","Category","Due Date","Status","Description"],r=re.map((e=>[`"${e.name.replace(/"/g,'""')}"`,`"${e.category.replace(/"/g,'""')}"`,`"${new Date(e.dueDate).toLocaleDateString()}"`,`"${"my-tasks"===e.status?"To Do":"in-progress"===e.status?"In Progress":"Completed"}"`,`"${e.description.replace(/"/g,'""')}"`])),t=[e.join(","),...r.map((e=>e.join(",")))].join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",`tasks_export_${i?`section_${i}_`:""}${(new Date).toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s),I("Tasks exported successfully")}catch(e){U("Failed to export tasks. Please try again.")}},disabled:d||0===re.length,title:"Export to CSV",children:[r.jsx(P,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1"}),r.jsx("span",{className:"hidden xs:inline",children:"Export"})]}),x&&r.jsxs("button",{className:"inline-flex items-center justify-center px-3 sm:px-4 py-1.5 sm:py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",onClick:x,disabled:d,title:"Refresh tasks",children:[r.jsx(G,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1 "+(d?"animate-spin":"")}),r.jsx("span",{className:"hidden xs:inline",children:"Refresh"})]})]}),r.jsx("div",{className:"relative w-full sm:w-auto sm:min-w-[200px] md:min-w-[240px]",children:r.jsxs("div",{className:"flex items-center w-full px-3 py-1.5 sm:py-2 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700 focus-within:border-blue-500 dark:focus-within:border-blue-400 transition-colors duration-200",children:[r.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 dark:text-gray-500"}),r.jsx("input",{type:"text",placeholder:"Search tasks...",value:D.search,onChange:e=>C({...D,search:e.target.value}),className:"w-full ml-2 text-sm bg-transparent border-none outline-none focus:ring-0 text-gray-700 dark:text-gray-300 placeholder-gray-500 dark:placeholder-gray-400"}),D.search&&r.jsx("button",{onClick:()=>C({...D,search:""}),className:"p-0.5 sm:p-1 ml-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:r.jsx(N,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})})]})})}),f&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-3 sm:p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[r.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filter Tasks"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("button",{onClick:()=>{C({category:"all",status:"all",startDate:"",endDate:"",search:""}),Q(""),T({by:"createdAt",order:"desc"})},className:"text-xs flex items-center gap-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 py-1 px-2",children:[r.jsx(y,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),"Reset"]})})]}),r.jsxs("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),r.jsxs("select",{value:D.status,onChange:e=>C({...D,status:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-sm",children:[r.jsx("option",{value:"all",children:"All Statuses"}),r.jsx("option",{value:"my-tasks",children:"To Do"}),r.jsx("option",{value:"in-progress",children:"In Progress"}),r.jsx("option",{value:"completed",children:"Completed"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),r.jsxs("select",{value:D.category,onChange:e=>C({...D,category:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-sm",children:[r.jsx("option",{value:"all",children:"All Categories"}),r.jsx("option",{value:"assignment",children:"Assignment"}),r.jsx("option",{value:"blc",children:"BLC"}),r.jsx("option",{value:"documents",children:"Documents"}),r.jsx("option",{value:"final-exam",children:"Final Exam"}),r.jsx("option",{value:"groups",children:"Groups"}),r.jsx("option",{value:"lab-final",children:"Lab Final"}),r.jsx("option",{value:"lab-performance",children:"Lab Performance"}),r.jsx("option",{value:"lab-report",children:"Lab Report"}),r.jsx("option",{value:"midterm",children:"Midterm"}),r.jsx("option",{value:"presentation",children:"Presentation"}),r.jsx("option",{value:"project",children:"Project"}),r.jsx("option",{value:"quiz",children:"Quiz"}),r.jsx("option",{value:"task",children:"Task"}),r.jsx("option",{value:"others",children:"Others"})]})]}),r.jsxs("div",{className:"xs:col-span-2",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date Range"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("div",{children:r.jsx("input",{type:"date",value:D.startDate,onChange:e=>C({...D,startDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-sm",placeholder:"Start date"})}),r.jsx("div",{children:r.jsx("input",{type:"date",value:D.endDate,onChange:e=>C({...D,endDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-sm",placeholder:"End date"})})]})]})]})]}),L.length>0&&r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-2 sm:p-3 flex flex-wrap items-center justify-between gap-2 sm:gap-3",children:[r.jsx("div",{className:"flex items-center",children:r.jsxs("span",{className:"text-xs sm:text-sm font-medium text-blue-700 dark:text-blue-300",children:[L.length," ",1===L.length?"task":"tasks"," selected"]})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[r.jsxs("button",{onClick:()=>le("completed"),disabled:A,className:"px-2 py-1 sm:px-2.5 sm:py-1.5 text-xs bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed flex items-center gap-1",children:[r.jsx(R,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),r.jsx("span",{className:"hidden xs:inline",children:"Complete"})]}),r.jsxs("button",{onClick:()=>le("in-progress"),disabled:A,className:"px-2 py-1 sm:px-2.5 sm:py-1.5 text-xs bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:bg-yellow-300 disabled:cursor-not-allowed flex items-center gap-1",children:[r.jsx(R,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),r.jsx("span",{className:"hidden xs:inline",children:"Progress"})]}),r.jsxs("button",{onClick:async()=>{if(L.length&&!A)try{_(!0);let r=0;const t=[];for(const a of L)try{await s(a),r++,q((e=>e.filter((e=>e.id!==a))))}catch(e){t.push(`Task ${a}: ${e.message}`)}r>0&&I(`${r} tasks deleted successfully`),t.length>0&&U(`Failed to delete ${t.length} tasks`),$([])}catch(e){U(`Error deleting tasks: ${e.message||"Please try again."}`)}finally{_(!1)}},disabled:A,className:"px-2 py-1 sm:px-2.5 sm:py-1.5 text-xs bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed flex items-center gap-1",children:[r.jsx(S,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),r.jsx("span",{className:"hidden xs:inline",children:"Delete"})]}),r.jsx("button",{onClick:()=>$([]),disabled:A,className:"px-2 py-1 sm:px-2.5 sm:py-1.5 text-xs bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Cancel"})]})]}),d?r.jsx("div",{className:"p-8 flex justify-center items-center",children:r.jsx(z,{className:"w-8 h-8 text-blue-500 animate-spin"})}):r.jsxs(r.Fragment,{children:[r.jsx(J,{tasks:re,onDeleteTask:ae,onUpdateTask:se,isSectionAdmin:o,viewMode:v,selectedTaskIds:L,onToggleSelection:e=>{$((r=>r.includes(e)?r.filter((r=>r!==e)):[...r,e]))},onSelectAll:()=>{$((e=>e.length===re.length?[]:re.map((e=>e.id))))},sortBy:E.by,sortOrder:E.order,onSort:e=>{"createdAt"!==e&&"dueDate"!==e&&"name"!==e&&"category"!==e&&"priority"!==e||T((r=>({by:e,order:r.by===e&&"asc"===r.order?"desc":"asc"})))}}),0===re.length&&!d&&r.jsx("div",{className:"p-8 text-center",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No tasks found. Try adjusting your filters or create a new task."})})]})]})}export{Y as TaskManager};
